
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="꿈꾸는 태태태의 공간">
    <title>Oracle + Mybatis 환경에서의 Date 다루기 - 꿈꾸는 태태태의 공간</title>
    <meta name="author" content="taetaetae">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"taetaetae","sameAs":["https://facebook.com/taetaetae0","https://www.linkedin.com/in/태관-권-517825129/","mailto:taetaetae_@naver.com"],"image":"profile.jpg"},"articleBody":"# 상황\nOracle, Java 8, mybatis3 환경\nDate컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함.\n쿼리에 아무 기능을 추가하지 않고 Date 형태로 Model에 바인딩을 하면 시분초가 없어진 2017-01-01 00:00:00 형태로 남게됨\n그래서 아래처럼 쿼리 작성할 때마다 TO_CHAR를 사용해서 포맷에 맞추어 형변환을 시키고 Date 또는 String으로 Model에 바인딩 하곤 했음.\n\n1234SELECTTO_CHAR(reg_ymdt, 'YYYY-MM-DD HH24:MI:SS') AS registDateFROM...\n\n이렇게 하다보니 query 만들때마다 형변환하는 쿼리를 만들어줘야하고, 자칫 포맷형식을 다르게 적으면 엉뚱한 결과를 초래하거나, Date형을 그대로 받아 사용해야하는 상황에서는 다시 형변환하는 과정(String to Date)을 해줘야만 함. .. 귀차니즘의 시작 : 삽질\n\n1. 삽질의 시작1-1. 오라클의 DATE형 → java.sql.Date 의 경우\nmybatis에서는 자동적으로 org.apache.ibatis.type.SqlDateTypeHandler를 호출하게됨 mybatis 3 문서 참고\n해당 핸들러의 내부 데이터 변환 코드는 다음과 같음\n\n1234@Overridepublic Date getNullableResult(ResultSet rs, String columnName)  throws SQLException &#123;\treturn rs.getDate(columnName);&#125;\n\njava.sql.ResultSet.getDate()메소드를 호출하면 실제 ‘yyyy-mm-dd’ 만 가져와 리턴하게됨 (여기서 디버깅 해보면 rs.getTimestamp(columnName)값은 시분초까지 다 들어가 있음)\n따라서 시간값이 없는 yyyy-mm-dd 형태로 리턴이 됨1-2. 오라클의 DATE형 → java.util.Date 의 경우\nmybatis에서는 자동적으로 org.apache.ibatis.type.DateOnlyTypeHandler를 호출하게됨 mybatis 3 문서 참고\n해당 핸들러의 내부 데이터 변환 코드는 다음과 같음\n\n12345678@Overridepublic Date getNullableResult(ResultSet rs, String columnName)  throws SQLException &#123;\tjava.sql.Date sqlDate = rs.getDate(columnName);\tif (sqlDate != null) &#123;\t\treturn new java.util.Date(sqlDate.getTime());\t&#125;\treturn null;&#125;\n\n위의 org.apache.ibatis.type.SqlDateTypeHandler 변환코드에서 발생한 문제점과 같이 yyyy-mm-dd 만 가져와서 java.sql.Date 객체를 만들고, 이 정보를 토대로 java.util.Date 객체를 만들게 되는데 앞서 시간값을 뺀 정보로 만들어졌기 때문에 결국 동일하게 yyyy-mm-dd 형태로 리턴이 됨\n\n2. 삽질완료, 해결의 시작\n오라클 + mybatis 환경에서 Date타입을 다루기 위해서는 타입핸들러를 명시적으로 만들어줘야 한다는걸 알게됨.2-1. 오라클의 DATE형 → java.sql.Date 의 경우\n아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다.\nmybatis-config.xml\n\n123&lt;typeHandlers&gt;\t&lt;typeHandler handler=\"com.naver.dbill.admin.common.handler.CustomDateHandler\"/&gt;&lt;/typeHandlers&gt;\n\nCustomDateHandler.java\n\n123456789101112131415...import java.sql.Date;...public class CustomDateHandler extends BaseTypeHandler&lt;Date&gt; &#123;\t...\t@Override\tpublic Date getNullableResult(ResultSet rs, String columnName) throws SQLException &#123;\t\tTimestamp sqlTimestamp = rs.getTimestamp(columnName);\t\tif (sqlTimestamp != null) &#123;\t\t\treturn new Date(sqlTimestamp.getTime());\t\t&#125;\t\treturn null;\t&#125;\t...&#125;\n\n위 코드를 작성하고 실행해보면 정상적으로 시분초 값이 있는 완전한 Date 형태를 볼수 있다.2-2. 오라클의 DATE형 → java.util.Date 의 경우\n아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다.\n단, mybatis 3 문서를 보면 java.sql.Date 와는 다르게 기본으로 설정된 typeHandler가 JDBC에 따라 3가지가 있다.\n따라서 작성한 커스텀 핸들러를 적용하기 위해서는 명시적으로 자바타입 과 JDBC타입 을 적어줘야 정상적으로 오버라이딩이 되어 해당 핸들러를 사용하게 된다.\nmybatis-config.xml\n\n123&lt;typeHandlers&gt;\t\t&lt;typeHandler handler=\"com.naver.dbill.admin.common.handler.CustomDateHandler\" javaType=\"java.util.Date\" jdbcType=\"DATE\"/&gt;&lt;/typeHandlers&gt;\n\nCustomDateHandler.java 는 위와 동일하다. ( import java.util.Date; 사용으로 변경 )\n\n# 삽질하며 알게된 보너스 지식\njava.sql.Date 는 java.util.Date 을 상속받았다.\n\n12public class Date extends java.util.Date &#123;&#125;\n\n검색을 하다보면 알수있겠지만  java.sql.Date 는 JDBC등을 이용해서 데이터베이스의 데이터를 사용하는데 적합하고, java.util.Date 은 보다 범용적인 날짜나 시각정보를 다룰때 적합하다고 한다.\ntoString 메소드의 리턴 Format 형태\njava.sql.Date : yyyy-mm-dd\njava.util.Date : EEE MMM dd HH:mm:ss zzz yyyy\n\n\nmybatis 에서 형변환은 mybatis 3 문서에 나와있는 자바타입과 JDBC타입이 일치할 경우에 해당 타입 핸들러를 기본으로 사용하게 된다.\n\n# 정상혁 님 조언 ( http://d2.naver.com/helloworld/645609 작성하신분 )\nOracle의 JDBC 드라이버가 예상 밖으로 동작하네요. Oracle의 DATE 타입도 문서를 보니 시분초까지 저장하게 되어 있는데, Oracle JDBC 구현체가 DATE 타입의 철학을 오해한게 아닌가하는 생각도 듭니다.\n참고로 java.sql.Date, java.sql.TimeStamp는 잘못된 설계라는 비판이 많습니다.\n저도 Java의 날짜와 시간 API 라는 글에서 아래와 같이 적은 적이 있습니다.\n\n123java.sql.Date 클래스는 상위 클래스인 java.util.Date 클래스와 이름이 같다. 이 클래스를 두고 Java 플랫폼 설계자는 클래스 이름을 지으면서 깜빡 존 듯하다는 조롱까지 나왔다.[24]그리고 이 클래스는 Comparable 인터페이스에 대한 정의를 클래스 선언에서 하지 않았기 때문에 Comparable과 관련된 Generics 선언을 복잡하게 만들었다.[25]java.sql.TimeStamp 클래스는 java.util.Date 클래스에 나노초(nanosecond) 필드를 더한 클래스이다. 이 클래스는 equals() 선언의 대칭성을 어겼다. Date 타입과 TimeStamp 타입을 섞어 쓰면 a.equals(b)가 true라도 b.equals(a)는 false인 경우가 생길 수 있다.[26]\n\n이런 이유 때문에 저는 가급적 Java8에 나온 ZonedDateTime 류를 모델객체에서는 쓰고 있기는합니다. 하지만 그 클래스도 JDBC 레벨에서 제대로 매핑을 안 해주는 경우가 있어서 converter, typeHandler류를 따로 만들어야합니다. 참고로 Spring JDBC에서는 아래와 같이 Converter를 만들어서 해결했습니다.\n\n123456public class ZonedDateTimeConverter implements Converter&lt;Timestamp, ZonedDateTime&gt; &#123;  @Override  public ZonedDateTime convert(Timestamp source) &#123;      return ZonedDateTime.ofInstant(source.toInstant(), ZoneId.of(\"UTC\"));  &#125;&#125;\n\njava.sql.Date vs java.util.Date 둘 중에 선택한다면 모델 객체에서는 java.util.Date가 더 어울린다는 생각이 듭니다.  모델에 java.sql.Date가 있는 것은  Controller에서 SqlException이 있는 것 같은 비슷한 느낌이랄까요..^^;\n\n# 마치며\n삽질을 하더라도 가급적이면 영양가 있는 삽질이 되야 할것같다. (하루종일 이것 붙잡다가 업무를 못해버리는;;)\nAPI문서, 블로그문서, 검색결과에 맹신하지말고 실제 소스까지 들어가봐서 확신을 갖자.\n\n","dateCreated":"2017-03-23T11:16:05+09:00","dateModified":"2019-05-30T17:14:52+09:00","datePublished":"2017-03-23T11:16:05+09:00","description":"# 상황\nOracle, Java 8, mybatis3 환경\nDate컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함.","headline":"Oracle + Mybatis 환경에서의 Date 다루기","image":[null,"oracle_mybatis_date.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/"},"publisher":{"@type":"Organization","name":"taetaetae","sameAs":["https://facebook.com/taetaetae0","https://www.linkedin.com/in/태관-권-517825129/","mailto:taetaetae_@naver.com"],"image":"profile.jpg","logo":{"@type":"ImageObject","url":"profile.jpg"}},"url":"https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/","keywords":"date, mybatis, oracle","thumbnailUrl":"oracle_mybatis_date.png"}</script>
    <meta name="description" content="# 상황 Oracle, Java 8, mybatis3 환경 Date컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함.">
<meta name="keywords" content="date,mybatis,oracle">
<meta property="og:type" content="blog">
<meta property="og:title" content="Oracle + Mybatis 환경에서의 Date 다루기">
<meta property="og:url" content="https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/index.html">
<meta property="og:site_name" content="꿈꾸는 태태태의 공간">
<meta property="og:description" content="# 상황 Oracle, Java 8, mybatis3 환경 Date컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함.">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-05-30T08:14:52.072Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Oracle + Mybatis 환경에서의 Date 다루기">
<meta name="twitter:description" content="# 상황 Oracle, Java 8, mybatis3 환경 Date컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함.">
    
    
        
    
    
        <meta property="og:image" content="https://taetaetae.github.io/assets/images/profile.jpg"/>
    
    
    
    
        <meta property="og:image" content="https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/oracle_mybatis_date.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/oracle_mybatis_date.png" />
    

    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-86432198-1', 'auto');
        ga('send', 'pageview');
    </script>


    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: "ca-pub-5788330009690816",
  enable_page_level_ads: true
  });
</script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">꿈꾸는 태태태의 공간</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">taetaetae</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Programmer</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/taetaetae0" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/태관-권-517825129/" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:taetaetae_@naver.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>    
    <ins class="adsbygoogle"
   style="display:inline-block;max-width:250px;width:100%;max-height:380px;height:100%"
   data-ad-client="ca-pub-5788330009690816">
</ins>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</nav>

            
        <div class="post-header-cover
                    text-left
                    "
             style="background-image:url('/2017/03/23/oracle-mybatis-date/oracle_mybatis_date.png');"
             data-behavior="5">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Oracle + Mybatis 환경에서의 Date 다루기
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2017-03-23T11:16:05+09:00">
	
		    Mar 23, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/tech/">tech</a>


    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="5"
                 class="hasCover
                        hasCoverMetaIn
                        ">
                
<article class="post">
    <div class="main-content-wrap">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5788330009690816"
     data-ad-slot="9180895229"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h3 id="상황"><a href="#상황" class="headerlink" title="# 상황"></a># 상황</h3><ul>
<li>Oracle, Java 8, mybatis3 환경</li>
<li>Date컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함.<a id="more"></a></li>
<li>쿼리에 아무 기능을 추가하지 않고 Date 형태로 Model에 바인딩을 하면 시분초가 없어진 <code>2017-01-01 00:00:00</code> 형태로 남게됨</li>
<li>그래서 아래처럼 쿼리 작성할 때마다 TO_CHAR를 사용해서 포맷에 맞추어 형변환을 시키고 Date 또는 String으로 Model에 바인딩 하곤 했음.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">TO_CHAR(reg_ymdt, <span class="string">'YYYY-MM-DD HH24:MI:SS'</span>) <span class="keyword">AS</span> registDate</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li>이렇게 하다보니 query 만들때마다 형변환하는 쿼리를 만들어줘야하고, 자칫 포맷형식을 다르게 적으면 엉뚱한 결과를 초래하거나, Date형을 그대로 받아 사용해야하는 상황에서는 다시 형변환하는 과정(<code>String to Date</code>)을 해줘야만 함. .. <code>귀차니즘의 시작 : 삽질</code></li>
</ul>
<h3 id="1-삽질의-시작"><a href="#1-삽질의-시작" class="headerlink" title="1. 삽질의 시작"></a>1. 삽질의 시작</h3><h4 id="1-1-오라클의-DATE형-→-java-sql-Date-의-경우"><a href="#1-1-오라클의-DATE형-→-java-sql-Date-의-경우" class="headerlink" title="1-1. 오라클의 DATE형 → java.sql.Date 의 경우"></a>1-1. <code>오라클의 DATE형</code> → <code>java.sql.Date</code> 의 경우</h4><ul>
<li>mybatis에서는 자동적으로 <code>org.apache.ibatis.type.SqlDateTypeHandler</code>를 호출하게됨 <a href="http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers" target="_blank" rel="noopener">mybatis 3 문서 참고</a></li>
<li>해당 핸들러의 내부 데이터 변환 코드는 다음과 같음</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span>  <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> rs.getDate(columnName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>java.sql.ResultSet.getDate()</code>메소드를 호출하면 실제 ‘yyyy-mm-dd’ 만 가져와 리턴하게됨 (여기서 디버깅 해보면 rs.getTimestamp(columnName)값은 시분초까지 다 들어가 있음)</li>
<li>따라서 시간값이 없는 <code>yyyy-mm-dd</code> 형태로 리턴이 됨<h4 id="1-2-오라클의-DATE형-→-java-util-Date-의-경우"><a href="#1-2-오라클의-DATE형-→-java-util-Date-의-경우" class="headerlink" title="1-2. 오라클의 DATE형 → java.util.Date 의 경우"></a>1-2. <code>오라클의 DATE형</code> → <code>java.util.Date</code> 의 경우</h4></li>
<li>mybatis에서는 자동적으로 <code>org.apache.ibatis.type.DateOnlyTypeHandler</code>를 호출하게됨 <a href="http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers" target="_blank" rel="noopener">mybatis 3 문서 참고</a></li>
<li>해당 핸들러의 내부 데이터 변환 코드는 다음과 같음</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span>  <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">	java.sql.Date sqlDate = rs.getDate(columnName);</span><br><span class="line">	<span class="keyword">if</span> (sqlDate != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> java.util.Date(sqlDate.getTime());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>위의 <code>org.apache.ibatis.type.SqlDateTypeHandler</code> 변환코드에서 발생한 문제점과 같이 <code>yyyy-mm-dd</code> 만 가져와서 java.sql.Date 객체를 만들고, 이 정보를 토대로 java.util.Date 객체를 만들게 되는데 앞서 시간값을 뺀 정보로 만들어졌기 때문에 결국 동일하게 <code>yyyy-mm-dd</code> 형태로 리턴이 됨</li>
</ul>
<h3 id="2-삽질완료-해결의-시작"><a href="#2-삽질완료-해결의-시작" class="headerlink" title="2. 삽질완료, 해결의 시작"></a>2. 삽질완료, 해결의 시작</h3><ul>
<li>오라클 + mybatis 환경에서 Date타입을 다루기 위해서는 타입핸들러를 명시적으로 만들어줘야 한다는걸 알게됨.<h4 id="2-1-오라클의-DATE형-→-java-sql-Date-의-경우"><a href="#2-1-오라클의-DATE형-→-java-sql-Date-의-경우" class="headerlink" title="2-1. 오라클의 DATE형 → java.sql.Date 의 경우"></a>2-1. <code>오라클의 DATE형</code> → <code>java.sql.Date</code> 의 경우</h4></li>
<li>아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다.</li>
<li>mybatis-config.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"com.naver.dbill.admin.common.handler.CustomDateHandler"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>CustomDateHandler.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomDateHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		Timestamp sqlTimestamp = rs.getTimestamp(columnName);</span><br><span class="line">		<span class="keyword">if</span> (sqlTimestamp != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Date(sqlTimestamp.getTime());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>위 코드를 작성하고 실행해보면 정상적으로 시분초 값이 있는 완전한 Date 형태를 볼수 있다.<h4 id="2-2-오라클의-DATE형-→-java-util-Date-의-경우"><a href="#2-2-오라클의-DATE형-→-java-util-Date-의-경우" class="headerlink" title="2-2. 오라클의 DATE형 → java.util.Date 의 경우"></a>2-2. <code>오라클의 DATE형</code> → <code>java.util.Date</code> 의 경우</h4></li>
<li>아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다.</li>
<li>단, <a href="http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers" target="_blank" rel="noopener">mybatis 3 문서</a>를 보면 <code>java.sql.Date</code> 와는 다르게 기본으로 설정된 typeHandler가 JDBC에 따라 3가지가 있다.</li>
<li>따라서 작성한 커스텀 핸들러를 적용하기 위해서는 명시적으로 <code>자바타입</code> 과 <code>JDBC타입</code> 을 적어줘야 정상적으로 오버라이딩이 되어 해당 핸들러를 사용하게 된다.</li>
<li>mybatis-config.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"com.naver.dbill.admin.common.handler.CustomDateHandler"</span> <span class="attr">javaType</span>=<span class="string">"java.util.Date"</span> <span class="attr">jdbcType</span>=<span class="string">"DATE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>CustomDateHandler.java 는 위와 동일하다. ( import java.util.Date; 사용으로 변경 )</li>
</ul>
<h3 id="삽질하며-알게된-보너스-지식"><a href="#삽질하며-알게된-보너스-지식" class="headerlink" title="# 삽질하며 알게된 보너스 지식"></a># 삽질하며 알게된 보너스 지식</h3><ul>
<li><code>java.sql.Date</code> 는 <code>java.util.Date</code> 을 상속받았다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Date</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">util</span>.<span class="title">Date</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>검색을 하다보면 알수있겠지만  <code>java.sql.Date</code> 는 JDBC등을 이용해서 데이터베이스의 데이터를 사용하는데 적합하고, <code>java.util.Date</code> 은 보다 범용적인 날짜나 시각정보를 다룰때 적합하다고 한다.</li>
<li>toString 메소드의 리턴 Format 형태<ul>
<li><code>java.sql.Date</code> : yyyy-mm-dd</li>
<li><code>java.util.Date</code> : EEE MMM dd HH:mm:ss zzz yyyy</li>
</ul>
</li>
<li>mybatis 에서 형변환은 <a href="http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers" target="_blank" rel="noopener">mybatis 3 문서</a>에 나와있는 자바타입과 JDBC타입이 일치할 경우에 해당 타입 핸들러를 기본으로 사용하게 된다.</li>
</ul>
<h3 id="정상혁-님-조언-http-d2-naver-com-helloworld-645609-작성하신분"><a href="#정상혁-님-조언-http-d2-naver-com-helloworld-645609-작성하신분" class="headerlink" title="# 정상혁 님 조언 ( http://d2.naver.com/helloworld/645609 작성하신분 )"></a># 정상혁 님 조언 ( <a href="http://d2.naver.com/helloworld/645609" target="_blank" rel="noopener">http://d2.naver.com/helloworld/645609</a> 작성하신분 )</h3><ul>
<li>Oracle의 JDBC 드라이버가 예상 밖으로 동작하네요. Oracle의 DATE 타입도 문서를 보니 시분초까지 저장하게 되어 있는데, Oracle JDBC 구현체가 DATE 타입의 철학을 오해한게 아닌가하는 생각도 듭니다.</li>
<li>참고로 java.sql.Date, java.sql.TimeStamp는 잘못된 설계라는 비판이 많습니다.</li>
<li>저도 Java의 날짜와 시간 API 라는 글에서 아래와 같이 적은 적이 있습니다.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.sql.Date 클래스는 상위 클래스인 java.util.Date 클래스와 이름이 같다. 이 클래스를 두고 Java 플랫폼 설계자는 클래스 이름을 지으면서 깜빡 존 듯하다는 조롱까지 나왔다.[24]</span><br><span class="line">그리고 이 클래스는 Comparable 인터페이스에 대한 정의를 클래스 선언에서 하지 않았기 때문에 Comparable과 관련된 Generics 선언을 복잡하게 만들었다.[25]</span><br><span class="line">java.sql.TimeStamp 클래스는 java.util.Date 클래스에 나노초(nanosecond) 필드를 더한 클래스이다. 이 클래스는 equals() 선언의 대칭성을 어겼다. Date 타입과 TimeStamp 타입을 섞어 쓰면 a.equals(b)가 true라도 b.equals(a)는 false인 경우가 생길 수 있다.[26]</span><br></pre></td></tr></table></figure>
<ul>
<li>이런 이유 때문에 저는 가급적 Java8에 나온 ZonedDateTime 류를 모델객체에서는 쓰고 있기는합니다. 하지만 그 클래스도 JDBC 레벨에서 제대로 매핑을 안 해주는 경우가 있어서 converter, typeHandler류를 따로 만들어야합니다. 참고로 Spring JDBC에서는 아래와 같이 Converter를 만들어서 해결했습니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZonedDateTimeConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">Timestamp</span>, <span class="title">ZonedDateTime</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ZonedDateTime <span class="title">convert</span><span class="params">(Timestamp source)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> ZonedDateTime.ofInstant(source.toInstant(), ZoneId.of(<span class="string">"UTC"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>java.sql.Date vs java.util.Date 둘 중에 선택한다면 모델 객체에서는 java.util.Date가 더 어울린다는 생각이 듭니다.  모델에 java.sql.Date가 있는 것은  Controller에서 SqlException이 있는 것 같은 비슷한 느낌이랄까요..^^;</li>
</ul>
<h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><ul>
<li>삽질을 하더라도 가급적이면 영양가 있는 삽질이 되야 할것같다. (하루종일 이것 붙잡다가 업무를 못해버리는;;)</li>
<li>API문서, 블로그문서, 검색결과에 맹신하지말고 실제 소스까지 들어가봐서 확신을 갖자.</li>
</ul>

            

        </div>
    </div>
    <style>.bmc-button img{width: 27px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-flex !important;color:#000000 !important;background-color:#FFDD00 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 22px !important;letter-spacing: 0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#000000 !important;}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><center><br><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/taetaetae"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me a coffee"><span style="margin-left:5px">Buy me a coffee</span></a>
    <!--<br><a href="http://www.naver.com"><img src="https://i.imgur.com/ietEvly.png" style="height:46px"></a>-->
    </center>
    <div id="post-footer" class="post-footer main-content-wrap">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5788330009690816"
     data-ad-slot="9180895229"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/date/">date</a> <a class="tag tag--primary tag--small t-link" href="/tags/mybatis/">mybatis</a> <a class="tag tag--primary tag--small t-link" href="/tags/oracle/">oracle</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/04/mybatis-useGeneratedKeys/" data-tooltip="mybatis insert/update 쿼리실행후 결과 가져오기" aria-label="PREVIOUS: mybatis insert/update 쿼리실행후 결과 가져오기">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/03/12/spring-parameter/" data-tooltip="스프링환경에서의 파라미터 관련 정리" aria-label="NEXT: 스프링환경에서의 파라미터 관련 정리">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/" title="Share on Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
        <!-- 
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
        -->

        <!--  utteranc comment -->
        
        <script src="https://utteranc.es/client.js"
                repo="taetaetae/blog-comment"
                issue-term="title"
                label="Comment"
                theme="github-light"
                crossorigin="anonymous"
                async>
        </script>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 taetaetae. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/04/mybatis-useGeneratedKeys/" data-tooltip="mybatis insert/update 쿼리실행후 결과 가져오기" aria-label="PREVIOUS: mybatis insert/update 쿼리실행후 결과 가져오기">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/03/12/spring-parameter/" data-tooltip="스프링환경에서의 파라미터 관련 정리" aria-label="NEXT: 스프링환경에서의 파라미터 관련 정리">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/" title="Share on Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="5">
    <i id="btn-close-shareoptions" class="fa fa-times"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/">
                    <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/">
                    <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/">
                    <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">taetaetae</h4>
        
            <div id="about-card-bio"><p>Programmer</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Naver Corp.</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                korea
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover_2.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/';
                 
                    this.page.identifier = '2017/03/23/oracle-mybatis-date/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'taetaetae';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    



    </body>
</html>
