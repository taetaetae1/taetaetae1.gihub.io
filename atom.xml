<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>꿈꾸는 태태태의 공간</title>
  
  <subtitle>taetaetae</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://taetaetae.github.io/"/>
  <updated>2018-12-02T20:06:59.701Z</updated>
  <id>https://taetaetae.github.io/</id>
  
  <author>
    <name>taetaetae</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  <image>
    <url>
      https://taetaetae.github.io/assets/images/profile.png
    </url>
  </image>
  
  <entry>
    <title>Jenkins 설치 치트키</title>
    <link href="https://taetaetae.github.io/2018/12/02/jenkins-install/"/>
    <id>https://taetaetae.github.io/2018/12/02/jenkins-install/</id>
    <published>2018-12-01T19:37:59.000Z</published>
    <updated>2018-12-02T20:06:59.701Z</updated>
    
    <content type="html"><![CDATA[<p>“show me the money”, “black sheep wall”.<br>어렸을적 스타크래프트라는 게임이 나오고서 입에 달고 살았던 <code>치트키</code>. 게임이 시작되고 해당 치트키를 입력하면 돈이 들어오거나 맵이 훤하게 보여 컴퓨터를 이기는데 도움을 주곤 했었다. <a id="more"></a><br>개발을 하면서 Jenkins는 나 대신 어떤 업무를 수행하는데 강력한 툴 중에 하나이다. (물론 만능이라는 소리는 아니지만…) 새로운 프로젝트가 시작되거나 개발도중 무언가 자동화를 하고 싶을 경우엔 Jenkins를 찾게 되는데 그럴때마다 설치를 하고 이런저런 설정이 필요하다.<br>눈치를 챘을수도 있지만 이 포스트는 오로지 <code>젠킨스 설치하는 방법</code>을 아주 간단하고 핵심만 정리하고자 한다. 마치 <code>치트키</code>처럼.<br>나중에 다시 보기위해 + 누군가 해당 포스트를 보고 도움이 되었으면 하는 바람으로.</p><p>(물론 이 방법밖에 있는건 아니지만 필자는 아래와 방법을 사용하고 있다.)</p><hr><p>우선 CentOS 환경에 Java가 설치되어 있는 상황이라 가정한다.</p><ul><li><p>적당한 위치에 tomcat 다운 ( <a href="https://tomcat.apache.org/download-80.cgi" target="_blank" rel="noopener">https://tomcat.apache.org/download-80.cgi</a> )</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://apache.mirror.cdnetworks.com/tomcat/tomcat-8/v8.5.35/bin/apache-tomcat-8.5.35.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>압축 해제후 하위 폴더중 webapps로 이동</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-tomcat-8.5.35.tar.gz</span><br><span class="line">cd apache-tomcat-8.5.35/webapps</span><br></pre></td></tr></table></figure></li><li><p>Jenkins 다운 ( <a href="https://jenkins.io/download/" target="_blank" rel="noopener">https://jenkins.io/download/</a> )</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war</span><br></pre></td></tr></table></figure></li><li><p>tomcat 하위폴더중 conf 폴더로 이동</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ../conf</span><br></pre></td></tr></table></figure></li><li><p>server.xml 수정 및 http port 확인</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi server.xml</span><br><span class="line"></span><br><span class="line">&lt;Host&gt; 하위에 추가</span><br><span class="line">&lt;Context path=&quot;/jenkins&quot; debug=&quot;0&quot; privileged=&quot;true&quot; docBase=&quot;jenkins.war&quot; /&gt;</span><br><span class="line"></span><br><span class="line">port 확인</span><br><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;/&gt;</span><br></pre></td></tr></table></figure></li><li><p>해당 서버의 ip와 위 port에 맞춰 url 입력후 jenkins 설치</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ip:8080/jenkins</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;“show me the money”, “black sheep wall”.&lt;br&gt;어렸을적 스타크래프트라는 게임이 나오고서 입에 달고 살았던 &lt;code&gt;치트키&lt;/code&gt;. 게임이 시작되고 해당 치트키를 입력하면 돈이 들어오거나 맵이 훤하게 보여 컴퓨터를 이기는데 도움을 주곤 했었다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="jenkins" scheme="https://taetaetae.github.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins에서 파이썬 출력을 실시간으로 보고싶다면?</title>
    <link href="https://taetaetae.github.io/2018/12/02/python-buffer/"/>
    <id>https://taetaetae.github.io/2018/12/02/python-buffer/</id>
    <published>2018-12-01T16:40:11.000Z</published>
    <updated>2018-12-02T20:07:31.557Z</updated>
    
    <content type="html"><![CDATA[<p>필자가 운영하고 있는 <a href="http://daily-devblog.com" target="_blank" rel="noopener">Daily Dev Blog</a> 라는 서비스는 매일 동일한 시간에 주기적으로 데이터를 크롤링 하고 사용자에게 메일을 발송하는 일련의 작업을 수행하고 있다. 헌데 예상하지 못한 부분에서 예외가 발생하게 되면 어떤경우는 메일 발송을 못한다거나 기존에 발송했던 데이터를 다시 보내는 등 정상적이지 못한 상황을 맞이하게 된다.<a id="more"></a><br><div class="figure center" style="width:;"><img class="fig-img" src="ddb_duplication.png" alt="메일이 하루라도 잘못오면 여기저기서 연락이 온다. 감사한 분들..."><span class="image-caption">메일이 하루라도 잘못오면 여기저기서 연락이 온다. 감사한 분들...</span><span class="caption">메일이 하루라도 잘못오면 여기저기서 연락이 온다. 감사한 분들...</span></div><br>이런저런 바쁜일들로 차일피일 미루다 마침 여유가 생겨 기존에는 Crontab 스케쥴로 파이썬 스크립트를 실행하던 것에서 Jenkins로 옮기는 작업을 했다. 젠킨스가 스케쥴링을 해주고 실행이력을 보여주며, 실시간으로 스크립트가 돌아가는걸 볼수 있을것 같다는 기대감에서이다. 위에서 이야기 했던 예외상황을 보다 빠르고 편하게 실시간으로 디버깅을 하기 위해서가 가장 컸다.</p><h3 id="당연히-될거라고-생각했으나…"><a href="#당연히-될거라고-생각했으나…" class="headerlink" title="# 당연히 될거라고 생각했으나…"></a># 당연히 될거라고 생각했으나…</h3><p>작업은 간단할꺼라 생각했다. </p><ol><li>우선 <a href="https://taetaetae.github.io/2018/12/02/jenkins-install/">Jenkins를 설치</a>하고 </li><li>기존에 스크립트 파일을 Jenkins Job으로 옮긴후에 </li><li>적당한 코드 중간중간에 디버깅이 용이하도록 로그를 출력하게 해둔다음</li><li>스케쥴링만 걸어두면 끝이라고 생각했다. </li></ol><p>하지만, 이렇게 간단하게 끝날것만 같았던 작업이 은근 귀찮은 작업이 될줄이야. 디버깅을 위해 로그를 출력하도록 해놨는데 모든 스크립트가 끝이 나서야 해당 로그가 출력되는 것이였다. 로그를 실시간으로 볼수 없다면 Crontab에서 Jenkins로 옮기는 이유가 크게 없게 된다. 실제로 아래처럼 코드를 작성하고 Jenkins Job을 실행시켜보면 다 끝나고서야 출력이 되는걸 볼수 있었다. </p><p>(1초에 한번씩 5초동안 로그를 찍는 간단한 코드다.)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">print(<span class="string">'start'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> second <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">5</span>) :</span><br><span class="line">  print(second)</span><br><span class="line">  time.sleep(second)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'end'</span>)</span><br></pre></td></tr></table></figure><div class="figure center" style="width:;"><img class="fig-img" src="before.gif" alt="스크립트가 다 끝나서야 출력을 볼수 있다ㅠ 실시간으로 디버깅이 어렵다."><span class="image-caption">스크립트가 다 끝나서야 출력을 볼수 있다ㅠ 실시간으로 디버깅이 어렵다.</span><span class="caption">스크립트가 다 끝나서야 출력을 볼수 있다ㅠ 실시간으로 디버깅이 어렵다.</span></div><h3 id="그럼-어떻게-해야할까"><a href="#그럼-어떻게-해야할까" class="headerlink" title="# 그럼 어떻게 해야할까?"></a># 그럼 어떻게 해야할까?</h3><p>개발을 하면서 만나는 대부분의 문제들은 누군가 과거에 경험했던 문제였고, 이미 해결된 문제일 확률이 상당히 높은것들이 많다. 이번에도 역시, 갓 스택 오버플로우 : <a href="https://stackoverflow.com/questions/107705/disable-output-buffering" target="_blank" rel="noopener">https://stackoverflow.com/questions/107705/disable-output-buffering</a></p><p>위 링크에서 알려준것처럼 해보면 다음과 같이 로그가 출력되는대로 젠킨스에서 볼수 있게 된다.<br><div class="figure center" style="width:;"><img class="fig-img" src="after.gif" alt="콘솔환경에서의 디버깅은 로깅이 최고!"><span class="image-caption">콘솔환경에서의 디버깅은 로깅이 최고!</span><span class="caption">콘솔환경에서의 디버깅은 로깅이 최고!</span></div></p><p>정리해보면 다음과 같은 방법이 있겠다.</p><ol><li><p><code>Execute Python script</code> 을 활용하여 Jenkins 에 직접 코드를 작성하는 경우 </p><ul><li>print의 flush옵션을 활용 ( <a href="https://docs.python.org/3/library/functions.html?highlight=print#print" target="_blank" rel="noopener">https://docs.python.org/3/library/functions.html?highlight=print#print</a> )</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'hello'</span>, flush=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><ul><li>매번 print 가 될때마다 flush가 되도록 재정의</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Unbuffered</span><span class="params">(object)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, stream)</span>:</span></span><br><span class="line">     self.stream = stream</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self, data)</span>:</span></span><br><span class="line">     self.stream.write(data)</span><br><span class="line">     self.stream.flush()</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">writelines</span><span class="params">(self, datas)</span>:</span></span><br><span class="line">     self.stream.writelines(datas)</span><br><span class="line">     self.stream.flush()</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, attr)</span>:</span></span><br><span class="line">     <span class="keyword">return</span> getattr(self.stream, attr)</span><br><span class="line"></span><br><span class="line">sys.stdout=Unbuffered(sys.stdout)</span><br></pre></td></tr></table></figure></li><li><p><code>Execute shell</code>을 활용하여 특정경로의 Python 파일을 실행할 경우</p><ul><li><code>-u</code> 옵션을 줘서 실행시킨다. ( python -u python_module.py )</li></ul></li></ol><p>이렇게 두고보면 너무 간단한 작업인데 이런 방법을 모르는 상황에서는 작성된 Python Script를 Shell Script로 다시 감싸보거나 Python 코드를 쓰지 말까 까지 생각했었다… 삽질의 연속들… (Shell Script로 작성하면 바로바로 보였기 때문…)</p><p>다시한번 모르면 몸이 고생한다(?)라는걸 몸소 체험한 좋은…시간이였다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;필자가 운영하고 있는 &lt;a href=&quot;http://daily-devblog.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Daily Dev Blog&lt;/a&gt; 라는 서비스는 매일 동일한 시간에 주기적으로 데이터를 크롤링 하고 사용자에게 메일을 발송하는 일련의 작업을 수행하고 있다. 헌데 예상하지 못한 부분에서 예외가 발생하게 되면 어떤경우는 메일 발송을 못한다거나 기존에 발송했던 데이터를 다시 보내는 등 정상적이지 못한 상황을 맞이하게 된다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="python" scheme="https://taetaetae.github.io/tags/python/"/>
    
      <category term="jenkins" scheme="https://taetaetae.github.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Deview 2018 리뷰 (Day 1, Day2)</title>
    <link href="https://taetaetae.github.io/2018/10/14/deview-2018/"/>
    <id>https://taetaetae.github.io/2018/10/14/deview-2018/</id>
    <published>2018-10-14T09:26:26.000Z</published>
    <updated>2018-10-14T16:21:54.824Z</updated>
    
    <content type="html"><![CDATA[<p>회사 내에서도 대학시절 수강신청마냥 1분도 안되서 마감될 정도로 관심이 많았던 <code>DEVIEW 2018</code>. 다행히 클릭신공으로 운좋게 신청에 성공하였고 팀에서도 바쁜 시기였지만 감사하게도 보내주셔서 올해는 이틀 모두 다녀올수 있게 되었다.<a id="more"></a> 예전에는 <code>연차가 올라가면 DEVIEW행사는 참여 안하겠지~</code>라는 생각이 있었는데 그때는 단순 호기심에 참석을 하고 싶었다면 이번에는 <code>뭐라도 배워오자</code>라는 마음으로 신입 시절보다 조금더 성숙한 마음가짐과 자세를 가지고 참석을 하게 되었다.</p><blockquote><p>다시 생각해보면 호기심만으로 세션들을 듣고 부스에서 나눠주는 굿즈를 조금이라도 더 받아와야지 하고 생각했던 신입시절의 생각이 틀린건 아니였지만, 말 그대로 <code>기술행사</code>이니만큼 가급적이면 세션에서 발표하는 내용을 내것으로 만들고 실무에서 또는 다른곳에서 활용할수는 없을까 하는 생각을 갖는게 보다 성장하려는 개발자로서의 자세가 아닐까 생각이 든다. (라고 멋드러지게 말하지만 세션내용의 절반이라도 이해하면 다행이겠지…)</p></blockquote><h3 id="행사-시작-그리고-키노트"><a href="#행사-시작-그리고-키노트" class="headerlink" title="# 행사 시작 그리고 키노트"></a># 행사 시작 그리고 키노트</h3><p>10초만에 마감되었다는 소리가 있을정도로 올해도 여전히 관심이 많았던 <code>DEVIEW 2018</code>. 코엑스에 도착하고 등록을 한뒤 이곳저곳 부스들을 구경하기 바빴다. 이번에는 지난번과 달리 거의 네이버 서비스가 60~70%를 자리잡고 있었고(파파고, 지도, 클로바, 글로벌 광고 등등) 일반 기업에서는 얼마 오지 않았다.(내 기억으로 5~6개?) 개인적으로 여러 다양한 회사들이 함께하는 기술행사가 되었으면 하는 바램이 있었지만 회사를 선정하는데, 그리고 기타 사정들이 있을꺼라는 아쉬움을 뒤로하고 CTO님이 발표하시는 키노트를 들으러 메인강의장에 들어갔다. (자칫… 이것도 네이버 독과점(?) 이러면 할말이 없는데…ㅠㅠ)<br><div class="figure center" style="width:;"><img class="fig-img" src="keynote.png" alt="송창현 네이버 CTO님의 keynote"><span class="image-caption">송창현 네이버 CTO님의 keynote</span><span class="caption">송창현 네이버 CTO님의 keynote</span></div><br>작년에는 거의 <code>로봇잔치</code>로 느껴졌는데 올해는 그 기술들의 융합(?)잔치 로 받아들여졌다. <code>Ambient Intelligence</code> 를 강조하시며 <code>기술의 진정한 가치는 기술이 생활속으로 사라졌을 때 나온다</code>라는 명언같은 말씀도 해주셨다. </p><ul><li>연결 : 사물, 상황, 위치인식, 이해</li><li>발견 : 적시에 답, 추천, 액션제공</li></ul><p>그리고 그와 관련된 네이버 서비스를 공개 하셨는데, 네이버 지도 Map API를 무제한/무료로 사용할수 있게 된다고 한다. (박수 유도하심 ㅎㅎ) 또한 이번에 가장 크게 바뀌는 네이버 모바일 홈 페이지인 <code>그린닷</code>, 지도 기술들의 종합 플랫폼인 <code>xDM Platform</code>(측위, 지도, 내비), 그리고 자율주행과 로봇에 대해 연구결과 그리고 앞으로의 방향성에 대해 정리해주셨다. 집에 돌아와서 검색좀 하다보니 <code>테크수다</code>에서 벌써(?) 영상을 하나 올린게 있어 공유해본다.</p><p><iframe width="560" height="315" src="https://www.youtube.com/embed/q2TM8KNnF14?rel=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><br>키노트를 다 듣고 작년에는 그런가보다 하고 별생각이 안들었는데 올해는 저런 기술들이 서비스 레벨까지 가는데 이렇다할 허들없이 사용자들에게 보여질수만 있다면 개발자로서 보다 더 큰 자부심을 가지고 기술개발에 정진할텐데… 하는 씁슬한 생각을 해보게 되었다. (물론 이런 부분들도 다 사정이 있을꺼라 생각이 들지만 안타까운건 감출수가 없을것 같다.)</p><p>이틀에 걸쳐 이런저런 다양한 세션들을 들을수 있어 좋았는데 몇몇 세션들은 기본지식이 없어 (AI, 머신러닝 등…ㅠ) 이해하기 힘들었다. 내년엔 이해할수 있도록 준비를 해서 오자며 <code>또</code>다짐을 하고… 그나마 조금이라도 이해할수 있었던 세션들 몇개만 정리해본다.</p><h3 id="React-Native-웹-개발자가-한-달-만에-앱-출시하기"><a href="#React-Native-웹-개발자가-한-달-만에-앱-출시하기" class="headerlink" title="# React Native: 웹 개발자가 한 달 만에 앱 출시하기"></a># React Native: 웹 개발자가 한 달 만에 앱 출시하기</h3><div class="figure center" style="width:;"><img class="fig-img" src="session_1.png" alt="React Native: 웹 개발자가 한 달 만에 앱 출시하기"><span class="image-caption">React Native: 웹 개발자가 한 달 만에 앱 출시하기</span><span class="caption">React Native: 웹 개발자가 한 달 만에 앱 출시하기</span></div><p>지난팀에서 아주 잠깐 React를 경험해보긴 했지만 거의 hello world 수준이였기 때문에 이 세션 역시 이해가 잘 되지 못했다. 하지만 필자처럼 이해를 잘 못하는 사람도 발표자가 전달하려는 목적이 무엇인지 알수 있을 정도로 전체적인 흐름은 조금이나마 이해를 할수 있었고 특히 개발하면서 좋았던 것이나 경험담을 알려주며 <code>삽질공유</code>를 해주는게 듣기 좋았다. React Native 는 빠른개발을 할수있고 코드공유가 쉬우며 개선이 쉽다는 장점이 있다고 한다. 또한 단기간에 크로스 플랫폼을 만들어야 할때 사용한다고 하니 나중에 참고해봐도 좋을듯 싶다.</p><ul><li>발표자료<br><iframe src="//www.slideshare.net/slideshow/embed_code/key/1UGMk1XHgSFIbL" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/deview/121react-native" title="[121]React Native: 웹 개발자가 한 달 만에 앱 출시하기" target="_blank">[121]React Native: 웹 개발자가 한 달 만에 앱 출시하기</a> </strong> from <strong><a href="https://www.slideshare.net/deview" target="_blank">NAVER D2</a></strong> </div></li></ul><h3 id="LINE-x-NAVER-개발-보안-취약점-이야기"><a href="#LINE-x-NAVER-개발-보안-취약점-이야기" class="headerlink" title="# LINE x NAVER 개발 보안 취약점 이야기"></a># LINE x NAVER 개발 보안 취약점 이야기</h3><div class="figure center" style="width:;"><img class="fig-img" src="session_2.png" alt="LINE x NAVER 개발 보안 취약점 이야기"><span class="image-caption">LINE x NAVER 개발 보안 취약점 이야기</span><span class="caption">LINE x NAVER 개발 보안 취약점 이야기</span></div><p><code>버그바운티</code>라는 신기한(?)프로그램에 대한 소개와 운영에 대한 내용을 발표해 주셨다. 가끔 사내에서도 <code>버그를 잡으면 포상을 드려요</code> 라는 글이 올라왔었는데 그때마다 손안데고 코풀려나 하는 비뚤어진(?)생각을 갖곤 했었다. 하지만 듣고보니 해커를 고용하는 가장 좋은 방법이면서도 회사의 보안을 지키는 가장 좋은 방법이라고 한다. 또한 잘 알려진 왠만한 기업들은 버그바운티 프로그램을 운영하고 있다고 한다. 비뚤어진 생각을 다시 고쳐 생각해보면, 해커에게는 취약점을 찾으며 해커 본연의 업무를 더욱더 발전시킬수 있고, 회사로써는 수만가지의 취약점을 관리하는 별도의 팀을 운영하는 비용보다 이러한 <code>버그바운티</code>라는 프로그램을 운영하면 선택과 집중을 하며 보다 효율적일것 같다는 생각이 들었다. 그러면서 어떠한 내용들로 보상을 해줬는가에 대해 소개를 해줬는데 가장 접하기 쉬운 XSS 공격이나 서버설정 미스로 인한 정보노출 등 아주 다양한 사례를 공유해 주셨다.</p><ul><li>발표자료<br><iframe src="//www.slideshare.net/slideshow/embed_code/key/MlweW8QkuAIhsg" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/deview/113linexnaver" title="[113]LINExNAVER 개발 보안 취약점 이야기" target="_blank">[113]LINExNAVER 개발 보안 취약점 이야기</a> </strong> from <strong><a href="https://www.slideshare.net/deview" target="_blank">NAVER D2</a></strong> </div></li></ul><h3 id="쿠팡-서비스-Cloud-Migration을-통해-배운-것들"><a href="#쿠팡-서비스-Cloud-Migration을-통해-배운-것들" class="headerlink" title="# 쿠팡 서비스 Cloud Migration을 통해 배운 것들"></a># 쿠팡 서비스 Cloud Migration을 통해 배운 것들</h3><div class="figure center" style="width:;"><img class="fig-img" src="session_3.png" alt="쿠팡 서비스 Cloud Migration을 통해 배운 것들"><span class="image-caption">쿠팡 서비스 Cloud Migration을 통해 배운 것들</span><span class="caption">쿠팡 서비스 Cloud Migration을 통해 배운 것들</span></div><p>사내에서도 발표가 있었는데 그때 제대로 못들어서 다시 듣게 되었다. 지난 2년동안 서비스를 클라우드로의 이전을 하면서 마주쳤던 문제들과 해결책, 그리고 클라우드의 마이크로서비스가 만나면서 마주친 새로운 문제들과 정리했던 생각들에 대해 공유하는 발표였다.</p><ul><li>클라우드 이전원칙 : 확장성 확보하기 위함, 무중단 이전, 고객에게 만족도에 영향이 없어야 함</li><li>공통배포 파이프라인 유지, 만든사람이 운영하는 문화, 장애관리 문화</li></ul><p>특히 <code>안정상태 찾기</code>라는 제목으로 서비스의 건강도를 측정하는 대시보드 형태의 페이지를 만들었다는 부분에서 내가 하고있는 서비스에서도 API Status 페이지처럼 서비스 전반에 대한 건강도(?)를 대시보드 형태로 충분히 만들수 있지 않을까 하는 생각을 해보았다.</p><ul><li>발표자료<br><iframe src="//www.slideshare.net/slideshow/embed_code/key/2KoOkDt1dbN9vl" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/deview/115-119061611" title="[115]쿠팡 서비스 클라우드 마이그레이션 통해 배운것들" target="_blank">[115]쿠팡 서비스 클라우드 마이그레이션 통해 배운것들</a> </strong> from <strong><a href="https://www.slideshare.net/deview" target="_blank">NAVER D2</a></strong> </div></li></ul><h3 id="Druid로-쉽고-빠르게-빅데이터-분석하기"><a href="#Druid로-쉽고-빠르게-빅데이터-분석하기" class="headerlink" title="# Druid로 쉽고 빠르게 빅데이터 분석하기"></a># Druid로 쉽고 빠르게 빅데이터 분석하기</h3><div class="figure center" style="width:;"><img class="fig-img" src="session_4.png" alt="Druid로 쉽고 빠르게 빅데이터 분석하기"><span class="image-caption">Druid로 쉽고 빠르게 빅데이터 분석하기</span><span class="caption">Druid로 쉽고 빠르게 빅데이터 분석하기</span></div><p>여태 참석한 DEVIEW 세션들 중에 시작전에 줄이 가장 길었던 세션(행사장 전체 반바퀴를 줄서야 했던 ;;) 그만큼 사람들도 빅데이터 분석에 대해 관심이 많이 있다는걸 증명하였고 나역시 Day1, Day2 전 세션들 중에 이 세션이 가장 기대가 되었다. Druid는 분석용도로 만든 플랫폼이고 아파치 인큐베이터에 들어가 있을정도로 각광받고 있는 플랫폼 이라고 한다. 일반적으로 빅데이터를 분석하기 위해서는 Druid와 Elasticsearch, Apache kudu 가 비교대상이 되는데 발표자분은 각 플랫폼을 아주 다양한 각도에서 비교 분석하며 현 상황에서 가장 적합한 플랫폼을 찾기위한 노력한 부분을 보여주셨다. 필자는 기존에 Elastic Stack을 백지부터 홀로 터득한 경험이 있어 무슨차이가 있는지 궁금했는데 가장 큰 다른점은 join과 group by가 된다는 장점이 있다고 한다. (join기능은 자체 제공하지는 않지만 spark와 연동해서 해결했다고 한다.)<br>또한 가장 관심갖고 봤던 비쥬얼라이징툴에 대해 소개해주셨는데 Imply UI소개를 듣고 감탄사가 절로 나왔지만 유료… 그라파나는 플러그인을 통한 다양한 그래프를 쉽게 표현이 가능하다고 하였고 Superset 은 표현할수있는 그래프가 가장 많고 권한관리도 입맛에 맞게 가능하다고 한다. 다만 너무 많아서 복잡할수도 있다고 … Metabase는 어플리케이션 방식이고 깔끔한 UI를 제공하지만 세부적인 설정은 불가능 하다는 단점이 있다고 한다.<br>솔루션 선택을 할때 마냥 좋다고 사용하는것이 아니라 실제로 다양한 관점에서의 테스트를 해보고 서비스에 적절한 솔루션을 선택하는 좋은 발표를 들을수 있어서 너무 좋았다.</p><ul><li>발표자료<br><iframe src="//www.slideshare.net/slideshow/embed_code/key/7l1PlNxFsuExZ" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/deview/215-druid-119186559" title="[215] Druid로 쉽고 빠르게 데이터 분석하기" target="_blank">[215] Druid로 쉽고 빠르게 데이터 분석하기</a> </strong> from <strong><a href="https://www.slideshare.net/deview" target="_blank">NAVER D2</a></strong> </div></li></ul><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><div class="figure center" style="width:;"><img class="fig-img" src="deview_last.png" alt="나도 언젠간 스피커가 될수 있겠지...?"><span class="image-caption">나도 언젠간 스피커가 될수 있겠지...?</span><span class="caption">나도 언젠간 스피커가 될수 있겠지...?</span></div><p>이번 Deview에서는 Facebook에서 알게된 POPit 저자분을 실제로 만나뵙기도 했고 지금은 S사에 계시는 우연히 만나게된 반가운 예전팀 형, 그리고 군 장교시절 필자의 소대원이 AI 스타트업 소속으로 부스를 운영을 하며 서비스 소개를 하고 있는 모습도 보고… 참 다양한 이벤트들이 많았던 행사였다. 사실 올해 Deview 발표자를 모집할때 <code>주니어 개발자가 회사밖에서 성장하는 방법</code> 같은 내용으로 발표를 해볼까도 생각했지만 지금생각해보면 좀더 준비를 철저히 그리고 깊게 해야겠다고 느꼈다.<br>그리고 내가 하고있는 업무 즉, 서비스 운영/개발은 아무리 바쁘고 힘들어도 기본으로 해야하고 회사를 벗어나 신기술 또는 기존기술의 고도화 방법을 찾아서 공부하고 내것으로 만들어 나가야 하는건 예전이나 지금이나 변함이 없다는걸 다시한번 느낄수 있었던 좋은 행사였다고 생각한다. 이번에도 뒤통수 세게 맞고 간다…</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;회사 내에서도 대학시절 수강신청마냥 1분도 안되서 마감될 정도로 관심이 많았던 &lt;code&gt;DEVIEW 2018&lt;/code&gt;. 다행히 클릭신공으로 운좋게 신청에 성공하였고 팀에서도 바쁜 시기였지만 감사하게도 보내주셔서 올해는 이틀 모두 다녀올수 있게 되었다.
    
    </summary>
    
      <category term="blog" scheme="https://taetaetae.github.io/categories/blog/"/>
    
    
      <category term="deview" scheme="https://taetaetae.github.io/tags/deview/"/>
    
  </entry>
  
  <entry>
    <title>2018 Pycon. 그리고 첫 발표를 하다.</title>
    <link href="https://taetaetae.github.io/2018/08/28/pycon-2018/"/>
    <id>https://taetaetae.github.io/2018/08/28/pycon-2018/</id>
    <published>2018-08-28T14:43:16.000Z</published>
    <updated>2018-08-28T17:30:18.324Z</updated>
    
    <content type="html"><![CDATA[<p>IT관련 행사에 참여하면 여러가지 정보를 얻을수 있다. 개인적으로는 사실 정보를 얻기 위함보다 그곳의  분위기를 현장에서 몸소 느끼고 참여한 사람들의 눈빛을 보며 해이해진 마음가짐을 다시 다잡을수 있음이 가장 큰 목적이다. 그에 올해 Pycon도 하나의 전환점이 되길 바라는 마음으로 신청을 하게 되었다.<br><a id="more"></a></p><h4 id="등록"><a href="#등록" class="headerlink" title="# 등록"></a># 등록</h4><p><a href="https://www.pycon.kr" target="_blank" rel="noopener">https://www.pycon.kr</a><br>얼리버드 등록을 한다고 Facebook에서 홍보를 하길래 그런가보다 했는데 잠깐 회사일에 집중하고 다시 보니 이미 매진이 되어있었다. 사실 Pycon 은 올해가 처음 가보는거라 인기를 실감할수 없었는데 이정도일줄은 상상도 못했다. (나중에 알게 된 사실이지만 올해가 가장 인원이 많았다고…) 그래서 나중에 진행되었던 일반표 등록은 휴대폰 알람까지 걸어두며 늦지않게 등록할수 있었다. 세부 일정들이 업데이트가 되고 어떤 세션을 들을까 고민하면서 간략 소개를 하나둘씩 보게 되었는데 Python을 만지며 평소에 궁금했던거나 재밌어 보이는 세션들이 너무많아 고민을 많이 했다. 한가지 아쉬운건 로그인 기반이 아니다 보니 (임시 로그인기반?) 내 시간표 설정하는게 없었다. 나는 별도로 적어서 갔지만 나중엔 그런 기능이 생겼으면 좋겠다. </p><blockquote><p>2019년 Pycon엔 크롬 익스텐션으로 기능을 만들어 로그인 여부와 상관없이 몇시에 내가 어떤 세션을 들을건지에 대한 설정을 하고 이를 이미지로 캡쳐해서 출력/다운 받을수 있는 걸 만들어 보고 싶다. (그전에 미뤄뒀던 크롬 익스텐션 개발하는 방법부터 공부하자…)</p></blockquote><h4 id="첫째날"><a href="#첫째날" class="headerlink" title="# 첫째날"></a># 첫째날</h4><p>개인적으로 아침잠이 너무 많은데 알림이 울리기도 전에 눈이 떠졌고 행사장에 도착해보니 후원사 부스는 아직 텅텅 비어있었고, 밤새가면서 준비를 하셨는지 자원봉사자 분들은 여기저기 빈백에 누워(쓰러져) 자고 있었다. 그만큼 Pycon에 대한 기대가 컸나보다. 시간이 지나니 하나둘씩 사람들이 등록을 하며 오기 시작하였고 역시나 행사에 꽃중에 꽃인 후원사 부스에서 나눠주는 이벤트 상품들을 받기 바빴다.<br><div class="figure center" style="width:;"><img class="fig-img" src="day1.png" alt="DIVE INTO DIVERSITY !!"><span class="image-caption">DIVE INTO DIVERSITY !!</span><span class="caption">DIVE INTO DIVERSITY !!</span></div><br>키노트를 시작으로 사람들은 각자 듣고싶은 세션에 참가하며 행사는 시작이 되었다. 전체적으로 기술의 난이도는 초급 수준의 발표였던걸로 느껴졌다. (물론 나는 초초초급도 안되는 꼬꼬마 수준이지만…) 대부분 Python으로 어떤걸 해봤고, 어떤 어려움이 있었고, 이러저러한 상황들을 만났으며, 요런 경우에서는 어떻게 하며 해결을 하였다는 등 기술을 활용한 “경험기”에 대한 내용들을 들을수 있었다.<br>Pycon의 슬로건인 <code>DIVE INTO DIVERSITY</code>에 걸맞게 아주 <code>다양한 주제</code>로 흥미있는 발표내용들이였다. 기억나는 것들중에 인상깊었던 부분들을 정리해본다.</p><ul><li>파이썬 문화(?)중의 하나는 몰라서 물어보는 사람에게 구글링을 하라기보다 직접 알려주라는 것이다.</li><li>배우고 싶다면 다른사람들을 가르치는것부터(알려주는것부터) 시작하라.</li><li>여성 개발자, 여성 발표자들도 점점 늘어나고 있다.</li><li>파이썬을 개발 현장(?)이 아닌 다른곳에서 사용한다면 작업 속도도 빠르고 얻어내는 가치또한 훨씬 더 방대하다.</li><li>엑셀로 할수 있는 작업을 파이썬으로 할수 있다. </li><li>파이썬의 다양한 라이브러리는 일상의 도움을 준다.</li></ul><p>행사를 들으며 꼭 질문을 해야지 하는 마음을 갖고 있었는데 (그래야 오래 기억에 남으니) 마침 어떤 세션에서 궁금한게 있어 질문을 할수 있었다. (질문을 하니 파이썬 관련 책 선물도 받았다.^^)<br>그리고 마지막 <code>라이트닝 톡</code>이라는 세션이 있었는데 여러 발표자들이 짤막하게 5분동안 하고싶은 이야기를 하는 세션이였다. 5분이라는 제한이 있기에 다들 쉽고 편하게 발표하는듯 보였으나 발표 자료나 발표내용을 보면 꼭 그렇게 간단하게 발표하는건 아니였다. 본 세션에서 말하기엔 다소 분량이 작은 알차고 깨알같은 발표도 있었고, 매년 Pycon 라이트닝톡에 발표하는게 목표이신 분도 있었다.<br>발표를 들으면서 난 언제 저런자리에 가서 발표를 할수 있을까 하는 마음이 스쳐 지나갈때 쯤. “왜못하지? 나 파이썬으로 만든거 있잖아?” 라고 혼잣말로 궁시렁거리며 둘째날에 있는 라이트닝톡에서 발표하기로 마음을 먹고 서둘러서 참가 신청을 보냈다. 그러고서는 저녁을 먹고 집에 늦게 돌아와 새벽 3시넘어서야 발표자료를 완성하였지만 “발표” 라는 부담감때문에 어렵게 잠에 들었다.</p><h4 id="둘째날"><a href="#둘째날" class="headerlink" title="# 둘째날"></a># 둘째날</h4><p>어제와는 달리 오늘은 잠을 많이 못자서 인지 늦게 일어나 첫 세션이 시작하고서 거의 끝날 즈음에 행사장에 도착하게 되었다. “괜히 발표 한다고 한걸까” 라는 생각이 들며 진행위 본부에 가서 발표 순서를 확인해보니 첫번째… 슬슬 머리가 아파오기 시작했다. 그래도 듣기로한 세션은 들어보고 싶어서 집중해서 세션들을 돌아가며 들었지만 머릿속에는 온통 “발표 발표 발표”라는 생각때문에 오히려 다른분께서 하시는 발표를 집중해서 듣지 못하였다.<br><div class="figure center" style="width:;"><img class="fig-img" src="day2.png" alt=""></div></p><h4 id="첫-발표"><a href="#첫-발표" class="headerlink" title="# 첫 발표"></a># 첫 발표</h4><p>라이트닝톡이 시작이 되고, 첫 타자로 단상위에 올라섰다. 어림잡아 200여명 정도 였던것 같다. (기분탓으로 많아 보였을수도…) 두근두근. 드디어 발표 시작. 마치 잡스 마냥 멋지게 발표를 하고 싶었지만 막상 올라가서 스피커를 통해 들려오는 내 목소리를 듣고 있자니 너무 떨렸다. (이럴줄 알았으면 청심환이라도 먹고 올라가는건데…) 잠깐 말을 안하고 있었는데 적막이 흐르고… 빨리 발표를 진행해야겠다 싶어 준비한 스크립트를 그대로 보고 읽기 시작한다… 마치 국어책 읽는것마냥…<br><div class="figure center" style="width:;"><img class="fig-img" src="presentation.png" alt="저땐 왜그렇게 떨렸는지..."><span class="image-caption">저땐 왜그렇게 떨렸는지...</span><span class="caption">저땐 왜그렇게 떨렸는지...</span></div><br>발표의 주제는 “파이썬으로 토이프로젝트 만들기” (a.k.a 기술블로그 구독서비스 홍보) 였다. 필자도 파이썬을 공식적(?)으로 배워본적도 없고 주어 듣고 구글링 한게 전부인 상태에서 왜 만들게 되었고 어떤식으로 만들었는지에 대해 발표를 했는데 사실 이 발표의 주된 목적중에 하나는 기술블로그 구독서비스 홍보였다. 조금이라도 구독자수를 늘리고 싶어서… 적어도 한 100명은 가입 하겠지 라는 생각으로…<br>하지만 발표가 끝나고 구독자수를 보기위해 홈페이지에 접속해보니 서버가 다운;;; ssh 접속도 안되는 상황이였다. 부랴부랴 AWS콘솔에서 서버 재시작을 하고 겨우 살렸는데 <code>아뿔싸!</code> 동접에 대한 테스트 즉, TPS 측정같은 성능테스트를 전혀 하지 않은것이다. 발표도 너무 못하고, 홍보도 제대로 못하고ㅠㅠ 이렇게 발표가 끝나서 너무 아쉽다. (물론 준비 시간이 부족했던게 핑계지만 가장 크다.)<br><div class="figure center" style="width:;"><img class="fig-img" src="slideshare.png" alt=""></div><br><a href="https://www.pycon.kr/2018/program/81" target="_blank" rel="noopener">발표자료</a><br><a href="https://www.youtube.com/watch?v=ugm706IAqg0&amp;start=23537" target="_blank" rel="noopener">유튜브 녹화영상</a></p><h4 id="번외-nGrinder를-성능테스트편"><a href="#번외-nGrinder를-성능테스트편" class="headerlink" title="# 번외 (nGrinder를 성능테스트편)"></a># 번외 (nGrinder를 성능테스트편)</h4><p>필자는 기술에 있어서 “개념만 아는 사람”과 “그 개념을 토대로 실제로 해본사람”은 하늘과 땅차이라고 생각한다. 예전 포스팅 한것중에 Apache 의 mpm 방식에 대해 정리한게 있었는데 (<a href="https://taetaetae.github.io/2018/06/27/apache-vs-nginx/">링크</a>) 정리할때 한번 각 방식에 대해서 프로토타이핑이라도 해봤으면… 이런 사태(?)는 면했을것 같다. Apache 설치시 Default방식인 Prefork방식으로 설치되어 있었고 AWS Free tier 의 메모리는 1기가. 사용중인 메모리는 약 450메가였고 mpm방식에 대해 아무 설정도 하지 않았으니 당연히 사용자가 늘어나면 늘어날수록 메모리는 올라가고 KeepAlive 또한 기본값인 <code>on</code>으로 되어있어서… 예정된 서버 다운이였다. (이것도 포스팅을 했었다…ㅠㅠ<a href="https://taetaetae.github.io/2017/08/28/apache-keep-alive/">링크</a>)<br>Apache 를 다시 Worker 방식으로 바꿔 설치하고 KeepAlive 또한 <code>Off</code>로 설정하고 nGrinder를 통해 성능테스트를 해보니 다음과 같은 결과를 얻을수 있었다.<br><div class="figure center" style="width:;"><img class="fig-img" src="tps.png" alt="Prefork방식일때 테스트를 해보니 다운이 되었다."><span class="image-caption">Prefork방식일때 테스트를 해보니 다운이 되었다.</span><span class="caption">Prefork방식일때 테스트를 해보니 다운이 되었다.</span></div><br>만약, 이걸 예상하고 Worker방식에 KeepAlive Off 가 되어있었다면? 홍보가 더 잘되었을것 같다는 생각을 뒤늦게 땅을 쳐가며 후회해본다. (이래서 개발 마지막 단계는 다양한 QA가 필요하다며…)</p><h4 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h4><p>이틀간의 걸쳐 진행된 Pycon은 필자에게 많은 선물을 안겨 주었다. (이벤트 상품들을 많이 받아서가 아니라..ㅎㅎ;;)<br><div class="figure center" style="width:;"><img class="fig-img" src="gift.png" alt="이번 파이콘에서 받은 선물들"><span class="image-caption">이번 파이콘에서 받은 선물들</span><span class="caption">이번 파이콘에서 받은 선물들</span></div><br>물론 주된 목적은 파이썬이라는 언어의 사용법과 가치, 확장성 등 다양한 세션을 통해 얻은 정보였지만 아무래도 첫 발표를 했던지라 필자에겐 라이트닝톡이 가장 기억이 남는다. 발표를 막상 해보니 별거 없다는 생각과 자신감이 생겼다. (물론 청중이 많아지고 시간이 길어진다면 또 다른 문제일수 있겠지만)<br><em>내년엔 좀더 준비를 탄탄히 하고 발표도 여유롭고 부드럽게 해서 꼭 본 세션에 참가해 보고 싶다.</em></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;IT관련 행사에 참여하면 여러가지 정보를 얻을수 있다. 개인적으로는 사실 정보를 얻기 위함보다 그곳의  분위기를 현장에서 몸소 느끼고 참여한 사람들의 눈빛을 보며 해이해진 마음가짐을 다시 다잡을수 있음이 가장 큰 목적이다. 그에 올해 Pycon도 하나의 전환점이 되길 바라는 마음으로 신청을 하게 되었다.&lt;br&gt;
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="python" scheme="https://taetaetae.github.io/tags/python/"/>
    
      <category term="pycon" scheme="https://taetaetae.github.io/tags/pycon/"/>
    
  </entry>
  
  <entry>
    <title>자바 객체 복사하기 ( feat. how to use CloneUtils? )</title>
    <link href="https://taetaetae.github.io/2018/08/21/how-to-use-cloneUtils/"/>
    <id>https://taetaetae.github.io/2018/08/21/how-to-use-cloneUtils/</id>
    <published>2018-08-21T09:02:47.000Z</published>
    <updated>2018-08-21T14:53:28.968Z</updated>
    
    <content type="html"><![CDATA[<p>자바(Java)로 개발을 하다보면 한번쯤 객체를 복사하는 로직을 작성할때가 있다. 그때마다 나오는 이야기인 <code>Shalldow Copy</code> 와 <code>Deep Copy</code>. 한국어로 표현하면 얕은 복사와 깊은 복사라고 이야기를 하는데 이 두 개념의 차이는 아주 간단하다. 객체의 주소값을 복사하는지, 아니면 객체의 실제 값(value)를 복사하는지. <a id="more"></a> 이 둘의 차이점을 소개하는 글들은 워낙 많으니 패스하도록 하고 이번 포스팅에서는 <code>Deep Copy</code>를 할때 <code>org.apache.http.client.utils</code> 하위에 있는 <code>CloneUtils</code> 사용법에 대해 정리 하고자 한다.</p><blockquote><p>그냥 쓰면 되는거 아닌가? 라고 생각했지만 (별거 아니라고 생각했지만) 해보고 안해보고의 차이는 엄청컸고 사용할때 주의점이 몇가지 있어 정리 하려고 한다.</p></blockquote><p>예제에 앞서 본 포스팅에서 사용할 객체를 간단히 정리하면 다음과 같다. (학교에서 학생 신상정보를 관리한다고 가정해보자.)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">String name; <span class="comment">// 이름</span></span><br><span class="line"><span class="keyword">int</span> age; <span class="comment">// 나이</span></span><br><span class="line">Family family; <span class="comment">// 가족</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Family</span> </span>&#123;</span><br><span class="line">String name;  <span class="comment">// 이름</span></span><br><span class="line"><span class="keyword">int</span> age; <span class="comment">// 나이</span></span><br><span class="line"><span class="keyword">boolean</span> isOfficeWorkers; <span class="comment">// 직장인 여부</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhysicalInformation</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> height; <span class="comment">// 키</span></span><br><span class="line"><span class="keyword">int</span> weight; <span class="comment">// 몸무게</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="객체는-Cloneable-interface-를-implement-해야하고-clone-메소드를-public-으로-override-해야한다"><a href="#객체는-Cloneable-interface-를-implement-해야하고-clone-메소드를-public-으로-override-해야한다" class="headerlink" title="# 객체는 Cloneable interface 를 implement 해야하고 clone 메소드를 public 으로 override 해야한다."></a># 객체는 Cloneable interface 를 implement 해야하고 clone 메소드를 public 으로 override 해야한다.</h4><p>당연한 이야기가 될수도 있으나 <code>CloneUtils</code>를 사용하기 위해서는 해당 객체는 Cloneable interface 를 implement 해야한다. 그리고 나서 clone 메소드를 override 해야되는데 여기서 가장 중요한점은 외부에서도 호출이 가능해야하기 때문에 <code>public</code> 으로 override를 해야한다. (기본은 protected 로 되어있다.) 우선 간단히 객체를 생성하고 출력부터 해보자. (출력을 이쁘게 하기 위해 <code>ToStringBuilder.reflectionToString</code>을 사용하였다.)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PhysicalInformation physicalInformation = <span class="keyword">new</span> PhysicalInformation();</span><br><span class="line">physicalInformation.height = <span class="number">180</span>;</span><br><span class="line">physicalInformation.weight = <span class="number">70</span>;</span><br><span class="line"></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE));</span><br></pre></td></tr></table></figure><p>결과는 당연히 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PhysicalInformation@5d6f64b1[height=180,weight=70]</span><br></pre></td></tr></table></figure><p>이제 Cloneable interface 를 implement 하고 clone 메소드를 public 으로 override 한뒤, CloneUtils를 사용해서 객체를 복사해보자. 테스트를 하면서 <code>Shalldow Copy</code>도 해보자.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class setting</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhysicalInformation</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> height;</span><br><span class="line"><span class="keyword">int</span> weight;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123; <span class="comment">// public 으로 바꿔주자.</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test code</span></span><br><span class="line">PhysicalInformation physicalInformation = <span class="keyword">new</span> PhysicalInformation();</span><br><span class="line">physicalInformation.height = <span class="number">180</span>;</span><br><span class="line">physicalInformation.weight = <span class="number">70</span>;</span><br><span class="line"></span><br><span class="line">PhysicalInformation physicalInformationShalldowCopy = physicalInformation;</span><br><span class="line">PhysicalInformation physicalInformationDeepCopy = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">physicalInformationDeepCopy = (PhysicalInformation)CloneUtils.clone(physicalInformation);</span><br><span class="line">&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 원본</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line"><span class="comment">// 얕은 복사</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(physicalInformationShalldowCopy, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line"><span class="comment">// 깊은 복사</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(physicalInformationDeepCopy, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 값 변경</span></span><br><span class="line">physicalInformation.weight = <span class="number">80</span>;</span><br><span class="line">physicalInformation.height = <span class="number">170</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 원본</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line"><span class="comment">// 얕은 복사</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(physicalInformationShalldowCopy, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line"><span class="comment">// 깊은 복사</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(physicalInformationDeepCopy, ToStringStyle.DEFAULT_STYLE));</span><br></pre></td></tr></table></figure><p>결과는 원본과 얕은 복사를 한것은 메모리 주소(?)가 같으나 깊은 복사를 한것은 데이터는 같지만 주소가 다르고 값을 변경해도 영향을 주지 않는다. (완전히 서로다른 객체인것을 증명)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PhysicalInformation@1376c05c[height=180,weight=70]</span><br><span class="line">PhysicalInformation@1376c05c[height=180,weight=70]</span><br><span class="line">PhysicalInformation@1b4fb997[height=180,weight=70]</span><br><span class="line"></span><br><span class="line">PhysicalInformation@1376c05c[height=170,weight=80]</span><br><span class="line">PhysicalInformation@1376c05c[height=170,weight=80]</span><br><span class="line">PhysicalInformation@1b4fb997[height=180,weight=70]</span><br></pre></td></tr></table></figure><p>만약 위에서 clone을 기본값인 protected로 override를 하게 되면 어떤 결과를 가져올까?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NoSuchMethodError: com.PhysicalInformation.clone()</span><br><span class="line">at org.apache.http.client.utils.CloneUtils.cloneObject(CloneUtils.java:55)</span><br><span class="line">at org.apache.http.client.utils.CloneUtils.clone(CloneUtils.java:77)</span><br><span class="line">at com.Test.main(Test.java:16)</span><br></pre></td></tr></table></figure><p>접근제한자에서 눈치를 챌수도 있었겠지만 접근을 할수없어 CloneUtils 이 리플렉션을 하는 과정에서 Exception을 발생한다. 꼭! public 으로 override를 해주자.</p><h4 id="객체-내에-clone이-안되는-변수는-별도-처리가-필요하다"><a href="#객체-내에-clone이-안되는-변수는-별도-처리가-필요하다" class="headerlink" title="# 객체 내에 clone이 안되는 변수는 별도 처리가 필요하다."></a># 객체 내에 clone이 안되는 변수는 별도 처리가 필요하다.</h4><p>객체 내에 있는 멤버 변수는 원시 변수(int, char, float 등) , Immutable Class (String, Boolean, Integer 등) 또는 Enum 형식일 때는 원본의 값을 바로 대입해도 되지만, 그렇지 않을 때는 멤버변수의 clone을 호출하여 복사해야 한다. 말로만 보면 무슨이야기 인지 모르니 예제를 보자.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">String name;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line">Family family;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Student 클래스에서 Cloneable 를 implements 하고 clone 메소드를 override 하였다. (여기서 구멍이 있다!!) 그다음 Family 클래스는 초기 그대로 두고 CloneUtils을 사용해서 객체를 복사하는 코드를 작성해보자.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Student student = <span class="keyword">new</span> Student();</span><br><span class="line">student.name = <span class="string">"taetaetae"</span>;</span><br><span class="line">student.age = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">Family family = <span class="keyword">new</span> Family();</span><br><span class="line">family.age = <span class="number">25</span>;</span><br><span class="line">family.isOfficeWorkers = <span class="keyword">true</span>;</span><br><span class="line">family.name = <span class="string">"son"</span>;</span><br><span class="line">student.family = family;</span><br><span class="line"></span><br><span class="line">Student studentDeepCopy = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">studentDeepCopy = (Student)CloneUtils.clone(student);</span><br><span class="line">&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// student 객체 복사여부 확인</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(student, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(studentDeepCopy, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line"><span class="comment">// student 내 family 객체 복사 여부 확인</span></span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(student.family, ToStringStyle.DEFAULT_STYLE));</span><br><span class="line">System.out.println(ToStringBuilder.reflectionToString(studentDeepCopy.family, ToStringStyle.DEFAULT_STYLE));</span><br></pre></td></tr></table></figure><p>Student 객체 안에 int, String, 그리고 별도로 만든 객체인 Family 가 있는 상황에서 복사를 해보자. 결과는 어떻게 나왔을까?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com.Student@1376c05c[name=taetaetae,age=20,family=com.Family@51521cc1]</span><br><span class="line">com.Student@deb6432[name=taetaetae,age=20,family=com.Family@51521cc1]</span><br><span class="line"></span><br><span class="line">com.Family@51521cc1[name=son,age=25,isOfficeWorkers=true]</span><br><span class="line">com.Family@51521cc1[name=son,age=25,isOfficeWorkers=true]</span><br></pre></td></tr></table></figure><p>위에서 말했던 구멍의 결과를 볼수 있다. Student 객체는 주소값이 다른걸 보니 깊은 복사가 되었지만 그 안에 있는 Family 형 변수는 얕은 복사가 된것을 확인할수 있다.</p><p>위에서 말한것과 같이 clone이 안되는 경우는 (다시 말하면 원시변수나 Immutable Class, enum 등 clone을 지원하는 객체가 아닐경우) 별도로 clone이 되도록 설정이 필요하다.</p><p>그래서 Family 도 Cloneable 를 implements 하고 clone 메소드를 override 해준다음 최상위 객체였던 Student의 clone 메소드를 아래처럼 조금 수정해주고 나서 테스트를 해보면 이쁘게 깊은 복사가 된것을 확인할수 있다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 복사가 될수있도록 설정</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Family</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line">String name;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line"><span class="keyword">boolean</span> isOfficeWorkers;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 일단 복사를 하고, 멤버 객체 자체를 복사한 다음 대입 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">String name;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line">Family family;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">Student student = (Student)<span class="keyword">super</span>.clone();</span><br><span class="line">student.family = (Family)CloneUtils.clone(student.family);</span><br><span class="line"><span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>그러고 테스트를 해보면 내부 멤버 변수도 복사가 된것을 확인할수 있다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">com.Student@51521cc1[name=taetaetae,age=20,family=com.Family@1b4fb997]</span><br><span class="line">com.Student@28ba21f3[name=taetaetae,age=20,family=com.Family@694f9431]</span><br><span class="line">com.Family@1b4fb997[name=son,age=25,isOfficeWorkers=true]</span><br><span class="line">com.Family@694f9431[name=son,age=25,isOfficeWorkers=true]</span><br></pre></td></tr></table></figure><h4 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h4><p>멤버변수가 List, Map, Set 등 여러 유형으로 복잡하게 만들어졌을경우 각각 복사를 해주는 등 다양한 케이스에 유연하게 대응할수 있어야 하겠다.<br>객체복사? 그거 그냥 하면 되는거 아냐? 라고 볼수도 있으나 입개발 하는 사람과 직접 구현해보고 내부 코드까지 들여다보는 수고를 하는 사람의 차이는 언젠간 분명히 드러날꺼라 생각한다. (필자가 그랬으니ㅠㅠ)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;자바(Java)로 개발을 하다보면 한번쯤 객체를 복사하는 로직을 작성할때가 있다. 그때마다 나오는 이야기인 &lt;code&gt;Shalldow Copy&lt;/code&gt; 와 &lt;code&gt;Deep Copy&lt;/code&gt;. 한국어로 표현하면 얕은 복사와 깊은 복사라고 이야기를 하는데 이 두 개념의 차이는 아주 간단하다. 객체의 주소값을 복사하는지, 아니면 객체의 실제 값(value)를 복사하는지.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="cloneUtils" scheme="https://taetaetae.github.io/tags/cloneUtils/"/>
    
      <category term="java deep copy" scheme="https://taetaetae.github.io/tags/java-deep-copy/"/>
    
  </entry>
  
  <entry>
    <title>기술블로그 구독서비스 개발 후기 - 2부</title>
    <link href="https://taetaetae.github.io/2018/08/09/daily-dev-blog-2/"/>
    <id>https://taetaetae.github.io/2018/08/09/daily-dev-blog-2/</id>
    <published>2018-08-09T11:37:26.000Z</published>
    <updated>2018-08-13T14:46:10.867Z</updated>
    
    <content type="html"><![CDATA[<p>1부에서는 기술블로그 구독서비스(이하 서비스)를 왜 만들게 되었고 어떤구조로 만들가에 대해 이야기를 해보았다면, 이번 포스팅에서는 만들면서 만나게 된 각종 <code>트러블슈팅 종합세트(?)</code>를 하나씩 풀어보고자 한다. <a id="more"></a>물론 개발을 하면서 아무 문제 없이 잘 되면 당연히 좋겠으나 잘되도 이상한게 개발이라는 세계가 아니던가.<br><div class="figure center" style="width:;"><img class="fig-img" src="why_normal.png" alt="잘 안되면 문제, 잘 되도 문제 ㅠㅠ<br>출처 : https://www.clien.net/service/board/park/9111495"><span class="image-caption">잘 안되면 문제, 잘 되도 문제 ㅠㅠ<br>출처 : https://www.clien.net/service/board/park/9111495</span><span class="caption">잘 안되면 문제, 잘 되도 문제 ㅠㅠ<br>출처 : https://www.clien.net/service/board/park/9111495</span></div></p><ul><li>1부 : <a href="https://taetaetae.github.io/2018/08/05/daily-dev-blog-1/">왜 만들게 되었는가 그리고 어떤 구조로 만들었는가</a></li><li>2부 : <a href="https://taetaetae.github.io/2018/08/09/daily-dev-blog-2/">문제발생 및 Trouble Shooting</a></li><li>3부 : 앞으로의 계획과 방향성</li></ul><p>지난 1부에서 이야기 했던것처럼 문제 - 해결, 문제 - 해결 식으로 나열해보고자 한다. 다소 글의 전개가 뒤죽박죽일수도 있겠지만 말 그대로 <code>트러블슈팅 종합세트</code>이니 독자들의 양해를 미리 구한다.</p><h6 id="트러블-슈팅-리스트"><a href="#트러블-슈팅-리스트" class="headerlink" title="- 트러블 슈팅 리스트"></a>- 트러블 슈팅 리스트</h6><ul><li><a href="#10시에-로직이-실행되었지만-메일을-11시-넘어서-받게-된다">10시에 로직이 실행되었지만 메일을 11시 넘어서 받게 된다.</a></li><li><a href="#제목없는-글-블로그-RSS파싱-오류-간헐적으로-오류가-생긴다">제목없는 글? 블로그 RSS파싱 오류? 간헐적으로 오류가 생긴다.</a></li><li><a href="#메일-내에-class를-적용하여-CSS-처리가-불가능하다">메일 내에 class를 적용하여 CSS 처리가 불가능하다.</a></li><li><a href="#메일을-보냈으나-스팸으로-처리된다">메일을 보냈으나 스팸으로 처리된다.</a></li><li><a href="#Elastic-Stack을-사용할수-없다">Elastic Stack을 사용할수 없다.</a></li><li><a href="#메일-보내는-발송속도가-너무-느리다">메일 보내는 발송속도가 너무 느리다.</a></li><li><a href="#구독해제가-아닌-자체-수신거부는-어찌-처리할까">구독해제가 아닌 자체 수신거부는 어찌 처리할까?</a></li></ul><h3 id="10시에-로직이-실행되었지만-메일을-11시-넘어서-받게-된다"><a href="#10시에-로직이-실행되었지만-메일을-11시-넘어서-받게-된다" class="headerlink" title="# 10시에 로직이 실행되었지만 메일을 11시 넘어서 받게 된다."></a># 10시에 로직이 실행되었지만 메일을 11시 넘어서 받게 된다.</h3><h5 id="👉-해결방안-Divide-and-Conquer"><a href="#👉-해결방안-Divide-and-Conquer" class="headerlink" title="👉 해결방안 : Divide and Conquer"></a>👉 해결방안 : Divide and Conquer</h5><p>본 서비스의 요구사항중 하나는 매일 오전 10시, 구독자들에게 어제 등록된 글을 수집하여 메일로 보내주는게 있다. 우선 로직은 다음과 같은 순서로 진행되게 개발하였고, jenkins 등 별도의 스케쥴러 관리 어플리케이션에 의해 할수도 있었으나 이 또한 심플하게 crontab 에 등록하여 매일 오전 10시에 실행되도록 하였다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. awesome-devblog 에서 블로거들의 RSS 피드를 조회한다.</span><br><span class="line">2. 어제 등록된 글이 있다면 리스트에 담는다.</span><br><span class="line">3. 조회가 끝나면 메일형식에 맞추어 html 문자열을 만든다.</span><br><span class="line">4. 만들어진 문자열을 가지고 등록된 구독자들에게 메일을 보낸다.</span><br></pre></td></tr></table></figure></p><p>로직은 아주 간단했다. 데이터를 파싱하는 방법이나 메일형식에 맞추어 html문자열을 만드는 등 별도의 라이브러리를 사용하는 다소 복잡한 부분만 빼면 단순히 for문과 if문을 조합해서 로직을 구성할수 있었다. 헌데, 10시에 해당로직이 실행되었지만 최대 1시간이 지나고서야 메일을 받는 경우도 있었다. 이게 무슨일일까!?<br>눈치를 챘을수도 있지만 RSS 피드를 조회하는 곳에서 오래걸린 것이다. 티스토리나 네이버등 다른 블로그들은 RSS를 읽고 파싱하는 속도가 그렇게 오래 걸리지 않았는데 (1초 이내) 유독 이글루스 블로그의 RSS파싱이 오래걸리는건 1분까지도 걸리던 것이였다. ( 참고로 <a href="https://github.com/kurtmckee/feedparser" target="_blank" rel="noopener">RSS 파싱모듈</a>, <a href="https://github.com/yaml/pyyaml" target="_blank" rel="noopener">yaml 파싱모듈</a> 을 사용했다. )<br> 아마 RSS의 형식이 약간 달라서 그런것 같긴 한데 그렇다고 이글루스 일 경우에 파싱을 다르게 하는건 좀 그렇고… 추후 이글루스가 아닌 또다른 파싱속도가 느린 블로그의 RSS를 만날수도 있기에 RSS 타입별로 예외처리를 하는건 좀 아닌것 같았다.<br>이런저런 고민끝에 아주 간단하게도 임무(?)를 나누는식으로 해결 하였다. 즉, RSS를 읽고 메일에 보낼 데이터를 만드는 job 하나와 만들어진 데이터를 가지고 이메일을 보내는 job 으로 나눈뒤 RSS를 분석하는 job은 9시에, 메일보내는 job은 10시에 보내도록 해서 생각보다 아주 심플하게 문제를 해결할수 있었다.<br>복잡하고 어려운 문제를 꼭 복잡하고 어렵게만 해결해야하는 법은 없는것 같다. <code>모로 가도 서울만 가면 된다</code>라는 속담이 있지 않는가.</p><h3 id="제목없는-글-블로그-RSS파싱-오류-간헐적으로-오류가-생긴다"><a href="#제목없는-글-블로그-RSS파싱-오류-간헐적으로-오류가-생긴다" class="headerlink" title="# 제목없는 글? 블로그 RSS파싱 오류? 간헐적으로 오류가 생긴다."></a># 제목없는 글? 블로그 RSS파싱 오류? 간헐적으로 오류가 생긴다.</h3><h5 id="👉-해결방안-언제나-신경써야-하는-예외처리-try-catch"><a href="#👉-해결방안-언제나-신경써야-하는-예외처리-try-catch" class="headerlink" title="👉 해결방안 : 언제나 신경써야 하는 예외처리(try-catch)"></a>👉 해결방안 : 언제나 신경써야 하는 예외처리(try-catch)</h5><p>내가 만든 코드는 언제나 내 생각대로<code>만</code> 돌아갔으면 하는건 모든 개발자의 마음과 같다.<br><div class="figure center" style="width:;"><img class="fig-img" src="deploy_pray.jpg" alt="흔한 IT 종사자들.deploy<br>출처 : https://9gag.com/gag/a0Yxw4B/operations-team-before-leaving-for-holidays"><span class="image-caption">흔한 IT 종사자들.deploy<br>출처 : https://9gag.com/gag/a0Yxw4B/operations-team-before-leaving-for-holidays</span><span class="caption">흔한 IT 종사자들.deploy<br>출처 : https://9gag.com/gag/a0Yxw4B/operations-team-before-leaving-for-holidays</span></div><br>하지만 그생각도 잠시 언제나 예외는 발생하기 마련. ( 물론 전혀 예외가 발생 안할수도 있으나 만약 발생하지 않았다 할지라도 발생할수 있는 가능성은 염두해둬야 한다. ) 파싱하는 과정에서 제목이 없는글로 온다거나, 가끔 RSS url 응답이 404 또는 503 인 경우가 있었다. </p><blockquote><p>참고로 필자는 출근이 늦은편이라 아침마다 늦잠을 자곤 했는데 이 서비스를 만들면서 덕분에(?) 9시 에는 메일에 보낼 데이터가 잘 만들어 졌는지, 10시에는 메일이 잘 갔는지 확인을 하다보니 일찍 일어나는 습관이 길러졌다 -ㅁ-</p></blockquote><p>이러한 경우는 예외처리를 해서 제목이 없는 경우엔 임의로 ‘제목없음’ 이라는 제목으로 만들어주고, RSS url 응답이 정상적이지 않는 경우엔 해당 블로그 RSS를 무시할수 있도록 try-catch (python에서는 try-except) 구문을 사용하여 로직 도중에 어떠한 이유라도 중단되는 일이 없도록 하였다.<br>언제나 예외처리는 항상 신경쓰자. 물론 내가 생각한 예외가 전혀 발생하지 않더라도 예외처리를 하는 습관을 기르다 보면 <code>호미로 막을것을 가래로 막는 불상사</code>는 만나지 않을것 같다.</p><h3 id="메일-내에-class를-적용하여-CSS-처리가-불가능하다"><a href="#메일-내에-class를-적용하여-CSS-처리가-불가능하다" class="headerlink" title="# 메일 내에 class를 적용하여 CSS 처리가 불가능하다."></a># 메일 내에 class를 적용하여 CSS 처리가 불가능하다.</h3><h5 id="👉-해결방안-Inline-Style-처리"><a href="#👉-해결방안-Inline-Style-처리" class="headerlink" title="👉 해결방안 : Inline Style 처리"></a>👉 해결방안 : Inline Style 처리</h5><p>개인적으로 디자인을 신경쓰는 개발자(?)인지라 메일보낼때도 그냥 텍스트보다는 그럴싸한 형식으로 메일을 보내고 싶었다. 그래서 Bootstrap을 활용하여 이쁘장하게 만들었는데 막상 보내보니 설정한 class는 다 날라가고 날것의(?) html으로만 보내지는 것이였다. 좀 찾아보니 이메일 내에는 여러 부분에서 html요소들이 제한된다고 한다. ( 관련링크: <a href="https://www.campaignmonitor.com/css/" target="_blank" rel="noopener">이메일 클라이언트 CSS지원</a> )<br>그래서 찾다보니 다행히도 class로 설정된 html을 이쁘게 inline style 로 바꿔주는 서비스(<a href="https://www.myintervals.com/emogrifier.php" target="_blank" rel="noopener">Emogrifier</a>)가 있어서 이를 활용하여 전부 inline style로 바꾸게 되었다. 정말 세상엔 능력자들이 너무 많다…</p><h3 id="메일을-보냈으나-스팸으로-처리된다"><a href="#메일을-보냈으나-스팸으로-처리된다" class="headerlink" title="# 메일을 보냈으나 스팸으로 처리된다."></a># 메일을 보냈으나 스팸으로 처리된다.</h3><h5 id="👉-해결방안-도메인-구입과-DKIM-설정"><a href="#👉-해결방안-도메인-구입과-DKIM-설정" class="headerlink" title="👉 해결방안 : 도메인 구입과 DKIM 설정"></a>👉 해결방안 : 도메인 구입과 DKIM 설정</h5><p>메일 발송은 본 서비스에서 가장 중요한 부분이다. 이런저런 과정을 통해 파싱해서 메일 보낼 데이터를 만들었는데 메일을 못보내면 말짱 꽝이기 때문. 그래서 메일보내는 방법을 다양하게 생각해봤는데 얕은 지식과 더 얕은 경험으로 두가지 방법을 생각할수 있었다.</p><ul><li>자체 SMTP 구축</li><li>Google SMTP 서버 활용</li></ul><p>우선 처음엔 자체 SMTP 구축을 해서 메일을 보내게 되었다. 메일보낼때 시스템 부하가 발생하면 어쩌지 하는 걱정을 하였지만 그 걱정에 앞서 수신자의 이메일이 <code>naver.com</code> 인 경우는 메일이 잘 보내지는데  <code>google.com</code> 인 경우에는 스팸으로 메일이 가게 된것이다. 스팸이라… 전혀 생각하지 못한 예외가 발생하였다!<br>이 서비스를 만들면서 가장 큰 위기였던것 같다. 우선 자체 SMTP를 구축해서 메일을 보내고 있었기에 어떻게든 설정을 통해 ‘난 스팸메일을 보내지 않는다’를 알리고 싶었다. 그에 찾아본 키워드로는 DKIM(DomainKeys Identified Mail)과 SPF(Sender Policy Framework)이 있었으나 … 귀차니즘인건지 열정의 부족인건지 서버에 셋팅하다 포기, 다시 셋팅하다 포기를 몇번을 한지 모른다.<br><div class="figure center" style="width:;"><img class="fig-img" src="i_have_to_live.jpg" alt="가장 큰 위기, 내가 이 서비스를 만들수 있을까? (정치적 메세지는 아닙니다.)<br>출처 : https://news.sbs.co.kr/news/endPage.do?news_id=N1003101192"><span class="image-caption">가장 큰 위기, 내가 이 서비스를 만들수 있을까? (정치적 메세지는 아닙니다.)<br>출처 : https://news.sbs.co.kr/news/endPage.do?news_id=N1003101192</span><span class="caption">가장 큰 위기, 내가 이 서비스를 만들수 있을까? (정치적 메세지는 아닙니다.)<br>출처 : https://news.sbs.co.kr/news/endPage.do?news_id=N1003101192</span></div><br>서버설정으로 스팸을 회피하기는 내 실력으론 부족한걸 인지하고, 다른방법으로 Google SMTP서버를 사용해보았더니 놀랍게도 너무 간단하게 스팸으로 발송이 안되고 정상적으로 메일을 발송할수 있었다. 그러나 그 행복(?)도 잠시 <code>무료</code>라는 키워드엔 언제나 <code>제한</code>이 있기 마련. 계정당 하루 최대 500개밖에 보낼수 없었다. 그렇다면 계정을 여러개 만들면 되는게 아닐까하고 서비스에 적용하기 앞서 계정을 여러개 만들어 테스트를 해보니 실 user당 하루 500개를 넘지 못하는걸 확인할수 있었다. (구글 SMTP를 사용하기 위해서는 항상 본인인증을 하는데 이게 제한 포인트인것같다.) 그럼 결국 Google SMTP도 정답은 아니고…<br>처음 서비스를 만들때 어떠케든 비용이 들지 않는 선에서 만들고 싶었으나 투자하는 시간에 비해 퍼포먼스가 나오지 않아 결국 돈을 지불하고서라도 해야겠다는 마음으로 SMTP 호스팅 업체를 찾다 AWS에 <a href="https://aws.amazon.com/ko/ses/" target="_blank" rel="noopener">SES</a>라는 서비스를 발견하게 된다. 비용은 1,000건당 0.1달라이니 구독자가 1,000명이고 30일을 발송한다고 가정하면 한달에 약 3달라가 드는셈. 원화로 따지면 한달에 3천원인데 나중에는 이 비용조차 줄여볼수 있는 방안을 고려해봐야 겠다. <code>이는 3부에서 정리해본다.</code><br>AWS의 SES를 활용하면 앞서 그토록 어려웠던 스팸메일 우회를 아주 간단하게 할수 있었고, 그러다 보니 도메인도 구매하게 되고 깔끔하게 스팸메일 우회를 처리하면서 도메인도 이쁘게(?) 만들수 있었다. ( 물론 도메인을 구입하면서 부가세 포함 13.2달라가 발생하였지만… <del>열정페이로</del> 이또한 수익을 얻는 구조로 생각을 해봐야 겠다. 1년만 서비스 할게 아니였으니… )<br>AWS의 도메인을 구입하고 AWS-SES를 통해 스팸을 우회하여 메일을 보내는 과정은 아래 포스팅을 참조하였다. (워낙 정리가 잘되어있어 별도로 정리하지는 않고, 링크를 공유하고자 한다.)</p><ul><li><a href="http://jojoldu.tistory.com/246" target="_blank" rel="noopener">http://jojoldu.tistory.com/246</a></li><li><a href="https://insidestory.kr/11477" target="_blank" rel="noopener">https://insidestory.kr/11477</a></li><li><a href="http://blog.naver.com/my0biho/220937119874" target="_blank" rel="noopener">http://blog.naver.com/my0biho/220937119874</a></li></ul><h3 id="Elastic-Stack을-사용할수-없다"><a href="#Elastic-Stack을-사용할수-없다" class="headerlink" title="# Elastic Stack을 사용할수 없다."></a># Elastic Stack을 사용할수 없다.</h3><h5 id="👉-해결방안-직접-만들어버리자"><a href="#👉-해결방안-직접-만들어버리자" class="headerlink" title="👉 해결방안 : 직접 만들어버리자!"></a>👉 해결방안 : 직접 만들어버리자!</h5><p>로깅은 서비스를 운영하는데 있어 하나의 무기가 될수 있다. 기본 서버에서는 아파치와 Elasticsearch, kibana를 동시에 돌릴만한 메모리가 안되었기에 (1G….) 서버 한대를 더 받고 Elasticsearch와 Kibana를 설치하였고 가입자수, 포스팅수 등 다양한 로깅을 보려했는데 몇일이 지나고 AWS에서 메일이 온다.<br><div class="figure center" style="width:;"><img class="fig-img" src="aws_free_tier_alert.jpg" alt="너님, 이대로 가다가는 돈낼수 있으니 참고해!"><span class="image-caption">너님, 이대로 가다가는 돈낼수 있으니 참고해!</span><span class="caption">너님, 이대로 가다가는 돈낼수 있으니 참고해!</span></div><br>한달에 사용할수 있는 서버운영 제한시간이 곧 다가온다는 이야기. 이것저것 검색해보니 Free Tier 일 경우 한달간 서버 한대를 24시간 사용하는데만 무료이고 그 이상은 과금이 나간다고 한다. 덕분에 한 3달라 정도 과금이 발생해버렸다. (정리하면, AWS Free Tier를 사용할경우 24시간 서버 운영시 한달에 한대밖에 사용하지 못한다. 서버를 중지했다가 다시 살리는 수고를 하면 여러대를 사용할수도 있긴 하겠다만 구지…)<br>해서 몇일간 Elasticsearch에 로깅해둔 데이터는 눈물을 머금고 기존 회원들의 이메일 리스트를 담고있는 sqlite3으로 백업 한 뒤 추가로 받았던 Elasticsearch용 서버는 다시 반납을 하게 되고, 이 데이터를 어찌 볼수 있을까 고민끝에 <a href="https://nhnent.github.io/tui.chart/latest/index.html" target="_blank" rel="noopener">tui.chart</a>를 사용하여 뷰를 만들게 된다. (아 물론, <a href="https://naver.github.io/billboard.js/" target="_blank" rel="noopener">billboard.js</a>도 훌륭하다. 개인 취향차이 같다. … )<br><div class="figure center" style="width:;"><img class="fig-img" src="kibana.png" alt="오픈소스인 kibana"><span class="image-caption">오픈소스인 kibana</span><span class="caption">오픈소스인 kibana</span></div><br><div class="figure center" style="width:;"><img class="fig-img" src="log_view.png" alt="직접 만든 뷰, 직접 만들어서인지 더 이뻐보이는건 기분탓이겠지"><span class="image-caption">직접 만든 뷰, 직접 만들어서인지 더 이뻐보이는건 기분탓이겠지</span><span class="caption">직접 만든 뷰, 직접 만들어서인지 더 이뻐보이는건 기분탓이겠지</span></div><br>로깅 뷰는 <a href="http://daily-devblog.com/log/view" target="_blank" rel="noopener">http://daily-devblog.com/log/view</a> 에서 확인이 가능하다. (최근 일주일의 데이터) 이번에 로깅 뷰를 만들면서 느낀거지만 kibana는 정말 좋은 오픈소스 툴인것 같다. 데이터 양이 많으면 자동으로 군집화(?)해서 보여주고… 이런게 스크립트단에서 처리를 하려면 엄청 복잡… 다시한번 ElasticStack을 찬양하며…</p><h3 id="메일-보내는-발송속도가-너무-느리다"><a href="#메일-보내는-발송속도가-너무-느리다" class="headerlink" title="# 메일 보내는 발송속도가 너무 느리다."></a># 메일 보내는 발송속도가 너무 느리다.</h3><h5 id="👉-해결방안-Thread-활용"><a href="#👉-해결방안-Thread-활용" class="headerlink" title="👉 해결방안 : Thread 활용"></a>👉 해결방안 : Thread 활용</h5><p>앞서 메일 보낼 데이터를 만드는 job과 메일을 보내는 job을 나눠서 메일을 보다 빠르게 발송할수 있었는데, 보내야 하는 사람이 많아지다 보니 그만큼 속도가 늦게 보내지는것이였다. 즉, 메일 보낼 사람의 메일이 구독 신청을 빨리해서 메일링 리스트 앞에 있다면 10시 부근에 받는데 최근에 구독 신청을 해서(늦게 구독 신청을 해서) 메일링 리스트의 뒷부분에 있다면 앞사람 다 보내고 받아야 하는 이슈가 있었다. 다시말하면 순차적으로 메일을 보내다보니 사람이 많아질수록 그만큼 늦게 받는 사람이 발생할수 있다는 것.<br>이 문제는 간단히 스레드를 활용해서 해결할수 있었다. 테스트하면서 캡쳐해둔게 있는데 첫번째 스크린샷은 한사람에게 메일을 그냥 10번 반복해서 보냈고 두번째 스크린샷은 스레드를 활용해서 보내보았다. 확실히 스레드를 활용하니 속도가 빠른걸 확인할수 있었다.<br><div class="figure center" style="width:;"><img class="fig-img" src="thread_mail_test_1.jpg" alt="순차적으로 발송했을 경우 : 약 30초 소요"><span class="image-caption">순차적으로 발송했을 경우 : 약 30초 소요</span><span class="caption">순차적으로 발송했을 경우 : 약 30초 소요</span></div><br><div class="figure center" style="width:;"><img class="fig-img" src="thread_mail_test_2.jpg" alt="스레드를 활용했을 경우 : 거의 1초 내외"><span class="image-caption">스레드를 활용했을 경우 : 거의 1초 내외</span><span class="caption">스레드를 활용했을 경우 : 거의 1초 내외</span></div><br>물론 AWS-SES에서 처리하는 메일발송 시간에 따라 달라지겠지만 실제로 스레드를 활용한 메일을 전부 열어보면 거의 동시에 온것을 확인할수 있었다. (구독자가 500명이 되었을때 확인해본 결과 1초 이내에 AWS-SES로 메일을 보낼수 있도록 처리한것을 확인할수 있었다. )</p><h3 id="구독해제가-아닌-자체-수신거부는-어찌-처리할까"><a href="#구독해제가-아닌-자체-수신거부는-어찌-처리할까" class="headerlink" title="# 구독해제가 아닌 자체 수신거부는 어찌 처리할까?"></a># 구독해제가 아닌 자체 수신거부는 어찌 처리할까?</h3><h5 id="👉-해결방안-AWS-반송-거부-확인-메일"><a href="#👉-해결방안-AWS-반송-거부-확인-메일" class="headerlink" title="👉 해결방안 : AWS 반송/거부 확인 메일"></a>👉 해결방안 : AWS 반송/거부 확인 메일</h5><p>미약하지만 메일 발송도 AWS-SES를 사용하다보니 이제는 비용이 발생하게 되었다. 따라서 비용을 최소화 하기 위해서는 쓸떼없는 메일(?)을 발송해선 안된다. 그래서 매일 보내는 메일 하단에 구독 취소룰 할수 있도록 링크를 만들어 뒀는데 이렇게 정상적인 구독취소가 아닌 메일 자체를 사용하고 있는 메일 시스템에서 거부를 할 경우. 이를 어떻게 알고 처리할수 있을까?<br>(역시 AWS~ AWS~)이러한 부분도 AWS에서 가이드를 해주고 있다. (무려 한글 ㅠㅠ 감사…)<br><a href="https://aws.amazon.com/ko/blogs/korea/automatic-managing-bounced-emails-by-amazon-ses/" target="_blank" rel="noopener">https://aws.amazon.com/ko/blogs/korea/automatic-managing-bounced-emails-by-amazon-ses/</a></p><hr><p>물론 또다른 문제들도 있었으나 메이저급(?) 문제들만 다뤄봤다. 가장 컸던건 앞서 말한 메일 스팸처리 ㅠㅠ 도메인도 구입하고 메일보내는데 비용도 들지만 그간 고생하고 삽질했던걸 생각하면 하나도 아깝지 않다. (어쩔수 없는 자본주의일까?)<br>마지막으로 3부에서는 이러한 서비스를 이제 어떤식으로 운영할꺼고, 어떻게 발전시켜 나갈것이며, 수익 모델은 어떻게 생각하고 있는지에 대해 이야기 해보고자 한다. (수익모델이라 하지만… 그저 이 서비스를 운영하는 정도?;;)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;1부에서는 기술블로그 구독서비스(이하 서비스)를 왜 만들게 되었고 어떤구조로 만들가에 대해 이야기를 해보았다면, 이번 포스팅에서는 만들면서 만나게 된 각종 &lt;code&gt;트러블슈팅 종합세트(?)&lt;/code&gt;를 하나씩 풀어보고자 한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
  </entry>
  
  <entry>
    <title>기술블로그 구독서비스 개발 후기 - 1부</title>
    <link href="https://taetaetae.github.io/2018/08/05/daily-dev-blog-1/"/>
    <id>https://taetaetae.github.io/2018/08/05/daily-dev-blog-1/</id>
    <published>2018-08-05T01:27:21.000Z</published>
    <updated>2018-08-13T14:46:14.435Z</updated>
    
    <content type="html"><![CDATA[<p>이번 포스팅은 약간의 자투리 시간을 활용하여 이것저것 만져보다 만들게 된 <code>Daily DevBlog</code>(기술블로그 구독서비스)에 대해 이야기 하려고 한다. <a id="more"></a><br>하나의 글에 관련 내용을 모두 담기에는 양이 많아서 읽는사람도 지루하고, 글을 쓰는 필자 또한 <code>어불성설</code> 할것같아 크게 3개의 시리즈로 나눠서 최대한 자세하고 현장감(?)있게 글을 써보려고 노력했다.</p><ul><li>1부 : <a href="https://taetaetae.github.io/2018/08/05/daily-dev-blog-1/">왜 만들게 되었는가 그리고 어떤 구조로 만들었는가</a></li><li>2부 : <a href="https://taetaetae.github.io/2018/08/09/daily-dev-blog-2/">문제발생 및 Trouble Shooting</a></li><li>3부 : 앞으로의 계획과 방향성</li></ul><p>글에 들어가기 앞서 최종 결과는 <a href="http://daily-devblog.com" target="_blank" rel="noopener">http://daily-devblog.com</a> 에서 확인할수 있다.</p><hr><h4 id="무엇이-나를-움직이게-했는가"><a href="#무엇이-나를-움직이게-했는가" class="headerlink" title="# 무엇이 나를 움직이게 했는가"></a># 무엇이 나를 움직이게 했는가</h4><p>얼마전까지 오픈소스는 정말 실력있는 개발자나 유명한 사람들 말고는 금기의 영역(?)이라고 생각했었지만 최근 <a href="https://taetaetae.github.io/2018/07/01/open-source-software-develpoer-story-review/">오픈소스 개발자 이야기 세미나</a>를 다녀온뒤 마음속에 있었던 벽이 사라지는듯 했다. 세미나를 들으면서 ‘나도 무언가를 만들어 볼수는 없을까?’, ‘회사라는 명찰을 떼면 난 어느 수준에서 개발을 하고 있는 것일까?’ 등 여러 생각들이 머리를 멤돌다 <a href="https://www.slideshare.net/zzsza/intro-102870757" target="_blank" rel="noopener">개발자를 위한 글쓰기</a>라는 글에서 기술블로그들을 모아놓은 <a href="https://awesome-devblog.herokuapp.com" target="_blank" rel="noopener">awesome-devblog</a>를 소개하는 글을 보게 되었고 내 머릿속에 정리안되던 그 생각들은 “이 데이터를 활용해서 무언가를 만들어보자!”로 귀결되었다. </p><blockquote><p>다른 이야기 이지만, awesome-devblog 을 보고 당장 내 블로그도 등록해야지 했었는데 이미 등록이 되어 있었다;; 등록해주신 분께 감사하다는 생각이 들기전에 내 블로그가 누군가에게 보여지고 있구나 하며 새삼 놀라움이 더 컸다.</p></blockquote><h4 id="요구사항과-도구-그리고-설계"><a href="#요구사항과-도구-그리고-설계" class="headerlink" title="# 요구사항과 도구 그리고 설계"></a># 요구사항과 도구 그리고 설계</h4><p>만들려고 생각해봤던 요구사항은 다음과 같다. 마치 회사에서 개발전 스펙을 정리하듯…</p><ol><li>웹페이지를 활용해서 구독하고자 하는 사람들의 이메일을 수집할수 있어야 한다.</li><li>매일 전날 작성된 글을 수집하고 조합하여 구독하고자 하는 사람들에게 메일을 보낼수 있어야 한다.</li></ol><p>위 두가지만 보면 너무 간단했다. 또한 기존에 사용하지 않았던 기술들을 사용해보면서 <code>최대한 심플하게</code> 개발하는것을 첫 개인 프로젝트의 목표로 하고 싶었다. 하여 생각한 아키텍처는 다음과 같다.</p><div class="figure center" style="width:;"><img class="fig-img" src="architecture.png" alt="최대한 심플하게 설계해보자."><span class="image-caption">최대한 심플하게 설계해보자.</span><span class="caption">최대한 심플하게 설계해보자.</span></div><p>데이터는 해당 github에 있길래 그냥 가져다 쓰려고 했으나 그래도 데이터를 관리하시는 분께 허락을 받고 사용하는게 상도덕(?)인것 같아 수소문끝에 연락을 해서 허락받는데 성공하였다.</p><div class="figure center" style="width:;"><img class="fig-img" src="message.png" alt="데이터 사용을 허락해주신 천사같으신분..."><span class="image-caption">데이터 사용을 허락해주신 천사같으신분...</span><span class="caption">데이터 사용을 허락해주신 천사같으신분...</span></div><blockquote><p>이 자리를 빌어 데이터를 사용할수 있도록 <a href="https://www.facebook.com/sarojaba" target="_blank" rel="noopener">허락해주신분</a> 께 감사인사를 표합니다.</p></blockquote><p>홈페이지를 만들기 위해서는 이제껏 삼겹살에 소주처럼(응?) Java에 Spring을 사용해 왔었지만 이번엔 좀 다른 방식을 사용하고 싶었다. </p><div class="figure center" style="width:;"><img class="fig-img" src="language_framework.png" alt="물론 삼겹살에 맥주, 치킨에 소주를 먹어도 되긴 하지만..."><span class="image-caption">물론 삼겹살에 맥주, 치킨에 소주를 먹어도 되긴 하지만...</span><span class="caption">물론 삼겹살에 맥주, 치킨에 소주를 먹어도 되긴 하지만...</span></div><p>최근에 Flask라는 python기반 웹 프레임워크를 만져본 <a href="https://taetaetae.github.io/2018/06/29/simple-web-server-flask-apache/">경험</a>이 있어서 이렇다할 고민없이 빠른 결정을 할수 있었다. 또한 DB는 mysql 이나 기타 memory DB를 사용할까 했지만 이또한 심플하게 파일을 활용하는 sqlite3 을 사용하고자 하였다.</p><h4 id="웹서버-최종-수정-파이널-진짜-확정"><a href="#웹서버-최종-수정-파이널-진짜-확정" class="headerlink" title="# 웹서버_최종_수정_파이널_진짜_확정"></a># 웹서버_최종_수정_파이널_진짜_확정</h4><p>Flask를 활용하기 위해서는 당연히 웹서버가 필요했다. 처음엔 <code>awesome-devblog</code>에서도 사용하고 있던 <a href="https://www.heroku.com/" target="_blank" rel="noopener">https://www.heroku.com/</a> 를 이용해서 해보려 했으나 매일 구독자들에게 메일을 보내는 등 스케쥴러 기능같은건 구현하기 힘들었고 인스턴트 어플리케이션을 등록하는 형태라 사용자의 메일을 입력받고 저장하는 로직을 만들기는 어려워 보였다. (필자가 heroku를 너무 수박 겉핥기식으로 봐서 일수도 있다…)<br>좀더 찾아보니 <a href="https://www.pythonanywhere.com/" target="_blank" rel="noopener">https://www.pythonanywhere.com/</a> 라는 제한적이지만 무료 서비스가 있었는데 웹콘솔도 지원하고 상당히 매력있어 보여서 <code>이거다!</code> 하며 개발을 시작을 했으나 (나름 도메인까지 그럴싸하게 만들었지만… <a href="http://dailydevblog.pythonanywhere.com/" target="_blank" rel="noopener">http://dailydevblog.pythonanywhere.com/</a> ) 세상에 공짜는 없다는 말을 실감하며 앞서 말했던 요구사항을 완벽하게 구현할 수 없는 상황이였다.(request 제한, 스케쥴러 등록 개수 제한 등 보다 여러기능을 사용하기 위해서는 돈을 내고 써야…)<br>마지막 희망으로 언제샀는지 서랍속 깊이 자고있던 라즈베리 파이를 꺼내서 공유기 DDNS설정을 하고 라즈베리안을 설치하며 웹서버를 위한 셋팅을 시도해보았으나 언제나 그렇듯 (시험공부 하기전에 책상 정리하고 괜히 방청소까지 하다가 피곤해서 자버리는듯한 느낌) 배보다 배꼽이 클것같아 이또한 진행하다가 중단하게 된다.<br>결국 AWS에서 1년동안은 무료로 사용할수 있는 <a href="https://aws.amazon.com/ko/free/" target="_blank" rel="noopener">Free Tier</a> 라는걸 발견하고 이참에 나도한번 사용해보자라는 마음을 가지고 과금되지 않게 조심조심 셋팅을 할수 있었다. 물론 뒤에서 이야기 하겠지만 약간의 과금은 필요했다ㅠ (나름 심도깊었던 고민을 한방에 해결해버리는 AWS 짱;; 이래서 AWS~ AWS~ 하는가 싶었다.)</p><div class="figure center" style="width:;"><img class="fig-img" src="select_server.png" alt="돌고 돌다 킹갓엠페러제네럴 AWS를 만나게 된다."><span class="image-caption">돌고 돌다 킹갓엠페러제네럴 AWS를 만나게 된다.</span><span class="caption">돌고 돌다 킹갓엠페러제네럴 AWS를 만나게 된다.</span></div><h4 id="AWS와-DNS-그리고-Elastic-Stack까지"><a href="#AWS와-DNS-그리고-Elastic-Stack까지" class="headerlink" title="# AWS와 DNS, 그리고 Elastic Stack까지"></a># AWS와 DNS, 그리고 Elastic Stack까지</h4><p>AWS Free Tier 에서는 참 고맙게도 다른사람들이 접속할수있도록 공인 IP를 제공해 줬다. 그래서 아파치에 Flask를 연동까지 하고 최대한 심플하게 웹페이지를 작성하여 접속이 가능하도록 했는데 문제는 IP주소로 서비스를 하기에는 뭔가 2% 부족해보였다. 그래서 무료 도메인을 찾아다니던 도중 <a href="https://freedns.afraid.org/" target="_blank" rel="noopener">https://freedns.afraid.org/</a> 이라는 서비스를 찾고 결국 <a href="http://daily-devblog.mooo.com" target="_blank" rel="noopener">http://daily-devblog.mooo.com</a> 라는 도메인으로 AWS에 설정된 공인IP를 연동시킬수 있었다. (지금은 redirect 시켜둔 상태, 2부에서 왜 도메인을 구입했는지에 설명할 예정이다.)<br>또한 예전 조직장님의 말씀이 떠올라 서비스에서의 또다른 인사이트를 찾기 위해 EC2 서버 한대 더 발급받아 (한대에 전부 올리기에는 메모리가 부족했다;;) Elastic Stack 을 셋팅하여 로깅을 할수 있었고 이를 아래 그림처럼 키바나로 시각화 할수 있었다. (이 얼마나 아름다운가… 다시한번 Elastic Stack 에 무한 감동을;;)</p><div class="figure center" style="width:;"><img class="fig-img" src="kibana.png" alt="각종 로깅을 통해 만들어낸 우아한 대시보드"><span class="image-caption">각종 로깅을 통해 만들어낸 우아한 대시보드</span><span class="caption">각종 로깅을 통해 만들어낸 우아한 대시보드</span></div><p>하지만 탄탄대로일것만 같았던 첫번째 개인 프로젝트는 여러가지 문제점들이 발생하였고 한 일주일동안 두세시간 자며 트러블 슈팅을 해야만 했었다. (업무시간을 피해가며 하다보니 시간이 나질 않았다…)</p><hr><p>우선 여기까지, 서비스를 만들게 된 계기와 전체 구조에 대해 이야기를 해보았고 다음 2부에서 하게될 이야기는 이보다 훨씬더 복잡하고 피곤한(?) 이야기로 포스팅 될것같다. 이야기의 흐름이 <code>문제 - 해결</code>, <code>문제 - 해결</code> 식의 java.util.Map 구조라고 해야하나…</p><p>2부를 기대해 본다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;이번 포스팅은 약간의 자투리 시간을 활용하여 이것저것 만져보다 만들게 된 &lt;code&gt;Daily DevBlog&lt;/code&gt;(기술블로그 구독서비스)에 대해 이야기 하려고 한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="python" scheme="https://taetaetae.github.io/tags/python/"/>
    
      <category term="aws" scheme="https://taetaetae.github.io/tags/aws/"/>
    
      <category term="flask" scheme="https://taetaetae.github.io/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>2018 오픈소스개발자이야기 후기</title>
    <link href="https://taetaetae.github.io/2018/07/01/open-source-software-develpoer-story-review/"/>
    <id>https://taetaetae.github.io/2018/07/01/open-source-software-develpoer-story-review/</id>
    <published>2018-07-01T01:00:00.000Z</published>
    <updated>2018-07-29T08:31:26.241Z</updated>
    
    <content type="html"><![CDATA[<p>Facebook그룹들을 눈팅하다(?) OSS개발자 포럼에서 <code>오픈소스 개발자이야기</code>라는 주제로 세미나를 주최한다는 공지를 보게되었다. 언제부턴가 트랜드에 뒤쳐지지 않으려는 몸부림중 세미나같은 외부 개발 행사에 참여해보자는 마음으로 공지를 보자마자 홀린듯이 신청을 하게 되었고<a id="more"></a> 세미나를 듣고 감흥이 가시기 전에 후기를 적고자 한다.(시간이 지나면 잊어버릴것만같은, 보고 들은 생생한 그 무언가를 얻었기에…)</p><div class="figure center" style="width:;"><img class="fig-img" src="first.png" alt=""></div><p>비가오는 주말이였지만 많이 배우고 오자는 설레임을 갖고 서울 광화문 근처에 있는 한국마이크로소프트로 가게되었다. 말로만 듣던 MS사 로고를 보고 사람들이 하나둘씩 모이는걸 보니 뭔가 배울수 있겠구나 하는 기대감이 생겼다. 사실 오픈소스를 사용만 해본 입장이라 실제 오픈소스에 기여하시는 분들은 어떤 생각들을 갖고 계시는지가 가장 궁금했고 개발자인 나도 언젠간 오픈소스에 기여할수있지 않을까 하는 생각을 하며 발표를 들었다.</p><h4 id="회색지대-이상과-현실-오픈소스-저작권-신정규-님"><a href="#회색지대-이상과-현실-오픈소스-저작권-신정규-님" class="headerlink" title="# 회색지대 : 이상과 현실 - 오픈소스 저작권 / 신정규 님"></a># 회색지대 : 이상과 현실 - 오픈소스 저작권 / 신정규 님</h4><div class="figure center" style="width:;"><img class="fig-img" src="01.png" alt=""></div><p>오픈소스는 아무리 말그대로 <code>Open</code>이지만 오픈소스마다 다양한 저작권을 갖고있고 서로 쟁취하려는 싸움이 많이 발생한다고 한다. 그러다보니 어떠한 프로그램을 만들고 오픈소스화 시킬때도 라이센스의 종류를 잘 결정해야 추후 불이익을 당하는 상황을 모면할수 있다고 한다. 특허와 라이센스는 같은 말이면서도 다른데 아래 표처럼 각 상황에 따라 다른 부분을 확인할수 있었다.</p><table><thead><tr><th></th><th>특허</th><th>라이센스</th></tr></thead><tbody><tr><td>권리발생</td><td>출원, 심사, 등록</td><td>창작과 동시 발생</td></tr><tr><td>권리내용</td><td>독점배타적 실시권</td><td>인격권/재산권</td></tr><tr><td>효력범위</td><td>아이디어의 동일성</td><td>표현의 실질적 유사성</td></tr></tbody></table><p>첫 시간이기도 하였고 아무래도 주제가 끝장토론을 해도 안끝날 주제였던지라 정해진 시간을 넘길정도로 이야기를 많이 해주셨다. 특히 오픈소스 관련된 이야기는 <code>사례</code>를 이야기 해야 재밌다고 하셨는데 시간관계상 몇가지만 말씀해주셨다.</p><ul><li>링크가 맞는지는 모르겠으나 첨부해본다.<ul><li><a href="https://ko.wikipedia.org/wiki/%EC%97%98%EB%A6%BC%EB%84%B7%EA%B3%BC_%ED%95%98%EC%9D%B4%EC%98%A8%EB%84%B7_%EC%82%AC%EA%B1%B4" target="_blank" rel="noopener">엘림넷 vs 하이온넷 사건</a></li><li><a href="https://namu.wiki/w/EFM%20%EB%84%A4%ED%8A%B8%EC%9B%8D%EC%8A%A4#s-3.3" target="_blank" rel="noopener">EFM Networks</a></li><li><a href="https://www.oss.kr/oss_guide/show/5a251739-761d-4199-a2ce-a6103f6b7ca0" target="_blank" rel="noopener">오라클 VS 구글</a></li></ul></li></ul><p>오픈소스 개발에 대해 단순하게 누구나 수정할수 있는 환경 이라고만 생각을 하고있다가 이런 복잡한 라이센스 문제가 나오니 약간 어려웠지만, 오픈소스의 생태계를 알고 발을 들이기 위해서는 어느정도의 히스토리는 알아야 겠다고 느끼게 되었다.</p><h4 id="Elastic-에서-Remote-로-일하기-김종민-님"><a href="#Elastic-에서-Remote-로-일하기-김종민-님" class="headerlink" title="# Elastic 에서 Remote 로 일하기 / 김종민 님"></a># Elastic 에서 Remote 로 일하기 / 김종민 님</h4><div class="figure center" style="width:;"><img class="fig-img" src="02.png" alt=""></div><p>그전부터 Elastic 제품들을 실무에서도 사용해 왔었기에 개인적으로 오늘 발표중에 가장 궁금했었고, 관심이 있던 시간이였다. 발표에 앞서 어떻게 Elastic에 들어가게 되셨고 회사 소개를 간단히 해주셨는데 생각보다 어마어마한 회사다고 느낄수 있었다.(800여명중 한국엔 9명 / 네덜란드 출신 스타트업 인데 본사는 캘리포니아 마운틴뷰에 있고 등등)<br>원격근무는 편하고 비용이 절약되는 장점이 있으나 동료들간의 유대감형성이 힘들거나 회의시 집중이 힘든 단점도 있다는 점을 말씀해 주셨다.<br>시간관계상 몇가지 링크들을 소개해주셨는데 나중에 봐볼 생각이다.</p><ul><li><a href="https://www.youtube.com/watch?v=dx65VsvWsuM" target="_blank" rel="noopener">침대에서 회사까지 1분</a></li><li><a href="http://it.chosun.com/site/data/html_dir/2018/05/03/2018050385084.html" target="_blank" rel="noopener">[마소 392호] 리모트 워크의 중심에 서보다</a></li></ul><p>원격 툴로는 다음과 같이 사용한다고 한다.</p><ul><li>github : 슬랙연동, 개발뿐 아니라 운영/기획/이벤트 공유시 활용</li><li>Google Apps</li><li>Slack : 봇 활용 (다양한 종류의 봇, 상황마다 특정 알림을 준다.)</li><li>salesforce : CRM 툴</li><li>zoom : 화상회의 200명 동시콜 가능, 회의가 끝나면 녹음/녹화/스크립팅까지 가능하다고 한다 (wow)</li><li>pinboard : 근태/인사 관리용 앱</li><li>jira는 사용 잘 안함</li></ul><p>나중에 팀 내 Slack 봇으로 여러가지 다양한 자동화를 구성할수 있을것 같다는 생각이 들었다.</p><h4 id="오픈소스-생태계-일원으로서의-개발자-변정훈-님"><a href="#오픈소스-생태계-일원으로서의-개발자-변정훈-님" class="headerlink" title="# 오픈소스 생태계 일원으로서의 개발자 / 변정훈 님"></a># 오픈소스 생태계 일원으로서의 개발자 / 변정훈 님</h4><div class="figure center" style="width:;"><img class="fig-img" src="03.png" alt=""></div><p>사회자분이 “아웃사이더님”이라고 하시길래 설마 했다. 뭐가 잘 안되면 구글링을 하게되는데 내가 자주 보던 블로그를 운영하셨던 분이 내눈앞에 ㄷㄷ…<br>언제부터 해야지~가 아니고 개발하다보니 어느새 오픈소스에 참여하고 있었다고 한다. 또한 참여하는게 아니고 이미 오픈소스 생태계속에서 살고있는 우리들이라 말씀하시고, 오픈소스 Contribution 방법으로는 사용/홍보/번역/리포팅/문서화/코드제출 등 다양하게 있으니 어렵게 생각하지 말자 라고 하셨다. 오픈소스에서 배울수 있는점은 커뮤니케이션의 방법, 협업의 방법과 중요성, 테스트코드의 중요성, 지속적 통합/지속적 배포, 코드의 품질관리 라고 한다.<br>점점 발표를 들으면서 오픈소스에 대한 생각이 바뀌고 있는 내 자신을 느낄수 있었다. 너무 어렵게만 생각해 온것 같다는.</p><h4 id="해외-오픈소스-컨퍼런스-발표와-참여-송태웅-님"><a href="#해외-오픈소스-컨퍼런스-발표와-참여-송태웅-님" class="headerlink" title="# 해외 오픈소스 컨퍼런스 발표와 참여 / 송태웅 님"></a># 해외 오픈소스 컨퍼런스 발표와 참여 / 송태웅 님</h4><div class="figure center" style="width:;"><img class="fig-img" src="04.png" alt=""></div><p>리눅스 파운데이션 이벤트에서 밸표했던 경험을 공유해주셨다. 발표에 앞서 나이가 어려보였는데 저렇게 세계적인 곳에 가서 발표를 할수있다는 용기와 대범함에 발표를 듣는 내내 놀라움을 감출수 없었다.<br>특히 영어에 대해 이야기를 해주셨는데 영어지만 IT전문용어가 있기 때문에 어느정도 질문에 답변이 가능할수 있었고, 영어를 잘하는것보다 기술을 더 깊이 이해하는게 좋다고 한다.(물론 기본적인 영어실력은 필수) 그리고 인상깊었던 말중에 “세미나 같은곳에 가면 질문 하나는 꼭 하자, 그냥 듣는것보다 질문에 대한 내용은 오래 기억이 남으니까” 라는 말이 뒤통수를 쌔게 후려 쳤다. 하지만 오늘 질문은… 못했다. 다음엔 꼭 하리라 다짐을 하며…</p><h4 id="파이썬-파이콘-파이썬소프트웨어재단-김영근-님"><a href="#파이썬-파이콘-파이썬소프트웨어재단-김영근-님" class="headerlink" title="# 파이썬, 파이콘, 파이썬소프트웨어재단  / 김영근 님"></a># 파이썬, 파이콘, 파이썬소프트웨어재단  / 김영근 님</h4><div class="figure center" style="width:;"><img class="fig-img" src="05.png" alt=""></div><p>PSF(Python Software Foundation)에서 하는 일과 간략한 파이썬에 대한 이야기를 해주셨다.<br>여담으로, 파이썬 2.x는 파이썬 커뮤니티에서는 전전전 여친 수준으로 잊고 있으니 3.x를 사용하라는 말씀도 해주셨다. 존중과 다양성을 가치로 두고있고 예컨데, 필리핀에서는 어린아이도 발표를 하고 여성 발표자도 점점 늘어나는 추세라고 한다. 파이썬은 문제 해결 하는데 있어 적어도 두번째로 좋은 언어다 라고 자부할수 있고, 애니메이션ㆍ영화 에서도 파이썬을 사용하고 있다고 한다. 또한 스프린트 라는 행사를 개최하여 외부에서 사람들이 직접 Contribution을 할수 있도록 도와주면서 누구나 파이썬에 Contribution을 할수 있는 순환구조를 만든다고 한다.<br>가장 인상깊었던 문구가 있었는데 사진은 못찍었고 대신 텍스트로 남겨본다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">동료 의식에서 시작되는 존중과 배려</span><br><span class="line">- 를 바탕으로한 소속감과 참여감</span><br><span class="line">- 에서 비롯되는 기여</span><br><span class="line">- 를 통해 발전하는 생태계</span><br><span class="line">- 에 모여드는 사람들</span><br><span class="line">- 사이에서 싹트는 동료의식</span><br><span class="line">(반복)</span><br></pre></td></tr></table></figure></p><p>딱! 내가 바라는(?) 개발 문화다. 이번 파이콘 행사가 기대가 더욱더 기대가 된다!</p><h4 id="아파치-제플린-프로젝트-시작부터-아파치-탑레벨-프로젝트가-되기까지-이문수-님"><a href="#아파치-제플린-프로젝트-시작부터-아파치-탑레벨-프로젝트가-되기까지-이문수-님" class="headerlink" title="# 아파치 제플린, 프로젝트 시작부터 아파치 탑레벨 프로젝트가 되기까지 / 이문수 님"></a># 아파치 제플린, 프로젝트 시작부터 아파치 탑레벨 프로젝트가 되기까지 / 이문수 님</h4><div class="figure center" style="width:;"><img class="fig-img" src="06.png" alt=""></div><p>아파치 제플린은 실무에서도 자주 사용하고 있는 오픈소스이다. 그런데 이 발표를 하기위해 저멀리 미국에서 오셨다는 아파치 제플린의 CTO님. 개인적으로 정말 대단해 보였다. 특히 제플린을 만든 계기부터 아파치 탑레벨 프로젝트로 되기까지의 과정이 정말 매력적으로 보였는데 2013년 10월경 하둡관련 화면단의 분석시스템이 없어 불편해서 만들기 시작하였고, 이를 여러 커뮤니티에 직접 홍보를 해가며 인큐베이션을 거쳐 결국 아파치 프로젝트로 되었다는 이야기.<br>왜 나는 못할까 라는 자괴감도 살짝 들었으나 저분의 끈기와 실행력은 높이 평가하고 싶고 또한 배우고 싶은 부분이였다. (외모는 여느 CTO처럼 거만하지 않았는데 말은 조리있게 잘하시고^^;)</p><h4 id="오픈소스-개발자에게-듣다-대담"><a href="#오픈소스-개발자에게-듣다-대담" class="headerlink" title="# 오픈소스 개발자에게 듣다(대담)"></a># 오픈소스 개발자에게 듣다(대담)</h4><p>질의응답 시간이였다.<br>Q. 오픈소스에 쉽게 기여할수 있는 방법?</p><ul><li>Github에 가보면 초보자들을 위한 이슈를 남겨놓은 경우도 있다.</li><li>조그마한 문서 수정부터 시작하자.</li><li>기여는 코드만 있는게 아니다. (e.g. 버그리포트 등)</li></ul><p>Q. 오픈소스 홍수시대에 살고있는데 어떤것을 파야하나요?</p><ul><li>유명한 코드는 너무 방대해서 보기 힘들다. 그걸 만든 사람의 토이 프로젝트를 보며 감을 익혀보자.</li></ul><p>Q. 처음으로 기여한 오픈소스는 무엇이며 어떻게 기여하였나?</p><ul><li>문서수정, 간단한 텍스트를 수정하는것부터 시작</li><li>내가 사용하는 프로젝트를 관심있게 보다가 인사이트를 찾아 수정</li><li>번역 또한 오픈소스에 기여</li></ul><p>Q. 오픈소스에서 활동하는것과 회사 업무와 비교시 장단점, 입사시 유리한가?</p><ul><li>회사업무보단 재밌다. Github계정을 기준으로 평가하기도 한다.</li><li>오픈소스 컨튜리뷰션은 내 개발 역사라고 볼수있다.</li></ul><p>Q. 개발자라면 꼭 읽어봐야할 책이 있다면 추천</p><ul><li>개발보단 사람과의 커뮤니케이션 관련된 책</li><li>기본서는 여러번 읽을수록 새롭다.</li></ul><h4 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h4><div class="figure center" style="width:;"><img class="fig-img" src="07.png" alt="전망좋은 MS, 사은품으로 받은 MS 티셔츠"><span class="image-caption">전망좋은 MS, 사은품으로 받은 MS 티셔츠</span><span class="caption">전망좋은 MS, 사은품으로 받은 MS 티셔츠</span></div><p>일명 <code>네임드 개발자</code>분들을 만나고 나니 한편으론 부럽기도 하였지만 한편으론 동기부여를 얻어간다. 첫불에 배부르랴, 조그마한것부터 시작하다보면 나도 언젠간 <code>네임드</code> 소리를 들으며 지금보다 조금이라도 발전된 내가 될수 있다는 자신감을 얻을수 있었던, 직장인으로써 황금같은 토요일이 아깝지 않을 만큼 정말 좋았던 시간이였다! (행사에 자주 와야겠다!)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Facebook그룹들을 눈팅하다(?) OSS개발자 포럼에서 &lt;code&gt;오픈소스 개발자이야기&lt;/code&gt;라는 주제로 세미나를 주최한다는 공지를 보게되었다. 언제부턴가 트랜드에 뒤쳐지지 않으려는 몸부림중 세미나같은 외부 개발 행사에 참여해보자는 마음으로 공지를 보자마자 홀린듯이 신청을 하게 되었고
    
    </summary>
    
      <category term="blog" scheme="https://taetaetae.github.io/categories/blog/"/>
    
    
      <category term="oss" scheme="https://taetaetae.github.io/tags/oss/"/>
    
      <category term="open source software" scheme="https://taetaetae.github.io/tags/open-source-software/"/>
    
      <category term="review" scheme="https://taetaetae.github.io/tags/review/"/>
    
  </entry>
  
  <entry>
    <title>초간단 API서버 만들기 - 2부 (Python + Flask + Nginx)</title>
    <link href="https://taetaetae.github.io/2018/07/01/simple-web-server-flask-nginx/"/>
    <id>https://taetaetae.github.io/2018/07/01/simple-web-server-flask-nginx/</id>
    <published>2018-06-30T17:00:00.000Z</published>
    <updated>2018-07-29T08:31:26.442Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://taetaetae.github.io/2018/07/01/simple-web-server-flask-apache/">지난포스팅</a>에 이어 이번엔 Flask와 Nginx를 연동하는 방법을 정리해보고자 한다. Apache로 연동했는데 왜 또 Nginx로 연동하는걸 정리하지(?)하며 의문이 들수 있는데 다른 포스팅을 봐도 <a id="more"></a> Apache + Flask 조합보다 Nginx + Flask 조합이 더 많고 지난 포스팅에서도 알수있었듯이 (<a href="https://taetaetae.github.io/2018/06/27/apache-vs-nginx/">Apache VS Nginx</a>) 둘중 어느것이 좋다고 할수도 없고 각 상황에서 연동하는 방법을 알고 있다면 이 또한 나만의 무기가 될것같아 Nginx를 연동하는 방법을 정리해보려 한다.<br><div class="figure center" style="width:;"><img class="fig-img" src="flask-apache-nginx.png" alt=""></div></p><p>1부에서 왜 Flask인가, Flask의 장점에 대해 정리를 했으니 이번 포스팅에서는 별도로 작성하진 않는다.</p><h3 id="Nginx-설치-https-nginx-org-en"><a href="#Nginx-설치-https-nginx-org-en" class="headerlink" title="# Nginx 설치 ( https://nginx.org/en/ )"></a># Nginx 설치 ( <a href="https://nginx.org/en/" target="_blank" rel="noopener">https://nginx.org/en/</a> )</h3><p>역시 소스설치를 한다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- 다운을 받고</span><br><span class="line">$ https://nginx.org/download/nginx-1.14.0.tar.gz</span><br><span class="line">- 압축을 푼 다음</span><br><span class="line">$ tar -zxvf nginx-1.14.0.tar.gz</span><br><span class="line">- 폴더로 이동해서 </span><br><span class="line">$ cd nginx-1.14.0</span><br><span class="line">- 설치할 디렉토리를 설정하고</span><br><span class="line">$ ./configure --prefix=/~~~/apps/nginx</span><br><span class="line">- make 파일을 만들고</span><br><span class="line">$ make</span><br><span class="line">- 설치를 진행한다.</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure></p><p>이렇게 하면 일단 Nginx는 설치가 되었다.</p><h3 id="uWSGI-설치-https-uwsgi-docs-readthedocs-io"><a href="#uWSGI-설치-https-uwsgi-docs-readthedocs-io" class="headerlink" title="# uWSGI 설치 ( https://uwsgi-docs.readthedocs.io/ )"></a># uWSGI 설치 ( <a href="https://uwsgi-docs.readthedocs.io/" target="_blank" rel="noopener">https://uwsgi-docs.readthedocs.io/</a> )</h3><p>앞서 Apache와 연동할때는 별도의 모듈을 Apache에게 등록하는 형태였다면 Nginx는 WSGI프로토콜을 활용하는 WSGI 어플리케이션을 실행하는 어플리케이션 서버를 활용해야 한다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- 다운을 받고</span><br><span class="line">$ wget https://projects.unbit.it/downloads/uwsgi-latest.tar.gz</span><br><span class="line">- 압축을 풀고</span><br><span class="line">$ tar zxvf uwsgi-latest.tar.gz</span><br><span class="line">- 폴더로 이동하여</span><br><span class="line">$ cd uwsgi-2.0.17</span><br><span class="line">- make 명령어를 호출하면 &apos;uwsgi&apos;이라는 실행파일이 생성된다.</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure></p><h3 id="Nginx-설정"><a href="#Nginx-설정" class="headerlink" title="# Nginx 설정"></a># Nginx 설정</h3><p>Apache와 비슷하게 uWSGI 관련 설정을 해준다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen       80;</span><br><span class="line">  server_name  localhost;</span><br><span class="line"></span><br><span class="line">  location / &#123; # ( / ) 경로로 들어올 경우</span><br><span class="line">    include uwsgi_params; # GET/POST 등 기본적으로 필요한 환경변수를 include 해준다.</span><br><span class="line">    uwsgi_pass 127.0.0.1:3031; # 요청을 IP:PORT로 전달한다.</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>별도의 모듈을 사용하지 않기때문에 전달해주는 (proxy느낌) 설정을 해준다.</p><h3 id="uWSGI-실행-및-Nginx-재시작"><a href="#uWSGI-실행-및-Nginx-재시작" class="headerlink" title="# uWSGI 실행 및 Nginx 재시작"></a># uWSGI 실행 및 Nginx 재시작</h3><p>앞서 설치한 <code>uwsgi</code>를 아래처럼 IP:port 를 명시적으로 적어주고 (위에서 전달받은 IP:PORT와 동일하게) Apache 연동시 활용했던 wsgi파일을 이번에도 동일하게 사용하도록 해서 실행한다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./uwsgi -s 127.0.0.1:3031 --wsgi-file /~~~/python_app/hello_world.wsgi</span><br></pre></td></tr></table></figure></p><p>이렇게 하면 background로 실행되는게 아닌 foreground로 실행되기 때문에 <code>&amp;</code>을 사용한다던지 해서 background로 실행되도록 해준다. 그후 Nginx를 재시작 해주면 원하는 그토록 원했던 <code>Hello World!</code>를 만날수가 있게 된다.</p><p>Apache연동과 조금 다른점은 모듈을 사용하지않고 별도의 전달 어플리케이션(?)이 필요하다는점이다. 간단히 Apache처럼 모듈만 넣으면 되는게 아니라서 불편할수도 있을것 같지만 한편으로는 관리할수있는 포인트가 더 늘어난 셈이라 어떤 측면에서는 활용할수 있는 방법이 하나 늘어난것으로 볼수도 있다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>막상 정리하고 나면 아무것도 아닌데 알기 위해서 몸부림을 쳐가며 책이며 구글링을 하는 과정을 통해 점점 성장을 하는것 같다. (성장통이라고나 할까) 이렇게 단순히 Flask를 할수있다 가 아닌 웹서버를 연동할수있다. 그것도 Apache와 Nginx 두개나. 이것도 언젠간 나만의 무기가 되지 않을까?</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://taetaetae.github.io/2018/07/01/simple-web-server-flask-apache/&quot;&gt;지난포스팅&lt;/a&gt;에 이어 이번엔 Flask와 Nginx를 연동하는 방법을 정리해보고자 한다. Apache로 연동했는데 왜 또 Nginx로 연동하는걸 정리하지(?)하며 의문이 들수 있는데 다른 포스팅을 봐도
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="apache" scheme="https://taetaetae.github.io/tags/apache/"/>
    
      <category term="nginx" scheme="https://taetaetae.github.io/tags/nginx/"/>
    
      <category term="web server" scheme="https://taetaetae.github.io/tags/web-server/"/>
    
      <category term="flask" scheme="https://taetaetae.github.io/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>초간단 API서버 만들기 - 1부 (Python + Flask + Apache)</title>
    <link href="https://taetaetae.github.io/2018/06/29/simple-web-server-flask-apache/"/>
    <id>https://taetaetae.github.io/2018/06/29/simple-web-server-flask-apache/</id>
    <published>2018-06-29T14:00:00.000Z</published>
    <updated>2018-07-29T08:31:26.435Z</updated>
    
    <content type="html"><![CDATA[<p>Static한 HTML이 아닌 로직이 필요한 API서버를 구성한다고 가정해보자. (이제까지 지식으로)처음 머릿속에 떠오르는건 Java를 사용하고 스프링으로 어플리케이션을 만들고 apache에 tomcat을 연동한 다음 …<a id="more"></a> 이러한 방법으로 API서버를 구성할수 있겠지만 프로토타이핑 또는 테스트 목적으로 만들기 위해서는 설정하는 시간이 은근 많이 소요된다. (물론 Java Config, Spring Boot 등 간소해졌지만…)<br>얼마전부터 Python에 대한 매력을 뼈저리게 느끼고 있다보니 Python으로 API서버를 구성할순 없을까 알아봤고 (모바일 게임 듀랑고 서버가 python이라고 하기도 하고…) <code>Flask</code>와 <code>Django</code>가 있어서 둘다 써본 결과 필자는 <code>Flask</code>가 맞겠다고 생각해서 정리를 해볼까 한다.<br><div class="figure center" style="width:;"><img class="fig-img" src="flask-apache-python.png" alt=""></div></p><blockquote><p>‘장고’라고도 불리는 Django에는 모든것들이 다 들어가 있어서 사용하기 너무 편리하다. (DB, 어드민 등 ) 하지만 Flask는 내가 사용할 것들만 import해서 사용하는 방식이라 어떤 측면에서는 아무것도 없다 할수 있겠으나 커스터마이징에 용이하다고 볼수 있었기에 Flask를 선택하게 되었다. (Django가 Flask보다 안좋다는 말은 아니니 오해는 하지 마시길…)</p></blockquote><p>글쓰기에 앞서 본 포스팅은 2개의 포스팅에 걸쳐 시리즈(?)형식으로 작성할 예정이다. 1부에서는 Flask가 무엇이고 이를 어떻게 사용하며 Apache와 연동하는 방법을 소개하고, 2부에서는 Nginx와 연동하는 방법을 소개한다.<br>환경은 다음과 같다.</p><ul><li>CentOS 7.4</li><li>Python 3.6 (기본은 2.7이였으나 추가로 설치)</li></ul><h3 id="Flask-http-flask-pocoo-org"><a href="#Flask-http-flask-pocoo-org" class="headerlink" title="# Flask ( http://flask.pocoo.org/ )"></a># Flask ( <a href="http://flask.pocoo.org/" target="_blank" rel="noopener">http://flask.pocoo.org/</a> )</h3><p>공식 홈페이지에서도 보면 알수 있듯이 너~무 간단하다. 단지 아래 코드 몇줄만 작성하면 우리가 모든 프로그램 초기 작성시 항상 만나는 “Hello World”를 볼수 있다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#hello_world.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World!"</span></span><br></pre></td></tr></table></figure></p><p>위와같이 작성하고 <code>python hello.py</code>로 실행해두고 브라우저에서 <code>http://127.0.0.1:5000</code> 을 요청하면 반가운 Hello World를 만날수 있다. (너무 간단;;) 자세한 문법은 <a href="http://flask.pocoo.org/docs" target="_blank" rel="noopener">도큐먼트</a>를 참조하면 될듯하고 이 Flask를 잘만 활용한다면 보다 빠르고 간단하게 API서버를 구성할수 있을거라 생각한다.</p><p>Hello World를 찍었으면 된거 아닌가 라고 질문할수도 있겠으나 실제 서비스에서 사용하기 위해서는 앞단에 웹서버를 두는게 여러 측면에서 효율적이다. 주로 사용하는 웹서버는 Apache 와 Nginx가 있는데 여기서는 Apache와 연동하는 방법을 정리 해보고자 한다.</p><h3 id="Apache-설치-http-archive-apache-org"><a href="#Apache-설치-http-archive-apache-org" class="headerlink" title="# Apache 설치 ( http://archive.apache.org/ )"></a># Apache 설치 ( <a href="http://archive.apache.org/" target="_blank" rel="noopener">http://archive.apache.org/</a> )</h3><p>우선 필자는 <code>yum</code> 이나 <code>apt-get</code>처럼 패키지 관리자로 설치하는것을 그렇게 좋아하지 않는다. 이유는 커스터마이징을 할 경우 시스템 어느곳에 설치되어있는지를 한눈에 파악하기 어렵고 윈도우경우 <code>Program Files</code>처럼 내가 추가로 설치하고 관리하는 프로그램들을 한곳에서 관리하고 싶기에 왠만하면 소스를 직접 컴파일하여 설치하곤 한다. 이번 역시 아파치도 소스로 설치하려고 한다.<br>현재 아파치는 2.4버전이 Stable버전으로 되어있지만 보다 레퍼런스가 많은 2.2버전으로 설치하기 위해 어렵게 아카이빙된 경로를 통해 다운을 받고 설치를 한다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- 다운을 받고</span><br><span class="line">$ wget http://archive.apache.org/dist/httpd/httpd-2.2.29.tar.gz </span><br><span class="line">- 압축을 푼 다음</span><br><span class="line">$ tar xvzf httpd-2.2.29.tar.gz</span><br><span class="line">- 해당 폴더로 들어가</span><br><span class="line">$ cd httpd-2.2.29</span><br><span class="line">- 컴파일 후 설치 경로를 정해주고</span><br><span class="line">$ ./configure --prefix=/~~~/apps/apache</span><br><span class="line">- make 파일을 만든다음</span><br><span class="line">$ make</span><br><span class="line">- 설치를 해준다.</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure></p><p>이렇게 되면 /~~~/apps/apache/ 하위에 필요한 파일들이 설치가 되는데 root계정이 아닌 일반계정으로 실행하기 위해서는 /bin하위에 있는 httpd에 대한 실행/소유권한을 변경해줘야 한다. (아니면 그냥 root권한으로 시작/종료. 왜? Apache는 80port를 사용하는데 일반적으로 리눅스에서는 1024 아래 port를 컨트롤 하기 위해서는 root권한이 있어야 사용이 가능, 그게 아니라면 이처럼 별도의 설정이 필요하다.)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown root:계정명 httpd</span><br><span class="line">$ sudo chmod +s httpd</span><br></pre></td></tr></table></figure><h3 id="mod-wsgi-설치-https-code-google-com-archive-p-modwsgi"><a href="#mod-wsgi-설치-https-code-google-com-archive-p-modwsgi" class="headerlink" title="# mod_wsgi 설치 ( https://code.google.com/archive/p/modwsgi/ )"></a># mod_wsgi 설치 ( <a href="https://code.google.com/archive/p/modwsgi/" target="_blank" rel="noopener">https://code.google.com/archive/p/modwsgi/</a> )</h3><p>웹 서버 게이트웨이 인터페이스(WSGI, Web Server Gateway Interface)는 웹서버와 웹 애플리케이션의 인터페이스를 위한 파이선 프레임워크다. 라고 정의되어있다. 즉, 웹서버(Apache)와 위에서 만든 Flask 어플리케이션을 연동해주기 위한 프레임워크이다. 이또한 소스로 설치해보자. (위와 같은 이유로~)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- 다운을 받고</span><br><span class="line">$ wget https://github.com/GrahamDumpleton/mod_wsgi/archive/3.5.tar.gz</span><br><span class="line">- 압축을 푼 다음</span><br><span class="line">$ tar -zxvf 3.5.tar.gz</span><br><span class="line">- 폴더에 들어가서</span><br><span class="line">$ cd mod_wsgi-3.5</span><br><span class="line">- 아파치의 빌드툴인 apxs의 경로를 설정해주고</span><br><span class="line">- 필자와 같이 기본 python 버전을 사용하지 않을꺼라면 꼭 python경로를 설정해줘야 한다! (중요)</span><br><span class="line">$ ./configure --with-apxs=/~~~/apps/apache/bin/apxs --with-python=/usr/bin/python3.6</span><br><span class="line">- make 파일을 만들고</span><br><span class="line">$ make</span><br><span class="line">- 설치~</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure></p><p>이렇게 설치를 하면 자동으로 아파치 하위 /modules 폴더안에 mod_wsgi.so 파일이 생긴다. (필자는 이것도 모르고 mod_wsgi.so파일을 다운 받으려고 구글링을 몇일째 했던 기억이 ㅠ)</p><h3 id="Apache-httpd-conf-설정"><a href="#Apache-httpd-conf-설정" class="headerlink" title="# Apache httpd.conf 설정"></a># Apache httpd.conf 설정</h3><p>Aapche에 mod_wsgi 모듈이 생겼고, 이를 적용하기 위해서 httd.conf 아파치 기본설정 파일을 수정해야 한다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- 모듈을 사용하겠다고 정의</span><br><span class="line">LoadModule wsgi_module modules/mod_wsgi.so</span><br><span class="line">- mod_wsgi로 실행한 WSGI 파이썬 어플리케이션을 특정 URL( / )로 설정하기 위해 다음과 같이 등록해준다.</span><br><span class="line">WSGIScriptAlias / /~~~/python_app/hello_world.wsgi</span><br><span class="line">- 등록된 파이썬 어플리케이션을 데몬 프로세스로 실행하기위해 다음과 같이 설정해준다.</span><br><span class="line">WSGIDaemonProcess hello_world(어플리케이션 명) user=계정명 group=계정명 threads=5(스레드 개수)</span><br><span class="line"></span><br><span class="line">&lt;Directory /~~~/python_app&gt;</span><br><span class="line">  WSGIApplicationGroup %&#123;GLOBAL&#125; # 해당 어플리케이션을 처리하는 프로세스에서 첫번째로 생성된 파이썬 인터프리터를 사용</span><br><span class="line">  Order deny,allow</span><br><span class="line">  Allow from all</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p><p>자세한 내용은 <a href="http://modwsgi.readthedocs.io/en/develop/" target="_blank" rel="noopener">공식 홈페이지</a>를 참고하는걸 추천한다.</p><h3 id="WSGI-파일-작성"><a href="#WSGI-파일-작성" class="headerlink" title="# WSGI 파일 작성"></a># WSGI 파일 작성</h3><p>Apache 설정에서 등록한 wsgi파일은 다음과 같이 작성해준다. 물론 이 내용도 <a href="http://flask.pocoo.org/docs/0.12/deploying/mod_wsgi/" target="_blank" rel="noopener">공식 홈페이지</a>를 참조하는게 좋다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.insert(<span class="number">0</span>, <span class="string">'/~~~/python_app'</span>)</span><br><span class="line"><span class="keyword">from</span> hello_world <span class="keyword">import</span> app <span class="keyword">as</span> application</span><br></pre></td></tr></table></figure></p><p>필자는 여기서 한참을 해맸던 부분이, <code>sys.path.insert</code>구문의 두번째 인자는 실제 실행될 Falsk 어플리케이션이 있는 경로를 적어줘야 하고, <code>hello_world</code>는 Flask 어플리케이션 파일의 확장자를 제외한 이름을 적어주면 된다.</p><p>이렇게 한 후 아파치를 시작해주면 앞서 만든 Flask 어플리케이션을 별도로 실행해 주지 않아도 Apache가 알아서 설정한 URL로 요청이 들어올경우 Flask 어플리케이션으로 전달해준다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>사실 이렇게 Apache를 연동하면서 까지 하게 된 계기는, Flask 어플리케이션 구동시 80 port를 받도록 구현하고 root권한을 가진 계정으로 실행하도록 해뒀는데 가끔 종료가 되는 부분을 해결하고자 시작하게 되었다.<br>이 밖에도 Flask의 다양한 기능들과 Flask만 제외하면 일반 Python 이기 때문에 활용성은 무궁무진할것으로 보인다.</p><p>2부로는 또다른 웹서버인 Nginx를 연동하는 방법을 알아보고자 한다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Static한 HTML이 아닌 로직이 필요한 API서버를 구성한다고 가정해보자. (이제까지 지식으로)처음 머릿속에 떠오르는건 Java를 사용하고 스프링으로 어플리케이션을 만들고 apache에 tomcat을 연동한 다음 …
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="python" scheme="https://taetaetae.github.io/tags/python/"/>
    
      <category term="apache" scheme="https://taetaetae.github.io/tags/apache/"/>
    
      <category term="web server" scheme="https://taetaetae.github.io/tags/web-server/"/>
    
      <category term="flask" scheme="https://taetaetae.github.io/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>Apache냐 Nginx냐, 그것이 알고싶다.</title>
    <link href="https://taetaetae.github.io/2018/06/27/apache-vs-nginx/"/>
    <id>https://taetaetae.github.io/2018/06/27/apache-vs-nginx/</id>
    <published>2018-06-27T08:17:33.000Z</published>
    <updated>2018-07-29T08:31:26.079Z</updated>
    
    <content type="html"><![CDATA[<p>웹서버는 HTTP 프로토콜을 통해 읽힐수 있는 문서를 처리를 하며 일반적으로 웹 어플리케이션의 앞단에 배치되곤 한다. 동적인 리소스는 WAS에게 처리하도록 하고 정적인 리소스를 보다 효율적으로 처리하기 위한 방법일수도 있다. 크게 Apache와 Nginx가 사용되곤 하는데 이 둘의 차이는 무엇일까?<a id="more"></a> 사실 필자는 사내에서 주로 Apache만 사용하다보니 Nginx는 그저 <code>Apache와는 다른 방식의 웹서버다</code> 또는 <code>보다 경량화 되었다</code> 정도로만 알고있었는데 이번기회를 통해 제대로 알고 비교를 해보면서 결국 어떤게 좋은지 알아보고자 한다.</p><blockquote><p>구글링을 조금만 해보면 Apache와 Nginx를 비교하는 포스팅이 많이 나온다. 이번 포스팅의 목적 이러한 정보들을 단순히 요약/종합 하려는게 아니고, 최대한 실무 서비스를 운영하는 시각으로 정리하고자 함을 밝힌다.</p></blockquote><h3 id="Apache-https-httpd-apache-org"><a href="#Apache-https-httpd-apache-org" class="headerlink" title="# Apache ( https://httpd.apache.org/ )"></a># Apache ( <a href="https://httpd.apache.org/" target="_blank" rel="noopener">https://httpd.apache.org/</a> )</h3><p>우리나라에서 웹어플리케이션을 개발하는 사람들은 한번쯤은 들어봤을 <code>Apache</code>. 국내 일반적인 기업에서 웹서버의 표준으로 자리잡았다고 해도 과언이 아닐것 같다. Client에서 요청을 받으면 MPM (Multi Processing Module : 다중처리모듈) 이라는 방식으로 처리를 하는데 대표적으로는 Prefork와 Worker방식이 있다. 간단하게 어떤식으로 처리하는지 알고 넘어가자.</p><ul><li>Prefork MPM<div class="figure center" style="width:;"><img class="fig-img" src="prefork.gif" alt="Worker MPM, http://old.zope.org/Members/ike/Apache2/osx/configure_html"><span class="image-caption">Worker MPM, http://old.zope.org/Members/ike/Apache2/osx/configure_html</span><span class="caption">Worker MPM, http://old.zope.org/Members/ike/Apache2/osx/configure_html</span></div>실행중인 프로세스를 복제되어 처리가 된다. 각 프로세스는 한번에 한 연결만 처리하고 요청량이 많아질수록 프로세스는 증가하지만 복제시 메모리영역까지 복제되어 동작하므로 프로세스간 메모리 공유가 없어 안정적이라 볼수 있다.</li><li>Worker MPM<div class="figure center" style="width:;"><img class="fig-img" src="worker.gif" alt="Worker MPM, http://old.zope.org/Members/ike/Apache2/osx/configure_html"><span class="image-caption">Worker MPM, http://old.zope.org/Members/ike/Apache2/osx/configure_html</span><span class="caption">Worker MPM, http://old.zope.org/Members/ike/Apache2/osx/configure_html</span></div>Prefork 동작방식이 1개의 프로세스가 1개의 스레드로 처리가 되었다면 Worker 동작방식은 1개의 프로세스가 각각 여러 쓰레드를 사용하게 된다. 쓰레드간의 메모리를 공유하며 PreFork방식보다 메모리를 덜 사용하는 장점이 있다.</li></ul><p>참고로 WAS로 tomcat을 연동하는 경우라면 <a href="https://tomcat.apache.org/download-connectors.cgi" target="_blank" rel="noopener">mod_jk</a>, <a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html" target="_blank" rel="noopener">mod_proxy</a>, <a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_ajp.html" target="_blank" rel="noopener">mod_proxy_ajp</a> 방식을 Apache 자체적으로 지원해주기 때문에 다양하고 효율적으로 tomcat을 연동할수 있다. <a href="https://www.lesstif.com/pages/viewpage.action?pageId=12943367" target="_blank" rel="noopener">참고링크</a></p><h3 id="Nginx-https-nginx-org-en"><a href="#Nginx-https-nginx-org-en" class="headerlink" title="# Nginx ( https://nginx.org/en/ )"></a># Nginx ( <a href="https://nginx.org/en/" target="_blank" rel="noopener">https://nginx.org/en/</a> )</h3><p>Nginx에 대해 살펴보기 전에 <a href="https://trends.google.co.kr" target="_blank" rel="noopener">구글 트랜드</a>를 활용하여 Nginx에 대한 관심이 어느정도인지를 보고 넘어가자.<br><div class="figure center" style="width:;"><img class="fig-img" src="google-trand.png" alt="최근 5년간 구글트랜드, 파란색이 Apache이고 빨간색이 Nginx"><span class="image-caption">최근 5년간 구글트랜드, 파란색이 Apache이고 빨간색이 Nginx</span><span class="caption">최근 5년간 구글트랜드, 파란색이 Apache이고 빨간색이 Nginx</span></div><br>전세계는 Nginx보다는 Apache에 대한 관심이 많은것으로 보이는데 국내는 아주 조금씩 Nginx에 대한 관심이 오르는것을 볼수있었다. (그래도 아직은 Apache가 월등히 우세한 편이다.)<br>그럼 Nginx는 어떤식으로 돌아가는 것일까? 가장 유명한(?) 특징이라면 <code>Event Driven 방식</code>을 꼽을수 있을것 같다. Event Driven 방식에 대해 잠깐 언급을 하고 넘어가면 요청이 들어오면 어떤 동작을 해야하는지만 알려주고 다른요청을 처리하는 방식이다. (<a href="https://dzone.com/articles/producer-consumer-pattern" target="_blank" rel="noopener">Producer Consumer Pattern</a>과 유사하다.) 그러다보니 프로세스를 fork하거나 쓰레드를 사용하는 아파치와는 달리 CPU와 관계없이 모든 IO들을 전부 Event Listener로 미루기 때문에 흐름이 끊기지 않고 응답이 빠르게 진행이 되어 1개의 프로세스로 더 빠른 작업이 가능하게 될수 있다. 이때문에 메모리적인 측면에서 Nginx가 System Resource를 적게 처리한다는 장점이 있다고 한다.<br><div class="figure center" style="width:;"><img class="fig-img" src="nginx_process_model.png" alt="Nginx Process Model (https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale)"><span class="image-caption">Nginx Process Model (https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale)</span><span class="caption">Nginx Process Model (https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale)</span></div></p><h3 id="그래서-뭐가-좋은가"><a href="#그래서-뭐가-좋은가" class="headerlink" title="# 그래서 뭐가 좋은가?"></a># 그래서 뭐가 좋은가?</h3><div class="figure center" style="width:;"><img class="fig-img" src="want_to_know_that_apache_vs_nginx.png" alt="그것이 알고싶다."><span class="image-caption">그것이 알고싶다.</span><span class="caption">그것이 알고싶다.</span></div><p>이 포스팅을 적으면서 마지막엔 <code>Apache가 더좋다</code> 또는 <code>Nginx가 더좋다</code>로 마무리를 짓고 싶었는데 어느 시사/교양 프로그램처럼 어쩔수 없는 <code>열린결말</code>로 마무리를 지을수밖에 없을것 같다. (어찌보면 이게 정답일수도?)</p><p>기술의 선택에 있어서 정답은 없는것 같다.(물론 Spring 을 사용하느냐 서블릿을 직접 구현하는냐 와는 좀 다른 성격의 이야기;;) 운영하고 있는 서비스의 상황을 잘 알고 튜닝을 해가면서 가장 효율적인것을 선택하는게 정답이라고 말할수 밖에… 커뮤니티 파워를 무시 못하기 때문에 Apache를 선택할수도 있을테고, 점점 관심도가 올라간다는건 그만큼의 장점이 있고 또한 메모리 측면에서 동접자 처리시 효율적인 Nginx를 사용할수 있을것 같다. </p><p>정리하면. 내가 사용하기에 어려움이 없는 도구를 잘 활용하는것, 그렇다고 오래된 기술이 편한다고 집착해서는 안되며, 새로운 기술을 두려워 하지말고 경험을 해본 뒤에 결정을 할것 이라고 내릴수 있을것 같다. (어렵다…ㅠㅠ)</p><hr><ul><li>참고 포스팅<br><a href="http://www.mukgee.com/?p=293" target="_blank" rel="noopener">http://www.mukgee.com/?p=293</a><br><a href="http://knot.tistory.com/88" target="_blank" rel="noopener">http://knot.tistory.com/88</a><br><a href="http://tmondev.blog.me/220737182315" target="_blank" rel="noopener">http://tmondev.blog.me/220737182315</a><br><a href="http://tmondev.blog.me/220731906490" target="_blank" rel="noopener">http://tmondev.blog.me/220731906490</a><br><a href="http://urin79.com/blog/20654191" target="_blank" rel="noopener">http://urin79.com/blog/20654191</a><br><a href="http://jaweb.tistory.com/entry/apache-%EC%99%80-Nginx-%EB%AD%90%EA%B0%80-%EC%A2%8B%EC%9D%80%EA%B1%B0%EC%95%BC" target="_blank" rel="noopener">http://jaweb.tistory.com/entry/apache-%EC%99%80-Nginx-%EB%AD%90%EA%B0%80-%EC%A2%8B%EC%9D%80%EA%B1%B0%EC%95%BC</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;웹서버는 HTTP 프로토콜을 통해 읽힐수 있는 문서를 처리를 하며 일반적으로 웹 어플리케이션의 앞단에 배치되곤 한다. 동적인 리소스는 WAS에게 처리하도록 하고 정적인 리소스를 보다 효율적으로 처리하기 위한 방법일수도 있다. 크게 Apache와 Nginx가 사용되곤 하는데 이 둘의 차이는 무엇일까?
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="apache" scheme="https://taetaetae.github.io/tags/apache/"/>
    
      <category term="nginx" scheme="https://taetaetae.github.io/tags/nginx/"/>
    
      <category term="web server" scheme="https://taetaetae.github.io/tags/web-server/"/>
    
      <category term="Event Driven" scheme="https://taetaetae.github.io/tags/Event-Driven/"/>
    
      <category term="Prefork MPM" scheme="https://taetaetae.github.io/tags/Prefork-MPM/"/>
    
      <category term="Worker MPM" scheme="https://taetaetae.github.io/tags/Worker-MPM/"/>
    
  </entry>
  
  <entry>
    <title>시계열 데이터를 분석하여 미래 예측 하기(Anomaly Detection)</title>
    <link href="https://taetaetae.github.io/2018/05/31/anomaly-detection/"/>
    <id>https://taetaetae.github.io/2018/05/31/anomaly-detection/</id>
    <published>2018-05-31T08:03:41.000Z</published>
    <updated>2018-10-17T03:00:52.456Z</updated>
    
    <content type="html"><![CDATA[<p>급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?<br>또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?<br>뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?<br> <a id="more"></a><br>위 질문에 공통된 정답은 <code>예전 기록들</code>인것 같다. 날씨예측은 기상청에서 과거 기록들을 보고 비가 올지 말지를 결정하고 ( 과거 날씨 서비스를 담당해봤지만 단순히 과거 기록들로 예측한다는건 불가능에 가깝긴 하다. ) 매장 운영시간은 예전에 손님들이 언제왔는지에 대한 데이터를 보고. 비트코인이나 주식은 차트를 보고 어느정도는 상승장일지 하락장일지 추측이 가능하다고 한다. ( 물론 호재/악재에 따라 흔들리지만..ㅠㅠ..?? )<br>이처럼 시간의 흐름에 따라 만들어진 데이터를 분석하는것을 <code>시계열 데이터 분석</code>이라 부르고 있다. 필자가 운영하는 서비스에서 시계열 데이터 분석을 통해 장애를 사전에 방지하는 사례를 공유 해보고자 한다.</p><h3 id="상황파악부터"><a href="#상황파악부터" class="headerlink" title="# 상황파악부터"></a># 상황파악부터</h3><p>손자병법에는 지피지기 백전불태 라는 말이 있다. 그만큼 현 상황을 잘 알아야 대응을 잘할수 있다는것. 필자가 운영하는 서비스는 PG(Payment Gateway) 서비스로 쇼핑몰같은 온/오프라인 사업자와 실제 카드사와의 중간 역활을 해주고 있다. 이를테면 사용자가 <code>생수를 10,000원에 XX카드로 구매해줘</code> 라고 요청이 오면 그 정보를 다시 형식에 맞춰 카드사로 전달하여 사용자가 물건을 구매할수 있도록 해준다.<br><div class="figure center" style="width:;"><img class="fig-img" src="pg.png" alt="PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다."><span class="image-caption">PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.</span><span class="caption">PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.</span></div></p><h3 id="요구사항-및-과거-데이터-분석"><a href="#요구사항-및-과거-데이터-분석" class="headerlink" title="# 요구사항 및 과거 데이터 분석"></a># 요구사항 및 과거 데이터 분석</h3><p>서비스를 운영해보니 감지하기 어려운 상황들이 있었다. </p><ul><li>연동하는 쇼핑몰에서 문제가 발생하거나 네트워크 문제가 발생할경우 즉, 트래픽이 평소보다 적게 들어올 경우</li><li>정상적인 에러(e.g. 잔액부족) 가 갑자기 많이 발생할 경우</li></ul><p>이를 분석하기위해 기존의 트래픽/데이터를 분석해봐야 했다.<br><div class="figure center" style="width:;"><img class="fig-img" src="trade_count.png" alt="결제건수 Kibana Visualize, 기영이 패턴"><span class="image-caption">결제건수 Kibana Visualize, 기영이 패턴</span><span class="caption">결제건수 Kibana Visualize, 기영이 패턴</span></div><br>위 그래프는 결제데이터 카운트 인데 어느정도 패턴을 찾을수 있다.<br><div class="figure center" style="width:;"><img class="fig-img" src="error_count.png" alt="에러건수 Kibana Visualize, 악어 패턴..(무리수..)"><span class="image-caption">에러건수 Kibana Visualize, 악어 패턴..(무리수..)</span><span class="caption">에러건수 Kibana Visualize, 악어 패턴..(무리수..)</span></div><br>위 그래프는 에러카운트 인데 일정한 패턴 속에서 어느 지점에서는 튀는것을 확인할수 있다. (빨간색 영역) 그렇다면 어떤 방법으로 장애상황보다 앞서서 감지를 할수 있을까? ( 장애 : 어떠한 내/외부 요인으로 인해 정상적인 서비스가 되지 않는 상태 )</p><h3 id="장애발생-전에-먼저-찾아보자"><a href="#장애발생-전에-먼저-찾아보자" class="headerlink" title="# 장애발생 전에 먼저 찾아보자!"></a># 장애발생 전에 먼저 찾아보자!</h3><p>가장 간단하게는 기존 데이터를 보고 수동으로 설정하는 방법이 있을수 있다. 예로들어 자정 즈음에는 결제량이 가장 많기때문에 약 xx건으로 설정해두고, 새벽에는 결제량이 가장 적기 때문에 약 yy건으로 설정해둔 후 에러 건수나 결제건수에 대해 실시간으로 검사를 해가면서 설정한 값보다 벗어날 경우 알림을 주는 방법이다.<br>하지만 아무리 과거 데이터를 완벽하게 분석했다 할지라도 24시간 모든 시점에서 예측은 벗어날 수밖에 없다. (예로들어 쇼핑 이벤트를 갑작스럽게 하게되면 결제량은 예측하지 못할정도로 늘어날테고…) 또한 설정한 예측값을 벗어날 경우 수동으로 다시 예측값을 조정해줘야 하는데, 이럴꺼면 24시간 종합 상황실에서 사람이 직접 눈으로 보는것 보다 못할것 같다. (인력 리소스가 충분하다면 뭐… 그렇게 해도 된다.)</p><h3 id="지난-데이터와-비교하기"><a href="#지난-데이터와-비교하기" class="headerlink" title="# 지난 데이터와 비교하기"></a># 지난 데이터와 비교하기</h3><p>일주일 기준으로 지난 일주일과의 데이터를 비교해보는 방법또한 있다. 간단하게 설명하면 이번주 월요일 10시의 데이터와 지난주 월요일 10시의 데이터의 차이를 비교해보는 방법이다. 키바나에서 클릭 몇번만으로 시각화를 도와주는 Visualize 기능을 통해 지난 일주일과 이번주를 비교해보면 아래 그래프처럼 표현이 가능하다.<br><div class="figure center" style="width:;"><img class="fig-img" src="visualize.png" alt="일주일 전 데이터와 단순 비교"><span class="image-caption">일주일 전 데이터와 단순 비교</span><span class="caption">일주일 전 데이터와 단순 비교</span></div><br>이 경우도 지난주 상황과 이번주 상황이 다른 경우에는 원하는 비교 항목 외에 다른 요인이 추가되기 때문에 원하는 비교를 할수가 없고 위에서 수동으로 설정하는 방법과 별반 다를바 없을것으로 생각된다.</p><h3 id="조금더-우아하게-언제부턴가-우아하단-말을-좋아하는것-같다"><a href="#조금더-우아하게-언제부턴가-우아하단-말을-좋아하는것-같다" class="headerlink" title="# 조금더 우아하게! (언제부턴가 우아하단 말을 좋아하는것 같다..)"></a># 조금더 우아하게! <code>(언제부턴가 우아하단 말을 좋아하는것 같다..)</code></h3><p>개발자는 문제에 대해서 언제나 분석을 토대로 접근을 하는것을 목표로 해야한다. 언제부턴가 Hot한 머신러닝을 도입해 보고 싶었으나 아직 그런 실력이 되질 못하고… 폭풍 구글링을 통해 알게된 Facebook에서 만든 <a href="https://facebook.github.io/prophet/" target="_blank" rel="noopener">Prophet</a>이라는 모듈을 활용해보고자 한다.<br><a href="https://opensource.fb.com/#artificial" target="_blank" rel="noopener">https://opensource.fb.com/#artificial</a> 이곳에 가보면 여러 Artificial Intelligence 관련된 오픈소스들중에 Prophet 모듈을 찾을수 있다. 다행히도 <a href="https://namu.wiki/w/BSD%20%EB%9D%BC%EC%9D%B4%EC%84%A0%EC%8A%A4" target="_blank" rel="noopener">BSD License</a>라서 실무에서도 다양하게 활용할수 있을것으로 보인다. 친절하게도 <code>Quick Start</code>을 통해 어떤식으로 예측을 하는지 보여준다. 참고로 Python 과 R 을 지원한다. (python 의 대단함을 다시금 느끼며…)<br>구성은 CentOS 7 + python3.6 + jenkins 를 활용한다. (python 경험이 부족하므로 코드가 허접할수도 있으니 양해바란다.)<br>데이터 분석시 가장 많이 사용된다는 <code>Pandas</code>와 대규모 다차원 배열을 쉽게 처리 할 수 있게 해주는 <code>numpy</code>, 그리고 <code>bprophet</code>를 비롯한 필요한 모듈들을 pip로 설치해준다.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install pandas</span><br><span class="line">pip install fbprophet</span><br><span class="line">pip install numpy</span><br></pre></td></tr></table></figure></p><p>필요한 모듈들을 import를 한다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line">matplotlib.use(<span class="string">'Agg'</span>) // centos 서버 환경에서 돌릴경우 예측결과를 그래프로 보는 과정에서 오류가 발생한다. 이를 방직하기 위해 해당 코드를 적어준다.</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> requests, datetime</span><br><span class="line"><span class="keyword">from</span> fbprophet <span class="keyword">import</span> Prophet</span><br></pre></td></tr></table></figure></p><p>기존에 데이터들은 모두 실시간으로 elasticserach에 인덱싱 중이기 때문에 rest api 를 활용하면 쉽게 데이터를 얻을수가 있다. (RDB로 관리를 했더라면… 배보다 배꼽이 더 큰 상황이였지 않았을까 하는 생각이 든다.)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 현재 시 기준 2주 (24 x 14 시간) 전의 데이터를 가져온다.</span></span><br><span class="line">day_gap = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">now_datetime = datetime.datetime.now()</span><br><span class="line">end_time = datetime.datetime(now_datetime.year, now_datetime.month, now_datetime.day, now_datetime.hour, <span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">end_time_stamp = str(int(end_time.timestamp() * <span class="number">1000</span>))</span><br><span class="line">start_time = end_time - datetime.timedelta(days=day_gap)</span><br><span class="line">start_time_stamp = str(int(start_time.timestamp() * <span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://elasticsearch:9200/_msearch'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"Content-Type"</span> : <span class="string">"application/x-ndjson"</span></span><br><span class="line">&#125;</span><br><span class="line">es_data = <span class="string">'&#123;"index":["index_name"]&#125;\n&#123;"size":0,"query":&#123;"bool":&#123;"must":[&#123;"range":&#123;"log_time":&#123;"gte":'</span> + start_time_stamp + <span class="string">',"lte":'</span> + end_time_stamp + <span class="string">'&#125;&#125;&#125;]&#125;&#125;,"aggs":&#123;"2":&#123;"date_histogram":&#123;"field":"log_time","interval":"1h", "time_zone":"Asia/Tokyo"&#125;&#125;&#125;&#125;\n'</span></span><br><span class="line">response_list = requests.post(url=url, headers=headers, data=es_data.encode(<span class="string">'utf-8'</span>)).json()[<span class="string">'responses'</span>][<span class="number">0</span>][<span class="string">'aggregations'</span>][<span class="string">'2'</span>][<span class="string">'buckets'</span>]</span><br><span class="line">print(<span class="string">'기준 : '</span> + str(start_time) + <span class="string">' ~ '</span> + str(end_time))</span><br><span class="line"></span><br><span class="line"><span class="comment"># es 데이터 중 시간값을 형식에 바꾸면서 key-value 형태로 정제한다.</span></span><br><span class="line">query_result = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> response_list :</span><br><span class="line">    query_result[data[<span class="string">'key_as_string'</span>].replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'.000+09:00'</span>, <span class="string">''</span>)] = data[<span class="string">'doc_count'</span>]</span><br></pre></td></tr></table></figure></p><p>elasticsearch에서 aggregation을 활용하여 데이터를 1시간 단위로 가져올경우 데이터가 없는 경우를 대비해 비어있는 시간에 해당하는 카운트를 0으로 맞춰주기 위하여 loop를 돌며 데이터를 정제해준다. (이 방법보다 더 좋은 방법이 분명 있을것이다…)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">anomaly_detection_base_data = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> range(<span class="number">24</span> * day_gap) :</span><br><span class="line">    key_date_time = start_time.strftime(<span class="string">'%Y-%m-%d %H:00:00'</span>)</span><br><span class="line">    <span class="keyword">if</span> key_date_time <span class="keyword">in</span> query_result :</span><br><span class="line">        anomaly_detection_base_data[key_date_time] = query_result[key_date_time]</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        anomaly_detection_base_data[key_date_time] = <span class="number">0</span></span><br><span class="line">    start_time = start_time + datetime.timedelta(hours=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>pandas 를 활용하여 데이터를 DataFrame 형식에 맞춰준 다음 <code>시간</code>기준으로 다음 24시간의 데이터를 예측하도록 한다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(list(anomaly_detection_base_data.items()), columns=[<span class="string">'ds'</span>, <span class="string">'y'</span>])</span><br><span class="line">m = Prophet()</span><br><span class="line">m.fit(df)</span><br><span class="line">future = m.make_future_dataframe(periods=<span class="number">24</span> , freq=<span class="string">'H'</span>)</span><br><span class="line">forecast = m.predict(future)</span><br></pre></td></tr></table></figure></p><p>실제 집계한 값과 예측값을 비교하여 알림발생 유무를 결정한다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 현재시간 -1시간 전 실제 집계</span></span><br><span class="line">check_datetime = now_datetime - datetime.timedelta(hours=<span class="number">1</span>)</span><br><span class="line">check_datetime = check_datetime.strftime(<span class="string">'%Y-%m-%d %H:00:00'</span>)</span><br><span class="line">check_datetime_count = query_result[check_datetime]</span><br><span class="line">print(<span class="string">'실제 집계수 : '</span> + check_datetime + <span class="string">' → '</span> + str(check_datetime_count))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 예측 최대치</span></span><br><span class="line">forecast_max_count = forecast[forecast.ds == check_datetime][<span class="string">'yhat_upper'</span>].values[<span class="number">0</span>]</span><br><span class="line">print(<span class="string">'예측 최대치 : '</span> + check_datetime  + <span class="string">' → '</span> +  str(forecast_max_count))</span><br></pre></td></tr></table></figure></p><p>여기서는 에러 카운트가 평소와는 다르게 발생할 경우에 알림을 발송을 하려 하기때문에 아래처럼 구성을 해준다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> check_datetime_count &gt; forecast_max_count :</span><br><span class="line">  <span class="comment"># 예측한 결과를 이미지로 저장후 알림에 포함시켜준다.</span></span><br><span class="line">  forecast_graph = m.plot(forecast, plot_cap=<span class="keyword">False</span>, xlabel=<span class="string">'time'</span>, ylabel=<span class="string">'count'</span>);</span><br><span class="line">  file_name = <span class="string">'forecast_graph.png'</span></span><br><span class="line">  forecast_graph.savefig(file_name)</span><br></pre></td></tr></table></figure></p><p>이런 python script를 jenkins 를 활용하여 1시간에 한번씩 실행될수있도록 구성해 두고 문제가 발생할때는 아래처럼 메일로 알림을 받는다.<br><div class="figure center" style="width:;"><img class="fig-img" src="forecast_graph.png" alt="예측결과"><span class="image-caption">예측결과</span><span class="caption">예측결과</span></div><br>위 그래프를 분석하면 다음과 같다.</p><ul><li>검정색 점 : 실제 데이터</li><li>파란 실선 : 트랜드 그래프</li><li>하늘색 음영 : 예측한 최대/최소치의 영역<br>빨간색으로 표시한 점 두개를 보면 예측을 벗어난것을 확인할수 있고 실제로 저 시간대에 내부적 이슈로 인해 에러가 많이 발생한 경우이다. (장애 발생 시점)</li></ul><p>이런식으로 구성을 해두면 앞서 수동으로 최대/최소 수치를 정해두고 이탈했는지에 대해서 모니터링 하는것보다 훨씬더 우아하게 모니터링을 할수있다.<br>물론 해당 모듈이 완벽하다는 소리는 아니다. 필자도 해당 모듈을 사용하다보니 어떤 경우에서는 예측수치와 실제 데이터가 비슷한 경우가 있어 알람을 받은 경우도 있다. 예전 포스팅에서도 이야기 했듯 정답은 없는것 같다. 상황에 맞춰서 지속적으로 커스터마이징을 해야하는게 개발자의 숙명 아닐까 싶다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>사실 이렇게 <code>시계열 데이터</code>라는 단어나 <code>Prophet</code>같은 오픈소스를 검색할수 있었던건 작년 <a href="https://taetaetae.github.io/2017/12/14/elastic-on-tour/">Elastic{ON}Tour 에서 봤던 Elastic X-pack의 머신러닝 기능</a> 때문이다. 그때 받은 충격(?)이 아직까지 있는건지 이렇게 오픈소스로 비슷하게나마 구현할수 있었던 원동력이 된것 같다. 기회가 되면 X-pack을 구매해서 운영하는 서비스에 머신러닝을 활용해서 이러한 시계열 데이터에 대해 분석해보고싶다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?&lt;br&gt;또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?&lt;br&gt;뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?&lt;br&gt;
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="python" scheme="https://taetaetae.github.io/tags/python/"/>
    
      <category term="anomaly detection" scheme="https://taetaetae.github.io/tags/anomaly-detection/"/>
    
      <category term="elasticsearch" scheme="https://taetaetae.github.io/tags/elasticsearch/"/>
    
      <category term="prophet" scheme="https://taetaetae.github.io/tags/prophet/"/>
    
      <category term="facebook" scheme="https://taetaetae.github.io/tags/facebook/"/>
    
  </entry>
  
  <entry>
    <title>아파치 엑세스 로그에 408코드가?</title>
    <link href="https://taetaetae.github.io/2018/04/29/apache-408-response-code/"/>
    <id>https://taetaetae.github.io/2018/04/29/apache-408-response-code/</id>
    <published>2018-04-29T08:39:36.000Z</published>
    <updated>2018-07-29T08:31:26.042Z</updated>
    
    <content type="html"><![CDATA[<p>예전에 아파치 로그를 엘라스틱 스택을 활용하여 <a href="https://taetaetae.github.io/2018/04/10/apache-access-log-user-agent">내 서버에 누가 들어오는지를 확인할수 있도록 구성</a>을 해두고 몇일간 지켜보니 다음과 같은 엑세스 로그가 발생하고 있었다.<a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.2.3.4 - - [26/Apr/2018:01:27:33 +0900] &quot;GET /aaa/ HTTP/1.1&quot; 200 6001 30788 &quot;http://www.naver.com&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:28:08 +0900] &quot;-&quot; 408 - 30 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:28:08 +0900] &quot;-&quot; 408 - 28 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:28:08 +0900] &quot;-&quot; 408 - 12 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:28:08 +0900] &quot;-&quot; 408 - 30 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:28:50 +0900] &quot;GET /aaa/ HTTP/1.1&quot; 200 5999 13521 &quot;http://www.naver.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:14 +0900] &quot;GET /aaa/ HTTP/1.1&quot; 200 5996 19437 &quot;http://www.naver.com&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:15 +0900] &quot;GET /aaa/ HTTP/1.1&quot; 200 5997 17553 &quot;http://www.naver.com&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:15 +0900] &quot;GET /aaa/ HTTP/1.1&quot; 200 5998 17429 &quot;http://www.naver.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:53 +0900] &quot;-&quot; 408 - 30 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:53 +0900] &quot;-&quot; 408 - 30 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:53 +0900] &quot;-&quot; 408 - 32 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:53 +0900] &quot;-&quot; 408 - 38 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:29:53 +0900] &quot;-&quot; 408 - 29 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:30:54 +0900] &quot;GET /aaa/ HTTP/1.1&quot; 200 6000 17881 &quot;http://www.naver.com&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:31:34 +0900] &quot;-&quot; 408 - 30 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:31:34 +0900] &quot;-&quot; 408 - 30 &quot;-&quot; &quot;-&quot;</span><br><span class="line">1.2.3.4 - - [26/Apr/2018:01:31:34 +0900] &quot;-&quot; 408 - 25 &quot;-&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure></p><p>한시간에 만건이상 <code>응답코드는 408</code>, <code>referrer도 없고</code>, <code>useragent도 없는</code>, <code>ip들도 매우 다양한</code> 이상한 녀석들이 요청되고 있었다. </p><blockquote><p>이렇게 엑세스 로그를 분석할수 있는 구성을 해두고 나니 보였지 안그랬음 그냥 지나갔을 터..</p></blockquote><p>이러한 데이터를 키바나에서 보면 아래처럼 볼수있는데 한눈에 봐도 과연 의미있는 요청들일까? 하는 의구심이 들정도이다. (1시간 아파치 엑세스 로그)<br><div class="figure center" style="width:;"><img class="fig-img" src="200vs400.png" alt="주황색이 408응답"><span class="image-caption">주황색이 408응답</span><span class="caption">주황색이 408응답</span></div></p><p>그럼 이런 호출들은 도대체 뭘까? 천천히 생각좀 해보자.</p><ol><li>정상적이지 않는 호출로 우리 서버의 취약점을 파악하려 하는것들일까?</li><li>응답코드 408은 요청시간초과 응답코드인데… 오히려 클라이언트 입장에서 문제가 있는건 아닐까?</li><li>어플리케이션 로직이 잘못되어 무한루프에 빠졌나;</li></ol><p><a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank" rel="noopener">위키백과</a>에서는 아파치 응답코드 중 <code>408</code>에 대한 응답을 다음과 같이 알려주고 있다.</p><blockquote><p>The server timed out waiting for the request. According to HTTP specifications: “The client did not produce a request within the time that the server was prepared to wait. The client MAY repeat the request without modifications at any later time</p></blockquote><p>즉, 아파치 단에서 타임아웃을 내버리는 상황. 여러 다양한 키워드들로 구글링을 해봐도 이렇다할 검색결과를 찾지 못하고 네트워크 관련상황인지 싶어 크롬 개발자도구를 열어 네트워크 지연 테스트를 해보았으나 별 효과가 없었다. 그렇게 범인찾는 형사의 심정으로 이것저것 알아보다 우연히 집에서 원격으로 회사 VPN 붙어서 테스트 하던도중 관련 증상을 재현 할수 있게 되었다.</p><h3 id="재현상황"><a href="#재현상황" class="headerlink" title="# 재현상황"></a># 재현상황</h3><p>우선 아파치버전은 2.2이고 <code>KeepAlive Off</code>가 되어있는 상황. 아래그림처럼 집PC - 공유기 - VPN - Apache - tomcat jenkins 상황이였는데 젠킨스에 한번 접속후에는 항상 408 응답이 주루룩(?) 발생하는것을 알수 있었다. (사실 맨위에 엑세스 로그가 재현한 엑세스 로그이다.)<br><div class="figure center" style="width:;"><img class="fig-img" src="network_flow.png" alt="요청의 흐름"><span class="image-caption">요청의 흐름</span><span class="caption">요청의 흐름</span></div></p><h3 id="결론"><a href="#결론" class="headerlink" title="# 결론"></a># 결론</h3><p>정확한 근거를 추론할수는 없었지만 재현한 바에 의해 결론을 내리자면, 특정 네트워크 환경에서 408응답이 발생하는것을 알수 있었다. (그중에 하나가 공유기 환경이라는 점)<br>해당 요청을 막기에는 너무 다양한 ip들이고 서비스 특성상 <code>keepAlive off</code>로 설정한점을 미루어 볼때 해당 요청을 deny 시키기에는 다소 무리가 있다고 보여진다. 또한 시스템에 영향을 줄 정도가 아니므로 무시하는것으로 결론을 내렸다.</p><p>결과적으로는 <code>그냥무시</code>로 끝났지만 그래도 알고 무시해야지~ 하는 마음으로 재현까지 해볼수 있었던 좋은 경험이였다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;예전에 아파치 로그를 엘라스틱 스택을 활용하여 &lt;a href=&quot;https://taetaetae.github.io/2018/04/10/apache-access-log-user-agent&quot;&gt;내 서버에 누가 들어오는지를 확인할수 있도록 구성&lt;/a&gt;을 해두고 몇일간 지켜보니 다음과 같은 엑세스 로그가 발생하고 있었다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="apache" scheme="https://taetaetae.github.io/tags/apache/"/>
    
      <category term="408" scheme="https://taetaetae.github.io/tags/408/"/>
    
  </entry>
  
  <entry>
    <title>내 서버에는 누가 들어오는걸까? (실시간 user-agent 분석기)</title>
    <link href="https://taetaetae.github.io/2018/04/10/apache-access-log-user-agent/"/>
    <id>https://taetaetae.github.io/2018/04/10/apache-access-log-user-agent/</id>
    <published>2018-04-10T14:20:19.000Z</published>
    <updated>2018-07-29T08:31:26.056Z</updated>
    
    <content type="html"><![CDATA[<p>Desktop 및 스마트폰의 대중화로 다양한 OS와 브라우저들을 사용하게 되었다. 이때, 내가 운영하는 웹서버에 들어오는 사람들은 무슨 기기로 접속을 하는 것일까? 혹여 특정 OS의 특정 브라우저에서만 안되는 버그를 잡기 위해 몇일밤을 고생하며 겨우 수정했는데… 과연 그 OS의 브라우저에서는 접속은 하기나 하는걸까? (ㅠㅠ) <a id="more"></a><br>만약, 접속 사용자의 Device 정보를 알고있다면 고생하며 버그를 잡기 전에 먼저 해당 Device 사용율을 체크해 볼수도 있고(수정이 아닌 간단한 얼럿으로 해결한다거나?) 비지니스 모델까지 생각해야하는 서비스라면 타겟팅을 정하는 등 다양한 활용도가 높은 것이 바로 <code>User-Agent</code>라고 한다(이하 UA). 일반 Apache 를 웹서버로 운영하고 있다고 가정을 하고 어떻게 분석을 할수 있었는지, 그리고 분석을 하며 좀더 우아한(?) 방법은 없는지 알아 보고자 한다. </p><h3 id="User-Agent가-뭐야"><a href="#User-Agent가-뭐야" class="headerlink" title="# User-Agent가 뭐야?"></a># User-Agent가 뭐야?</h3><p>백문이 불여일타(?)라 했던가, 우선 <a href="http://www.useragentstring.com" target="_blank" rel="noopener">http://www.useragentstring.com</a> 를 들어가보자. 그러면 자신의 OS 및 브라우저 등 정보를 파싱해서 보여주는데 <a href="https://en.wikipedia.org/wiki/User_agent" target="_blank" rel="noopener">위키백과</a>에 따르면 ‘사용자를 대신하여 일을 수행하는 소프트웨어 에이전트’라고 한다. 즉, UA만 알아도 어떤 기기/브라우저를 사용하는지 알 수 있다는것.<br><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent" target="_blank" rel="noopener">mozilla</a>에 가보면 스팩 등 다양한 UA를 볼수가 있는데 특히 맨 아래보면 기기/브라우저별로 지원정보가 나와있다. 여기서도 보면 모든 모바일 삼성 브라우저를 제외하고는 전부 지원이 되는걸 확인할수 있다.<br><div class="figure center" style="width:;"><img class="fig-img" src="browser_compatibility.png" alt="출처 : developer.mozilla.org"><span class="image-caption">출처 : developer.mozilla.org</span><span class="caption">출처 : developer.mozilla.org</span></div></p><h3 id="기존의-방법"><a href="#기존의-방법" class="headerlink" title="# 기존의 방법"></a># 기존의 방법</h3><p>그럼 어떻게 내 서버에 들어온 사용자들의 UA를 확인할 수 있을까? (앞서 Apache를 웹서버로 운영한다고 했으니) Apache access log 에는 Apache에서 제공해주는 모듈을 이용해 접속한 클라이언트의 정보가 남겨지곤 한다. 그렇다면 이 access log를 리눅스 명령어든 엑셀로 뽑아서든지 활용해서 정규식으로 포맷팅 하고 그 결과를 다시 그룹화 시키면 얼추 원하는 데이터를 추출해 낼수 있다. ( 버거형들이 만들어둔 정규식을 가져다 사용할수도 있겠다. <a href="https://regexr.com/?37l4e" target="_blank" rel="noopener">https://regexr.com/?37l4e</a> )<br>하지만, 우선 자동화가 안되어있어 데이터를 구하고 싶을때마다 귀차니즘에 걸릴수 있고 슈퍼 개발자 파워를 기반으로(?) 데이터 추출을 자동화 한들 <code>실시간</code>으로 보고싶을땐 제한사항이 많다.</p><h3 id="좀더-나은-방법"><a href="#좀더-나은-방법" class="headerlink" title="# 좀더 나은 방법(?)"></a># 좀더 나은 방법(?)</h3><p>실시간 데이터를 모니터링 하는데에는 다양한 오픈소스와 다양한 툴이 있겠지만 경험이 부족한건지 아직까진 ElasticStack 만한걸 못본것 같다. 간단하게 설명을 하면 access log 를 사용하지 않고 front단에서 javascript 로 UA를 구한다음 이러한 정보를 받을수 있는 API를 만들어 그쪽으로 보내면 서버에서 해당 UA를 분석해서 카프카로 보내고 ..!@#$%^blabla…<br>^^; 그림으로 보자.<br><div class="figure center" style="width:;"><img class="fig-img" src="user_agent_method_1.png" alt="좀더 나은 방법"><span class="image-caption">좀더 나은 방법</span><span class="caption">좀더 나은 방법</span></div><br>front단에서는 <code>navigator.userAgent</code>를 활용하여 UA를 구할수 있었고, API에서는 UA를 받고 파싱을 하는데 관련 코드는 다음과 같이 작성하였다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String VERSION_SEPARATOR = <span class="string">"."</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">userAgentParsingToMap</span><span class="params">(String userAgent, Map&lt;String, Object&gt; dataMap)</span> </span>&#123;</span><br><span class="line">    HashMap browser = Browser.lookup(userAgent);</span><br><span class="line">    HashMap os = OS.lookup(userAgent);</span><br><span class="line">    HashMap device = Device.lookup(userAgent);</span><br><span class="line"></span><br><span class="line">    dataMap.put(<span class="string">"browserName"</span>, browser.get(<span class="string">"family"</span>));</span><br><span class="line">    dataMap.put(<span class="string">"browserVersion"</span>, getVersion(browser));</span><br><span class="line">    dataMap.put(<span class="string">"osName"</span>, os.get(<span class="string">"family"</span>));</span><br><span class="line">    dataMap.put(<span class="string">"osVersion"</span>, getVersion(os));</span><br><span class="line">    dataMap.put(<span class="string">"deviceModel"</span>, device.get(<span class="string">"model"</span>));</span><br><span class="line">    dataMap.put(<span class="string">"deviceBrand"</span>, device.get(<span class="string">"brand"</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getVersion</span><span class="params">(HashMap dataMap)</span> </span>&#123;</span><br><span class="line">    String majorVersion = (String)dataMap.get(<span class="string">"major"</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(majorVersion)) &#123;</span><br><span class="line">        <span class="keyword">return</span> StringUtils.EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line">    String minorVersion = (String)dataMap.get(<span class="string">"minor"</span>);</span><br><span class="line">    String pathVersion = (String)dataMap.get(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(majorVersion);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(minorVersion)) &#123;</span><br><span class="line">        sb.append(VERSION_SEPARATOR);</span><br><span class="line">        sb.append(minorVersion);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(pathVersion)) &#123;</span><br><span class="line">        sb.append(VERSION_SEPARATOR);</span><br><span class="line">        sb.append(pathVersion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>참고로 Java단에서 UA를 파싱하는 parser가 여러가지가 있는데 그중 <code>uap_clj</code>라는 모듈이 그나마 잘 파싱이 되어서 사용하게 되었다.</p><ul><li>모듈별 비교 </li></ul><table><thead><tr><th>모듈</th><th>Browser</th><th>OS</th><th>Device</th></tr></thead><tbody><tr><td>eu.bitwalker.useragentutils.UserAgent</td><td>O</td><td>불명확함 (Android 5.x)</td><td>X</td></tr><tr><td>net.sf.uadetector.UserAgentStringParser</td><td>O</td><td>O</td><td>불명확함 (Smartphone)</td></tr><tr><td>uap_clj.java.api.*</td><td>O</td><td>O</td><td>O</td></tr></tbody></table><ul><li><p>Parsing 비교</p><ul><li><p>UA</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mozilla/5.0 (Linux; Android 5.1.1; Nexus 6 Build/LYZ28E) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Mobile Safari/537.36&quot;</span><br></pre></td></tr></table></figure></li><li><p>결과</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Browser : &#123;patch=3239, family=Chrome Mobile, major=63, minor=0&#125;</span><br><span class="line">- OS : &#123;patch=1, patch_minor=, family=Android, major=5, minor=1&#125;</span><br><span class="line">- Device : &#123;model=Nexus 6, family=Nexus 6, brand=Generic_Android&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>위와 같이 구성을 하면 Elasticsearch에 인덱싱된 데이터를 Kibana에서 입맛에 맞게 실시간으로 볼수있게 되었다!<br>하지만 API를 만드는 부분 + front에서 별도의 javascript가 들어간다는 부분 + 운영하는 모든 페이지에 해당 javascript를 넣어야지만 볼수있는 부분 등 약간 아쉬운 감이 있다. 뭔가 더 좋은 방법이 없을까? 깔끔하면서도 <code>우아한</code> 방법. 짱구를 열심히 더 굴려보자.</p><h3 id="좀더-우아한-방법"><a href="#좀더-우아한-방법" class="headerlink" title="# 좀더 우아한 방법?"></a># 좀더 우아한 방법?</h3><p>Logstash 에는 UA를 파싱해주는 filter plugin 이 있다고 한다. (<a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-useragent.html" target="_blank" rel="noopener">링크</a>) 이 방법과 예전에 포스팅한 access log 를 elasticsearch 에 인덱싱 하는 방법을 혼합하면 위에서 걱정했던 문제들을 아주 깔끔하게 해결할 수 있을것 같다.</p><blockquote><p>지난 포스팅 : <a href="https://taetaetae.github.io/2018/01/25/apache-access-log-to-es">링크</a></p></blockquote><p>물론 글보다는 그림설명이 더 빠르니 전체적인 흐름을 그림으로 보자.<br><div class="figure center" style="width:;"><img class="fig-img" src="user_agent_method_2.png" alt="좀더 우아한 방법"><span class="image-caption">좀더 우아한 방법</span><span class="caption">좀더 우아한 방법</span></div><br>① front 단에서 javascript로 UA를 구하고 ② 별도로 만든 API에 데이터를 전송한뒤 ③ API에서는 이를 또 파싱하는 작업을 logstash 의 <code>user-agent filter plugin</code>으로 깔끔하게 해결할 수 있었다.<br>우선 apache에서 access log format 은 다음과 같고<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b %D \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span><br></pre></td></tr></table></figure></p><p>logstash쪽 설정은 다음과 같이 해주었다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">        file &#123;</span><br><span class="line">                path =&gt; &quot;/~~~/access.log.*&quot;</span><br><span class="line">                start_position =&gt; &quot;beginning&quot;</span><br><span class="line">                codec =&gt; multiline &#123;</span><br><span class="line">                    pattern =&gt; &quot;^%&#123;IPORHOST&#125;&quot;</span><br><span class="line">                    negate =&gt; true</span><br><span class="line">                    what =&gt; previous</span><br><span class="line">                    auto_flush_interval =&gt; 1</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">        grok &#123;</span><br><span class="line">                match =&gt; &#123; &quot;message&quot; =&gt; [&quot;%&#123;IPORHOST:clientip&#125; (?:-|%&#123;USER:ident&#125;) (?:-|%&#123;USER:auth&#125;) \[%&#123;HTTPDATE:timestamp&#125;\] \&quot;(?:%&#123;WORD:httpMethod&#125; %&#123;NOTSPACE:uri&#125;(?: HTTP/%&#123;NUMBER:httpversion&#125;)?|-)\&quot; %&#123;NUMBER:responseCode&#125; (?:-|%&#123;NUMBER:bytes&#125;) (?:-|%&#123;NUMBER:bytes2&#125;)( \&quot;%&#123;DATA:referrer&#125;\&quot;)?( \&quot;%&#123;DATA:user-agent&#125;\&quot;)?&quot;] &#125;</span><br><span class="line">                remove_field =&gt; [&quot;timestamp&quot;,&quot;@version&quot;,&quot;path&quot;,&quot;tags&quot;,&quot;httpversion&quot;,&quot;bytes2&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">        useragent &#123;</span><br><span class="line">                source =&gt; &quot;user-agent&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        if [os_major]  &#123;</span><br><span class="line">                mutate &#123;</span><br><span class="line">                        add_field =&gt; &#123;</span><br><span class="line">                                os_combine =&gt; &quot;%&#123;os&#125; %&#123;os_major&#125;.%&#123;os_minor&#125;&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">                 mutate &#123;</span><br><span class="line">                        add_field =&gt; &#123;</span><br><span class="line">                                os_combine =&gt; &quot;%&#123;os&#125;&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        if [os] =~ &quot;Windows&quot; &#123;</span><br><span class="line">                mutate &#123;</span><br><span class="line">                        update =&gt; &#123;</span><br><span class="line">                                &quot;os_name&quot; =&gt; &quot;Windows&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if [os] =~ &quot;Mac&quot; &#123;</span><br><span class="line">                mutate &#123;</span><br><span class="line">                        update =&gt; &#123;</span><br><span class="line">                                &quot;os_name&quot; =&gt; &quot;Mac&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">        if [user-agent] != &quot;-&quot; and [user-agent] !~ &quot;Java&quot; &#123;</span><br><span class="line">                kafka &#123;</span><br><span class="line">                        bootstrap_servers =&gt; &quot;~~~&quot;</span><br><span class="line">                        topic_id =&gt; &quot;~~~&quot;</span><br><span class="line">                        codec =&gt; json&#123;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>설정하는데 가장 큰 어려웠던 점은 grok filter 패턴을 작성하는데 많은 시간을 할해야만 했다. 개인적으로 <a href="http://grokconstructor.appspot.com/do/match?example=2" target="_blank" rel="noopener">http://grokconstructor.appspot.com/do/match?example=2</a> 에서 테스트 해보면서 패턴을 작성할수 있어 그나마 다행이였다.<br>또한 logstash에서 파싱해주는 정보를 조금 다듬기 위해 <code>mutate</code> filter 를 사용해서 필드를 조합/수정 하였다.<br>위처럼 적용을 하고 한두시간 수집을 해보니 Elasticsearch에 아래와 같은 도큐먼트가 생성이 된것을 확인할수 있었다.<br><div class="figure center" style="width:;"><img class="fig-img" src="user_agent_elasticsearch_document.jpg" alt="이 얼마나 우아한가..."><span class="image-caption">이 얼마나 우아한가...</span><span class="caption">이 얼마나 우아한가...</span></div><br>이 정보들을 잘 조합해서 Kibana에서 보면 다음과 같이 볼수 있다.<br><div class="figure center" style="width:;"><img class="fig-img" src="kibana_1.png" alt="user-agent 아 모바일 에서도 안드로이드 7.0에서 많이 들어오는구나~"><span class="image-caption">user-agent 아 모바일 에서도 안드로이드 7.0에서 많이 들어오는구나~</span><span class="caption">user-agent 아 모바일 에서도 안드로이드 7.0에서 많이 들어오는구나~</span></div><br>UA는 아니지만 기왕 한김에 Access log의 uri를 분석해보면 아래처럼 볼수도 있겠다.<br><div class="figure center" style="width:;"><img class="fig-img" src="kibana_2.png" alt="외부에서 막 찔러 대는구나~ 시스템에 영향줄 정도면 막아야지!"><span class="image-caption">외부에서 막 찔러 대는구나~ 시스템에 영향줄 정도면 막아야지!</span><span class="caption">외부에서 막 찔러 대는구나~ 시스템에 영향줄 정도면 막아야지!</span></div></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>사실 logstash filter plugin을 작성하면서 뭔가 if-else로 분기처리한게 아쉽긴 하지만 만족할만한 결과를 얻을수 있어서 다행이라고 생각하고, 역시 데이터를 raw형태로 보는것보다 시각화해서 보는게 훨씬더 이해도를 높일수 있다는걸 다시금 실감할수 있었던 좋은 시간이였다.<br>그런데.. 이 방법말고 더 우아한 방법은 없으려나..?;;</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Desktop 및 스마트폰의 대중화로 다양한 OS와 브라우저들을 사용하게 되었다. 이때, 내가 운영하는 웹서버에 들어오는 사람들은 무슨 기기로 접속을 하는 것일까? 혹여 특정 OS의 특정 브라우저에서만 안되는 버그를 잡기 위해 몇일밤을 고생하며 겨우 수정했는데… 과연 그 OS의 브라우저에서는 접속은 하기나 하는걸까? (ㅠㅠ)
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="user-agent" scheme="https://taetaetae.github.io/tags/user-agent/"/>
    
      <category term="apache access log" scheme="https://taetaetae.github.io/tags/apache-access-log/"/>
    
      <category term="Elasitcsearch" scheme="https://taetaetae.github.io/tags/Elasitcsearch/"/>
    
      <category term="Logstash" scheme="https://taetaetae.github.io/tags/Logstash/"/>
    
      <category term="Kibana" scheme="https://taetaetae.github.io/tags/Kibana/"/>
    
  </entry>
  
  <entry>
    <title>gzip 설정으로 속도를 더 빠르게!</title>
    <link href="https://taetaetae.github.io/2018/04/01/apache-gzip/"/>
    <id>https://taetaetae.github.io/2018/04/01/apache-gzip/</id>
    <published>2018-04-01T08:58:11.000Z</published>
    <updated>2018-07-29T08:31:26.069Z</updated>
    
    <content type="html"><![CDATA[<p>내가 운영중인 웹서비스의 응답속도를 보다 더 빠르게 하기 위해서는 어떤 방법이 있을까?<br>웹 서비스를 위해 서버를 구성할 경우 일반적으로 앞단에 <code>웹서버</code>를 두고 그뒤에 <code>WAS</code>를 두는 설계를 하곤 한다. <a id="more"></a>여기서 웹서버는 대표적으로 Apache나 Nginx가 있고 WAS는 tomcat이나 기타 다른 모듈을 사용하는데 이렇게 두단계로 나누는 이유는 여러가지가 있겠지만 여기서는 앞단의 웹서버(Apache)의 설정으로 응답속도를 줄일수 있는 방법을 알아 보고자 한다.</p><h3 id="웹페이지의-응답속도를-줄일수-있는-‘일반적인’방법들"><a href="#웹페이지의-응답속도를-줄일수-있는-‘일반적인’방법들" class="headerlink" title="# 웹페이지의 응답속도를 줄일수 있는 ‘일반적인’방법들"></a># 웹페이지의 응답속도를 줄일수 있는 ‘일반적인’방법들</h3><p>꼭 서버의 설정들을 건드리지 않고도 웹페이지의 응답속도를 줄일수 있는 방법은 다양하다. 가장 간단하게 코드 레벨에서 설정할수 있는 방법으로는 스타일시트를 위에 선언하거나 java script는 코드 아래부분에 넣는것만으로도 어느정도 응답속도를 줄일수 있다고 한다. </p><blockquote><p>(사족) 신입시절 회사 대표님이 필수로 읽어보라고 전 직원들에게 선물해주셨던 <a href="http://book.naver.com/bookdb/book_detail.nhn?bid=4587095" target="_blank" rel="noopener">웹사이트 최적화기법 (스티브 사우더스 저)</a>이 생각이 난다. <del>모두 사주려면 돈이 얼마야…</del> 그만큼 웹개발자들에게 중요하면서도 한편으로는 기본이 되는 부분들이니 한번쯤 목차라도 읽어보는게 좋을듯 하다.</p></blockquote><p>사실 이 포스팅을 작성하게된 가장 큰 계기는 얼마전 사내 해커톤을 하면서 경험한 부분 때문이다. ( + 들어만 봤지 실제로 해보지는 않아서… ) 서버에서 node(React)를 띄우고 그 앞단에 Apache로 단순 Port Redirect ( 80 → 3000 ) 시켜주고 있었는데 react 에서 사용하는 <code>bundle.js</code>의 용량이 크다보니 최초 페이지 접근시 로딩시간이 5초 이상되어버린 것이다. bundle.js를 줄여보는등 다양한 방법을 사용했다가 결국 Apache 설정을 통해 1초 이내로 줄일수 있었다.</p><h3 id="gzip"><a href="#gzip" class="headerlink" title="# gzip"></a># gzip</h3><p>우선 <code>gzip</code>이란 파일 압축에 쓰이는 응용 소프트웨어로 GNU zip의 준말이라고 한다. (참고 : <a href="https://ko.wikipedia.org/wiki/Gzip" target="_blank" rel="noopener">위키백과 Gzip</a>) 이를 사용하기 위해서는 브라우저가 지원을 해야하는데 <a href="https://caniuse.com/#search=gzip" target="_blank" rel="noopener">https://caniuse.com/#search=gzip</a> 을 보면 대부분의 브라우저에서 지원하는것을 볼수 있다. </p><h3 id="데이터-흐름"><a href="#데이터-흐름" class="headerlink" title="# 데이터 흐름"></a># 데이터 흐름</h3><p>그럼 gzip 을 사용했을때와 사용하지 않았을때의 차이는 어떻게 다를까? 우선 Request/Response Flow 를 잠깐 살펴보면 다음과 같다.</p><ul><li>gzip 사용 전<div class="figure center" style="width:;"><img class="fig-img" src="before_gzip.png" alt="출처 : betterexplained.com"><span class="image-caption">출처 : betterexplained.com</span><span class="caption">출처 : betterexplained.com</span></div></li></ul><ol><li>브라우저가 서버측에 <code>/index.html</code>을 요청한다.</li><li>서버는 Request를 해석한다.</li><li>Response에 요청한 내용을 담아 보낸다.</li><li>Response를 기다렸다가 브라우저에 보여준다. (100kb)</li></ol><ul><li>gzip 사용 후<div class="figure center" style="width:;"><img class="fig-img" src="after_gzip.png" alt="출처 : betterexplained.com"><span class="image-caption">출처 : betterexplained.com</span><span class="caption">출처 : betterexplained.com</span></div></li></ul><ol><li>브라우저가 서버측에 <code>/index.html</code>을 요청한다.</li><li>서버는 Request를 해석한다.</li><li>Response에 요청한 내용을 담아 보낸다. 여기서 해당 내용을 압축하는 과정이 추가가 된다.</li><li>Response header에 압축이 되어있다는 정보를 확인후 브라우저는 해당 내용을 받고(10kb), 압축을 해제한 후 사용자에게 보여준다.</li></ol><p>정리하면, gzip을 사용하면 서버는 Client에게 보낼 Response를 압축하기 때문에 네트워크 비용을 줄일수 있어 응답속도가 빠른 장점이 있다. </p><h3 id="무조건-사용해야-하는가"><a href="#무조건-사용해야-하는가" class="headerlink" title="# 무조건 사용해야 하는가?"></a># 무조건 사용해야 하는가?</h3><p>물론 무조건 좋은 <code>(마치 show me the money 같은)</code>정답은 없다. 서버에서 압축을 하여 Client에게 보내면 그대로 사용자에게 보여주는것이 아니라 <code>압축을 해제하는 과정</code>이 추가적으로 필요하다. 이러한 과정에서 브라우저는 cpu를 사용하게 되어 오히려 랜더링 하는 과정이 느려질수 있어 자칫 응답속도는 빨라졌다 하더라도 사용자 체감상 더 느려진것처럼 보여질수 있다. 따라서 상황에 맞춰 gzip을 사용해야 할것인지 말것인지에 대해 테스트가 필요하다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>학부시절 또는 신입시절, 아파치는 정적인 리소스를  담당하고 톰켓은 서블릿 처럼 데이터 가공이 필요한 페이지를 담당한다고 주문을 외우듯 하였지만, 웹서버에서 압축을 하면 어떤 효과가 있는지 실제로 경험해보는게 가장 중요한것 같다.<br>적용 방법은 복붙하는 느낌이라 아파치 공식 문서를 링크 하는것으로 해당 포스팅을 마무리 하겠다.</p><ul><li>Apache Document (사용법) : <a href="https://httpd.apache.org/docs/2.2/ko/mod/mod_deflate.html" target="_blank" rel="noopener">https://httpd.apache.org/docs/2.2/ko/mod/mod_deflate.html</a></li><li>적용 테스트 사이트<ul><li><a href="https://developers.google.com/speed/pagespeed/insights" target="_blank" rel="noopener">https://developers.google.com/speed/pagespeed/insights</a></li><li><a href="http://www.whatsmyip.org/http-compression-test" target="_blank" rel="noopener">http://www.whatsmyip.org/http-compression-test</a></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;내가 운영중인 웹서비스의 응답속도를 보다 더 빠르게 하기 위해서는 어떤 방법이 있을까?&lt;br&gt;웹 서비스를 위해 서버를 구성할 경우 일반적으로 앞단에 &lt;code&gt;웹서버&lt;/code&gt;를 두고 그뒤에 &lt;code&gt;WAS&lt;/code&gt;를 두는 설계를 하곤 한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="gzip" scheme="https://taetaetae.github.io/tags/gzip/"/>
    
      <category term="mod_deflate" scheme="https://taetaetae.github.io/tags/mod-deflate/"/>
    
  </entry>
  
  <entry>
    <title>RestClientException 처리</title>
    <link href="https://taetaetae.github.io/2018/03/17/rest-client-exception/"/>
    <id>https://taetaetae.github.io/2018/03/17/rest-client-exception/</id>
    <published>2018-03-17T10:19:39.000Z</published>
    <updated>2018-07-29T08:31:26.431Z</updated>
    
    <content type="html"><![CDATA[<p>Spring 환경에서 (Spring5는 달라졌지만…) 외부 API로의 호출을 할때 자주 쓰이는 RestTemplate. 이때 request에 대해 정상적인 응답이 아닌 경우에 대한 처리는 어떻게 할까? 막연하게 생각을 해보면 Http Status Code를 받아서 판별을 하면 되지만 Http Status Code만 봐도 엄청~많다. <a id="more"></a> ( 위키피디아 참고 : <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/List_of_HTTP_status_codes</a> )<br>if~else 로 다 나눌수도 없고… 우선 성공/실패에 대한 판별은 어떻게 할까 하고 코드를 파고파고 들어가다가 알게된 부분에 대해 정리를 해보겠다.</p><h4 id="Http-Status-Code-그룹정의"><a href="#Http-Status-Code-그룹정의" class="headerlink" title="# Http Status Code 그룹정의"></a># Http Status Code 그룹정의</h4><p>Spring-project github에 가보면 HttpStatus 하위에 내부 Enum으로 아래처럼 정의되어 있다. ( <a href="https://github.com/spring-projects/spring-framework/blob/4.3.x/spring-web/src/main/java/org/springframework/http/HttpStatus.java#L505" target="_blank" rel="noopener">링크</a> )<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> HttpStatus &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Series <span class="title">series</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Series.valueOf(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Series &#123;</span><br><span class="line"></span><br><span class="line">INFORMATIONAL(<span class="number">1</span>),</span><br><span class="line">SUCCESSFUL(<span class="number">2</span>),</span><br><span class="line">REDIRECTION(<span class="number">3</span>),</span><br><span class="line">CLIENT_ERROR(<span class="number">4</span>),</span><br><span class="line">SERVER_ERROR(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Series <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> seriesCode = status / <span class="number">100</span>;</span><br><span class="line"><span class="keyword">for</span> (Series series : values()) &#123;</span><br><span class="line"><span class="keyword">if</span> (series.value == seriesCode) &#123;</span><br><span class="line"><span class="keyword">return</span> series;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"No matching constant for ["</span> + status + <span class="string">"]"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>약 80여개 응답코드들을 크게 5개 묶음으로 정의해 놓은것을 볼수있다. 즉, 201 / 201 / 202 같은 녀석들은 전부 <code>SUCCESSFUL</code> 성공 으로 그룹핑이 되는것을 확인할수 있다.</p><h4 id="그럼-RestTemplate-에서는-어떻게-처리하고-있나"><a href="#그럼-RestTemplate-에서는-어떻게-처리하고-있나" class="headerlink" title="# 그럼 RestTemplate 에서는 어떻게 처리하고 있나?"></a># 그럼 RestTemplate 에서는 어떻게 처리하고 있나?</h4><p>코드를 쭉쭉 따라가다 보면 아래처럼 4xx, 5xx 는 에러라고 판단하고 그에 따라 RestClientException 을 반환하는것을 확인할수 있다. </p><ul><li><p>RestTemplate 호출 <a href="https://github.com/spring-projects/spring-framework/blob/4.3.x/spring-web/src/main/java/org/springframework/web/client/RestTemplate.java#L649" target="_blank" rel="noopener">링크</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">ClientHttpRequest request = createRequest(url, method);</span><br><span class="line"><span class="keyword">if</span> (requestCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">requestCallback.doWithRequest(request);</span><br><span class="line">&#125;</span><br><span class="line">response = request.execute();</span><br><span class="line">handleResponse(url, method, response);</span><br><span class="line"><span class="keyword">if</span> (responseExtractor != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> responseExtractor.extractData(response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (IOException ex) &#123;</span><br></pre></td></tr></table></figure></li><li><p>에러 판별 <a href="https://github.com/spring-projects/spring-framework/blob/4.3.x/spring-web/src/main/java/org/springframework/web/client/DefaultResponseErrorHandler.java" target="_blank" rel="noopener">링크</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">hasError</span><span class="params">(HttpStatus statusCode)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (statusCode.series() == HttpStatus.Series.CLIENT_ERROR || statusCode.series() == HttpStatus.Series.SERVER_ERROR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="성공-실패-처리는-어떻게-할것인가"><a href="#성공-실패-처리는-어떻게-할것인가" class="headerlink" title="# 성공/실패 처리는 어떻게 할것인가"></a># 성공/실패 처리는 어떻게 할것인가</h4><p>각자 정의하기 나름일것 같다. 우선 아주 간단하게 RestTemplate 를 사용할때 예외처리를 하여 정의된 대로 4xx, 5xx가 에러라고 판단할 수 있을것 같고<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    responseBody = restTemplate.postForObject(url, httpEntity, <span class="keyword">byte</span>[].class);</span><br><span class="line">&#125; <span class="keyword">catch</span> (RestClientException e) &#123; <span class="comment">// 에러인 경우 RestClientException 을 내뱉는다.</span></span><br><span class="line">    log.error(<span class="string">"##### restTemplate error, url = &#123;&#125;"</span>, url, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>정의된 에러(?)와는 조금 다르게 처리하고 싶다면 <code>DefaultResponseErrorHandler</code>을 상속받고 <code>hasError</code>메소드를 무조건 패스하도록 Override 하고난 다음 응답 코드를 받아서 처리하는 방법이 있을수 있겠다.<br>(물론 이러한 방법 말고 다양한 방법이 있을것 같다.)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Spring 환경에서 (Spring5는 달라졌지만…) 외부 API로의 호출을 할때 자주 쓰이는 RestTemplate. 이때 request에 대해 정상적인 응답이 아닌 경우에 대한 처리는 어떻게 할까? 막연하게 생각을 해보면 Http Status Code를 받아서 판별을 하면 되지만 Http Status Code만 봐도 엄청~많다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="RestTemplate" scheme="https://taetaetae.github.io/tags/RestTemplate/"/>
    
      <category term="RestClientException" scheme="https://taetaetae.github.io/tags/RestClientException/"/>
    
  </entry>
  
  <entry>
    <title>소나큐브 이용 코드 정적분석 자동화</title>
    <link href="https://taetaetae.github.io/2018/02/08/jenkins-sonar-github-integration/"/>
    <id>https://taetaetae.github.io/2018/02/08/jenkins-sonar-github-integration/</id>
    <published>2018-02-08T11:10:54.000Z</published>
    <updated>2018-07-29T08:31:26.201Z</updated>
    
    <content type="html"><![CDATA[<p><code>코드 정적분석</code>이라 함은 실제 프로그램을 실행하지 않고 코드만의 형태에 대한 분석을 말한다. 이를테면 냄새나는 코드(?)라던지, 위험성이 있는 코드, 미리 정의된 규칙이나 코딩 표준을 준수하는지에 대한 분석을 말하는데 java 기준으로는 아래 다양한 (잘 알려진) 정적분석 도구들이 있다.<a id="more"></a></p><ul><li>PMD<ul><li>미사용 변수, 비어있는 코드 블락, 불필요한 오브젝트 생성과 같은 Defect을 유발할 수 있는 코드를 검사</li><li><a href="https://pmd.github.io" target="_blank" rel="noopener">https://pmd.github.io</a></li></ul></li><li>FindBugs<ul><li>정해진 규칙에 의해 잠재적인 에러 타입을 찾아줌</li><li><a href="http://findbugs.sourceforge.net" target="_blank" rel="noopener">http://findbugs.sourceforge.net</a></li></ul></li><li>CheckStyle<ul><li>정해진 코딩 룰을 잘 따르고 있는지에 대한 분석</li><li><a href="http://checkstyle.sourceforge.net" target="_blank" rel="noopener">http://checkstyle.sourceforge.net</a></li></ul></li></ul><p>이외에 <code>SonarQube</code> 라는 툴이 있는데 개인적으로 위 알려진 다른 툴들의 종합판(?)이라고 생각이 들었고, 그중 가장 인상깊었던 기능이 github과 연동이 되고 적절한 구성을 하게 되면 코드를 수정하는과 동시에 자동으로 분석을 하고 리포팅까지 해준다는 부분이였다. ( <del>더 좋은 방법이 있는지는 모르겠으나</del> 다른 도구들은 수동으로 돌려줘야 하고 리포팅 또한 Active하지 못한(?) 아쉬운 점이 있었다.  )</p><p>지금부터 Jenkins + github web-hook + SonarQube 를 구성하여 코드를 수정하고 PullRequest를 올리게 되면 수정한 파일에 대해 자동으로 정적분석이 이뤄지고, 그에대한 리포팅이 해당 PullRequest에 댓글로 달리도록 설정을 해보겠다. (코드리뷰를 봇(?)이 자동으로 해주는게 얼마나 편한 일인가…)</p><h3 id="기본-컨셉"><a href="#기본-컨셉" class="headerlink" title="# 기본 컨셉"></a># 기본 컨셉</h3><p>전체적인 컨셉은 다음 그림과 같다.<br><div class="figure center" style="width:;"><img class="fig-img" src="concept.png" alt="전체 컨셉"><span class="image-caption">전체 컨셉</span><span class="caption">전체 컨셉</span></div></p><ol><li>IDE에서 코드수정을 하고 remote 저장소에 commit &amp; push를 한다.<br>그 다음 github에서 master(혹은 stable한 branch)에 대해 작업 branch를 PullRequest 올린다.</li><li>미리 등록한 github의 web-hook에 의해 PullRequest 정보들을 jenkins에 전송한다. </li><li>전달받은 정보를 재 가공하여 SonarQube로 정적분석을 요청한다.</li><li>SonarQube에서 분석한 정보를 다시 jenkins로 return 해준다.</li><li>SonarQube으로부터 return 받은 정보를 해당 PullRequest의 댓글에 리포팅을 해준다.</li></ol><p>간단히 보면 (뭐 간단하니 쉽네~) 라고 볼수도 있겠지만 나는 이런 전체 흐름을 설정하는데 있어 어려웠다.</p><blockquote><p>사실 셋팅하는 과정에서 적지않은 삽질을 했었기에, 이 포스팅을 적는 이유일수도 있겠다.<br>더불어 검색을 해봐도 이렇게 전체흐름이 정리된 글이 잘 안보여서 + 내가 한 삽질을 다른 누군가도 할것같아서(?)</p></blockquote><h3 id="Maven-설치"><a href="#Maven-설치" class="headerlink" title="# Maven 설치"></a># Maven 설치</h3><p>기본적으로 Maven의 H2DB를 사용하므로 SonarQube를 설치하기전에 Maven부터 설치해줘야 한다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://apache.mirror.cdnetworks.com/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz</span><br><span class="line">$ tar -zxvf apache-maven-3.5.2-bin.tar.gz</span><br><span class="line">(환경변수 셋팅후 )</span><br><span class="line">$  mvn -version</span><br><span class="line">Apache Maven 3.5.2 (138edd61fd100ec658bfa2d307c43b76940a5d7d; 2017-10-18T16:58:13+09:00)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><h3 id="SonarQube-설치"><a href="#SonarQube-설치" class="headerlink" title="# SonarQube 설치"></a># SonarQube 설치</h3><p>정적분석을 도와주는 SonarQube를 설치해보자.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://sonarsource.bintray.com/Distribution/sonarqube/sonarqube-6.7.1.zip</span><br><span class="line">$ unzip sonarqube-6.7.1.zip</span><br><span class="line">$ cd sonarqube-6.7.1/bin/linux-x86-64</span><br><span class="line">$ ./sonar.sh start</span><br><span class="line">Starting SonarQube...</span><br><span class="line">Started SonarQube.</span><br></pre></td></tr></table></figure></p><p>기본적으로 9000포트를 사용하고 있으니 다른포트를 사용하고자 한다면 /sonarqube-6.7.1/conf/sonar.properties 내 <code>sonar.web.port=9000</code> 을 수정해주면 된다. (SonarQube도 Elasticsearch를 사용하구나…)<br>설치후 실행을 한뒤 <code>서버IP:9000</code>을 접속해보면 아래 화면처럼 나온다. (혹시 접속이 안된다거나 서버가 실행이 안된다면 <code>./sonar.sh console</code>로 로그를 보면 문제해결에 도움이 될수도 있다. )<br><div class="figure center" style="width:;"><img class="fig-img" src="sonar_main.png" alt="SonarQube 메인화면"><span class="image-caption">SonarQube 메인화면</span><span class="caption">SonarQube 메인화면</span></div></p><h3 id="SonarQube-Scanner-설치"><a href="#SonarQube-Scanner-설치" class="headerlink" title="# SonarQube Scanner 설치"></a># SonarQube Scanner 설치</h3><p>소스를 연동시켜 정적분석을 하기 위해서는 SonarQube Scanner 라는게 필요하다고 한다. 아래 url에서 다운받아 적절한 곳에 압축을 풀어두자.<br><a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="noopener">https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.0.3.778-linux.zip</span><br><span class="line">$ unzip sonar-scanner-cli-3.0.3.778-linux.zip</span><br></pre></td></tr></table></figure></p><h3 id="jenkins-설치-및-SonarQube-연동"><a href="#jenkins-설치-및-SonarQube-연동" class="headerlink" title="# jenkins 설치 및 SonarQube 연동"></a># jenkins 설치 및 SonarQube 연동</h3><p>jenkins 설치는 간단하니 별도 언급은 안하고 넘어가…려고 했으나, 하나부터 열까지 정리한다는 마음으로~<br><a href="https://jenkins.io/download/" target="_blank" rel="noopener">https://jenkins.io/download/</a> 에서 최신버전을 tomcat/webapps/ 아래에 다운받고 server.xml 을 적절하게 수정해준다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war</span><br><span class="line">$ vi tomcat/conf/server.xml</span><br><span class="line">&lt;Connector port=&quot;19001&quot; protocol=&quot;HTTP/1.1&quot; # 포트 변경</span><br><span class="line">&lt;Context path=&quot;/jenkins&quot; debug=&quot;0&quot; privileged=&quot;true&quot; docBase=&quot;jenkins.war&quot; /&gt; #추가</span><br><span class="line"># tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure></p><p>jenkins 설치를 완료 한 후 필요한 플러그인을 추가로 설치해준다.</p><ul><li>Python Plugin</li><li>GitHub Pull Request Builder</li><li>GitHub plugin</li></ul><p>접속 : <code>서버IP:19001</code> (참고로 한 서버에서 다 설치하다보니 port 충돌을 신경쓰게되었다. )<br>처음 jenkins를 실행하면 이런저런 설정을 하는데 특별한 설정 변경없이 next버튼을 연신 눌러면 설치가 완료 되고, SonarQube를 사용하기 위해 <code>SonarQube Scanner for Jenkins</code>라는 플러그인을 설치해주자. (이건 각 버전마다 궁합(?)이 안맞을수도 있으니 확인이 필요할수도 있다. 내가 설치한 버전은 jenkins 2.89, SonarQube Plugin 2.6.1이다.)<br>설치를 하면 jenkins &gt; configure 에서 <code>SonarQube servers</code>정보를 등록해준다.<br><div class="figure center" style="width:;"><img class="fig-img" src="jenkins_sonarqube_config.png" alt="SonarQube 젠킨스 설정"><span class="image-caption">SonarQube 젠킨스 설정</span><span class="caption">SonarQube 젠킨스 설정</span></div><br>authentication token 은 SonarQube에 처음 접속했을때 아래화면을 볼수 있는데, 여기서 authentication token을 발급받을수 있다. 또한 language 와 build 방법을 선택하자. (이부분은 나중에 변경이 가능하니 개발상황에 맞춰서 설정하면 될듯하다.)<br><div class="figure center" style="width:;"><img class="fig-img" src="authentication.png" alt="authentication token 발급"><span class="image-caption">authentication token 발급</span><span class="caption">authentication token 발급</span></div><br>그 다음 jenkins &gt; configureTools 에서 SonarQube scanner 정보를 다음 화면과 같이 등록해준다.<br><div class="figure center" style="width:;"><img class="fig-img" src="jenkins_sonarqube_scanner.png" alt="SonarQube scanner 젠킨스 설정"><span class="image-caption">SonarQube scanner 젠킨스 설정</span><span class="caption">SonarQube scanner 젠킨스 설정</span></div><br>우선 여기까지 하면 jenkins 와 SonarQube 연동은 된걸로 보면 된다.</p><h3 id="Github과-Jenkins-연동"><a href="#Github과-Jenkins-연동" class="headerlink" title="# Github과 Jenkins 연동"></a># Github과 Jenkins 연동</h3><p>앞서 설명한 전체 컨셉 그림과 같이 github 에 pullRequest가 발생하면 web-hook을 이용하여 jenkins로 정보를 전달하는 방식인데, 이럴려면 우선 github과 jenkins가 연동이된 상태여야 한다. 관련 방법은 아래 링크에 정리를 해놨으니 참고해도 좋을듯 하다.</p><blockquote><p><a href="/2018/02/08/github-with-jenkins">Github과 Jenkins 연동하기</a></p></blockquote><h3 id="Jenkins-job-등록"><a href="#Jenkins-job-등록" class="headerlink" title="# Jenkins job 등록"></a># Jenkins job 등록</h3><p>Jenkins job은 두개를 만들어 줘야 한다.</p><ul><li>1번 job <code>pullrequest_receiver</code> : github으로부터 web-hook을 통해 pullRequest정보를 받는 job</li><li>2번 job <code>sonaqube-job</code> : 1번 job으로 부터 정보를 받아 SonarQube를 이용해 정적분석후 해당 pullRequest에 댓글로 리포팅 하는 Job</li></ul><h5 id="1번-job"><a href="#1번-job" class="headerlink" title="- 1번 job"></a>- 1번 job</h5><p>편의상 job 이름은 <code>pullrequest_receiver</code>으로 정하였고, 매개변수로 <code>String Parameter</code>에 이름은 <code>payload</code>라 정하였다. 그리고 Build 에서 Execute Python 으로 아래 코드를 실행하도록 하였다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  os, json, sys, requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://~~~/jenkins/job/sonaqube-job'</span></span><br><span class="line">hookData = json.loads(os.environ[<span class="string">'payload'</span>])</span><br><span class="line">branch = hookData[<span class="string">'pull_request'</span>][<span class="string">'head'</span>][<span class="string">'ref'</span>];</span><br><span class="line">prId = hookData[<span class="string">'pull_request'</span>][<span class="string">'number'</span>];</span><br><span class="line">componentName = hookData[<span class="string">'repository'</span>][<span class="string">'name'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> action == <span class="string">'closed'</span> <span class="keyword">or</span> action == <span class="string">'synchronize'</span> <span class="keyword">or</span> action == <span class="string">'assigned'</span> : <span class="comment"># 이 부분은 적절하게 수정이 필요하다.</span></span><br><span class="line">  sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">repository = hookData[<span class="string">'repository'</span>][<span class="string">'full_name'</span>]</span><br><span class="line"></span><br><span class="line">url = url + <span class="string">'/buildWithParameters?branch='</span> + branch + <span class="string">'&amp;pr='</span> + str(prId) + <span class="string">'&amp;repository='</span> + repository + <span class="string">'&amp;componentName='</span> + componentName</span><br><span class="line"></span><br><span class="line">response = requests.post(url)</span><br></pre></td></tr></table></figure></p><p>WebHook을 이용해서 Jenkins Job을 실행시키는 과정은 아래 링크에 별도로 정리해놨으니 참고해도 좋을듯 하다.</p><blockquote><p><a href="/2018/02/08/github-web-hook-jenkins-job-excute">Github의 WebHook을 이용하여 자동 Jenkins Job 실행</a></p></blockquote><p>위와 같이 설정을 하고 pullRequest가 발생을 하면 해당 Job이 실행이 되면서 정보들을 적절하게 조합하여 2번 job으로 보내게 된다. 여기서 job을 하나로 나누지 않고 <code>github정보를 받는 job</code>, <code>SonarQube 분석 job</code> 이렇게 두개로 나눈 이유는 여러 Repository에 대해서 셋팅을 하고 싶은경우 Repository에서는  <code>1번 job</code>으로 쏘게 하고 <code>1번 job</code>내부에서 payload의 정보를 분석하여 Repository별 SonarQube 분석 job url로 보내면 되기 때문이다. 1번 job 은 하나, 2번 job은 Repository 별로 분기 되는 구조.</p><h5 id="2번-job"><a href="#2번-job" class="headerlink" title="- 2번 job"></a>- 2번 job</h5><p>SonarQube job을 작성할 차례다. 1번 job에서 파라미터를 보내주기 때문에 역시 2번 job에서도 파라미터를 미리 받도록 설정해주자.</p><ul><li>파라미터 목록<ul><li>pr</li><li>branch</li><li>repository</li><li>componentName</li></ul></li></ul><p>이 job에서는 SonarQube 분석이 되는데, 해당 repo에 대한 접근권한이 있어야 하기 때문에 앞서 설정한 <code>Github과 Jenkins 연동</code> 방법으로 Repository 와 Credentials 을 지정해주고, 브랜치 경로 또한 파라미터로 받은 값으로 지정해 준다.<br><div class="figure center" style="width:;"><img class="fig-img" src="jenkins_config_source.png" alt="소스코드 관리 설정"><span class="image-caption">소스코드 관리 설정</span><span class="caption">소스코드 관리 설정</span></div></p><p>마지막으로 최종 목적이였던 SonarQube 분석을 할 차례인데, 이번에 SonarQube가 버전업이 되면서 java 기분 .java 파일만 가지고 하는게 아니라 .java파일을 컴파일 하면 나오는 .class파일 경로를 필수로 지정해줘야 한다고 한다. (예전에는 .class 파일 경로를 지정하지 않아도 되었는데 홈페이지 설명에 의하면 바이너리 파일까지 같이 분석하게 되면 분석 신뢰도가 높아진다고 한다.)<br><a href="https://docs.sonarqube.org/display/PLUG/Java+Plugin+and+Bytecode" target="_blank" rel="noopener">https://docs.sonarqube.org/display/PLUG/Java+Plugin+and+Bytecode</a></p><blockquote><p>딴 이야기로, 난 여태까지 정적분석이라는건 코드만을 가지고 하는줄 알았다. 자바 기준에서는 .java . 하지만 이번에 SonarQube 설정을 하면서 알게된 부분으로, 정적분석이라는건 맨 위에 적어놨듯 <code>실제 프로그램을 실행하지 않고 코드만의 형태에 대한 분석</code> 이기 때문에 java 기준에서는 .class 파일또한 분석의 대상으로 볼수가 있다. (실제로 구버전 - .java만 분석 / 신버전 - .java + .class 분석 을 해봤더니 불필요한 분석결과(?)가 줄어든것을 알수 있었다. )</p></blockquote><p>그래서 결국 컴파일을 한 뒤에 SonarQube 분석을 하면 되겠다.<br><div class="figure center" style="width:;"><img class="fig-img" src="build_sonarqube_config.png" alt="빌드 및 SonarQube 분석 설정"><span class="image-caption">빌드 및 SonarQube 분석 설정</span><span class="caption">빌드 및 SonarQube 분석 설정</span></div><br>SonarQube 설정파일은 다음과 같다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=$&#123;componentName&#125; # 유니크한 프로젝트 키 네이밍 값</span><br><span class="line">sonar.projectVersion=0.1</span><br><span class="line">sonar.sourceEncoding=UTF-8 </span><br><span class="line">sonar.analysis.mode=preview </span><br><span class="line">sonar.github.repository=$&#123;repository&#125;</span><br><span class="line">sonar.github.endpoint=https://api.github.co</span><br><span class="line">sonar.github.login= # github login id</span><br><span class="line">sonar.github.oauth= # github 개인키</span><br><span class="line">sonar.login=admin</span><br><span class="line">sonar.password=admin </span><br><span class="line">sonar.github.pullRequest=$&#123;pr&#125;</span><br><span class="line">sonar.host.url= # SonarQube url</span><br><span class="line">sonar.issuesReport.console.enable=true </span><br><span class="line">sonar.github.disableInlineComments=true</span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.exclusions=</span><br><span class="line">sonar.java.binaries=target/classes # 빌드 결과물 경로</span><br></pre></td></tr></table></figure></p><p>이렇게 긴~~과정을 거치고 나면 pullRequest 를 올릴때마다 아래 그림처럼 수정한 파일에 대해서 자동으로 분석을 하여 알려준다.<br><div class="figure center" style="width:;"><img class="fig-img" src="sonar_result_report.png" alt="SonarQube 분석결과"><span class="image-caption">SonarQube 분석결과</span><span class="caption">SonarQube 분석결과</span></div></p><p>또한 분석결과에 따라 (이 부분은 SonarQube 설정으로 조정이 가능할것같다) merge 가 가능/불가능이 조정되어 진다.<br><div class="figure center" style="width:;"><img class="fig-img" src="sonar_result.png" alt="SonarQube 분석 중 critical 항목이 없어서 merge 가능한 화면"><span class="image-caption">SonarQube 분석 중 critical 항목이 없어서 merge 가능한 화면</span><span class="caption">SonarQube 분석 중 critical 항목이 없어서 merge 가능한 화면</span></div></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>반복적인 일에 대해서 자동화 구성을 한다는것은 참 의미있는 일인것 같다. 팀내 이런 구성을 도입하구서 획기적으로 코드 품질이 나아지진 않았지만 자칫 잘못해서 merge가 되는 위험한 코드들은 어느정도 SonarQube가 잡아주는것 같다. 사족이지만, 이렇게 적고나니 간단한데 이런 구성에 대한 정보를 알기까지는 엄청난 시간이 들었기에… 오랜만의 포스팅에 대한 뿌듯함을 다시한번 느낀다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;코드 정적분석&lt;/code&gt;이라 함은 실제 프로그램을 실행하지 않고 코드만의 형태에 대한 분석을 말한다. 이를테면 냄새나는 코드(?)라던지, 위험성이 있는 코드, 미리 정의된 규칙이나 코딩 표준을 준수하는지에 대한 분석을 말하는데 java 기준으로는 아래 다양한 (잘 알려진) 정적분석 도구들이 있다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="github" scheme="https://taetaetae.github.io/tags/github/"/>
    
      <category term="jenkins" scheme="https://taetaetae.github.io/tags/jenkins/"/>
    
      <category term="SonarQube" scheme="https://taetaetae.github.io/tags/SonarQube/"/>
    
      <category term="integration" scheme="https://taetaetae.github.io/tags/integration/"/>
    
  </entry>
  
  <entry>
    <title>Github의 WebHook을 이용하여 자동 Jenkins Job 실행</title>
    <link href="https://taetaetae.github.io/2018/02/08/github-web-hook-jenkins-job-excute/"/>
    <id>https://taetaetae.github.io/2018/02/08/github-web-hook-jenkins-job-excute/</id>
    <published>2018-02-08T08:10:54.000Z</published>
    <updated>2018-07-29T08:31:26.161Z</updated>
    
    <content type="html"><![CDATA[<p>PullRequest가 발생하면 알림을 받고싶다거나, 내가 관리하는 레파지토리에 댓글이 달릴때마다 또는 이슈가 생성될때마다 정보를 저장하고 싶다거나. 종합해보면 <code>Github에서 이벤트가 발생할때 어떤 동작을 해야 할 경우</code> Github에서 제공하는 Webhook 을 사용하여 목적을 달성할 수 있다.<a id="more"></a><br>아 당연한 이야기이지만 언급하고 넘어갈께 있다면, Github에서 Jenkins Job을 호출하기 위해서는 Jenkins가 외부에 공개되어 있어야 한다. (내부사설망이나 private 한 설정이 되어있다면 호출이 안되어 Webhook기능을 사용할 수 없다.)</p><h3 id="Jenkins-Security-설정"><a href="#Jenkins-Security-설정" class="headerlink" title="# Jenkins Security 설정"></a># Jenkins Security 설정</h3><p>Jenkins Job을 외부에서 URL로 실행을 하기 위해서는 아래 설정이 꼭 필요하다. (이 설정을 몰라서 수많은 삽질을 했다.)<br>CSRF Protection 설정 체크를 풀어줘야 한다. 이렇게 되면 외부에서 Job에 대한 트리거링이 가능해 진다.<br><div class="figure center" style="width:;"><img class="fig-img" src="jenkins_config.png" alt="Jenkins > Configure Global Security"><span class="image-caption">Jenkins > Configure Global Security</span><span class="caption">Jenkins > Configure Global Security</span></div></p><h3 id="Jenkins-Job-설정"><a href="#Jenkins-Job-설정" class="headerlink" title="# Jenkins Job 설정"></a># Jenkins Job 설정</h3><p>Github 에서 Webhook에 의해 Jenkins Job을 실행하게 될텐데, 그때 정보들이 <code>payload</code>라는 파라미터와 함께 <code>POST</code> 형식으로 호출이 되기 때문에 미리 Job에서 받는 준비(?)를 해둬야 한다.<br>설정은 간단하게 다음과 같이 Job 파라미터 설정을 해주면 된다.<br><div class="figure center" style="width:;"><img class="fig-img" src="jenkins_job_param.png" alt="Jenkins > 해당 Job > configure"><span class="image-caption">Jenkins > 해당 Job > configure</span><span class="caption">Jenkins > 해당 Job > configure</span></div></p><h3 id="Github-Webhook-설정"><a href="#Github-Webhook-설정" class="headerlink" title="# Github Webhook 설정"></a># Github Webhook 설정</h3><p>이제 Github Repository 의 Hook 설정만 하면 끝이난다. 해당 Repository &gt; Settings &gt; Hooks 설정에 들어가서 <code>Add webhook</code>을 선택하여 Webhook을 등록해준다.<br>URL은 <code>{jenkins URL}/jenkins/job/{job name}/buildWithParameters</code>식으로 설정해주고 Content Type 은 <code>application/x-www-form-urlencoded</code>으로 선택한다. 언제 Webhook을 트리거링 시킬꺼냐는 옵션에서는 원하는 설정에 맞추면 되겠지만 나는 <code>pullRequest</code>가 등록 될때만 미리 만들어 놓은 Jenkins Job을 실행시킬 계획이였으니 <code>Let me select individual events.</code>을 설정하고 <code>Pull Request</code>에 체크를 해준다. 아래 그림처럼 말이다.<br><div class="figure " style="width:;"><img class="fig-img" src="oss_webhook.png" alt="해당 Repositroy > Settings > Hooks"><span class="image-caption">해당 Repositroy > Settings > Hooks</span><span class="caption">해당 Repositroy > Settings > Hooks</span></div><br>이렇게 등록하고 다시 들어가서 맨 아랫 부분<code>Recent Deliveries</code>을 보면 ping test 가 이루어져 정상적으로 응답을 받은것을 확인할수가 있다.<br><div class="figure " style="width:;"><img class="fig-img" src="oss_webhook_result.png" alt="Webhook 등록 결과"><span class="image-caption">Webhook 등록 결과</span><span class="caption">Webhook 등록 결과</span></div></p><p>이렇게 설정을 다 한 뒤 PullRequest를 발생시키면 Jenkins 해당 Job에서는 파라미터를 받으며 실행이 된것을 확인할수가 있다.<br><div class="figure " style="width:;"><img class="fig-img" src="jenkins_webhook_result.png" alt="Jenkins Job 실행 결과"><span class="image-caption">Jenkins Job 실행 결과</span><span class="caption">Jenkins Job 실행 결과</span></div></p><p>끝~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;PullRequest가 발생하면 알림을 받고싶다거나, 내가 관리하는 레파지토리에 댓글이 달릴때마다 또는 이슈가 생성될때마다 정보를 저장하고 싶다거나. 종합해보면 &lt;code&gt;Github에서 이벤트가 발생할때 어떤 동작을 해야 할 경우&lt;/code&gt; Github에서 제공하는 Webhook 을 사용하여 목적을 달성할 수 있다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="github" scheme="https://taetaetae.github.io/tags/github/"/>
    
      <category term="jenkins" scheme="https://taetaetae.github.io/tags/jenkins/"/>
    
      <category term="Webhook" scheme="https://taetaetae.github.io/tags/Webhook/"/>
    
  </entry>
  
  <entry>
    <title>Github과 Jenkins 연동하기</title>
    <link href="https://taetaetae.github.io/2018/02/08/github-with-jenkins/"/>
    <id>https://taetaetae.github.io/2018/02/08/github-with-jenkins/</id>
    <published>2018-02-08T08:10:21.000Z</published>
    <updated>2018-07-29T08:31:26.178Z</updated>
    
    <content type="html"><![CDATA[<p>Jenkins에서 Github의 소스를 가져와서 빌드를 하는 등 Github과 Jenkins와 연동을 시켜줘야하는 상황에서, 별도의 선행 작업이 필요하다. 다른 여러 방법이 있을수 있는데 여기서는 SSH로 연동하는 방법을 알아보고자 한다.<a id="more"></a></p><p>우선 Jenkins가 설치되어있는 서버에서 인증키를 생성하자.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -f id_rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in id_rsa.</span><br><span class="line">Your public key has been saved in id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:~~~~~ ~~~@~~~~~</span><br><span class="line">The key&apos;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|     o*+**=*=**+ |</span><br><span class="line">|     o B=o+o++o  |</span><br><span class="line">|     E+.o+ + oo .|</span><br><span class="line">|      oo. * o ...|</span><br><span class="line">|     .+ S  =   o |</span><br><span class="line">|     . +    o .  |</span><br><span class="line">|      . .  .     |</span><br><span class="line">|       .         |</span><br><span class="line">|                 |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">id_rsa  id_rsa.pub</span><br></pre></td></tr></table></figure><p>개인키(id_rsa)는 젠킨스에 설정해준다. (처음부터 끝까지 복사, 첫줄 마지막줄 빼면 안된다… )<br><div class="figure center" style="width:;"><img class="fig-img" src="ssh_jenkins.png" alt="젠킨스에 SSH 개인키 설정"><span class="image-caption">젠킨스에 SSH 개인키 설정</span><span class="caption">젠킨스에 SSH 개인키 설정</span></div><br>그 다음 공개키(id_rsa.pub)는 Github에 설정을 해준다.<br><div class="figure center" style="width:;"><img class="fig-img" src="ssh_github.png" alt="Github에 SSH 공개키 설정"><span class="image-caption">Github에 SSH 공개키 설정</span><span class="caption">Github에 SSH 공개키 설정</span></div><br>이렇게 한뒤 Jenkins 에서 임의로 job을 생성하고 job 설정 &gt; 소스코드 관리 에서 git 부분에 아래처럼 테스트를 해서 정상적으로 연동이 된것을 확인한다. <code>Credentials</code> 값을 위에서 설정한 개인키로 설정하고, repo 주소를 SSH용으로 적었을때 에러가 안나오면 성공한것이다.<br><div class="figure center" style="width:;"><img class="fig-img" src="ssh_complete.png" alt="정상 연결되면 Jenkins 오류도 없고, github SSH 키에 녹색불이 들어온다."><span class="image-caption">정상 연결되면 Jenkins 오류도 없고, github SSH 키에 녹색불이 들어온다.</span><span class="caption">정상 연결되면 Jenkins 오류도 없고, github SSH 키에 녹색불이 들어온다.</span></div></p><p>끝~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Jenkins에서 Github의 소스를 가져와서 빌드를 하는 등 Github과 Jenkins와 연동을 시켜줘야하는 상황에서, 별도의 선행 작업이 필요하다. 다른 여러 방법이 있을수 있는데 여기서는 SSH로 연동하는 방법을 알아보고자 한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="github" scheme="https://taetaetae.github.io/tags/github/"/>
    
      <category term="jenkins" scheme="https://taetaetae.github.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>linux(centOS)에서 selenium 설정하기 (feat. python)</title>
    <link href="https://taetaetae.github.io/2018/02/01/linux-selenium/"/>
    <id>https://taetaetae.github.io/2018/02/01/linux-selenium/</id>
    <published>2018-02-01T05:52:10.000Z</published>
    <updated>2018-07-29T08:31:26.226Z</updated>
    
    <content type="html"><![CDATA[<p>테스트 코드로 안되는 실제 브라우저단 사용성 테스트를 하고싶은 경우가 있다. 이를테면 화면이 뜨고, 어떤 버튼을 누르면, 어떤 결과가 나와야 하는 일련의 <code>Regression Test</code>. 이때 활용할수 있는게 다양한 도구가 있지만 이번엔 <code>selenium</code> 에 대해서 알아보고자 한다.<a id="more"></a></p><p>처음부터 사실 web application 테스트를 하려고 selenium 를 알아보게 된건 아니고, 내가 참여하고 있는 특정 밴드(네이버 BAND)에서 일주일에 한번씩 동일한 형태의 글을 올리고 있는데 (일종의 한주 출석체크 같은…) 이를 자동화 해볼순 없을까 하며 밴드 API를 찾아보다 selenium 라는것을 알게되었고, 매크로처럼 어떤버튼 누르고 그다음 어떤버튼 누르고 하는 일련의 과정을 코드로 구성할수 있다는 점에 감동을 받아(?) + 별도의 API를 발급받지 않아도 되어 사용하게 되었다. (물론 UI가 바뀌면 골치아프겠지만…)</p><blockquote><p>여기서는 selenium 이 무엇인지에 대한 설명은 하지 않는다. (인터넷에 나보다 정리 잘된글이 많으니…) 단, linux 환경에서 셋팅하는 정보가 너무 없고 몇일동안 삽질을 한게 아쉬워서 그 과정을 포스팅 해본다. (나같은 분이 이 글을 보고 도움이 되실꺼라는 기대를 갖으며…)</p></blockquote><blockquote><p>※ 주의 : 본 포스팅은 밴드 서비스에 글을 올릴수 있는 비 정상적인 방법의 공유가 아닌, selenium에 대한 사용 후기(?)에 대한 글입니다. (참고로 막혔어요 -ㅁ-)</p></blockquote><h3 id="설정하기"><a href="#설정하기" class="headerlink" title="설정하기"></a>설정하기</h3><p>서버 환경은 CentOS 7.4 64Bit + Python 3.6.3 + jdk 8 이다. 우선 selenium 을 설치해준다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python3.6 -m pip install selenium</span><br></pre></td></tr></table></figure></p><p>그 다음 CentOS에서 크롬브라우저를 설치하기 위하여 yum 저장소를 추가한다. (꼭 크롬이 아니더라도 파이어폭스나 지금은 지원이 끊긴 팬텀JS 같은것으로 활용할수도 있으나 다른것들도 해봤는데 자꾸 설정에서 걸려서 크롬에 대한 내용을 포스팅 한다.)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/yum.repos.d/google-chrome.repo</span><br><span class="line">[google-chrome]</span><br><span class="line">name=google-chrome</span><br><span class="line">baseurl=http://dl.google.com/linux/chrome/rpm/stable/x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub</span><br></pre></td></tr></table></figure></p><p>그리고는 yum 으로 크롬 브라우저를 설치한다. (내가 설치했을때의 버전은 <code>google-chrome-stable.x86_64 0:64.0.3282.119-1</code>)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install google-chrome-stable</span><br></pre></td></tr></table></figure></p><p>크롬드라이버를 설치해야한다. 다음 url에서 받을수 있는데 <a href="https://sites.google.com/a/chromium.org/chromedriver/downloads" target="_blank" rel="noopener">https://sites.google.com/a/chromium.org/chromedriver/downloads</a> 나는 2.35 linux64 버전을 받았다. 다운받고 unzip 하면 딱하나 파일이 있는데 나중에 selenium 을 사용할때 이용되니 path를 알아두자.</p><p>그다음 파이썬 코드를 작성한다. 내가 짠 파이썬 코드는 다음과 같은 순서로 실행이 된다.</p><ul><li>밴드 접속 ( <a href="https://band.us/home" target="_blank" rel="noopener">https://band.us/home</a> )</li><li>로그인</li><li>특정 밴드 선택</li><li>글쓰기 버튼 누르고 양식에 맞춰 글 작성</li><li>글 등록</li></ul><p>파이썬 코드는 아래처럼 작성하였다. (중요부분만.. 그 아래는 자유)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line"><span class="comment"># 초기화 --------------------------------------------</span></span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">"--headless"</span>)</span><br><span class="line"></span><br><span class="line">driver  = webdriver.Chrome(executable_path=<span class="string">'home/~~~/chromedriver'</span>, chrome_options=chrome_options)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get(<span class="string">'https://band.us/home'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그인 --------------------------------------------</span></span><br><span class="line">driver.find_element_by_class_name(<span class="string">'_loginLink'</span>).click()</span><br><span class="line">...생략</span><br></pre></td></tr></table></figure></p><p>그리고 실행을 해보면 작동이 잘~ 된다.<br><div class="figure center" style="width:;"><img class="fig-img" src="result.png" alt="selenium + python 으로 자동작성된 밴드 글"><span class="image-caption">selenium + python 으로 자동작성된 밴드 글</span><span class="caption">selenium + python 으로 자동작성된 밴드 글</span></div></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h3><p><code>selenium</code> 에 대해 찾아보면 거의 윈도우 환경에서 돌아가는것들에 대한 포스팅이 많았다. 난 리눅스 환경에서 스케쥴러(젠킨스 같은)를 통해 자동으로 화면없이 작동시키고 싶었는데 아무리 찾아봐도 + 삽질해도 잘 안되었다. 결국 사내에도 나같은 삽질을 하신 분을 찾고 묻고 물어 <code>크롬드라이버</code>만 있어야 하는것이 아니라 <code>크롬앱</code>또한 있어야 동작을 한다는것을 알게 되었다.<br><strong>역시, 내가 한 삽질은 누군가 이미 한 삽질이라는걸 다시한번 깨닳은 좋은(?) 시간이였다.</strong></p><p>이걸로 나중에 내가 맡고있는 서비스에 대한 웹 자동 테스트 툴도 만들어 볼 생각이다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;테스트 코드로 안되는 실제 브라우저단 사용성 테스트를 하고싶은 경우가 있다. 이를테면 화면이 뜨고, 어떤 버튼을 누르면, 어떤 결과가 나와야 하는 일련의 &lt;code&gt;Regression Test&lt;/code&gt;. 이때 활용할수 있는게 다양한 도구가 있지만 이번엔 &lt;code&gt;selenium&lt;/code&gt; 에 대해서 알아보고자 한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="python" scheme="https://taetaetae.github.io/tags/python/"/>
    
      <category term="linux" scheme="https://taetaetae.github.io/tags/linux/"/>
    
      <category term="selenium" scheme="https://taetaetae.github.io/tags/selenium/"/>
    
      <category term="chromedriver" scheme="https://taetaetae.github.io/tags/chromedriver/"/>
    
  </entry>
  
</feed>
