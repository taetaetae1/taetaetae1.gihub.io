<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>꿈꾸는 태태태의 공간</title>
  
  <subtitle>taetaetae</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://taetaetae.github.io/"/>
  <updated>2020-03-26T17:26:48.070Z</updated>
  <id>https://taetaetae.github.io/</id>
  
  <author>
    <name>taetaetae</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  <image>
    <url>
      https://taetaetae.github.io/assets/images/profile.png
    </url>
  </image>
  
  <entry>
    <title>매니저는 정말 개발자의 무덤일까? (리뷰 - 개발자 7년차, 매니저 1일차)</title>
    <link href="https://taetaetae.github.io/2020/03/26/7-years-of-development-1st-day-of-manager/"/>
    <id>https://taetaetae.github.io/2020/03/26/7-years-of-development-1st-day-of-manager/</id>
    <published>2020-03-26T14:37:17.000Z</published>
    <updated>2020-03-26T17:26:48.070Z</updated>
    
    <content type="html"><![CDATA[<p>개발자로서의 커리어는 정말 다양하지만 필자가 보고 들은 경험을 아주 일반화 시켜 정리해 보자면 다음과 같다.<br>처음엔 전공/비전공을 불문하고 신입으로 개발을 시작하여 다양한 개발 경험을 하게 된다. <a id="more"></a>사수에게 혼나기도 해보고 또는 혼내줄 사수가 없어 혼자 끙끙 밤도 새보고, 다크서클과 거북목을 겸비한 이른바 “삽질”을 하며 고통의 시절을 보내고 나면 어느덧 승진(진급)을 하며 일정 규모의 “팀장(혹은 관리자)”이 된다. 그게 자의든 타의든. 개발자는 다소 “기술”이라는 특수성을 가지고 있지만 어느 직군이든 간에 이러한 커리어 패스의 흐름은 매우 비슷하게 흘러가는 것 같다. 적어도 필자가 보고 들은 것만 보면 말이다. (예외 케이스는 항상 있지만…)<br>하루는 팀장님과의 면담 중에 “이제는 마냥 눈앞에 있는 개발만 할 것이 아니다. 기술을 좀 더 깊게 들여다보는 자리와 사람을 관리하며 주어진 과제를 진행하는 자리, 둘 중 선택해야 하는 시기가 온 것 같다. 더 높고 더 멀리, 그리고 더 넓게 볼 줄 알아야 한다.”라는 말씀을 듣게 된다. 어느덧 “그 시점”이 다가온 것이다. 개인적으로 필자는 팀장님이 말씀하신 두 가지 중 전자에 좀 더 가깝게 다가가고 싶다. 그만큼 오래오래 “실무 개발”을 하고 싶고, 또 그만큼 개발이 재밌기 때문이다. 아직도 눈앞의 문제를 해결하기 위해 개발하며 시간 가는 줄 모를 만큼 밤을 새우는 게 재미있는 걸 보면…</p><div class="figure center" style="width:;"><a class="fancybox" href="chiken.jpg" title="요리하는 걸 좋아하지만 이상하게 치킨집은 하고 싶지 않다. <br>출처 : https://catapult.tistory.com/entry/%EC%B9%98%ED%82%A8%EC%A7%91%EC%9D%B4%EB%82%98-%EC%B0%A8%EB%A0%A4%EC%95%BC%EC%A7%80" data-caption="요리하는 걸 좋아하지만 이상하게 치킨집은 하고 싶지 않다. <br>출처 : https://catapult.tistory.com/entry/%EC%B9%98%ED%82%A8%EC%A7%91%EC%9D%B4%EB%82%98-%EC%B0%A8%EB%A0%A4%EC%95%BC%EC%A7%80" data-fancybox="default"><img class="fig-img" src="chiken.jpg" alt="요리하는 걸 좋아하지만 이상하게 치킨집은 하고 싶지 않다. <br>출처 : https://catapult.tistory.com/entry/%EC%B9%98%ED%82%A8%EC%A7%91%EC%9D%B4%EB%82%98-%EC%B0%A8%EB%A0%A4%EC%95%BC%EC%A7%80"><span class="image-caption">요리하는 걸 좋아하지만 이상하게 치킨집은 하고 싶지 않다. <br>출처 : https://catapult.tistory.com/entry/%EC%B9%98%ED%82%A8%EC%A7%91%EC%9D%B4%EB%82%98-%EC%B0%A8%EB%A0%A4%EC%95%BC%EC%A7%80</span></a><span class="caption">요리하는 걸 좋아하지만 이상하게 치킨집은 하고 싶지 않다. <br>출처 : https://catapult.tistory.com/entry/%EC%B9%98%ED%82%A8%EC%A7%91%EC%9D%B4%EB%82%98-%EC%B0%A8%EB%A0%A4%EC%95%BC%EC%A7%80</span></div><div style="clear:both;"></div><p>어느 날 SNS 피드에 개발 관련된 소식들을 받아보다가 <a href="https://book.naver.com/bookdb/book_detail.nhn?bid=16240506" target="_blank" rel="noopener">개발 7년차. 매니저 1일차</a>라는 제목의 책을 보게 된다. 뭐야, 이거 내 이야기 아니야? 하며 귀신에 홀린 듯 사서 읽어보려는 찰나, 마침 한빛미디어 에서 주최하는 <a href="http://www.hanbit.co.kr/event/current/current_event_view.html?hbe_idx=127" target="_blank" rel="noopener">나는 리뷰어다</a> 라는 이벤트를 발견하게 된다. 결국 리뷰어에 당첨이 되고 운 좋게 해당 책을 받아볼 수 있었다. (이 책을 읽게 해준 한빛미디어 측에게 이 글로나마 감사의 인사를 전하고 싶다.)</p><div class="figure center" style="width:;"><a class="fancybox" href="book.jpg" title="필자의 SNS를 장식했던 개발 7년차, 매니저 1일차" data-caption="필자의 SNS를 장식했던 개발 7년차, 매니저 1일차" data-fancybox="default"><img class="fig-img" src="book.jpg" alt="필자의 SNS를 장식했던 개발 7년차, 매니저 1일차"><span class="image-caption">필자의 SNS를 장식했던 개발 7년차, 매니저 1일차</span></a><span class="caption">필자의 SNS를 장식했던 개발 7년차, 매니저 1일차</span></div><div style="clear:both;"></div><p>이번 포스팅에서는 우선 책에 대한 리뷰를 간단히 적어보고 거기에 필자의 생각을 조금 더 얹어보고 싶다. 필자를 두고 만들어진 책 같아서 아직도 책 표지만 봐도 신기하고 설렌다. 일단 책 표지나 제목이 맘에 든 건 감출 수 없는 사실이다.</p><h3 id="신입-혹은-주니어-개발자가-읽어봐도-좋을-책"><a href="#신입-혹은-주니어-개발자가-읽어봐도-좋을-책" class="headerlink" title="# 신입 혹은 주니어 개발자가 읽어봐도 좋을 책."></a># 신입 혹은 주니어 개발자가 읽어봐도 좋을 책.</h3><p>제목만 보면 이제 갓 팀장 혹은 매니저를 하게 되는 사람에게만 해당되는 책으로 보인다. 표지 상단에 “개발만 해왔던 내가, 어느 날 갑자기 ‘팀’을 맡았다!” 적혀있기도 했으니까. 하지만 책을 읽다 보면 꼭 그렇지마는 않다. 멘토링을 할 때엔 멘토와 멘티 각자의 위치에서 어떤 자세로 서로를 맞이해야 하는 방법에 대해서도 알려주기도 하고 무작정 눈앞에 있는 기능 개발만을 하며 안갯속을 걷는 주니어 개발자가 미리 미래를 경험해보는 좋은 사례를 들어 알려주고 있기 때문이다.<br>꼭 누군가 혹은 무언가를 “관리”하는 입장이 아닌 “팀”이라는 공동체 사회, 특히 개발 팀에서 팀원들과 협력하는 방법론을 살펴보고 있고, 경력이 낮으면 안 보이는 부분들까지 마치 멀리 있는 것을 대신 망원경으로 보여주는 느낌이 들었다. 앞부분에는 “이 책을 읽는 방법”이라며 상황별로 읽는 챕터를 가이드 해주고 있지만 사실 어느 하나 중요하지 않을 내용이 없어서 처음부터 무언가에 홀린 듯 읽을 수밖에 없었고 선배님이 앞서 지나간 길을 올바르게 지나갈 수 있도록 가이드 해주는 느낌으로 중간중간 사례가 있어서 현업에 있어서 그런지 좀 더 쉽게 읽힐 수 있었다.</p><h3 id="다-읽고서야-알아차린-번역서-라는-사실"><a href="#다-읽고서야-알아차린-번역서-라는-사실" class="headerlink" title="# 다 읽고서야 알아차린 번역서(?)라는 사실."></a># 다 읽고서야 알아차린 번역서(?)라는 사실.</h3><p>어떠한 XX 기술 서적에서는 Method를 ‘방법’, Overriding 을 ‘과적’이라고 번역한 책들이 있는가 반면, 이 책은 읽는 내내 국내 어떤 분이 쓰신 거라 생각하고 읽어내려 갔지만 다 읽고 보니 외국에 어느 CTO가 쓴 책을 옮겨서 다시 써진 책이었다. 그만큼 전혀 특유의 번역 느낌(?)은 없었고 오히려 한국 문화에 맞춰 다시 써진 건 아닐까 싶을 정도로 너무 술술 잘 읽혔다.<br>더불어 책 중간중간에 이 바닥(?)에서 유명하신 분들이 기고해 주신 소중한 경험담과 생각들을 덤으로 읽어볼 수 있어서 너무 좋았고 챕터가 끝날 때 즈음이면 생각해 볼 만한 질문을 던지면서 무작정 읽지 말고 깊게 생각하고 읽으라고 하는 것만 같은 저자의 목소리를 들을 수가 있어 좋았다.</p><h3 id="기타"><a href="#기타" class="headerlink" title="# 기타."></a># 기타.</h3><p>특이한 건, 책 맨 뒤에 보면 키워드를 다시 찾아서 읽어볼 수 있도록 “찾아보기” 코너가 있어서 언제든지 위기 상황(?)에서 가이드처럼 활용해 볼 만한 부분인 것 같아 좋았고, 시간이 지나고 정말 “관리자”가 된다면 다시 한번 처음부터 정독을 하며 보다 나은 “관리자”가 되어보고 싶은 맘도 들었다.</p><div class="figure center" style="width:;"><a class="fancybox" href="book_point.jpg" title="정곡을 찌르는 문구들, 사실 이것 말고도 무궁무진하다." data-caption="정곡을 찌르는 문구들, 사실 이것 말고도 무궁무진하다." data-fancybox="default"><img class="fig-img" src="book_point.jpg" alt="정곡을 찌르는 문구들, 사실 이것 말고도 무궁무진하다."><span class="image-caption">정곡을 찌르는 문구들, 사실 이것 말고도 무궁무진하다.</span></a><span class="caption">정곡을 찌르는 문구들, 사실 이것 말고도 무궁무진하다.</span></div><div style="clear:both;"></div><h3 id="기억에-남는-매니저"><a href="#기억에-남는-매니저" class="headerlink" title="# 기억에 남는 매니저."></a># 기억에 남는 매니저.</h3><p>짧은 개발자 경력 중에 필자가 만나보았던 “매니저” 중 그래도 괜찮았다고 생각나는 분은 세분 정도다.</p><ul><li>C : 마이크로 매니징의 끝판왕. 신입시절인 필자가 Java 코딩을 할 때 StringBuilder 을 쓰는지 StringBuffer을 쓰는지까지 확인하거나 SpringFramework의 일부 모듈 코드를 A4로 출력해서 보는 것을 추천하신 분. 어떻게 보면 정말 토나오게(?) 힘들었지만 지나고 보면 그러한 관심도 요즘은 가뭄에 콩 나듯 있을까 하기에 나름 뜨거운 정이 있으셨던 분으로 기억한다.</li><li>J : 필자에게 관심이 있는 듯 없는듯하면서 가끔 지나가다 뒤통수를 치는 듯한 몸 쪽 깊숙한 멘트로 성장하는데 엄청난 원동력이 되어주신 분. 회사 업무 그 이상을 주문하고 필자가 스스로 개발/개선 포인트를 찾아서 하는 방법을 알려주신 분.</li><li>S : 아, 이 분은 정말 천재구나 할 정도로 높이 그리고 멀리 보는데 일가견이 있으신 분. 필자가 개발하는 데 어려움을 겪고 있으면 키워드 몇 개를 던져주면서 감을 주지 않고 감을 따는 방법을 알려주신 분.</li></ul><p>물론 다른 분들도 필자에게 영향력이 있던 분들이지만, 필자가 생각하는 바라직한 “매니저”의 역할은 팀이 목표에 방해요소를 최대한 줄이고 팀원들의 성장을 도와주며 비로소 나아가고자 하는 방향을 명확하고 신뢰 있는 말과 행동이라 생각한다. </p><div class="figure center" style="width:;"><a class="fancybox" href="boss_leader.jpg" title="워낙에 유명한 짤이라 다른 미사여구가 필요 없지 않을까 싶다. <br>출처 : https://twitter.com/hazaraouad/status/451603771869900800" data-caption="워낙에 유명한 짤이라 다른 미사여구가 필요 없지 않을까 싶다. <br>출처 : https://twitter.com/hazaraouad/status/451603771869900800" data-fancybox="default"><img class="fig-img" src="boss_leader.jpg" alt="워낙에 유명한 짤이라 다른 미사여구가 필요 없지 않을까 싶다. <br>출처 : https://twitter.com/hazaraouad/status/451603771869900800"><span class="image-caption">워낙에 유명한 짤이라 다른 미사여구가 필요 없지 않을까 싶다. <br>출처 : https://twitter.com/hazaraouad/status/451603771869900800</span></a><span class="caption">워낙에 유명한 짤이라 다른 미사여구가 필요 없지 않을까 싶다. <br>출처 : https://twitter.com/hazaraouad/status/451603771869900800</span></div><div style="clear:both;"></div><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>“매니저”라는 안 좋은 인식을 벗어나게 해줄 내용들이 정말 많이 있고 필자 또한 “오랫동안 개발만 하고 싶어”라는 생각을 조금 달리해볼 수 있는 안경을 쓰게 해준 것 같아 좋았던 책이다.<br>더불어, 멘토링 하던 시절이 생각나게 하는 책이다. 멘토로써 준비를 하고 필자 자신에게, 그리고 멘티에게 보다 더 좋은 촉진제 역할이 되었더라면 하는 아쉬움이 남는 멘토링. 다음에 기회가 되면 조금 더 “준비”를 해서 이 책에 나와있는 “좋은 매니저”의 가이드를 기반으로 비록 작은 날갯짓이지만 멀리 보면 팀에 도움이 되는 그런 사람이 되고 싶게 만드는 책으로 오래 기억에 남을 것 같다. </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;개발자로서의 커리어는 정말 다양하지만 필자가 보고 들은 경험을 아주 일반화 시켜 정리해 보자면 다음과 같다.&lt;br&gt;처음엔 전공/비전공을 불문하고 신입으로 개발을 시작하여 다양한 개발 경험을 하게 된다.
    
    </summary>
    
      <category term="review" scheme="https://taetaetae.github.io/categories/review/"/>
    
    
      <category term="book" scheme="https://taetaetae.github.io/tags/book/"/>
    
  </entry>
  
  <entry>
    <title>조금 더 괜찮은 Rest Template 1부 - Retryable</title>
    <link href="https://taetaetae.github.io/2020/03/22/better-rest-template-1-retryable/"/>
    <id>https://taetaetae.github.io/2020/03/22/better-rest-template-1-retryable/</id>
    <published>2020-03-22T06:30:35.000Z</published>
    <updated>2020-03-22T15:03:35.336Z</updated>
    
    <content type="html"><![CDATA[<p>웹 어플리케이션을 만들면서 꼭 한번 쯤 만나게 되는 “RestTemplate”. 접근 가능한 외부 HTTP URL(보통 API)을 호출하는 방법중에 하나로 springframework 에서 제공해주는 모듈이다. 특히 큰 한덩어리로 관리되던 Monolithic Architecture 에서 요청을 하고(client) 응답을 주는(server)  <a id="more"></a>즉, Endpoint가 작은 단위로 분리되는 Microservice Architecture 로 바뀌면서 각 서비스간 호출방식이 HTTP 일 경우 자주 사용되곤 하는 것 같다. (webClient 등 다른 여러 호출 방법들이 있다.)<br>만약, 요청을 하는 클라이언트 입장에서 응답을 주는 서버의 상태가 불안정 하다고 가정했을때, 어떤식으로 처리해야 할까? 예컨대, 요청 10번에 한번은 어떠한 이슈로 응답이 지연되거나 서버에러가 발생한다고 하면 클라이언트를 사용하는 사용자 입장에서는 간헐적인 오류응답에 답답함을 호소할 수도 있다. 그럼 잠시 눈을 감고 생각해보자.<br>가볍게 생각하면 아래처럼 아주 간단하게 “예외처리”를 이용할 수도 있다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// http call</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"><span class="comment">// 서버에러가 아닌 약속된 에러응답을 리턴</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>하지만 이것도 정답이 아닐수 있는게, “간헐적인 오류”로 인해 사용자는 오류화면을 봐야하기 때문에 클라이언트에 대한 신뢰를 저버릴 수밖에 없다. 그럼 어떻게 해야할까? 여러가지 해결방법이 있겠지만 간단하면서도 강력하다고 생각되는 방법이 바로 “재시도” 라고 생각한다. 클라이언트를 사용하는 사용자가 눈치 못챌만큼 빠르게 재시도를 한다면 에러가 나도 다시한번 호출해서 성공할 수 있는 가능성이 높기 때문이다. (그치만 근본적인 원인은 해결해야…)</p><div class="figure center" style="width:;"><a class="fancybox" href="retry.png" title="실제로 조금있다 해보면 되는 경우가 많으니 안될때는 조금 (천천히) 시도해보자. <br>출처 : http://www.segye.com/newsView/20200302504384" data-caption="실제로 조금있다 해보면 되는 경우가 많으니 안될때는 조금 (천천히) 시도해보자. <br>출처 : http://www.segye.com/newsView/20200302504384" data-fancybox="default"><img class="fig-img" src="retry.png" alt="실제로 조금있다 해보면 되는 경우가 많으니 안될때는 조금 (천천히) 시도해보자. <br>출처 : http://www.segye.com/newsView/20200302504384"><span class="image-caption">실제로 조금있다 해보면 되는 경우가 많으니 안될때는 조금 (천천히) 시도해보자. <br>출처 : http://www.segye.com/newsView/20200302504384</span></a><span class="caption">실제로 조금있다 해보면 되는 경우가 많으니 안될때는 조금 (천천히) 시도해보자. <br>출처 : http://www.segye.com/newsView/20200302504384</span></div><div style="clear:both;"></div><p>이번 포스팅에서는 RestTemplate 를 이용할때 “재시도” 할 수 있는 방법에 대해 알아보고자 한다. 아주 간단할지 모르지만 노력에 비해 효과가 상당하다고 생각하기 때문에 정리해 두고 싶었다.</p><h3 id="Spring-Retry"><a href="#Spring-Retry" class="headerlink" title="# Spring Retry"></a># Spring Retry</h3><p><a href="https://github.com/spring-projects/spring-retry" target="_blank" rel="noopener">공식 Github</a>에 소개를 빌리자면, Spring 어플리케이션에 대한 재시도 지원을 제공한다고 한다. 위에서 이야기 했던 “RestTemplate”과는 사실 무관하고, 이를 활용해서 재시도 하는 “RetryRestTemplate”를 구현해보려 하는것이다. 우선 이 “Spring-Retry”의 예제를 보면 아주 심플하게 사용할 수 있다. 우선 pom에 구현에 필요한 dependency 를 추가하고 아래 코드를 보자.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.retry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-retry<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableRetry</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Service <span class="title">service</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Service();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Retryable</span>(RemoteAccessException.class) <span class="comment">// 2</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ... do something</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Recover</span> <span class="comment">// 3</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recover</span><span class="params">(RemoteAccessException e)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// ... panic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>@EnableRetry 어노테이션을 @Configuration을 지정한 클래스 중 하나에 추가한다.</li><li>재시도 하려는 메소드에 @Retryable 어노테이션을 지정해준다.</li><li>재시도가 완료되는 시점에서 실행하고 싶을때 선언하는 어노테이션, @Retryable 동일한 클래스에서 선언되어야 하고 return type 은 @Retryable을 지정한 메소드와 동일해야 한다.</li></ol><h3 id="Retry-Rest-Template"><a href="#Retry-Rest-Template" class="headerlink" title="# Retry Rest Template"></a># Retry Rest Template</h3><p>이렇게 springframework 에서 제공해주는 spring-retry 를 이용해서 이번 포스팅의 목표인 재시도를 하는 Retry Rest Template 를 구성해보자. 우선, RestTemplate 를 Bean 으로 등록하고, 위에서 이야기 한 어노테이션들로 구성해보자.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableRetry</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RetryableRestTemplateConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">retryableRestTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">SimpleClientHttpRequestFactory clientHttpRequestFactory = <span class="keyword">new</span> SimpleClientHttpRequestFactory(); <span class="comment">// 1</span></span><br><span class="line">clientHttpRequestFactory.setReadTimeout(<span class="number">2000</span>);</span><br><span class="line">clientHttpRequestFactory.setConnectTimeout(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(clientHttpRequestFactory) &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Retryable</span>(value = RestClientException.class, maxAttempts = <span class="number">3</span>, backoff = <span class="meta">@Backoff</span>(delay = <span class="number">1000</span>)) <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">exchange</span><span class="params">(URI url, HttpMethod method, HttpEntity&lt;?&gt; requestEntity, Class&lt;T&gt; responseType)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> RestClientException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.exchange(url, method, requestEntity, responseType); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Recover</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;String&gt; <span class="title">exchangeRecover</span><span class="params">(RestClientException e)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> ResponseEntity.badRequest().body(<span class="string">"bad request T.T"</span>); <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> restTemplate;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ol><li>SimpleClientHttpRequestFactory 를 만들고 각 타임아웃을 설정해준 다음 RestTemplate 파라미터로 넘겨준다.</li><li>사용하는 곳에서 exchange 메소드를 이용할 것이므로 해당 메소드를 오버라이드 해준다. 먼저 해당 메소드에서 “RestClientException”이 발생할 경우 Retry 로직을 수행한다고 정해주고, 최대 시도는 3번, backoff 설정중 delay를 1000ms(1초)로 지정해서 재시도가 진행되도록 해준다.</li><li>2 에서 지정한 재시도가 끝나면 (재시도를 전부 다 하면) 해당 메소드를 수행하게 되어있고, 임의로 응답에 지정한 문구를 넘겨준다.</li></ol><p>이렇게 하고 실제로 사용하는 로직에서 일부러 잘못된 URL을 호출해 보도록 하자. 그리고서 로그를 자세히 보도록 application.properties 에 “debug=true” 설정을 해준다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate retryableRestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(value = <span class="string">"/employees"</span>, produces = MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">employees</span><span class="params">()</span> <span class="keyword">throws</span> URISyntaxException </span>&#123;</span><br><span class="line"><span class="keyword">final</span> String baseUrl = <span class="string">"http://dummy.restapiexample.com/api/v1/employeeszzz"</span>; <span class="comment">// zzz 가 빠져야 한다.</span></span><br><span class="line">URI uri = <span class="keyword">new</span> URI(baseUrl);</span><br><span class="line">ResponseEntity&lt;String&gt; exchange = retryableRestTemplate.exchange(uri, HttpMethod.GET, <span class="keyword">null</span>, String.class);</span><br><span class="line"><span class="keyword">return</span> exchange.getBody();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>이렇게 하고 실행을 시켜보면 다음과 같이 재시도 관련 로깅이 찍히는 것을 볼 수 있고<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">23:05:50.893 DEBUG 21016 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : GET &quot;/employees&quot;, parameters=&#123;&#125;</span><br><span class="line">23:05:50.898 DEBUG 21016 --- [nio-8080-exec-1] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.retryableresttemplate.TestController#employees()</span><br><span class="line">23:05:50.994 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : HTTP GET http://dummy.restapiexample.com/api/v1/employeeszzz</span><br><span class="line">23:05:50.999 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : Accept=[text/plain, application/json, application/*+json, */*]</span><br><span class="line">23:05:51.861 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : Response 404 NOT_FOUND</span><br><span class="line">23:05:52.869 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : HTTP GET http://dummy.restapiexample.com/api/v1/employeeszzz</span><br><span class="line">23:05:52.869 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : Accept=[text/plain, application/json, application/*+json, */*]</span><br><span class="line">23:05:53.603 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : Response 404 NOT_FOUND</span><br><span class="line">23:05:54.605 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : HTTP GET http://dummy.restapiexample.com/api/v1/employeeszzz</span><br><span class="line">23:05:54.606 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : Accept=[text/plain, application/json, application/*+json, */*]</span><br><span class="line">23:05:55.305 DEBUG 21016 --- [nio-8080-exec-1] org.springframework.web.HttpLogging      : Response 404 NOT_FOUND</span><br><span class="line">23:05:57.192 DEBUG 21016 --- [nio-8080-exec-1] m.m.a.RequestResponseBodyMethodProcessor : Using &apos;application/json;q=0.8&apos;, given [text/html, application/xhtml+xml, image/webp, image/apng, application/xml;q=0.9, application/signed-exchange;v=b3;q=0.9, */*;q=0.8] and supported [application/json]</span><br><span class="line">23:05:57.193 DEBUG 21016 --- [nio-8080-exec-1] m.m.a.RequestResponseBodyMethodProcessor : Writing [&quot;bad request T.T&quot;]</span><br><span class="line">23:05:57.202 DEBUG 21016 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed 200 OK</span><br></pre></td></tr></table></figure></p><p>브라우저에서 해당 url을 접근해보면 @Recover 에서 지정했던 결과를 볼 수 있게 된다. 사실 이러한 방법에 대해 삽질하기 전에 다른 방법들을 찾아봤지만 restTemplate 을 사용하는 곳에서 각각 retry관련 로직을 추가해야 했기에 뭔가 어글리해 보여서 삽질을 시작하게 되었다. 다행히 성공.</p><div class="figure center" style="width:;"><a class="fancybox" href="response.jpg" title="예제로 임의 문자열을 리턴했지만 상황에 따라 얼마든지 커스터마이징이 가능하다." data-caption="예제로 임의 문자열을 리턴했지만 상황에 따라 얼마든지 커스터마이징이 가능하다." data-fancybox="default"><img class="fig-img" src="response.jpg" alt="예제로 임의 문자열을 리턴했지만 상황에 따라 얼마든지 커스터마이징이 가능하다."><span class="image-caption">예제로 임의 문자열을 리턴했지만 상황에 따라 얼마든지 커스터마이징이 가능하다.</span></a><span class="caption">예제로 임의 문자열을 리턴했지만 상황에 따라 얼마든지 커스터마이징이 가능하다.</span></div><div style="clear:both;"></div><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>어떻게 보면 너무나 당연하게 “여러번 재시도 요청하면 되지?” 라는 말을 할 수 있지만, “입코딩” 하는 것과 실제로 코드를 구현하는건 다른 이야기인것 같다. 정말 작은 로직 추가로 꽤 큰 효과를 볼 수 있어 다행이라 생각한다.<br>이러한 “재시도” 말고도 요청하고자 하는 곳의 서버의 상태가 안좋을 때 서버에러가 아닌 다른 명시적인 에러를 반환할 수 있는 방법이 다양할 것 같다. 모든것엔 정답이 없는 것 처럼.<br>제목에서 알 수 있듯이 다음 “2부” 에서는 “Retry”가 아닌 “Circuit Breaker”를 사용하여 “재시도”의 방법보다 조금 다른 측면에서 조금 더 괜찮은 방법으로 RestTemplate 를 사용해 보고자 한다.</p><p>위에서 사용한 코드는 <a href="https://github.com/taetaetae/retryable-resttemplate" target="_blank" rel="noopener">필자의 Github Repo</a>에서 확인이 가능하다.</p><p>참고 url</p><ul><li><a href="https://dzone.com/articles/how-to-use-spring-retry" target="_blank" rel="noopener">https://dzone.com/articles/how-to-use-spring-retry</a></li><li><a href="https://www.baeldung.com/spring-retry" target="_blank" rel="noopener">https://www.baeldung.com/spring-retry</a></li><li><a href="https://github.com/spring-projects/spring-retry" target="_blank" rel="noopener">https://github.com/spring-projects/spring-retry</a></li><li><a href="https://docs.spring.io/spring-batch/docs/current/reference/html/retry.html" target="_blank" rel="noopener">https://docs.spring.io/spring-batch/docs/current/reference/html/retry.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;웹 어플리케이션을 만들면서 꼭 한번 쯤 만나게 되는 “RestTemplate”. 접근 가능한 외부 HTTP URL(보통 API)을 호출하는 방법중에 하나로 springframework 에서 제공해주는 모듈이다. 특히 큰 한덩어리로 관리되던 Monolithic Architecture 에서 요청을 하고(client) 응답을 주는(server)
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="spring boot" scheme="https://taetaetae.github.io/tags/spring-boot/"/>
    
      <category term="retryable" scheme="https://taetaetae.github.io/tags/retryable/"/>
    
  </entry>
  
  <entry>
    <title>SpringRestDocs를 SpringBoot에 적용하기</title>
    <link href="https://taetaetae.github.io/2020/03/08/spring-rest-docs-in-spring-boot/"/>
    <id>https://taetaetae.github.io/2020/03/08/spring-rest-docs-in-spring-boot/</id>
    <published>2020-03-08T14:16:59.000Z</published>
    <updated>2020-03-22T14:20:23.835Z</updated>
    
    <content type="html"><![CDATA[<p>API를 개발하고 제공하기 위해서는 그에 해당하는 API 명세를 작성해서 사용하는 곳에 전달하게 된다. 어떤 URL에 어떤 파라미터를 사용해서 어떻게 요청을 하면 어떤 결과를 응답으로 내려주는지에 대한 관련 정보들. 이러한 “API 문서” 를 제공하는 방식은 상황에 따라 다양한 방법으로 사용되곤 한다. <a id="more"></a></p><div class="figure center" style="width:;"><a class="fancybox" href="api-document.jpg" title="API 코드와 해당 문서의 동기화가 자동으로 되어야 조금 편해질것 같다는 생각이 들었다. <br>출처 : https://dribbble.com/shots/3386291-API-Documentation" data-caption="API 코드와 해당 문서의 동기화가 자동으로 되어야 조금 편해질것 같다는 생각이 들었다. <br>출처 : https://dribbble.com/shots/3386291-API-Documentation" data-fancybox="default"><img class="fig-img" src="api-document.jpg" alt="API 코드와 해당 문서의 동기화가 자동으로 되어야 조금 편해질것 같다는 생각이 들었다. <br>출처 : https://dribbble.com/shots/3386291-API-Documentation"><span class="image-caption">API 코드와 해당 문서의 동기화가 자동으로 되어야 조금 편해질것 같다는 생각이 들었다. <br>출처 : https://dribbble.com/shots/3386291-API-Documentation</span></a><span class="caption">API 코드와 해당 문서의 동기화가 자동으로 되어야 조금 편해질것 같다는 생각이 들었다. <br>출처 : https://dribbble.com/shots/3386291-API-Documentation</span></div><div style="clear:both;"></div><p>필자는 주로 “위키”(또는 일반 문서)를 활용해서 전달하곤 했었는데 API의 형태가 달라질 때마다 해당 위키를 수정해야만 하는 번거로움이 있었다. API 수정하면 위키도 수정하고. 깜박하고 위키 수정을 안하게 될 경우 왜 API 명세가 다르냐는 문의가… 그러다 알게된 Spring Rest Docs. (아무리 좋은 기술, 좋은 툴 이라 해도 실제로 본인이 필요로 하고 사용을 해야하는 이유가 생길때 비로소 빛을 발하는것 같은 느낌이다.)</p><blockquote><p>이 포스팅에서는 swegger 와 비교하는 내용은 제외할까 한다. 워낙 유명한 두 양대 산맥(?)이라 검색해보면 각각의 장단점이 자세히 나와있기에…</p></blockquote><p>최근 들어 TestCode 의 중요성을 절실하게 느끼고 있었고, TestCode 를 작성하면 자연스럽게 문서를 만들어 주는 부분이 가장 매력적이라고 생각이 들었다. 이를 반대로 생각하면, TestCode 가 실패할 경우 빌드 자체가 안되기에 어쩔수 없이 TestCode를 성공시켜야만 하고, 자연스럽게 정상적인(최신화 된) API 문서가 만들어지게 된다.<br>이번 포스팅에서는 다음과 같은 목표를 두고 실무에서 언제든지 활용이 가능한 약간의 “가이드” 같은 내용으로 작성해 보고자 한다. </p><ul><li>Spring Boot 최신 버전에서 Spring Rest Docs 를 설정한다.</li><li>임의의 API 를 만들고 그에 따른 TestCase 를 작성한다.</li><li>Spring.profile 에 따라 Spring Rest Docs Url 을 접근 가능/불가능 할 수 있게 한다.</li></ul><p>물론 필자의 방법이 다를수도 있지만, 이러한 방법을 토대로 보다 더 우아하고 아름다운 방법을 알아갈수 있지 않을까 하는 기대로.</p><h3 id="Spring-Boot-에-Spring-Rest-Docs-셋팅하고-TestCase-작성하기"><a href="#Spring-Boot-에-Spring-Rest-Docs-셋팅하고-TestCase-작성하기" class="headerlink" title="# Spring Boot 에 Spring Rest Docs 셋팅하고 TestCase 작성하기"></a># Spring Boot 에 Spring Rest Docs 셋팅하고 TestCase 작성하기</h3><p>우선 Spring Boot 프로젝트를 만든다. <a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a> 에서 만들어도 되고 IDE 에서 제공하는 툴로 만들어도 되고. 만드는 방식은 무방하다. 그 다음 필요한 dependency 를 추가해 준다.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.restdocs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-restdocs-mockmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>임의로 API를 작성하고</p><ul><li><p>모델 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String title;</span><br><span class="line"><span class="keyword">private</span> String author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>컨트롤러</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/book/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">getABook</span><span class="params">(@PathVariable Integer id)</span> </span>&#123;</span><br><span class="line">Book book = <span class="keyword">new</span> Book();</span><br><span class="line">book.setId(id);</span><br><span class="line">book.setTitle(<span class="string">"spring rest docs in spring boot"</span>);</span><br><span class="line">book.setAuthor(<span class="string">"taetaetae"</span>);</span><br><span class="line"><span class="keyword">return</span> book;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>해당 컨트롤러에 대한 TestCase 를 작성하자.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebMvcTest</span>(BookController.class)</span><br><span class="line"><span class="meta">@AutoConfigureRestDocs</span> <span class="comment">// (1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookControllerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MockMvc mockMvc; <span class="comment">// (2)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> test_책을_조회하면_null이_아닌_객체를_리턴한다() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">mockMvc.perform(get(<span class="string">"/book/&#123;id&#125;"</span>, <span class="number">1</span>)</span><br><span class="line">.accept(MediaType.APPLICATION_JSON))</span><br><span class="line">.andDo(MockMvcResultHandlers.print())</span><br><span class="line">.andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">.andDo(document(<span class="string">"book"</span>, <span class="comment">// (3)</span></span><br><span class="line">pathParameters(</span><br><span class="line">parameterWithName(<span class="string">"id"</span>).description(<span class="string">"book unique id"</span>) <span class="comment">// (4)</span></span><br><span class="line">),</span><br><span class="line">responseFields(</span><br><span class="line">fieldWithPath(<span class="string">"id"</span>).description(<span class="string">"book unique id"</span>),</span><br><span class="line">fieldWithPath(<span class="string">"title"</span>).description(<span class="string">"title"</span>),</span><br><span class="line">fieldWithPath(<span class="string">"author"</span>).description(<span class="string">"author"</span>)</span><br><span class="line">)</span><br><span class="line">))</span><br><span class="line">.andExpect(jsonPath(<span class="string">"$.id"</span>, is(notNullValue()))) <span class="comment">// (5)</span></span><br><span class="line">.andExpect(jsonPath(<span class="string">"$.title"</span>, is(notNullValue())))</span><br><span class="line">.andExpect(jsonPath(<span class="string">"$.author"</span>, is(notNullValue())));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>(1) Spring Boot 에서는 해당 어노테이션으로 여러줄에 걸쳐 설정해야 할 Spring Rest Docs 관련 설정을 아주 간단하게 해결할 수 있게 된다. (<a href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs" target="_blank" rel="noopener">참고</a>)<br>(2) <a href="https://docs.spring.io/spring-restdocs/docs/2.0.4.RELEASE/reference/html5/#getting-started-sample-applications" target="_blank" rel="noopener">공식 도큐먼트</a> 에서는 4가지 방식을 말하고 있는데 이 포스팅 에서는 “MockMvc” 을 사용하고자 한다.<br>(3) “book” 이라는 identifier 를 지정하면 해당 TestCase 가 수행될때 snippets 가 생성되는데 해당 identifier 묶음으로 생성이 된다.<br>(4) request의 파라미터 필드, response의 필드의 설명을 적어줌으로써 이 정보를 가지고 snippets 가 생성이 되고 결과적으로 API 문서가 만들어 진다.<br>(5) 필자가 가장 매력적이라 생각되는 부분. 이 부분에서 테스트를 동시에 함으로써 응답이 달라지거나 잘못된 응답이 내려올 경우 TestCase가 실패하게 되어 API문서 또한 생성되지 않게 된다.</p><p>여기까지 한 뒤 빌드시 문서가 제대로 만들어 지도록 빌드 플러그인을 추가해 준다.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.asciidoctor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asciidoctor-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>generate-docs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>process-asciidoc<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">backend</span>&gt;</span>html<span class="tag">&lt;/<span class="name">backend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">doctype</span>&gt;</span>book<span class="tag">&lt;/<span class="name">doctype</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.restdocs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-restdocs-asciidoctor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-restdocs.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>빌드 플러그인에 의해 snippets를 조합하여 최종 API 문서가 만들어질수 있도록 src/main/ 하위에 asciidoc 이라는 폴더를 만들고 그 하위에 적당한 이름의 adoc 파일을 작성한다. 파일 이름은 나중에 만들어질 API문서의 html 파일 이름이 된다.<br><figure class="highlight adoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">= RESTful Notes API Guide</span></span><br><span class="line"><span class="meta">:doctype:</span> book</span><br><span class="line"><span class="meta">:icons:</span> font</span><br><span class="line"><span class="meta">:source-highlighter:</span> highlightjs</span><br><span class="line"><span class="meta">:toc:</span> left</span><br><span class="line"><span class="meta">:toclevels:</span> 4</span><br><span class="line"><span class="meta">:sectnums:</span></span><br><span class="line"><span class="meta">:sectlinks:</span></span><br><span class="line"><span class="meta">:sectanchors:</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">[[api]]</span></span><br><span class="line"><span class="meta">==</span> Book Api</span><br><span class="line">api 에 관련된 설명을 이곳에 적습니다.</span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/book/curl-request.adoc[]</span><br><span class="line">include::&#123;snippets&#125;/book/http-request.adoc[]</span><br><span class="line">include::&#123;snippets&#125;/book/path-parameters.adoc[]</span><br><span class="line">include::&#123;snippets&#125;/book/http-response.adoc[]</span><br><span class="line">include::&#123;snippets&#125;/book/response-fields.adoc[]</span><br></pre></td></tr></table></figure></p><p>위 adoc 파일 작성은 생소하니 <a href="https://asciidoctor.org/docs/user-manual/" target="_blank" rel="noopener">asscidoc document</a>를 참조하면서 작성하면 도움이 될것같다.<br>그 다음 메이븐 빌드를 하면 TestCase 가 돌면서 snippets 이 생성되고 이를 가지고 빌드 플러그인에 의해 최종 API 문서가 생성이 된다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mvn install</span><br><span class="line"></span><br><span class="line">[INFO] -------------------------------------------------------</span><br><span class="line">[INFO]  T E S T S</span><br><span class="line">[INFO] -------------------------------------------------------</span><br><span class="line">[INFO] Running com.taetaetae.springrestdocs.books.BookControllerTest</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[INFO] Results:</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- asciidoctor-maven-plugin:1.5.8:process-asciidoc (generate-docs) @ spring-rest-docs ---</span><br><span class="line">[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO] Rendered 경로\spring-rest-docs\src\main\asciidoc\index.adoc</span><br></pre></td></tr></table></figure></p><p>그러면 target/generated-docs 하위에 index.html 파일이 생성된 것을 확인할 수 있다.<br><div class="figure center" style="width:;"><a class="fancybox" href="index_html.jpg" title="생성된것을 볼 수 있고 자동으로 만들어진 snippets들도 볼 수 있다." data-caption="생성된것을 볼 수 있고 자동으로 만들어진 snippets들도 볼 수 있다." data-fancybox="default"><img class="fig-img" src="index_html.jpg" alt="생성된것을 볼 수 있고 자동으로 만들어진 snippets들도 볼 수 있다."><span class="image-caption">생성된것을 볼 수 있고 자동으로 만들어진 snippets들도 볼 수 있다.</span></a><span class="caption">생성된것을 볼 수 있고 자동으로 만들어진 snippets들도 볼 수 있다.</span></div><div style="clear:both;"></div></p><p>이 파일을 열어보면 다음처럼 이쁘게 문서가 작성된 것을 확인할 수 있다.<br><div class="figure center" style="width:;"><a class="fancybox" href="docs.jpg" title="얼마든지 입맛에 맞게 수정이 가능하다." data-caption="얼마든지 입맛에 맞게 수정이 가능하다." data-fancybox="default"><img class="fig-img" src="docs.jpg" alt="얼마든지 입맛에 맞게 수정이 가능하다."><span class="image-caption">얼마든지 입맛에 맞게 수정이 가능하다.</span></a><span class="caption">얼마든지 입맛에 맞게 수정이 가능하다.</span></div><div style="clear:both;"></div></p><p>그러면 이 파일을 어떻게 사용하는 곳에 제공할 수 있을까? html 만 따로 전달해야 할까? 메이븐 플러그인 중 “maven-resources-plugin”을 활용하여 API서버를 띄우면 외부에서 URL 로 접근할 수 있도록 설정해보자.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">$&#123;project.build.outputDirectory&#125;/static/docs</span><br><span class="line"><span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span></span><br><span class="line">$&#123;project.build.directory&#125;/generated-docs</span><br><span class="line"><span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>쉽게말해, 만들어진 문서를 특정 경로로 복사하게 되면 외부에서도 해당 경로로 접근시 볼 수 있게 된다. 지금은 “{domain}/docs/index.html” 을 접근하면 문서를 볼 수 있다.</p><h3 id="Spring-profile-에-따라-Spring-Rest-Docs-Url-을-접근-가능-불가능-할-수-있게-한다"><a href="#Spring-profile-에-따라-Spring-Rest-Docs-Url-을-접근-가능-불가능-할-수-있게-한다" class="headerlink" title="# Spring.profile 에 따라 Spring Rest Docs Url 을 접근 가능/불가능 할 수 있게 한다."></a># Spring.profile 에 따라 Spring Rest Docs Url 을 접근 가능/불가능 할 수 있게 한다.</h3><p>필요에 따라 운영환경에서는 해당 API 명세를 보여주게 되면 보안상으로 좋지 못하므로 API 문서의 접근을 막아야 한다. 뭔가 아주 간단하게 spring boot 의 설정을 통해 처리 할 수 있을꺼라 생각했지만, 아무리 찾아봐도 그런 기능은 없어보인다.ㅠㅠ 어쩔수 없이 필터를 추가하여 해당 url을 운영환경에서는 FORBIDDEN 처리를 해보도록 하자.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebFilter</span>(urlPatterns = <span class="string">"/docs/index.html"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRestDocsAccessFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;spring.profiles.active&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String phase;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (StringUtils.equals(<span class="string">"release"</span>, phase)) &#123; <span class="comment">// (1)</span></span><br><span class="line">HttpServletResponse response = (HttpServletResponse)servletResponse;</span><br><span class="line">response.sendError(HttpServletResponse.SC_FORBIDDEN);</span><br><span class="line">filterChain.doFilter(servletRequest, response);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>(1) spring profile 이 release 일 경우 일부러 FORBIDDEN 처리를 해준다.</p><p>이렇게 되면 개발환경에서만 접근이 가능하고 운영환경에서는 접근이 불가능한, 테스트 케이스를 성공한 동기화 + 자동화 된 API 문서를 만들 수 있게 되었다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>언제나 그렇듯, 초기 설정은 실제 비즈니스 로직 개발보다 훨씬 공수가 더 드는 건 어쩔 수없다. 하지만 약간의 노력으로 안정되고 자동화된 개발 프로세스를 구축한다면 그 작은 날갯짓이 나중엔 큰 바람을 일으킬 수 있지 않을까 하는 기대를 해본다.</p><p>참, 위에서 만든 코드는 <a href="https://github.com/taetaetae/SpringRestDocs-In-SpringBoot" target="_blank" rel="noopener">Github</a> 에 있으니 참고 바란다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;API를 개발하고 제공하기 위해서는 그에 해당하는 API 명세를 작성해서 사용하는 곳에 전달하게 된다. 어떤 URL에 어떤 파라미터를 사용해서 어떻게 요청을 하면 어떤 결과를 응답으로 내려주는지에 대한 관련 정보들. 이러한 “API 문서” 를 제공하는 방식은 상황에 따라 다양한 방법으로 사용되곤 한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="spring boot" scheme="https://taetaetae.github.io/tags/spring-boot/"/>
    
      <category term="spring rest docs" scheme="https://taetaetae.github.io/tags/spring-rest-docs/"/>
    
  </entry>
  
  <entry>
    <title>Jupyter 설치하고 원격접속까지 (for 파.알.못)</title>
    <link href="https://taetaetae.github.io/2020/02/09/jupyter-install/"/>
    <id>https://taetaetae.github.io/2020/02/09/jupyter-install/</id>
    <published>2020-02-09T11:06:15.000Z</published>
    <updated>2020-02-09T12:25:51.909Z</updated>
    
    <content type="html"><![CDATA[<p>파이썬이라는 언어는 다른 프로그래밍 언어들에 비해 쉽고 직관적이라 그런지 프로그래밍을 처음 시작하는 사람들에게 더욱이 주목을 받고 있는것 같다. 정말 다양한 모듈들이 많아 여러분야에서 활용되고 있고 <a id="more"></a>특히 언제부터인가 핫! 해진 분야(?)라 해도 과언이 아닐정도인 “머신러닝” 분야에서도 다양하게 사용되고 있는것 같다.<br>마침 필자가 속해 있는 팀 내에 머신러닝 스터디가 시작이 되었고, 그에 파이썬을 이용하여 스터디를 해야하는 상황. 하지만 스터디를 하는 팀원 절반 이상이 파이썬을 이용한 개발 경험이 없었고, 서로 배운것을 공유를 하면서 스터디를 하면 더 좋겠다는 생각이 들때 즈음. 언제 어디선가 봤던것이 머릿속을 스쳐 지나간다. 그건 바로 Jupyter(이하 주피터).</p><div class="figure center" style="width:;"><a class="fancybox" href="jupyter_logo.jpg" title="출처 : https://jupyter.org/" data-caption="출처 : https://jupyter.org/" data-fancybox="default"><img class="fig-img" src="jupyter_logo.jpg" alt="출처 : https://jupyter.org/"><span class="image-caption">출처 : https://jupyter.org/</span></a><span class="caption">출처 : https://jupyter.org/</span></div><div style="clear:both;"></div><p><a href="https://jupyter.org/" target="_blank" rel="noopener">주피터</a>는 수십 개의 프로그래밍 언어에서 대화 형 컴퓨팅을위한 오픈 소스 소프트웨어, 오픈 표준 및 서비스를 개발하기 위한 툴이라고 한다. 이 포스트를 작성하기 전까지만 해도 “주피터 == 파이썬 웹 개발툴” 이라고만 알고있었는데 좀더 찾아보니 <a href="https://github.com/jupyter/jupyter/wiki/Jupyter-kernels" target="_blank" rel="noopener">다양한 언어를 지원</a>하는것 같다.<br>그럼 이러한 주피터를 특정 서버에 설치하고 로컬에 파이썬을 설치하지 않아도 원격으로 파이썬 코딩을 해보면 좀더 스터디에 도움이 되지 않을까 하는 마음이 들었다. 또한 학교에서 운동장에 잔디를 깔아서 맘껏 뛰놀수 있게 하는 느낌으로 팀원들을 위해 설치를 해두고 원격으로 접속할 수 있게 해두면 모두가 편하고 쉽게 파이썬에 대해 경험을 해볼 수 있지 않을까 하는 마음으로 주피터를 설치를 해 보고자 한다.<br>본 포스팅의 목표는 다음과 같다.</p><ul><li>환경 : CentOS 7.4 64Bit, python 2.7 (기본)</li><li>목표<ul><li>anaconda 를 활용하여 시스템 기본 파이썬을 건드리지 않는 가상환경을 구축한다.</li><li>주피터를 설치하고 원격으로 접속할 수 있도록 설정한다.</li></ul></li></ul><p>여기까지 보면 필자가 엄청나게 파이썬에 대해 잘 아는것처럼 보일수도 있어 미리 말하지만 필자는 찐 자바 개발자이면서 파이썬 개발 수준은 기본적인 스크립트를 작성하는 정도이다. 그러니 이 포스트를 읽고 있는 필자같은 파알못(?) 분들도 충분히 설치가 가능하다. (최대한 따라할수 있을 정도의 치트키 수준으로 작성 하고자 한다.)</p><h3 id="아나콘다-설치-덤으로-설치되는-주피터"><a href="#아나콘다-설치-덤으로-설치되는-주피터" class="headerlink" title="# 아나콘다 설치 (덤으로 설치되는 주피터)"></a># 아나콘다 설치 (덤으로 설치되는 주피터)</h3><p>우선 아나콘다를 설치하자. 아나콘다는 Anaconda(이전: Continuum Analytics)라는 곳에서 만든 파이썬 배포판으로, 수백 개의 파이썬 패키지를 포함하고 있다고 한다. 즉, 아나콘다를 설치하고 만들어진 가상환경에서 파이썬 개발을 하면 다양한 모듈이 이미 설치되어 있기 때문에 편리하다는 이야기. </p><div class="figure center" style="width:;"><a class="fancybox" href="ananconda.jpg" title="출처 : https://www.anaconda.com/" data-caption="출처 : https://www.anaconda.com/" data-fancybox="default"><img class="fig-img" src="ananconda.jpg" alt="출처 : https://www.anaconda.com/"><span class="image-caption">출처 : https://www.anaconda.com/</span></a><span class="caption">출처 : https://www.anaconda.com/</span></div><div style="clear:both;"></div><p>더불어 시스템에 기본으로 설치되어 있는 파이썬을 건드리면 여러 복잡한 문제가 발생할 수 있기에. 아나콘다를 활용하여 파이썬 3을 사용하는 가상환경을 만들어 보자.<br>설치는 아주 간단하다. 아나콘다 설치파일을 다운받고 이를 실행하면 끝.<br>(user 레벨이 root 면 sudo 명령어를 생략해도 된다.)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh</span><br><span class="line">$ sudo bash Anaconda3-2019.10-Linux-x86_64.sh</span><br><span class="line"></span><br><span class="line">Welcome to Anaconda3 2019.10</span><br><span class="line"></span><br><span class="line">In order to continue the installation process, please review the license</span><br><span class="line">agreement.</span><br><span class="line">Please, press ENTER to continue</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">===================================</span><br><span class="line">Anaconda End User License Agreement</span><br><span class="line">===================================</span><br><span class="line"></span><br><span class="line">Copyright 2015, Anaconda, Inc.</span><br><span class="line">~~~ 중략 ~~~</span><br><span class="line">Do you accept the license terms? [yes|no]</span><br><span class="line">[no] &gt;&gt;&gt; yes # yes!!</span><br><span class="line"></span><br><span class="line">Anaconda3 will now be installed into this location:</span><br><span class="line">/root/anaconda3</span><br><span class="line"></span><br><span class="line">  - Press ENTER to confirm the location</span><br><span class="line">  - Press CTRL-C to abort the installation</span><br><span class="line">  - Or specify a different location below</span><br><span class="line"></span><br><span class="line">[/root/anaconda3] &gt;&gt;&gt; /home/anaconda3 # 설치될 경로를 설정해주고 기본 설정값에 설치하려면 그냥 엔터</span><br><span class="line"></span><br><span class="line">~~~뭐가 엄청 설치된다. 물 한잔 먹고 오자.~~~</span><br><span class="line"></span><br><span class="line">installation finished.</span><br><span class="line">Do you wish the installer to initialize Anaconda3</span><br><span class="line">by running conda init? [yes|no]</span><br><span class="line">[no] &gt;&gt;&gt; yes # yes!!</span><br></pre></td></tr></table></figure></p><p>이렇게 되면 설치는 끝. 환경변수를 설정해서 기본 파이썬 환경을 아나콘다에 의해 설정되도록 맞춰주자.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo vi .bashrc</span><br><span class="line"></span><br><span class="line">__conda_setup=&quot;$(&apos;/home/anaconda3/bin/conda&apos; &apos;shell.bash&apos; &apos;hook&apos; 2&gt; /dev/null)&quot;</span><br><span class="line">if [ $? -eq 0 ]; then</span><br><span class="line">    eval &quot;$__conda_setup&quot;</span><br><span class="line">else</span><br><span class="line">    if [ -f &quot;/home/anaconda3/etc/profile.d/conda.sh&quot; ]; then</span><br><span class="line">        . &quot;/home/anaconda3/etc/profile.d/conda.sh&quot;</span><br><span class="line">    else</span><br><span class="line">        export PATH=&quot;/home/anaconda3/bin:$PATH&quot;</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line">unset __conda_setup</span><br><span class="line"></span><br><span class="line">source .bashrc</span><br></pre></td></tr></table></figure></p><p>그러면 다음과 같이 프롬프트가 변경된것을 확인할 수 있다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">환경변수 변경 전</span><br><span class="line">[user@server ~]$ </span><br><span class="line"></span><br><span class="line">환경변수 변경 후</span><br><span class="line">(base) [user@server ~]$</span><br></pre></td></tr></table></figure></p><p>참, 아나콘를 설치하면 주피터가 같이 설치가 된다. 좀전에 설치된 내용을 보면 주피터가 설치된것을 확인할 수 있다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">jinja2             pkgs/main/noarch::jinja2-2.10.3-py_0</span><br><span class="line">joblib             pkgs/main/linux-64::joblib-0.13.2-py37_0</span><br><span class="line">jpeg               pkgs/main/linux-64::jpeg-9b-h024ee3a_2</span><br><span class="line">json5              pkgs/main/noarch::json5-0.8.5-py_0</span><br><span class="line">jsonschema         pkgs/main/linux-64::jsonschema-3.0.2-py37_0</span><br><span class="line">jupyter            pkgs/main/linux-64::jupyter-1.0.0-py37_7</span><br><span class="line">jupyter_client     pkgs/main/linux-64::jupyter_client-5.3.3-py37_1</span><br><span class="line">jupyter_console    pkgs/main/linux-64::jupyter_console-6.0.0-py37_0</span><br><span class="line">jupyter_core       pkgs/main/noarch::jupyter_core-4.5.0-py_0</span><br><span class="line">jupyterlab         pkgs/main/noarch::jupyterlab-1.1.4-pyhf63ae98_0</span><br><span class="line">jupyterlab_server  pkgs/main/noarch::jupyterlab_server-1.0.6-py_0</span><br><span class="line">keyring            pkgs/main/linux-64::keyring-18.0.0-py37_0</span><br><span class="line">kiwisolver         pkgs/main/linux-64::kiwisolver-1.1.0-py37he6710b0_0</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><h3 id="주피터-원격-설정"><a href="#주피터-원격-설정" class="headerlink" title="# 주피터 원격 설정"></a># 주피터 원격 설정</h3><p>다음으로 주피터 환경설정을 만들어 주자. 기본 설정이 아닌 별도 설정을 만드는 이유는 원격으로 띄울때 입맛에 맞도록 띄우기 위함이다. 설정파일을 생성하고 수정을 해주자.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo jupyter notebook --generate-config</span><br><span class="line">Writing default config to: /root/.jupyter/jupyter_notebook_config.py</span><br><span class="line">$ sudo vi /root/.jupyter/jupyter_notebook_config.py</span><br><span class="line">c.NotebookApp.notebook_dir = &apos;/home/data&apos; # 주피터에서 만든 결과물들이 저장되는 경로</span><br><span class="line">c.NotebookApp.ip = &apos;0.0.0.0&apos; # 외부에서 접속하기 위한 설정</span><br><span class="line">c.NotebookApp.port = 80 # 서버 ip (혹은 설정한 도메인) 으로 바로 접속하기 위해</span><br></pre></td></tr></table></figure></p><p>이렇게 하면 설정 끝! 이제 아래 명령어로 드디어 주피터를 실행시켜 보자.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ sudo jupyter notebook --config=/root/.jupyter/jupyter_notebook_config.py --allow-root --no-browser</span><br><span class="line"></span><br><span class="line">[I 21:30:18.278 NotebookApp] JupyterLab extension loaded from /home/anaconda3/lib/python3.7/site-packages/jupyterlab</span><br><span class="line">[I 21:30:18.278 NotebookApp] JupyterLab application directory is /home/anaconda3/share/jupyter/lab</span><br><span class="line">[I 21:30:18.279 NotebookApp] Serving notebooks from local directory: /home/data</span><br><span class="line">[I 21:30:18.280 NotebookApp] The Jupyter Notebook is running at:</span><br><span class="line">[I 21:30:18.280 NotebookApp] http://server:80/?token=82db9~~~~~~be6b9d5</span><br><span class="line">[I 21:30:18.280 NotebookApp]  or http://127.0.0.1:80/?token=82db9~~~~~~be6b9d5</span><br><span class="line">[I 21:30:18.280 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 21:30:18.283 NotebookApp]</span><br><span class="line"></span><br><span class="line">    To access the notebook, open this file in a browser:</span><br><span class="line">        file:///root/.local/share/jupyter/runtime/nbserver-9366-open.html</span><br><span class="line">    Or copy and paste one of these URLs:</span><br><span class="line">        http://server:80/?token=82db9~~~~~~be6b9d5</span><br><span class="line">     or http://127.0.0.1:80/?token=82db9~~~~~~be6b9d5</span><br></pre></td></tr></table></figure></p><p>서버 ip로 접속을 해보면 로그인 페이지가 나오고 토큰을 입력하라고 한다. 그럼 당황하지 말고 서버에 나온 토큰을 입력하고 로그인을 하면 아래처럼 브라우저(?)같은 화면을 맞이할 수 있다.</p><div class="figure center" style="width:;"><a class="fancybox" href="jupyter_install.jpg" title="기나긴 여정끝에 맞이하는 로그인 페이지!" data-caption="기나긴 여정끝에 맞이하는 로그인 페이지!" data-fancybox="default"><img class="fig-img" src="jupyter_install.jpg" alt="기나긴 여정끝에 맞이하는 로그인 페이지!"><span class="image-caption">기나긴 여정끝에 맞이하는 로그인 페이지!</span></a><span class="caption">기나긴 여정끝에 맞이하는 로그인 페이지!</span></div><div style="clear:both;"></div><p>그런데 기다란 토큰을 입력하는 것보단 외우기 쉬운 패스워드를 입력하는게 더 편할테니, 하단 영역에서 패스워드를 설정해두면 다음번엔 (토큰보다는 외우기 쉬운) 패스워드를 입력하고 로그인이 가능하다.</p><blockquote><p>여기서 80 port 로 띄우기 위해서는 root 권한이 있어야 한다.<br>처음엔 80 port 가 아닌 다른 port 로 띄우고 앞단에 아파치를 둬서 프록시 태우려 했으나 프록시가 되는 과정에서 뭔가 정보전달이 잘 안되는 느낌이었다. 그렇기에 앞서 말한대로 root 권한으로 띄워야 한다.</p></blockquote><p>모든 foreground 프로세스들은 그 프로세스를 띄운 세션이 종료되면 해당 프로세스 또한 종료가 되어버린다. 리눅스의 “&amp;” 명령어를 이용하여 backgrund로 띄워주자.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo jupyter notebook --config=/root/.jupyter/jupyter_notebook_config.py --allow-root --no-browser &amp;</span><br></pre></td></tr></table></figure></p><h3 id="주피터-활용팁"><a href="#주피터-활용팁" class="headerlink" title="# 주피터 활용팁"></a># 주피터 활용팁</h3><p>IDE처럼 엄청난 기능을 제공하진 않지만 외부에서 누구나 간단히 접속하여 파이썬 코딩을 할 수 있는 상태가 되었다. 폴더 기능도 제공하니 각자의 환경(폴더)을 만들어서 코드를 작성할 수 있다.<br>여기서는 “notebook” 이라는 개념으로 불리우는데 파이썬 파일을 만들고 언제나 그랬듯 hello world 를 출력한뒤 Shift+Enter 을 누르면 바로 결과물이 나오는 것을 확인할 수 있다.</p><div class="figure center" style="width:;"><a class="fancybox" href="download_notebook.jpg" title="위 메뉴에서 다양한 포맷으로 다운을 받을 수 있다." data-caption="위 메뉴에서 다양한 포맷으로 다운을 받을 수 있다." data-fancybox="default"><img class="fig-img" src="download_notebook.jpg" alt="위 메뉴에서 다양한 포맷으로 다운을 받을 수 있다."><span class="image-caption">위 메뉴에서 다양한 포맷으로 다운을 받을 수 있다.</span></a><span class="caption">위 메뉴에서 다양한 포맷으로 다운을 받을 수 있다.</span></div><div style="clear:both;"></div><p>자동완성은 “Tab”, 어느정도 시간이 지나면 자동으로 저장이 되고, File → Download as → Notebook(.ipynb) 로 추출을 한뒤 gist 에도 업로드가 가능하다. 아주 이쁘게. (gist 에 올려진 주피터 노트북 결과물 : <a href="https://gist.github.com/search?l=Jupyter+Notebook&amp;q=ipynb" target="_blank" rel="noopener">링크</a>)</p><p>더 자세한 내용은 주피터 도큐먼트를 참고하자. <a href="https://jupyter.org/documentation" target="_blank" rel="noopener">링크</a></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>이로써 팀원들이 파이썬을 가지고 놀아볼 수 있는(?) 운동장이 만들어 졌다. 우리는 개발자니까. 환경이 없으면 직접 만들면 되니까. 개발자로 살아가면서 이런 부분이 참 매력적인 것 같다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;파이썬이라는 언어는 다른 프로그래밍 언어들에 비해 쉽고 직관적이라 그런지 프로그래밍을 처음 시작하는 사람들에게 더욱이 주목을 받고 있는것 같다. 정말 다양한 모듈들이 많아 여러분야에서 활용되고 있고
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="python" scheme="https://taetaetae.github.io/tags/python/"/>
    
      <category term="jupyter" scheme="https://taetaetae.github.io/tags/jupyter/"/>
    
  </entry>
  
  <entry>
    <title>스프링 부트로 멀티모듈 셋팅하기</title>
    <link href="https://taetaetae.github.io/2020/01/19/spring-boot-maven-multi-module/"/>
    <id>https://taetaetae.github.io/2020/01/19/spring-boot-maven-multi-module/</id>
    <published>2020-01-19T01:29:03.000Z</published>
    <updated>2020-01-19T03:03:09.034Z</updated>
    
    <content type="html"><![CDATA[<p>서비스를 처음 만들기 시작할때면 각 직군별로 생각하는 포인트가 다양하다. 설계, 기획, 디자인, 개발. 여기서 개발은 프로젝트 셋팅을 어떻게 해야하지? 하는 고민을 하기 마련이다. 아주 간단하게 하나의 모듈로 모든 기능을 담당하도록 만들 수 있지만 기능별로 모듈을 나눠서 셋팅하는게 관리측면에서 장점이라 생각한다.<a id="more"></a><br>예를 들어보자. 도서관의 들어온 책 정보를 외부에 제공하는 “API”, 주기적으로 책 정보를 업데이트 하는 “Batch”. 이렇게 크게 두가지의 모듈이 있어야 한다고 가정했을때 어떤식으로 모듈을 설계할 수 있을까?<br>이번 포스팅에서는 스프링 부트와 메이븐을 활용해서 하나의 프로젝트(컴포넌트)에서 여러 모듈을 관리할 수 있는 <a href="https://spring.io/guides/gs/multi-module/" target="_blank" rel="noopener">Spring Multi Module</a>을 셋팅하는 방법에 대해 알아보고자 한다. 필자도 셋팅하기 전에는 “그냥 하면 되는거 아니야?”라며 우습게 보다 아주 사소한 부분들에서 엄청난 삽질을 해서 그런지 꼭 포스팅으로 남겨놔야 겠다고 다짐했고 이렇게 정리를 할 수 있게 되어서 다행이라 생각한다.</p><div class="figure center" style="width:;"><a class="fancybox" href="team_structure.png" title="어쩌면 우리가 있는 팀도 멀티모듈이 아닐까? <br>출처 : https://bcho.tistory.com/813" data-caption="어쩌면 우리가 있는 팀도 멀티모듈이 아닐까? <br>출처 : https://bcho.tistory.com/813" data-fancybox="default"><img class="fig-img" src="team_structure.png" alt="어쩌면 우리가 있는 팀도 멀티모듈이 아닐까? <br>출처 : https://bcho.tistory.com/813"><span class="image-caption">어쩌면 우리가 있는 팀도 멀티모듈이 아닐까? <br>출처 : https://bcho.tistory.com/813</span></a><span class="caption">어쩌면 우리가 있는 팀도 멀티모듈이 아닐까? <br>출처 : https://bcho.tistory.com/813</span></div><div style="clear:both;"></div><h3 id="왜-멀티모듈로-셋팅할까"><a href="#왜-멀티모듈로-셋팅할까" class="headerlink" title="# 왜 멀티모듈로 셋팅할까?"></a># 왜 멀티모듈로 셋팅할까?</h3><p>위에서 예시로 이야기 한것처럼 현재 우리가 셋팅해야할 모듈은 크게 두가지 이다.</p><ul><li>API : 외부에 도서관에 들어온 책 정보를 알려주는 모듈</li><li>Batch : 주기적으로 도서관의 책 정보를 갱신하는 모듈</li></ul><p>한번 생각을 해보자. 위에서 말한 모듈들 중에 동시에 사용할것만 같은 정보가 있다. “책 정보”. 각 모듈마다 “책 정보”를 가져오는 로직을 작성하는것 보다 한곳에서 해당로직을 구현하고 이를 여러곳에서 사용하는게 사용하는게 중복코드를 방지할수 있는 방법이란건 쉽게 알아차릴수 있다. 그렇다면 어떻게 모듈을 분리할수 있을까?<br>필자의 경험으로 미루어 볼때 크게 두가지 방법이 있는것 같다. </p><ul><li>공통으로 사용하는 모듈을 jar로 만들고 이를 메이븐 원격 저장소에 deploy, 사용하는 모듈에서 디펜던시에 추가하여 사용</li><li>멀티모듈로 구성하고 사용하는 모듈에서 디펜던시에 추가하여 사용</li></ul><p>첫번째 방법의 가장 큰 단점은, 공통으로 사용하는 모듈이 변경될때마다 버전을 바꿔주고 (안바꿔도 되지만 사용하는 모듈에서 캐시 갱신을 해야하는 불편함이 생긴다.) 메이븐 원격 저장소에 deploy를 해줘야 한다. 그에 반해 두번째 방법은 이런과정없이 함께 빌드만 해주면 끝나고 IDE에서 개발시 한 모듈에서 동시에 수정과 사용이 가능하기 때문에 훨씬 편리하다.<br><a href="https://johngrib.github.io/wiki/No-Silver-Bullet/" target="_blank" rel="noopener">은총알은 없다</a> 라는 말처럼, 정답은 없다. 하지만 이런저런 방법들을 미리 알아두면 적시적소에 사용할 수 있는. 필자가 다른글들에서도 언급을 자주하던 “나만의 무기”가 되지 않을까?</p><h3 id="멀티모듈-셋팅하기"><a href="#멀티모듈-셋팅하기" class="headerlink" title="# 멀티모듈 셋팅하기"></a># 멀티모듈 셋팅하기</h3><p>위에서 이야기 했던 “API”, “Batch”와는 별도로 공통으로 사용하는 모듈인 “Core” 이렇게 총 3개의 모듈을 만들예정이다.</p><blockquote><p>다른 이야기지만, 공통으로 사용할 것 “같아서” 미리 공통로직을 작성하는 습관은 좋지 않는것 같다. 그러다보면 쓸데없이 공통로직이 무거워지므로 실제로 사용하면서 중복코드가 발생할때 그때 공통로직으로 리펙토링 해도 늦지 않는것 같다. (꼰데인가…)</p></blockquote><p>구현하는 환경은 다음과 같다.</p><ul><li>Spring Boot 2.2.3</li><li>Maven</li><li>IntelliJ</li></ul><p>우선 IDE의 힘을 빌려 하나의 스프링 부트 프로젝트를 생성해본다.<br><div class="figure center" style="width:;"><a class="fancybox" href="spring_boot_init.jpg" title="다음 > 다음 > 다음" data-caption="다음 > 다음 > 다음" data-fancybox="default"><img class="fig-img" src="spring_boot_init.jpg" alt="다음 > 다음 > 다음"><span class="image-caption">다음 > 다음 > 다음</span></a><span class="caption">다음 > 다음 > 다음</span></div><div style="clear:both;"></div></p><p>그 다음 만든 프로젝트에서 우클릭 후 새로운 모듈을 선택. Maven 모듈을 선택하고 적당한 이름을 적어준다.<br><div class="figure center" style="width:;"><a class="fancybox" href="new_module.jpg" title="다음 > 다음 > 다음 222" data-caption="다음 > 다음 > 다음 222" data-fancybox="default"><img class="fig-img" src="new_module.jpg" alt="다음 > 다음 > 다음 222"><span class="image-caption">다음 > 다음 > 다음 222</span></a><span class="caption">다음 > 다음 > 다음 222</span></div><div style="clear:both;"></div></p><p>“API”, “Batch”, “Core” 라는 모듈을 추가하고 실제 모듈이 되는 “API”, “Batch”에 Build plugin 을 셋팅해주자. 그렇게 하고 각 Pom.xml을 보면 아래와 같다. (“API” 모듈에 대해서만 집중적으로 이야기 하려 한다. “Batch” 모듈도 동일한 형식으로 작성하기 때문.)</p><ul><li><p>최 상위 Pom.xml (library)<br>  modules 하위에 멀티모듈로 설정한 모듈들의 이름이 들어가 있는것을 확인할 수 있다.</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>core<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>batch<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taetaetae<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>library<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>API Pom.xml<br>  parent 부분이 설정되어 있는 모습을 볼수 있고, core 모듈을 사용하기 위해 dependency 에 추가를 해준다.</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taetaetae<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taetaetae<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">finalName</span>&gt;</span>library-api<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Core Pom.xml<br>  Core 모듈은 “jar”로 패키징 되어 다른 곳에서 사용되어야 하기 때문에 packaging 만 설정해준다.</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taetaetae<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>이렇게 하고서 Core 모듈에 공통으로 사용될 로직을 작성하고, API 모듈에서 이를 사용하는 로직을 작성한뒤, 빌드를 해보면 에러 없이 정상 작동을 하는 모습을 볼 수 있다.</p><ul><li>메이븐 빌드 Goal : mvn clean install -pl api -am<blockquote><p>-pl [ ] : 지정된 이름의 모듈만 빌드한다.<br>-am : 연결된 상위 모듈까지 같이 빌드한다.<br><a href="https://books.sonatype.com/mvnref-book/reference/_using_advanced_reactor_options.html#_specifying_a_subset_of_projects" target="_blank" rel="noopener">Reference 참고</a></p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Reactor Build Order:</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] library                                                            [pom]</span><br><span class="line">[INFO] core                                                               [jar]</span><br><span class="line">[INFO] api                                                                [jar]</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] -----------------------&lt; com.taetaetae:library &gt;------------------------</span><br><span class="line"></span><br><span class="line">...중략...</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Reactor Summary for library 0.0.1-SNAPSHOT:</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] library ............................................ SUCCESS [  0.715 s]</span><br><span class="line">[INFO] core ............................................... SUCCESS [  3.005 s]</span><br><span class="line">[INFO] api ................................................ SUCCESS [  1.715 s]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  6.008 s</span><br><span class="line">[INFO] Finished at: 2020-01-19T11:26:46+09:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>본문 최 하단에 해당 소스가 업로드 된 Github에서 확인이 가능하겠지만, (“도서관” 이라는 목적에는 안맞지만…) 정수를 더하고 빼는 유틸을 Core에 만들고 이를 Api에 있는 컨트롤러에서 사용하도록 만들어 보았다. (어디까지나 모듈에서 멀티모듈로 되어있는 다른 모듈에 접근이 가능한지를 보기 위함이라… 예시가 우아하진 않다.)</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>언제부터인가 단순 로직개발보다 구조관점에서 바라보는 연습을 하곤한다. 아무리 알고리즘이 잘 작성되고 우아한 코드일지라도 구조가 개발 생산성 측면과 유지보수 측면에서 분리하면 아무 소용 없는것 같다. 위에서도 이야기 했듯이 멀티모듈이 무조건적인 정답은 아니지만 시스템을 구성하는데 있어 다양한 선택지를 알고있는 여유를 갖는것도 좋아보인다.</p><p>※ <a href="https://github.com/taetaetae/spring-boot-maven-multi-module" target="_blank" rel="noopener">Github 예제 소스</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;서비스를 처음 만들기 시작할때면 각 직군별로 생각하는 포인트가 다양하다. 설계, 기획, 디자인, 개발. 여기서 개발은 프로젝트 셋팅을 어떻게 해야하지? 하는 고민을 하기 마련이다. 아주 간단하게 하나의 모듈로 모든 기능을 담당하도록 만들 수 있지만 기능별로 모듈을 나눠서 셋팅하는게 관리측면에서 장점이라 생각한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="spring boot" scheme="https://taetaetae.github.io/tags/spring-boot/"/>
    
      <category term="module" scheme="https://taetaetae.github.io/tags/module/"/>
    
      <category term="structure" scheme="https://taetaetae.github.io/tags/structure/"/>
    
      <category term="maven" scheme="https://taetaetae.github.io/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>조금은 무거운 2019 회고</title>
    <link href="https://taetaetae.github.io/2019/12/29/review-2019/"/>
    <id>https://taetaetae.github.io/2019/12/29/review-2019/</id>
    <published>2019-12-29T13:22:03.000Z</published>
    <updated>2019-12-29T17:48:42.861Z</updated>
    
    <content type="html"><![CDATA[<p>“회고”는 비단 개발 블로그 뿐만 아니라 어떠한 과정의 마지막에는 꼭 해야할 중요한 시간인 것 같다. 앞만보고 달려가자! 닥공! 라는 말이 있지만 사실 이 말이 성립되기 위해선 지난 과거에 대한 정리와 반성 그리고 무엇을 하려고 했는데 어떤 이유로 못했는지와 그 동안의 나 자신을 바라볼 수 있는 이 “회고” 시간이 필요하다. <a id="more"></a>벌써 2019년도 마무리가 되어간다. 작년보다 더 정신없이 달려온 올해. 내년엔 올해보다 더 멋지고 힘차게 출발하기 위해 필자의 한 해를 돌아보고자 한다.<br>그렇다면 회고는 어떻게 하는게 가장 좋을까? 무작정 타임라인 기반으로 1월엔 뭐했고 2월엔 뭐했고… 이 방법이 틀린건 아니지만 타임라인 기반으로 정리를 한 뒤 키워드별로 다시 정리하는 방식이 가장 맞을것 같다는 생각이다. 무엇을 했고, 뭐가 좋았고 어떤건 아쉬웠고. 그래서 내년엔 어떻게 할 것이고. 각자의 회고 방식에는 차이가 있겠지만 회고를 하는 이유, 그리고 회고라는 목표 중에 공통점은 “뒤를 돌아보고, 앞을 보기위한 힘을 찾는것” 이 아닐까 싶다.</p><div class="figure center" style="width:;"><a class="fancybox" href="back_no_hae.png" title="내년 회고를 할때는 흑백이 아닌 컬러 사진을 넣을 수 있는 분위기가 될까?... <br>출처 : http://www.nanum.com/site/poet_walk/820914" data-caption="내년 회고를 할때는 흑백이 아닌 컬러 사진을 넣을 수 있는 분위기가 될까?... <br>출처 : http://www.nanum.com/site/poet_walk/820914" data-fancybox="default"><img class="fig-img" src="back_no_hae.png" alt="내년 회고를 할때는 흑백이 아닌 컬러 사진을 넣을 수 있는 분위기가 될까?... <br>출처 : http://www.nanum.com/site/poet_walk/820914"><span class="image-caption">내년 회고를 할때는 흑백이 아닌 컬러 사진을 넣을 수 있는 분위기가 될까?... <br>출처 : http://www.nanum.com/site/poet_walk/820914</span></a><span class="caption">내년 회고를 할때는 흑백이 아닌 컬러 사진을 넣을 수 있는 분위기가 될까?... <br>출처 : http://www.nanum.com/site/poet_walk/820914</span></div><div style="clear:both;"></div><h3 id="회사는-성장의-공간이-아닌것을-깨닳는-순간"><a href="#회사는-성장의-공간이-아닌것을-깨닳는-순간" class="headerlink" title="# 회사는 성장의 공간이 아닌것을 깨닳는 순간."></a># 회사는 성장의 공간이 아닌것을 깨닳는 순간.</h3><p>(이야기에 앞서 필자는 현재 서비스 개발자임을 밝힌다.)<br>내년이 되면 컴퓨터쟁이가 된지 벌써 8년차. 매년 성장의 그래프를 그려보면 작년까지만 해도 우상향이었다. (그래프의 기울기는 매년 달랐지만) 허나 올해는 기울기가 0 이거나 오히려 마이너스가 된 것 같은 느낌이다. 왜일까.</p><div class="figure center" style="width:;"><a class="fancybox" href="height.jpg" title="키는 왜 더이상 성장을 안할까? (쓰읍...) <br>출처 : http://www.guro1318.or.kr/bbs/board.php?bo_table=data&wr_id=1723" data-caption="키는 왜 더이상 성장을 안할까? (쓰읍...) <br>출처 : http://www.guro1318.or.kr/bbs/board.php?bo_table=data&wr_id=1723" data-fancybox="default"><img class="fig-img" src="height.jpg" alt="키는 왜 더이상 성장을 안할까? (쓰읍...) <br>출처 : http://www.guro1318.or.kr/bbs/board.php?bo_table=data&wr_id=1723"><span class="image-caption">키는 왜 더이상 성장을 안할까? (쓰읍...) <br>출처 : http://www.guro1318.or.kr/bbs/board.php?bo_table=data&wr_id=1723</span></a><span class="caption">키는 왜 더이상 성장을 안할까? (쓰읍...) <br>출처 : http://www.guro1318.or.kr/bbs/board.php?bo_table=data&wr_id=1723</span></div><div style="clear:both;"></div><p>회사를 다니다 보면 아주 일반적으로 “시키는 일”을 하곤 한다. 주어진 업무를 정해진 기간 안에 스펙에 맞춰 개발하는. 아주 극단적으로 나쁘게 말하면 “도구”로 전락되어버릴 수도 있는 시간들. (개발자가 도구가 된다는 말은 너무나도 듣기 싫은 말중에 하나.) 흔히 말하는 CRUD(Create, Read, Update, Delete) 성의 개발 업무를 하곤 한다. 하지만 꼭 성과에 align(더 좋은 한국말을 찾고 싶은데…) 하는 일 말고도 허드렛일(일종의 서스테이닝?)을 할 경우도 있는데 그게 만약 재미없는 일이라면 어떨까?<br>필자는 그렇게 “시키는 일만 하며 재미없는 회사생활” 보다 “재미있게 개발하며 성장을 할 수 있는 회사생활” 이라는 기준을 가지고 한 해를 지내온 것 같다. 즉, “시키는 일”이 아닌 “시키지도 않은 일”을 찾아서 해가며. 예컨대, 처음에 잡았던 서비스 구조가 사용자가 많아지고 요구사항이 많아짐에 따라 복잡하고 성능을 저해하는 상황을 발견하고 미리 구조개선을 통해 성능과 효율이라는 두마리의 토끼를 잡는다거나. 지난 외부 세미나에서 듣고 인사이트를 얻어 팀내에도 적용해본 <a href="https://taetaetae.github.io/2019/10/13/batch-nondisruptive-deploy/">배치 무중단 배포 기능</a>. 팀 내 코드리뷰의 활성화와 수동으로 해야할 업무들을 메신저 봇을 활용하여 자동화 한다거나. 서비스 지표 대시보드를 만들어 한눈에 서비스 상황을 볼 수 있게 별도의 개발 페이지를 만들어 보는 등. 다양한 업무 내/외 적으로 일을 찾아가며 + 필자의 개인 시간을 할애해 가면서 정말 재미있게 보내온 것 같다.<br>하지만 뒤를 돌아보면 “성장 했는가?” 라는 질문이 있다면 “그렇게 하고있는것 같아서 신나게 해왔는데 돌아보니 막상 뭘했나 하는 느낌이 든다” 라고 말할 수 있을 정도로 여러가지를 많이 하며 다양한 “경험”을 얻긴 했지만 실질적인 “성장”은 아쉽지만 부족한 한 해 였던것 같다.<br>회사가 원하는, 연차에 맞는 업무 역량과 개발 팀에서의 위치를 충족시키기엔 회사 안에서 성장하기엔 한계가 있다고 판단이 들었다. (이 생각이 왜 이제서야 들었을까.) 오픈소스나 새로운 언어를 회사 밖에서 혼자서 공부 하던지 여러명이서 스터디를 통해 습득을 해야하고 토이프로젝트 또한 회사와 별도로 진행하며 개발 스킬을 늘려야 할것 같다. 그 이유는 회사에서의 성장이 결국 나의 성과로 잡힐 수는 없는데 괜시리 기대를 하게 되기도 하고 특히 서비스를 운영하는 팀에서는 요즘 핫 하다는 개발 방법론이나 솔루션을 도입하기에는 다소 무리가 있기 때문이다. (물론 회사일도 하면서 성장을 할 수 있는 상황이라면 금상첨화. 이를 찾는건 정말 어려운 일 같다.)<br>내년에는 좀더 회사 밖에서 새로운 지식도 쌓으려 노력하고, 외부 활동도 찾아가며 주니어도 시니어도 아닌 “매너리즘에 빠질 애매한 연차”를 슬기롭게 극복하려 노력해봐야 겠다.</p><h3 id="개발-커리어-쌓기-꾸준함이-정답"><a href="#개발-커리어-쌓기-꾸준함이-정답" class="headerlink" title="# 개발 커리어 쌓기. 꾸준함이 정답!"></a># 개발 커리어 쌓기. 꾸준함이 정답!</h3><p>작년보단 줄어들었지만 다양한 외부활동을 해왔다. 지금의 연차에 어울리진 않지만 한번도 제대로된 해커톤을 해보지 않아 <a href="https://taetaetae.github.io/2019/05/19/d-light-togetherthon-2019/">GDG에서 주최했던 해커톤에 참여</a>를 하며 마지막에 결과물에 대해 발표도 해보고, 필자의 토이프로젝트인 <a href="http://daily-devblog.com/" target="_blank" rel="noopener">기술블로그 구독서비스</a> 에 대한 <a href="https://festa.io/events/364?" target="_blank" rel="noopener">일련의 개발 히스토리에 대해서 발표</a>를 할 수 있었던 좋은 기회가 있었다. 또한 팀 분들께 글쓰기에 대한 인사이트를 전달하고자 <a href="https://taetaetae.github.io/2019/10/27/a-reason-for-writing/">지난 포스팅</a> 에 대한 내용을 간추려 발표를 하기도 하였다. (TMI : Deview 에서도 발표를 하려 지원을 했지만 아쉽게도 사내 탈락을 하고 ㅠ…) 발표는 글쓰기를 넘어 사람들 앞에서 라이브로 이야기하는 엄청난 활동인 것 같다. 내년에도 기회가 된다면 이번엔 좀 준비를 잘해서 여유로운 발표를 해보고 싶다. (그렇게 하기 위해서는 먼저 나 자신을 디벨롭 해야겠지?)</p><div class="figure center" style="width:;"><a class="fancybox" href="gdg.jpeg" title="앞이 안보이던 발표. 아 물론 내 눈앞. <br>출처 : https://lalwr.blogspot.com/2019/07/toy-story-side-project-by-gdg-campus.html" data-caption="앞이 안보이던 발표. 아 물론 내 눈앞. <br>출처 : https://lalwr.blogspot.com/2019/07/toy-story-side-project-by-gdg-campus.html" data-fancybox="default"><img class="fig-img" src="gdg.jpeg" alt="앞이 안보이던 발표. 아 물론 내 눈앞. <br>출처 : https://lalwr.blogspot.com/2019/07/toy-story-side-project-by-gdg-campus.html"><span class="image-caption">앞이 안보이던 발표. 아 물론 내 눈앞. <br>출처 : https://lalwr.blogspot.com/2019/07/toy-story-side-project-by-gdg-campus.html</span></a><span class="caption">앞이 안보이던 발표. 아 물론 내 눈앞. <br>출처 : https://lalwr.blogspot.com/2019/07/toy-story-side-project-by-gdg-campus.html</span></div><div style="clear:both;"></div><p>블로그 포스팅은 작년 수준으로 작성한 것 같다. 더 많이 쓰려고 했는데… 이점은 이 포스팅을 통해 반성을 해본다. “글또” 라는 모임에도 참여를 하며 적어도 2주에 글 하나는 써야지 했지만 올해 하반기에 개인적인 큰 이벤트도 있었고, 단순히 글 개수만을 채우기 위한 포스팅은 하기 싫었기 때문이다. (이거봐, 또 변명일색. 정신차려 태태태!) 하루에 한시간, 아니 30분만 투자하면 조금이라도 작성할 수 있는데 왜 이렇게 힘들어 했는지. 조금 더 신경써서 고퀄리티 기술블로그 포스팅을 해보려고 노력해야겠다. (왜 개발자가 바쁜데 글까지 써야하는 이유는 지난 포스팅을 참고)<br>운이 좋아 서평도 쓰게 되었다. 어떻게 필자를 알고 연락을 주셨는지 출판사에서 페이스북 메신저로 연락이 와서 쓰게 되었다. 전문적인 기술서적은 아니었지만 <a href="http://digital.kyobobook.co.kr/digital/ebook/ebookDetail.ink?barcode=4801160509510" target="_blank" rel="noopener">프로그래머로써의 꼭 한번즈음은 읽어볼만한 책</a>에 대한 서평이었다. 처음으로 서평을 써보게 되어서 상당히 재밌었고, 서점이나 인터넷 책 구매 사이트에 필자 이름이 있다는 것에 감동의 연속이었다. 지금도 가끔씩 책 쓸 생각이 있냐는 연락이 종종 오지만, 내가 그럴 능력이 될까 싶다가도. 한번즈음 도전해보고 싶은. 글쓰기는 필자 삶을 바꿔놨다고 해도 과언이 아닐 정도로 정말 좋은 영역인것 같다.<br>필자의 토이프로젝트인 <a href="http://daily-devblog.com/" target="_blank" rel="noopener">기술블로그 구독서비스</a> 에 구독하는 사람이 어느덧 2,300여명을 넘어섰다. 어떻게 알고 다들 구독하시는지. 덕분에 메일 발송속도는 처음과는 현저하게 느려졌고 (사용자가 많아짐에 따라 구조개선을 해야하는건 당연한 이야기), 이제는 무언가 다른 기능을 추가해야하지 않을까 싶은 생각이 든다. 현재는 장님 코끼리 만지듯 python + flask 로 개발되었는데 내년엔 java 기반으로 바꾸면서 성능개선 + 기타 다른 기능을 만들어 볼까 한다. 더불어 한달에 약 3만원가량 AWS 서버비용이 나가고 있는데 후원을 받는것도 한계가 있고. 비지니스 모델을 찾거나, 사용자가 만명을 넘어서도 비용없이 돌아가는 구조를 생각해 봐야겠다. (1년이면 약 3~40만원, 무시 못할 비용이다…후..후원좀…)</p><div class="figure center" style="width:;"><a class="fancybox" href="ddb.jpg" title="구독자 수 그래프, 뭔가 방법을 찾아야 한다." data-caption="구독자 수 그래프, 뭔가 방법을 찾아야 한다." data-fancybox="default"><img class="fig-img" src="ddb.jpg" alt="구독자 수 그래프, 뭔가 방법을 찾아야 한다."><span class="image-caption">구독자 수 그래프, 뭔가 방법을 찾아야 한다.</span></a><span class="caption">구독자 수 그래프, 뭔가 방법을 찾아야 한다.</span></div><div style="clear:both;"></div><h3 id="핑계와-타협이-많았던-올해-내년엔-어떤-도전을-할까"><a href="#핑계와-타협이-많았던-올해-내년엔-어떤-도전을-할까" class="headerlink" title="# 핑계와 타협이 많았던 올해. 내년엔 어떤 도전을 할까?"></a># 핑계와 타협이 많았던 올해. 내년엔 어떤 도전을 할까?</h3><p>유독 올해는 작년, 제작년보다 필자 자신과 타협을 많이 했던 것 같다. 너무 바빠서라는 부끄러운 핑계부터 시작하여, 밥먹듯 야근하며 일 열심히 했으니까 라는 말도 안되는 타협까지. 우선 건강부터 챙겨야 겠다. 컴퓨터쟁이의 고질병인 거북목과 라운드숄더. 몸짱까진 아니더라도 늙어서도 코딩을 하려면 지금부터 몸관리를 해야하지 않을까 싶다.<br>앞서 이야기 한 것처럼 회사 밖에서의 나를 찾아보고자 한다. 그에 토이프로젝트 2.0 도 출시해보고, 새로운 언어, 새로운 오픈소스도 공부해보며 기술블로그도 열심히 포스팅해야지.<br>작년에는 “Coder 가 아닌 Programmer 가 되고 싶다.” 며 그럴싸한 계획이 있었는데 돌이켜 보면 그렇게 지낸것 같다. 단순히 도구가 되는 개발자가 아니라 단순 반복적인 일이나 허드렛일을 하면서도 그속에서 성장 포인트를 찾으려 애를 쓰는. 이 부분은 내년에도 유지하는 것으로.<br>목표를 뚜렷하게 잡는 일도 중요하지만, 적어도 내년엔 올해보다는 더 성장한 내가 되었으면 하고, 뒤 돌아봤을 때 부끄러움이 없는 내가 되었으면 좋겠다는 말로 올해 회고를 마무리 하고자 한다.<br>고생했다 태태태. 내년에도 잘 달려주길.</p><p><br><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;“회고”는 비단 개발 블로그 뿐만 아니라 어떠한 과정의 마지막에는 꼭 해야할 중요한 시간인 것 같다. 앞만보고 달려가자! 닥공! 라는 말이 있지만 사실 이 말이 성립되기 위해선 지난 과거에 대한 정리와 반성 그리고 무엇을 하려고 했는데 어떤 이유로 못했는지와 그 동안의 나 자신을 바라볼 수 있는 이 “회고” 시간이 필요하다.
    
    </summary>
    
      <category term="review" scheme="https://taetaetae.github.io/categories/review/"/>
    
    
      <category term="review" scheme="https://taetaetae.github.io/tags/review/"/>
    
  </entry>
  
  <entry>
    <title>개발하기 바쁜데 글까지 쓰라고? (글쓰는 개발자가 되자.)</title>
    <link href="https://taetaetae.github.io/2019/10/27/a-reason-for-writing/"/>
    <id>https://taetaetae.github.io/2019/10/27/a-reason-for-writing/</id>
    <published>2019-10-27T04:51:16.000Z</published>
    <updated>2019-10-27T15:25:54.090Z</updated>
    
    <content type="html"><![CDATA[<p>신입시절. 배워야 할 것도 회사 업무도 많아 허우적대던 때가 있었다. 그렇게 하루에 3~4시간 자며 정신없이 하루를 보내던 날 문득 동기 형이 “개발자는 기술 블로그를 해야 돼!”라는 전혀 이해가 안 되는 말을 해온다. 이렇게 바빠 죽겠는데 블로그에 글까지 쓰라고? <a id="more"></a>말이 되는 소릴 하라며 반박하다 못내 이기는 척 하나 둘 글을 쓰기 시작했고, 다른 유명 블로거처럼 엄청나진 않지만 하루에 1,000~2,000명 정도 들어오며 점점 성장해 가는 나만의 기술 블로그가 되었다. </p><div class="figure center" style="width:;"><a class="fancybox" href="blog_graph.jpg" title="미약하지만 처음보다는 성장하고 있는 블로그 PV(Page View)" data-caption="미약하지만 처음보다는 성장하고 있는 블로그 PV(Page View)" data-fancybox="default"><img class="fig-img" src="blog_graph.jpg" alt="미약하지만 처음보다는 성장하고 있는 블로그 PV(Page View)"><span class="image-caption">미약하지만 처음보다는 성장하고 있는 블로그 PV(Page View)</span></a><span class="caption">미약하지만 처음보다는 성장하고 있는 블로그 PV(Page View)</span></div><div style="clear:both;"></div><p>또한 필자의 개발자 경력(?)을 돌이켜 보자면 기술 블로그를 하기 전과 하고 난 후로 나뉠 만큼 기술 블로그는 개인적으로 엄청난 영향력이 되었다.</p><blockquote><p>이 기회를 빌어 동기 형에게 감사의 인사를 전하고 싶다. 형. 보고 있죠? ;]</p></blockquote><p>이번 포스팅은 꼭 “블로그를 하자” 라기 보다 “글을 왜 써야 하고 어떻게 써야 하는지”에 대해 이야기해보고자 한다. 처음 이 글을 쓰려고 마음먹었을 땐 개발자라는 직군에 국한되지 않고 누구에게나 적용될 정도의 범용적인 글을 쓰려 했으나 “S”의 조언으로 독자(타깃)을 최대한 개발자에 맞춰 써보고자 한다. thanks to “S”<br>사실 조금만 검색을 해보면 특히 개발자에게 글쓰기가 얼마나 중요한지 찾아볼 수 있을 정도로 다양한 글들에서 “개발자가 왜 글을 써야 하는가”에 대한 내용이 언급이 되곤 했었다. 글을 쓰지 않던 개발자. 하지만 지금은 글쓰기가 정말 중요하다고 느끼며 적어도 2주에 하나 이상의 글을 쓰려는 현업 개발자의 시선에서 정리를 해보고자 한다.<br>그리고 마침 멘토링 해주고 있는 분께도 글 쓰는것에 대한 중요성을 알려주고 싶었고, 팀 내에도 공유를 하고 싶어 겸사겸사.</p><h2 id="왜-글을-써야-할까"><a href="#왜-글을-써야-할까" class="headerlink" title="# 왜 글을 써야 할까?"></a># 왜 글을 써야 할까?</h2><h5 id="✓-비로소-내-것이-되기-위한-과정"><a href="#✓-비로소-내-것이-되기-위한-과정" class="headerlink" title="✓ 비로소 내 것이 되기 위한 과정"></a>✓ 비로소 내 것이 되기 위한 과정</h5><p>프로그래밍 언어를 처음 배울때 꼭 만나는 문구 <code>Hello World를 출력하시오</code>. 이게 의미하는 의미가 무엇일까? 정말 새로운 세계를 알려주려 하는 것 일까?(그럴수도 있다…) 우리가 살아가며 “배움”이라는 과정은 대부분 비슷하겠지만 특히 IT 기술은 책을 다 읽었다든지, 동영상 강의를 다 들었다고 해서 내 것이 되었다고 말하기는 어려울 것 같다. 직접 키보드를 두드려 가며 거기서 얻을 수 있는 또 다른 “인사이트” 가 생길 수도 있기 때문이다.<br>다른 예로, 운영하던 시스템이나 서비스에서 장애를 맞았다고 가정해보자. 하지만 우리는 늘 그래왔듯 어떻게든 장애를 해결할 것이다. 이러한 상황에서 분명 “문제의 원인”이 있었을 테고 “해결 과정”이 있기 마련인데 이곳에서도 “인사이트”가 분명 있을 것이다.<br>이러한 “인사이트”를 글로 적다 보면 그냥 “아~ 그렇구나, 그랬었지” 하는 머릿속에서의 기억보다는 훨씬 더 오래 남을 것이고 혹여 글에서 정리를 잘못해 다른 사람들의 피드백이 있다면 더할 나위 없이 좋은 효과라고 생각이 된다. (이것이 바로 공유의 힘!)<br>더불어 글을 쓸 때 올바른 정보에 기반하여 쓰는 습관이 중요한데 그러다 보면 원래 쓰려고 했던 내용보다 더 깊게 알아가는 과정 속에서 또 다른 배움을 얻을 수 있는 반강제적 기회가 생길 수 있다. 누가 시키지 않았어도 배운 것에 대한 활용을 하고 싶은 생각이 들고 이를 또 글로 쓰고. 긍정적인 순환 속에 생겨나는 작은 발자국일지라도 성장해가는 자신을 느낄 수 있을 것이다.</p><h5 id="✓-몸이-기억하는-정리하는-습관"><a href="#✓-몸이-기억하는-정리하는-습관" class="headerlink" title="✓ 몸이 기억하는 정리하는 습관"></a>✓ 몸이 기억하는 정리하는 습관</h5><p>개발을 하다 보면 정말 간단한 “CRUD”(Create, Read, Update, Delete) 부터 시작해서 엄청나게 복잡한 도메인 지식에 기반하여 개발을 해야 하는 상황이 생긴다. 그럴 때면 머릿속으로 정리하는 것보다 그림이나 글을 써가면서 정리하는 게 좋다는 건 굳이 말하지 않아도 아는 사실. 글을 쓰다 보면 기승전결의 정리 방법과 목적이 무엇이고 근거가 무엇인지에 대해 구분하는 스킬이 늘어나는 것 같다.(적어도 필자는 기술 블로그를 운영하면서 정리하는 스킬이 그전보다 엄청나게 늘어났다고 자부한다.)<br><div class="figure center" style="width:;"><a class="fancybox" href="ink.jpg" title="중국 속담중에 하나, 머릿속에 박혀 나오질 않는다." data-caption="중국 속담중에 하나, 머릿속에 박혀 나오질 않는다." data-fancybox="default"><img class="fig-img" src="ink.jpg" alt="중국 속담중에 하나, 머릿속에 박혀 나오질 않는다."><span class="image-caption">중국 속담중에 하나, 머릿속에 박혀 나오질 않는다.</span></a><span class="caption">중국 속담중에 하나, 머릿속에 박혀 나오질 않는다.</span></div><div style="clear:both;"></div><br>구조가 보기 어렵게 꼬여버린 스파게티 코드나 기능(스펙)이 너무 복잡한 도메인 지식도 글을 쓰며 갈고닦은 “정리 스킬”이 있다면 보다 깔끔한 코드로, 복잡하지만 간결한 스펙으로 정리하는 데 도움이 될 수 있다. 이러한 스킬은 비단 개발할 때나 스펙 정리할 때 뿐만 아니라 상대방과의 이야기를 할 때나 어떠한 계획을 세울 때. 고민이 생겼을 때 등 정말 다양한 곳에서 사용할 수 있는 정말 “나만의 무기”가 될 수 있다.</p><h5 id="✓-나를-브랜딩하는-수단-a-k-a-기술블로그"><a href="#✓-나를-브랜딩하는-수단-a-k-a-기술블로그" class="headerlink" title="✓ 나를 브랜딩하는 수단 (a.k.a 기술블로그)"></a>✓ 나를 브랜딩하는 수단 (a.k.a 기술블로그)</h5><p>특히 이 글을 읽고 있는 독자가 학생이시라면 “글쓰기”, 나아가서는 “기술 블로그”를 강력 추천하고 싶다. (그렇다고 학생이 아니라면 늦었다는 소리는 아니다. 지금 당장 시작하자.)<br><div class="figure center" style="width:;"><a class="fancybox" href="park.jpg" title="늦었으니 지금당장 시작하라는 소리일꺼다. 그쵸 명수형? <br>출처 : http://blog.besunny.com/?p=6111" data-caption="늦었으니 지금당장 시작하라는 소리일꺼다. 그쵸 명수형? <br>출처 : http://blog.besunny.com/?p=6111" data-fancybox="default"><img class="fig-img" src="park.jpg" alt="늦었으니 지금당장 시작하라는 소리일꺼다. 그쵸 명수형? <br>출처 : http://blog.besunny.com/?p=6111"><span class="image-caption">늦었으니 지금당장 시작하라는 소리일꺼다. 그쵸 명수형? <br>출처 : http://blog.besunny.com/?p=6111</span></a><span class="caption">늦었으니 지금당장 시작하라는 소리일꺼다. 그쵸 명수형? <br>출처 : http://blog.besunny.com/?p=6111</span></div><div style="clear:both;"></div><br>자신이 어떤 생각을 가지고 어떤 기술에 관심을 가지며 어떤 문제 해결을 해왔는지에 대해 나만의 개발 히스토리로 한눈에 볼 수 있는 수단이 된다고 생각하기 때문이다. 참, 요즘 채용시에 Github 계정이나 기술 블로그를 제출해야 하는 곳이 많이 생길 정도로 기술 블로그에 대한 관심이 부쩍 늘어난 것 같다. (적어도 필자가 취업할 때보다는… 아. 옛날이여)<br>필자는 기술 블로그를 운영하면서 집필, 추천평 등 전혀 예상하지 못한 경험을 할 수 있었다. (그중에 한 것도 있고 거절한 것도 있지만…) 그에 발표를 할 수 있었던 좋은 기회도 생겼고, 개인 메일로 이직 제안이나 기술 문의 등 “회사”라는 명찰을 떼고 외부에서 오롯이 나 혼자 일어설 수 있는 힘이 조금씩 생겨나고 있는것 같다. (그렇다고 이직 의사가 있다는 건 전~혀 아니니 오해는 말자. 회사님 사랑해요.)<br>취업이나 이직을 할 때. 나에 대해 누군가에게 알리는 순간이 있을 때 구구절절 이런저런 기술들을 할 줄 알고 이런저런 경험을 해봤어요라고 말하는 것도 방법이 될수 있지만 우아하게 기술 블로그 링크하나 딱! 전달해 보는건 어떨까? 뭔가 더 있어 보이지 않을까?</p><h3 id="글을-쓸때-중요한-핵심-6가지"><a href="#글을-쓸때-중요한-핵심-6가지" class="headerlink" title="# 글을 쓸때 중요한 핵심 6가지"></a># 글을 쓸때 중요한 핵심 6가지</h3><h5 id="✓-그래서-너가-말하고-싶은게-뭔데"><a href="#✓-그래서-너가-말하고-싶은게-뭔데" class="headerlink" title="✓ 그래서 너가 말하고 싶은게 뭔데?"></a>✓ 그래서 너가 말하고 싶은게 뭔데?</h5><p>글을 쓰다 보면 이야기하고 싶은 게 많아서(잘 쓰고 싶어서) 결론보다는 그 결론을 말하기 위한 보충 설명이나 근거를 먼저 말하곤 한다. 하지만 글을 읽는 독자 입장에서는 정답(=결론)이 가장 궁금한데 그것이 글의 말미에 있다면 자칫 글의 퀄리티가 아무리 좋더라도 지루한(?) 과정을 거치는 수고가 필요할 수밖에 없다. 가급적 글의 무게중심은 서두에 두는 게 “글”이라는 목적에 부합하는 것 같다. 결론을 앞에서 이야기하고 근거를 이야기한 후 마지막에 한 번 더 결론을 이야기하는 것도 하나의 방법이 될 수 있겠다.<br>그래도 뚜렷한 결론이 있다면 다행이다. 결론마저 없는 글은 독자로 하여금 왜 글을 썼는지 모를 느낌을 안겨줄 수 있다.(최악의 경우 읽다가 중단하게 된다…ㅜㅜ) 글쓰기에 있어 결론도 중요하지만 이 글을 쓰는 목적이 명확해야 설령 목표가 글 뒤에 배치되었다고 해도 끝까지 읽을 수 있는 힘이 생기지 않을까?<br><div class="figure center" style="width:;"><a class="fancybox" href="kimchi.jpg" title="반전에 반전을 거듭하며 결론을 도무지 알수없는 레파토리는 김치싸대기를 던지던 아침 드라마가 어울린다.<br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14289808&memberNo=12508720" data-caption="반전에 반전을 거듭하며 결론을 도무지 알수없는 레파토리는 김치싸대기를 던지던 아침 드라마가 어울린다.<br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14289808&memberNo=12508720" data-fancybox="default"><img class="fig-img" src="kimchi.jpg" alt="반전에 반전을 거듭하며 결론을 도무지 알수없는 레파토리는 김치싸대기를 던지던 아침 드라마가 어울린다.<br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14289808&memberNo=12508720"><span class="image-caption">반전에 반전을 거듭하며 결론을 도무지 알수없는 레파토리는 김치싸대기를 던지던 아침 드라마가 어울린다.<br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14289808&memberNo=12508720</span></a><span class="caption">반전에 반전을 거듭하며 결론을 도무지 알수없는 레파토리는 김치싸대기를 던지던 아침 드라마가 어울린다.<br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14289808&memberNo=12508720</span></div><div style="clear:both;"></div></p><h5 id="✓-누가-읽게-되는-글인가"><a href="#✓-누가-읽게-되는-글인가" class="headerlink" title="✓ 누가 읽게 되는 글인가?"></a>✓ 누가 읽게 되는 글인가?</h5><p>글을 쓰는 사람(필자)이 있으면 글을 읽는 사람(독자)이 있기 마련. 대부분의 글들은 필자가 독자를 “설득”하기 위한 내용이 주를 이룬다. 독자가 한정적이라면. 예컨대, 주간 보고를 쓴다고 가정했을 때 독자는 오롯이 팀장님이 된다. 이런 경우 주저리주저리 쓰거나 다시 한번 묻게 되는 문장들보다는 팀장님이 정말 궁금해할 내용을 적어주는 게 좋다. 한 번 더 안 물어볼 수 있게 작성한 글을 팀장님의 위치에서 다시 한번 읽어보는 것도 하나의 방법이 될 수 있다.<br>만약 독자의 스펙트럼이 넓거나 기술 블로그처럼 불특정 다수라면 가장 지식이 없는 사람에게 쓰는 것처럼 글을 써보자. 가끔 너무 쉽고 자세히 써서 당신이 아마추어처럼 보일 것 같다는 우려를 할 수도 있다. 하지만 지금 글을 쓰는 당신이 적어도 글을 안 쓰고 읽기만 하는 독자보다는 가장 프로에 가깝다.<br>독자가 다 알 거라는 생각은 하지 말자. 최대한 쉽게. 처음 보는 사람도 보고 따라 하거나 이해가 되도록 눈높이를 낮춰서 쓰는 습관을 길러보자. 무려 당신의 글을 시간을 할애하면서까지 읽어주는데 최대한 친절해야 하지 않을까?</p><h5 id="✓-앵무새가-되지-말자"><a href="#✓-앵무새가-되지-말자" class="headerlink" title="✓ 앵무새가 되지 말자."></a>✓ 앵무새가 되지 말자.</h5><p>링크만 복붙하거나 소위 말해 펌 글, 정작 내용은 없고 코드만 덩그러니 있거나 단순히 “글쓰기”를 위해 쓰는 글들은 오히려 안 쓰는게 좋다.<br>글에는 자신만의 생각이 녹아있어야 한다고 생각한다. 그렇지 않고서는 따라쟁이 앵무새와 다를 게 없다. 어떠한 오픈소스를 도입하는 과정을 글로 썼다고 생각해보자. Step By Step으로 따라 할 수 있게 작성한 글일지라도 최소한 마지막에는 자신만의 생각이 정리되어 있어야 글을 쓰는 자신도, 글을 읽는 독자도 “마무리”가 될 수 있기 때문이다. 왜 오픈소스를 도입하게 되었고, 도입하는 과정에서의 문제, 도입하고 나서의 장점과 단점 등 이야기할 거리는 무궁무진하다.</p><h5 id="✓-글쓰기에도-호흡이-중요"><a href="#✓-글쓰기에도-호흡이-중요" class="headerlink" title="✓ 글쓰기에도 호흡이 중요"></a>✓ 글쓰기에도 호흡이 중요</h5><p>TV나 인터넷 영상들을 보고 있노라면 편집의 기술이 엄청나게 발전된 것을 체감할 수 있다. 혹시 체감하지 못했다면 화면의 전환이나 자막 등 너무 자연스러워서일 수 있다. 글쓰기에서도 이러한 전환이나 문장의 흐름, 호흡은 정말 중요하다.<br>이러한 글쓰기에서의 호흡은 문장 쪼개기, 단락 구분하기, 적절한 그림 및 표 활용 등 독자가 읽을 때 지루하지 않을 정도의 말 그대로 “숨 쉴 수 있는 타이밍”을 제공해야 한다. 읽을 때 집중이 잘 안되거나 어디까지 읽었지 하며 흐름이 끊긴 경우를 경험해 봤을 거라 생각이 든다. 사실 이 부분은 필자도 잘 안되긴 하지만 이번 포스팅처럼 말하고자 하는 메인 키워드 단위로 나눈다거나 약간의 위트를 더하기 위한 짤 같은 것도 이러한 “호흡”의 기술이라 생각한다.</p><h5 id="✓-퇴고-글쓰기의-가장-중요한-단계"><a href="#✓-퇴고-글쓰기의-가장-중요한-단계" class="headerlink" title="✓ 퇴고. 글쓰기의 가장 중요한 단계"></a>✓ 퇴고. 글쓰기의 가장 중요한 단계</h5><p>지금 이 글을 쓰는 순간에도 퇴고를 10번 이상 하는 것 같다. 필자가 생각하는 퇴고라 함은 쓴 글의 처음부터 끝까지 읽어보며 맞춤법이나 띄어쓰기 교정, 실제로 소리 내어 읽어보며 숨이 차거나 집중이 흐려지진 않은지 하는 일련의 과정을 말한다.<br>퇴고를 꼭 몇번 해야 한다는 정해진 규칙은 없지만 최소 3번은 하는 것 같다. 그러면서 더 중요한 것을 위로 올리고 불필요하게 글자 수만 늘린 건 없는지. 글의 목적과는 거리가 있는 문장은 없는지 등 우리가 서비스를 출시하기 위해 개발 환경에서 테스트를 하고 QA 단계를 거쳐 최종 운영환경에 릴리즈 하는것 처럼.<br>글쓰기는 말하고자 하는 것을 “텍스트”로 전달하는 아주 기본적이며 제한적인 수단이기 때문에 몇 번이고 읽어보면서 고칠 수 있는 부분은 최대한 고치자. 그러면서 글을 썼던 자신을 되돌아보며 무슨 생각으로 이런 글을 썼나 돌아보는 기회도 되고.</p><h5 id="✓-나만의-글쓰기-플랫폼을-찾자"><a href="#✓-나만의-글쓰기-플랫폼을-찾자" class="headerlink" title="✓ 나만의 글쓰기 플랫폼을 찾자."></a>✓ 나만의 글쓰기 플랫폼을 찾자.</h5><p>정말 다양한 글쓰기 플랫폼이 있다. Github, 네이버 블로그, 티스토리, 워드프레스 등 서버호스팅 비용 없이도 무료로 제공해주는 곳들인데 각 플랫폼 마다의 장단점이 있으니 자신에게 맞는 곳을 찾아서 글을 써보자. 특히 Github 블로그는 정말 다양한 방법으로 블로그를 만들 수 있고 테마 또한 무궁무진하며 웹에 대한 지식이 있다면 얼마든지 커스터마이징이 가능하다.<br>블로그를 만들었으면 검색에 잘 되도록 SEO 설정을 해두고 RSS를 만들어 국내 기술블로그를 모아둔 <a href="https://github.com/sarojaba/awesome-devblog" target="_blank" rel="noopener">awesome-devblog</a>에 자신의 블로그 정보에 대해 PullRequest를 날려보자. 그러면 필자가 만든 <a href="http://daily-devblog.com" target="_blank" rel="noopener">기술블로그 구독서비스</a>에서 여러 사람들에게 매일 오전 10시에 친절하게, 그것도 무료로 홍보를 해주기 때문이다. (갑 분 서비스 홍보, 후원좀…)<br>GA(Google Analytics)를 붙여 어디서 유입되고 얼마나 들어오는지 보는 재미도 쏠쏠하다. 필자도 처음엔 많아야 10명(그게 전부 필자였다는건 비밀)이었지만 점점 방문자수가 늘어나니 글을 좀더 재미있고 잘 써야겠다는 사명감과 책임감도 생겨서 초창기에 썼던 글과 요즘의 글을 비교를 해보면 글의 퀄리티가 훨씬 늘어난것 같다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><div class="figure center" style="width:;"><a class="fancybox" href="cyworld.jpg" title="무엇을 말하려는지의 글쓴이의 목적은 충분히 전달되었다. 오글거림도 함께. <br>출처 : http://m.news.zum.com/articles/25408896" data-caption="무엇을 말하려는지의 글쓴이의 목적은 충분히 전달되었다. 오글거림도 함께. <br>출처 : http://m.news.zum.com/articles/25408896" data-fancybox="default"><img class="fig-img" src="cyworld.jpg" alt="무엇을 말하려는지의 글쓴이의 목적은 충분히 전달되었다. 오글거림도 함께. <br>출처 : http://m.news.zum.com/articles/25408896"><span class="image-caption">무엇을 말하려는지의 글쓴이의 목적은 충분히 전달되었다. 오글거림도 함께. <br>출처 : http://m.news.zum.com/articles/25408896</span></a><span class="caption">무엇을 말하려는지의 글쓴이의 목적은 충분히 전달되었다. 오글거림도 함께. <br>출처 : http://m.news.zum.com/articles/25408896</span></div><div style="clear:both;"></div><p>우리는 사실 어렸을때부터 글쓰기를 해왔다. 어렸을적 그림일기부터 시작하여 사랑하는 사람에게 손편지를 쓰고 싸이월드에 흑역사를 만들었던 시절들. 개발자가 된, 혹은 이제 개발자가 되려는 사람들이 있다면 그냥 글이 아닌 자신이 가지고 있는 기술에 대한 글을 써보는건 어떨까. Stack Overflow Driven Development (SODD) 라는 말이 있듯이 개발은 사실 엄청난 성능과 최적의 알고리즘을 요하는게 아니라면 개발자 간의 경쟁력은 일반적인 개발실력 이외엔 시간과 경험의 차이인것 같다. 여기에 글쓰기 연습을 하며 보다 논리적이고 정리하는 습관을 기른다면 이또한 남들과는 다른 나만의 무기가 될수 있지 않을까 하는 생각을 해본다.<br>이 글을 읽는 독자분들 중 자신만의 기술블로그가 없다면 지금 당장이라도 시작하라고 권하고 싶다. 첫 시작은 어렵겠지만 자신만의 스타일로 “글쓰는 개발자”가 되는데 건투를 빈다.</p><hr><p># 참고<br><a href="https://www.44bits.io/ko/post/8-suggestions-for-tech-programming-blog" target="_blank" rel="noopener">좋은 기술 블로그를 만들어 나가기 위한 8가지 제언</a><br><a href="https://book.naver.com/bookdb/book_detail.nhn?bid=13673719" target="_blank" rel="noopener">강원국의 글쓰기 : 남과 다른 글은 어떻게 쓰는가</a><br><br><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;신입시절. 배워야 할 것도 회사 업무도 많아 허우적대던 때가 있었다. 그렇게 하루에 3~4시간 자며 정신없이 하루를 보내던 날 문득 동기 형이 “개발자는 기술 블로그를 해야 돼!”라는 전혀 이해가 안 되는 말을 해온다. 이렇게 바빠 죽겠는데 블로그에 글까지 쓰라고?
    
    </summary>
    
      <category term="blog" scheme="https://taetaetae.github.io/categories/blog/"/>
    
    
      <category term="writing" scheme="https://taetaetae.github.io/tags/writing/"/>
    
      <category term="blog" scheme="https://taetaetae.github.io/tags/blog/"/>
    
  </entry>
  
  <entry>
    <title>더이상 기다리지 않아도 되는 배치 무중단 배포</title>
    <link href="https://taetaetae.github.io/2019/10/13/batch-nondisruptive-deploy/"/>
    <id>https://taetaetae.github.io/2019/10/13/batch-nondisruptive-deploy/</id>
    <published>2019-10-13T06:46:12.000Z</published>
    <updated>2019-11-04T01:03:44.746Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://taetaetae.github.io/2019/09/29/woowabros-spring-batch/">지난 포스팅</a>, 그러니까 우아한 형제들에서 초대를 받아 Spring batch 에 대한 테크세미나에 다녀 왔다. 그 중 가장 인상깊었던 부분이 바로 <code>무중단 배포</code>. 차일피일 미루다 필자가 속한 팀에서도 배포때마다 가장 불편을 느끼고 있었던 부분이었기도 했고<a id="more"></a>, <code>그런가보다</code> 하며 개념만 알고 넘어가기엔 무언가 양심에 찔려 직접 무중단 배포를 할 수 있도록 구성을 해보고 테스트까지 해보고자 한다.</p><h3 id="상황-및-문제점"><a href="#상황-및-문제점" class="headerlink" title="# 상황 및 문제점"></a># 상황 및 문제점</h3><p>리눅스 서버에 Jenkins가 설치되어 있고, Spring batch 모듈을 실행시키고 있다. 수동으로 실행을 하거나, Jenkins RestApi를 이용해서 실행을 할 수 있지만 주로 정해진 시간 즉, 스케쥴링에 의해 실행되곤 한다. 스케쥴링의 가장 작은 단위는 1분단위 배치도 있기 때문에 24시간 멈추지 않고 실행되고 있다고 무방하다. 하지만 배치 모듈이 수정되고, 배포를 하기 위해서는 다음과 같은 시나리오로 진행이 된다.</p><ol><li>Jenkins 설정의 <code>끄기전 준비</code> 를 실행하여 더이상 Jenkins에 의해 Spring batch 모듈(이하 Job)이 실행되지 않도록 한다.</li><li>새로운 Job은 더이상 실행되지 않지만 이미 실행중이였던 Job 은 강제로 중단을 하거나 Job 이 끝날때까지 기다린다.</li><li>실행중인 Job이 없을 경우 이제 배포를 진행한다.</li><li>배포가 완료되면 Jenkins 설정의 <code>끄기전 준비</code>를 해제한다.</li></ol><div class="figure center" style="width:;"><a class="fancybox" href="wait.jpg" title="실행중인 Job이 안끝나면 마냥 기다릴텐가? <br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14100660&memberNo=2032633" data-caption="실행중인 Job이 안끝나면 마냥 기다릴텐가? <br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14100660&memberNo=2032633" data-fancybox="default"><img class="fig-img" src="wait.jpg" alt="실행중인 Job이 안끝나면 마냥 기다릴텐가? <br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14100660&memberNo=2032633"><span class="image-caption">실행중인 Job이 안끝나면 마냥 기다릴텐가? <br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14100660&memberNo=2032633</span></a><span class="caption">실행중인 Job이 안끝나면 마냥 기다릴텐가? <br>출처 : https://m.post.naver.com/viewer/postView.nhn?volumeNo=14100660&memberNo=2032633</span></div><div style="clear:both;"></div><p>실행되는 Job을 중단하지 못하는 상황 즉, 실행중에 중단하면 트랜잭션이 깨져 무조건 기다려야만 하는 상황이라면 배포 또한 계속 지연될 수 밖에 없는 상황인 것이다. Spring boot에 java config 를 활용하고 딱 <code>jar</code> 파일 하나를 실행하는 방식이라면 <code>jar</code>파일을 바꿔치기 하는 식으로 고민을 해볼수도 있을것 같다. 하지만 Legacy 코드가 아직 존재하여 일반 Spring 에 xml 로 config 하는 방식으로 운영중이라 <code>jar</code>파일 하나만 바꿔치기 하기엔 무리가 있는 상황. </p><p>은총알처럼 어디에서나 사용이 가능한 만병통치약 같은 방법은 없다. 언제나 그랬듯 현재 시스템(xml config 방식)에 가장 최적화된 방법, 그리고 java config 방식에서도 사용이 가능할것 같은 방법을 생각해 보았다.</p><h3 id="무중단-배포를-가능케-하는-3가지-핵심"><a href="#무중단-배포를-가능케-하는-3가지-핵심" class="headerlink" title="# 무중단 배포를 가능케 하는 3가지 핵심"></a># 무중단 배포를 가능케 하는 3가지 핵심</h3><p><strong>1. 배포를 매번 새로운 경로에 배포한다.</strong><br>각 회사마다, 그리고 서비스마다 정말 다양한 배포 시스템이 있다. 그들의 공통점은 원격서버의 <code>특정 경로</code>에 빌드된 파일들을 밀어 넣어준다는 것. 시나리오는 다음과 같다.</p><ol><li>배포할때마다 별도의 디렉토리를 생성한뒤 심볼릭 링크를 연결해준다.</li><li>배포는 <code>1</code>에서 연결한 심볼릭 링크에 배포되도록 설정, 결국 매번 만들어지는 디렉토리에 배포가 되게 된다.</li></ol><p>여기서 중요한점은 “배포할 때마다 새로운 디렉토리에 배포가 된다” 와 배포시에는 항상 심볼릭 링크에만 배포를 하면 되기 때문에 “배포시스템이 새로 만들어지는 디렉토리의 경로를 몰라도 무방하다”는 점이다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> /~~~/deploy/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 임시 디렉토리</span></span><br><span class="line">DIRECTORY_NAME=batch_$(/bin/date +%Y%m%d%H%M%S)</span><br><span class="line">mkdir <span class="variable">$DIRECTORY_NAME</span></span><br></pre></td></tr></table></figure></p><p>위 쉘 스크립트를 실행하면 batch_20191012205218 와 같은 디렉토리가 생성이 된다. 심볼릭 링크 관련해서는 바로 아래 이어서 설명하겠다.</p><p><strong>2. 심볼릭 링크의 원래 링크를 즉시 변경</strong><br>보통 심볼릭 링크 (즉, 바로가기) 의 경로를 변경하기 위해서는 아래처럼 지웠다가 삭제하는 식으로 했었는데<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir directory_a</span><br><span class="line">$ mkdir directory_b</span><br><span class="line">$ ln -s directory_a asdf</span><br><span class="line">$ ll</span><br><span class="line">asdf -&gt; directory_a</span><br><span class="line">directory_a</span><br><span class="line">directory_b</span><br><span class="line"></span><br><span class="line"><span class="comment"># directory_a 에서 directory_b 로 바꾸는 경우 (심볼릭 링크 자체를 삭제하고 다시 심볼릭 링크 생성)</span></span><br><span class="line">$ rm asdf</span><br><span class="line">$ ln -s directory_b asdf</span><br><span class="line">$ ll</span><br><span class="line">asdf -&gt; directory_b</span><br><span class="line">directory_a</span><br><span class="line">directory_b</span><br></pre></td></tr></table></figure></p><p>이렇게 되면 삭제하고 ~ 다시 만들어지는 타이밍에 배포가 되거나 실행이 되는 즉, 해당 경로에 엑세스 하는 경우 이전의 경로를 바라본다거나 의도했던 방식으로 실행이 되지 않는 상황이 발생한다. (찰나의 타이밍 이지만 필자는 이러한 문제로 이전의 경로를 바라보는 문제가 발생했었다.) 그래서 ln 의 옵션중인 <code>-Tfs</code>옵션으로 즉시 변경을 해주도록 하자. (<a href="https://linux.die.net/man/1/ln" target="_blank" rel="noopener">ln man 참고</a>)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 만든 임시 디렉토리로 배포될수 있도록 설정한다.</span></span><br><span class="line">ln -Tfs /deploy/<span class="variable">$DIRECTORY_NAME</span> /~~~/deploy/batch</span><br></pre></td></tr></table></figure></p><p><strong>3. 심볼릭 링크가 가리키는 원래 링크에서 실행</strong><br>리눅스 명령어 중에 <a href="https://linux.die.net/man/1/readlink" target="_blank" rel="noopener">readlink</a>라는게 있다. 실제 링크를 얻어오는 명령어 인데 이를 활용하여 위에서 설정해둔 심볼릭 링크의 실제 링크(최신 배포된 경로)를 가져오고 그곳에서 Spring batch 모듈을 실행하는 식으로 구성을 해보자.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">BASEDIR=`readlink -f $(dirname <span class="variable">$0</span>)` <span class="comment"># -f 옵션 : 전체경로</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$BASEDIR</span> <span class="comment"># 이후 Spring batch jar 실행</span></span><br></pre></td></tr></table></figure></p><p>이렇게 되면 Job이 실행중이라도 기존에 실행중인 Job은 기존 모듈을 바라보고 실행이 되고, 도중에 새로 배포가 되어도 기존 실행되는 Job에는 영향을 주지 않으며(심볼릭 링크에 연결되었던 과거 배포 경로에서 실행되고 있기 때문) 새롭게 배포된 후 Job이 실행될때도 배포된 경로의 &gt; 심볼릭 링크의 &gt; 실제 링크 즉, 새롭게 배포된 경로에서 실행되기 때문에 무중단 배포가 가능하게 된다.</p><h3 id="전체-흐름"><a href="#전체-흐름" class="headerlink" title="# 전체 흐름"></a># 전체 흐름</h3><p>핵심만 설명하다보니 전체적으로 어떻게 돌아가는지 이해를 못하셨을 분들을 위해 전체 흐름에 대해 설명을 해보고자 한다.<br><strong>1. 배포 전</strong><br>  임시 디렉토리를 생성하고, 그곳에 배포가 될 수 있도록 심볼릭 링크를 연결해준다.<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> /~~~/deploy/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 임시 디렉토리</span></span><br><span class="line">DIRECTORY_NAME=batch_$(/bin/date +%Y%m%d%H%M%S)</span><br><span class="line">mkdir <span class="variable">$DIRECTORY_NAME</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 만든 임시 디렉토리로 배포될수 있도록 설정한다.</span></span><br><span class="line">ln -Tfs /~~~/deploy/<span class="variable">$DIRECTORY_NAME</span> /~~~/deploy/batch</span><br></pre></td></tr></table></figure></p><p><strong>2. 배포</strong><br>  배포 시스템에 의해 <code>/~~~/deploy/batch</code> 로 배포되도록 한다.</p><p><strong>3. 배포 후</strong><br>  이후 배포 실행은 새롭게 배포된 경로에서 실행되도록 심볼릭 링크를 수정해준다.<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> /~~~/deploy/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 배포된 경로를 실행할 경로로 변경해준다.</span></span><br><span class="line">REAL_DIRECTORY_PATH=$(readlink -f /~~~/deploy/batch)</span><br><span class="line">ln -Tfs <span class="variable">$REAL_DIRECTORY_PATH</span> /~~~/deploy/batch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 예전에 배포된 폴더들을 삭제해준다. (최근 몇개까지만 지울것인가는 상황에 따라)</span></span><br></pre></td></tr></table></figure></p><p><strong>4. 배치 실행</strong><br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">BASEDIR=`readlink -f $(dirname <span class="variable">$0</span>)` <span class="comment"># -f 옵션 : 전체경로</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$BASEDIR</span> <span class="comment"># 이후 배치 실행 ( e.g. batch.jar xxxJob )</span></span><br></pre></td></tr></table></figure></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p><code>jar</code>파일이 실행되고 <code>JVM</code>에 올라가게 되면 <code>jar</code>파일을 삭제한다거나 위치를 이동시켜도 에러가 나거나 하지는 않지만 코드 내에서 상대경로같은 설정들이 있기 때문에 폴더 전체를 심볼릭 링크로 연결하고 그 안에서 실행되도록 수정하였다. 앞서 이야기 했지만 이러한 설계는 어디까지나 필자가 운영하고 있는 상황에 맞춘것이기 때문에 이를 어떻게 잘 <code>활용</code>하는가가 이번 포스팅에 주요 핵심이 될 수 있을것 같다.<br>항상 배포 할때마다 <code>예전에 그렇게 해왔기 때문에</code> 라는 핑계로 Job이 돌고있으면 기다렸다가 배포해야만 했던 필자 자신이 부끄러워진다. 시도조차 안해보고 그런가보다 하고 적응만 하려 하거나, 불편하지만 안불편한척 하는 그런 태도를 버려야 하지 않을까 하는 반성을 해보는 시간이 되었다.<br><br><br><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://taetaetae.github.io/2019/09/29/woowabros-spring-batch/&quot;&gt;지난 포스팅&lt;/a&gt;, 그러니까 우아한 형제들에서 초대를 받아 Spring batch 에 대한 테크세미나에 다녀 왔다. 그 중 가장 인상깊었던 부분이 바로 &lt;code&gt;무중단 배포&lt;/code&gt;. 차일피일 미루다 필자가 속한 팀에서도 배포때마다 가장 불편을 느끼고 있었던 부분이었기도 했고
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="batch" scheme="https://taetaetae.github.io/tags/batch/"/>
    
      <category term="jenkins" scheme="https://taetaetae.github.io/tags/jenkins/"/>
    
      <category term="linux" scheme="https://taetaetae.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>우아한 스프링 배치 테크세미나 정리 및 후기 (by 우아한 형제들)</title>
    <link href="https://taetaetae.github.io/2019/09/29/woowabros-spring-batch/"/>
    <id>https://taetaetae.github.io/2019/09/29/woowabros-spring-batch/</id>
    <published>2019-09-29T08:55:50.000Z</published>
    <updated>2019-09-30T04:22:41.750Z</updated>
    
    <content type="html"><![CDATA[<p>지난주 우아한 형제들에서 진행하였던 “9월 우아한 테크 세미나 - 우아한 스프링 배치” 에 다녀왔다. 필자에게 이번 9월은 정신이 어디에 있는지 모를만큼 바쁘고 힘들었지만 예전부터 궁금하기도 했고 <a id="more"></a>요즘들어 관심을 갖던 “배치 어플리케이션”을 어떻게 하면 “우아한 방법”으로 사용할 수 있을지에 대해 여러 생각들이 있었기에 큰 기대를 가지고 지옥철을 견디며 잠실 근처에 있는 우아한 형제들 작은집으로 가게 되었다.<br>어떤 내용을 발표하였는지에 대해 <code>기억잘하는 똑똑한 앵무새</code>가 되어 정리하기 보다 주요 포인트에 대한 생각과 함께 참여를 못한 분들 위해서라기 보다 내 스스로 정리를 하기 위해 포스팅을 작성해 보고자 한다.<br>(이번에도 불러주셔서 감사합니다 ^=^)</p><h3 id="인트로"><a href="#인트로" class="headerlink" title="# 인트로"></a># 인트로</h3><p>연사자 분은 워낙에 유명하신 분이라 별도의 설명이 필요 없이 운영하시는 <a href="https://jojoldu.tistory.com" target="_blank" rel="noopener">블로그 주소</a>로 대체를 해본다. 이번 행사에 초대되신 분들은 한번이라도 스프링 배치를 써분 분들을 대상으로 진행하게 되었다고 했는데 마침 필자도 팀 내에서 운영하고 있는 배치 어플리케이션을 보다 효율적이고 우아하게 바꿔보고자 하는 니즈가 있었기에 아마 초대된게 아닐까 싶다.<br><div class="figure center" style="width:;"><a class="fancybox" href="small_house.jpg" title="아기자기한 우아한 형제들 건물 내부" data-caption="아기자기한 우아한 형제들 건물 내부" data-fancybox="default"><img class="fig-img" src="small_house.jpg" alt="아기자기한 우아한 형제들 건물 내부"><span class="image-caption">아기자기한 우아한 형제들 건물 내부</span></a><span class="caption">아기자기한 우아한 형제들 건물 내부</span></div><div style="clear:both;"></div></p><p>더불어 발표전에 간략히 회사가 원하는 인재에 대하여 언급해주셨는데 그게 어찌나 공감이 가던지. 역시 생각이 남다른 회사구나 하고 다시한번 생각을.</p><blockquote><p>자기보다 경험이 “적은” 사람에게 “설득을 당할 수” 있어야 하고, 자기보다 경험이 “많은 사람을 설득” 시킬 수 있어야 한다.</p></blockquote><h3 id="기본편"><a href="#기본편" class="headerlink" title="# 기본편"></a># 기본편</h3><p>배치 어플리케이션이란 컴퓨터에서 사람와 상호작용없이 이어지는 프로그램(작업)들의 실행이라고 <a href="https://ko.wikipedia.org/wiki/%EC%9D%BC%EA%B4%84_%EC%B2%98%EB%A6%AC" target="_blank" rel="noopener">위키피디아</a>에 간결&amp;명료하게 정리되어 있다. 그만큼 일반적인 웹 어플리케이션과의 차이가 있는데 웹 어플리케이션은 실시간 처리가 기본이고 요청에 대한 응답을 제공해야 하니 아무래도 속도가 상대적이며 QA시 편한 부분이 있다. 그에 반해 배치 어플리케이션은 웹 어플리케이션에서 말하는 요청이라는 개념보다 후속처리에 가깝고, 속도 또한 절대적이며 QA가 복잡하다는게 특징이다. 따라서 테스트코드는 웹 어플리케이션 보다 배치 어플리케이션이 더 필요하다고 볼 수 있다.<br>배치 어플리케이션이 필요한 상황은 크게 두가지로 나눠 볼 수가 있다고 한다.</p><ul><li>일정 주기로 실행 되어야 할 때</li><li>실시간 처리가 어려운 대량의 데이터를 처리 할때</li></ul><p>평소 첫번째 상황만 생각하고 배치 어플리케이션을 작성하곤 했었는데 두번재 상황에 대해 생각에 생각을 더 해보니 스프링 배치를 간단하게만 (Tasklet) 사용하고 있는건 아닌가 하는 반성을 해보곤 했다. (Reader, Processor, Writer 등 다양한 레이어가 있는데도…)</p><p>특히 스프링 배치에서는 기본적으로 모든 데이터를 메모리에 쌓지 않는 조회방식라고 한다. (DB기준) Paging 혹은 Cursor로 pageSize만큼만 읽어오고 chunkSize만큼만 commit 하는 형태. 이러한 각 레이어별 size를 잘 조정하기만 해도 적은 노력으로 큰 성능을 얻을 수 있는 부분이 프레임워크를 사용하는 이유 아닐까 라고 생각해본다.</p><p>또한 <code>@JobScope</code> 나 <code>@StepScope</code>는 Late Binding 즉 배치 어플리케이션이 실행되는 시점이 아니라 Job 이 실행될때 생성이 되기 때문에 이를 활용하여 동적으로 reader / processor / wirter 레이어를 만들 수 있다고 한다.</p><h3 id="활용편"><a href="#활용편" class="headerlink" title="# 활용편"></a># 활용편</h3><p>스프링 배치를 이용한 배치 어플리케이션이 있고 이를 스케쥴링 등 관리를 해주는 도구들에 이야기를 해주셨다. </p><ul><li>Cron<ul><li>리눅스를 어느정도 사용해봤다면 알만한 리눅스 기본 스케쥴링 프로그램인 Cron.</li><li>필자도 Cron 으로 주기적으로 실행하도록 설정해보기도 하였지만 배치 어플리케이션의 특성상 로그 및 실행/종료 등 제한사항이 많은 건 사실인것 같다.</li></ul></li><li>Spring MVC + API Call<ul><li>주변에서 사용하고 있다고 하던 방식. 이 방식의 장점은 항상 떠있기 때문에 어플리케이션 구동시간이 별도로 필요 없다는 장점이 있지만 전반적인 관리가 어려운 단점이 있는것 같다.</li><li>물론 울며 겨자먹기 식으로 단점을 극복할 방법은 여러가지가 있겠지만 모든건 항상 Trade off</li></ul></li><li>Spring Batch Admin (Deprecated)<ul><li>예전 팀분이 알려주셔서 잠깐 봤던 부분이긴 한데 어느사이에 Deprecated 되었다고 한다. </li></ul></li><li>Quertz + Admin<ul><li><a href="http://www.quartz-scheduler.org/" target="_blank" rel="noopener">http://www.quartz-scheduler.org/</a></li><li>아주 오래전에 써본 기억이 있지만 배보다 배꼽이 더 큰 상황같았던 힘들었던 기억들만 남아있는 구현방법인것 같다. 여러 레이어를 혼용해서 쓰다보면 각 레이어간의 상호 연결성의 위배되는 경우가 많기에…</li></ul></li><li>CI Tools (Jenkins / Teamcity 등)<ul><li>아무래도 가장 추천할만한게 CI Tool 인것 같다. 그중에 필자도 Jenkins라는 툴을 너무 좋아하고.</li><li>유료 툴 중에 Teamcity 를 잠깐 언급해주셨는데 찾아보니 한번즈음 써보고 싶을만한 기능들이 있어보였다.</li></ul></li></ul><p>Jenkins 의 장점은 <del>말해뭐해</del> 정도로 배치 어플리케이션과 궁합이 너무 잘 맞는 툴인것 같다. (물론 다른 툴들도 있겠지만 필자<code>개취</code>라 넘어가도록 하자.) 특히 실행시 필요한 플러그인들이 다양하게 많이 있고, 실행방법 또한 수동/스케쥴링 으로 다양하게 할 수가 있으며 RestAPI 지원과 보안, 실행이력관리, 로그 등 최적화 되어있다고 해도 과언이 아닐정도로 다양한 장점들이 있는것 같다.</p><p>Jenkins 설정중에 Global properteis 을 통해 환경변수를 설정하는것도 가능하다고 설명해 주셨다. 또한 환경변수들의 묶음을 다시 환경변수로 재 정의해서 사용할 수 도 있고. 참 대단한 Jenkins. 필자는 이제까지 하나의 쉘스크립트를 만들고 공통으로 사용할 파라미터들을 스크립트 단에서 설정후에 Jenkins 에서 쉘스크립트를 실행하는 방식으로 구성하곤 하였는데 이렇게 Jenkins 의 환경변수를 이용하는 방법도 다른 측면에서 활용범위가 높을것 같아 좋아보였다.</p><p>무중단 배포에 대해 설명을 해주셨다. 이는 사실 스프링배치 나 Jenkins 와는 관련이 없지만 이 둘을 사용하면서 배포를 할때 리눅스의 명령어니 <code>readlink</code>와 <code>ln -s</code>를 활용하여 중단없이 배포를 할 수 있도록 한다고 한다. 필자는 이제까지 Jenkins의 <code>끄기전 준비</code>를 실행 하고 스케쥴러에 의해 다음 Job이 실행되지 않는것을 확인 후에 배포를 하곤 했었는데 이러한 기능을 통해 충분히 무중단 배포를 구성 해볼수도 있을껏 같았다. 이 부분은 별도의 포스팅으로 정리를 해볼까 한다.</p><div class="figure center" style="width:;"><a class="fancybox" href="seminar.jpg" title="정말 중요한 Jenkins의 장점과 멱등성" data-caption="정말 중요한 Jenkins의 장점과 멱등성" data-fancybox="default"><img class="fig-img" src="seminar.jpg" alt="정말 중요한 Jenkins의 장점과 멱등성"><span class="image-caption">정말 중요한 Jenkins의 장점과 멱등성</span></a><span class="caption">정말 중요한 Jenkins의 장점과 멱등성</span></div><div style="clear:both;"></div><p><code>멱등성</code>에 대해 설명해 주셨다. 필자도 같은 생각인데 배치 어플리케이션을 구성하면서 가장 중요시 생각해야할 개념이 <code>멱등성</code>인것 같다. 우선 <code>멱등성</code>이란 연산을 여러번 적용 하더라도 결과가 달라지지 않는 성질을 의미하는데 코드 내에 <code>LocalDateTime.now()</code>같은게 있다면 과거 기준으로 실행하고 싶어도 해당 코드로 인해 수정/배포를 하지 않고서는 할 수 없는 경우가 생기는것 같다. 그래서 제어할수 없는 코드는 제어할 수 있도록 파라미터를 받아 처리하는 형식으로 구성해야 좀더 효율적으로 실행할 수 있는 것 같다.</p><p>배치 어플리케이션에 대한 책을 추천해주셨다. <a href="https://www.apress.com/gp/book/9781484237236" target="_blank" rel="noopener">The Definitive Guide to Spring Batch</a>와 내년 상반기에 책을 출간할 예정이라고 하시는데 꼭 들여다 보고 싶을 책인것 같다. (국내 최초 스프링 배치에 대한 내용의 책!)</p><h3 id="오늘의-질문"><a href="#오늘의-질문" class="headerlink" title="# 오늘의 질문"></a># 오늘의 질문</h3><p>이번에도 어김없이 이 시간을 내것으로 만들기 위해 질문을 하였다. 이 세미나에 온 목적이기도 하다.<br>젠킨스로 스케쥴링을 하고, jar를 실행시켜 젠킨스에 로깅을 남기는게 일반적인것 실행방식 같은데 그러다보면 jar실행시 job과 관련없는 bean들이 뜨다보니 실행시간이 느려진다. 이부분은 어떻게 해소할수 있을까?<br>​라는 질문에 <code>@ConditionalOnProperty</code> 어노테이션을 활용하게되면 해당 Job 에서 필요한 bean 만 띄울수 있다고 하셨다.<br>필자가 운영하고 있는 스프링 배치 버전이 3.x 이기도 하고 멀티 모듈로 구성되어 있으며 (batch가 단독 컴포넌트가 아님…) 필요한 bean만을 지정하기에는 스파게티 코드가 될게 뻔한 상황인것 같아 질문의 답변에서 해법을 찾기에는 조금 힘들었지만 또 언제나 그랬듯 이러한 상황에서 해결방법을 찾아야 하는게 개발자의 숙명 아니겠는가. 좀더 고민해봐야할 부분인것 같다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>스프링 배치에 대한 기본개념과 관리도구를 활용해서 생생한 현장감과 함께 배치 어플리케이션의 운영 노하우를 들을 수 있어서 너무 좋았던 세미나였다. 이번에도 역시나 내가 고민하고 있던 문제는 누군가 이미 고민했던 문제라는것, 그리고 그러한 고민의 해결방법을 공유함에 있어 생겨나는 가치에 대해 다시한번 온몸으로 뜨거운 열정을 느낄수 있었던 날로 기억에 남을 것 같다.<br><div class="figure center" style="width:;"><a class="fancybox" href="think.gif" title="충분하면 만족해야만 할까?<br>출처 : https://vryjam.com/gif.php?id=ODWEBD0bmRGzTq5" data-caption="충분하면 만족해야만 할까?<br>출처 : https://vryjam.com/gif.php?id=ODWEBD0bmRGzTq5" data-fancybox="default"><img class="fig-img" src="think.gif" alt="충분하면 만족해야만 할까?<br>출처 : https://vryjam.com/gif.php?id=ODWEBD0bmRGzTq5"><span class="image-caption">충분하면 만족해야만 할까?<br>출처 : https://vryjam.com/gif.php?id=ODWEBD0bmRGzTq5</span></a><span class="caption">충분하면 만족해야만 할까?<br>출처 : https://vryjam.com/gif.php?id=ODWEBD0bmRGzTq5</span></div><div style="clear:both;"></div><br>다만, 이제까지 A라는 구조로 구성된 어플리케이션에 단순 기능 추가만 할게 아니라 정말 A라는 구조가 최선일까, A의 구조보다 보다 더 효율적이고 유연한 B 나 C 의 구조는 없을까 하는 이러한 고민을 계속 하려는 자세를 가져야 겠구나 하는 생각을 해본다.<br><br><br><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;지난주 우아한 형제들에서 진행하였던 “9월 우아한 테크 세미나 - 우아한 스프링 배치” 에 다녀왔다. 필자에게 이번 9월은 정신이 어디에 있는지 모를만큼 바쁘고 힘들었지만 예전부터 궁금하기도 했고
    
    </summary>
    
      <category term="review" scheme="https://taetaetae.github.io/categories/review/"/>
    
    
      <category term="batch" scheme="https://taetaetae.github.io/tags/batch/"/>
    
      <category term="jenkins" scheme="https://taetaetae.github.io/tags/jenkins/"/>
    
      <category term="spring" scheme="https://taetaetae.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>네트워크 모니터링이 궁금할땐 ? Packetbeat !</title>
    <link href="https://taetaetae.github.io/2019/09/08/network-monitor-by-packetbeat/"/>
    <id>https://taetaetae.github.io/2019/09/08/network-monitor-by-packetbeat/</id>
    <published>2019-09-08T09:11:34.000Z</published>
    <updated>2019-09-08T16:24:02.633Z</updated>
    
    <content type="html"><![CDATA[<p>모니터링은 서비스 로직 개발 만큼 한번씩 고민해보고 경험해 봤을 중요한 영역이라 할 수 있다. 그중 웹서버에서 제공해주는 엑세스 로그는 운영하고 있는 웹서비스에 대해 여러가지 측면에서 분석할 수 있는 가장 강력한 아이템 중에 하나라고 생각한다. <a id="more"></a>이를 통해 사용자들이 어떤 url을 많이 호출하고, 어떤 user-agent형태를 사용하는지 알게 되면 그에 따라 서비스 전략을 변경할수도 있고 악의적으로 공격적인 요청에 대해 웹서버단에서 차단을 할 수 있기 때문이다.<br>이렇게 <code>inbound 트래픽(외부에서 들어오는 요청)</code>에 대해서는 엑세스 로그를 잘 분석하면 기존의 웹 어플리케이션과는 전혀 무관하게 모니터링이 가능하지만 반대로 <code>outbund 트래픽(외부로 나가는 요청)</code>에 대해서는 어떤식으로 모니터링을 할 수 있을까? </p><div class="figure center" style="width:;"><a class="fancybox" href="passbook.jpg" title="월급통장의 inbound 트래픽보다 outbound 트래픽이 너무 많은 요즘...<br>이미지 출처 : https://www.app24moa.com/feedDetail/2/2002" data-caption="월급통장의 inbound 트래픽보다 outbound 트래픽이 너무 많은 요즘...<br>이미지 출처 : https://www.app24moa.com/feedDetail/2/2002" data-fancybox="default"><img class="fig-img" src="passbook.jpg" alt="월급통장의 inbound 트래픽보다 outbound 트래픽이 너무 많은 요즘...<br>이미지 출처 : https://www.app24moa.com/feedDetail/2/2002"><span class="image-caption">월급통장의 inbound 트래픽보다 outbound 트래픽이 너무 많은 요즘...<br>이미지 출처 : https://www.app24moa.com/feedDetail/2/2002</span></a><span class="caption">월급통장의 inbound 트래픽보다 outbound 트래픽이 너무 많은 요즘...<br>이미지 출처 : https://www.app24moa.com/feedDetail/2/2002</span></div><p>예컨데, 날씨 서비스를 하기 위해 외부에서 <code>서울날씨</code>라는 페이지를 조회했을 경우 기상청 API에서 넘겨받은 데이터를 가공하여 보여준다고 가정해보자. 이때 기상청에서 제공해주는 특정 API중에 어느 하나가 늦게 응답이 온다거나, 특정시간대에 에러응답을 받을경우 과연 이를 어떤식으로 모니터링 할수 있을까? 어플리케이션 코드에 <code>모니터링을 위한 코드</code>를 추가할 것인가? 혹 하나의 서버에서 A모듈은 java로, B모듈은 python으로 개발되었을 경우 각각 모듈마다 모니터링을 위한 코드를 추가하는 식으로 하다보면 비지니스 로직을 방해하거나 오히려 추가한 코드 또한 관리해야 하는 배보다 배꼽이 더 커져버릴 상황도 생길수 있다.<br>어플리케이션의 비지니스 로직과는 무관하게 서버 자체에서 외부로 나가는 네트워크 트래픽에 대해 모니터링을 할 수 있는 <code>가벼우면서도 심플한 모듈</code>을 찾고 싶었다. 어플리케이션의 개발언어가 무엇이든 상관없이 별도의 에이전트 형식으로 띄워두기만 하면 네트워크 트래픽을 수집 및 분석, 나아가서는 모니터링까지 할수있는… 그래서 찾다보니 역시나 이러한 고민을 누군가는 하고 있었고 오픈소스까지 되어있는 Elastic Stack 의 Beat중 <code>Packetbeat</code>라는 데이터 수집모듈을 알게 되었다.</p><blockquote><p>역시 내가 하고있는 고민은 이미 누군가 했던 고민들… 이러한 고민에 대해 해결하는 방법을 보다 빨리 찾는게 경쟁력이 될텐데…</p></blockquote><p>이번 포스팅에서는 Packetbeat 에 대해 간단히 알아보고 이를 활용하여 outbound 트래픽에 대해 모니터링을 해보며 어떤식으로 활용할 수 있는지에 대해 알아보고자 한다.</p><h3 id="Packetbeat"><a href="#Packetbeat" class="headerlink" title="# Packetbeat ?"></a># Packetbeat ?</h3><p>ElasticStack 중에 데이터 수집기 플랫폼인 <code>Beats</code>중 네트워크 트래픽 데이터에 대해 수집을 할 수 있는 데이터 수집기를 제공하고 있다. <a href="https://ko.wikipedia.org/wiki/Pcap" target="_blank" rel="noopener">pcap</a>라이브러리를 이용하여 서버의 네트워크 레벨에서 데이터를 수집 및 분석한 후 외부로(Elasticsearch, Logstash, Kafka 등) 전송해주는 <code>경량 네트워크 패킷 분석기</code>라고 <a href="https://www.elastic.co/kr/products/beats/packetbeat" target="_blank" rel="noopener">공식 홈페이지</a>에 소개되고 있다.<br>몇번 사용해보면서 느낀 장점들은 다음과 같다.</p><ul><li>설치 및 실행이 너무 간단하다.</li><li>설정값 튜닝을 통해 간단하지만, 그러한 간단함에 비해서 너무 강력한 수집이 가능하다.</li><li>앞서 이야기 했던 어플리케이션 코드와는 전혀 무관하게 작동한다.</li></ul><h3 id="무엇을-해볼것인가-a-k-a-목표"><a href="#무엇을-해볼것인가-a-k-a-목표" class="headerlink" title="# 무엇을 해볼것인가?! (a.k.a. 목표)"></a># 무엇을 해볼것인가?! (a.k.a. 목표)</h3><p>필자가 운영하는 <a href="http://daily-devblog.com" target="_blank" rel="noopener">Daily-DevBlog</a> 라는 서비스가 있다. <del>(갑분 서비스 홍보)</del> 여러 사람들의 rss를 조회하고 파싱해서 메일을 보내주는 서비스 인데, packetbeat 사용 예시를 들기위해 조금 변형하여 모든 rss를 접근하고 가장 최신글의 제목을 출력하는 아주 간단한 python 스크립트로 outbound 트래픽을 발생시켜 보고자 한다.<br>그리고 packetbeat 를 이용하여 외부로 호출되는 트래픽을 수집하고 Elasticsearch 로 인덱싱 하여 최종적으로는 어느 rss의 속도가 가장 느린지 실행되는 python코드와는 전혀 관련없이 모니터링 해보고자 한다.<br>python 코드는 다음과 같다.</p><blockquote><p>참고로 필자는 <code>awesome-devblog</code>의 운영자분께 해당 데이터 사용에 대해 허락을 받은 상태이다.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, yaml, feedparser</span><br><span class="line"></span><br><span class="line">blog_info_list_yml_url = <span class="string">'https://raw.githubusercontent.com/sarojaba/awesome-devblog/master/db.yml'</span></span><br><span class="line">blog_info_list_yml = requests.get(url=blog_info_list_yml_url).text</span><br><span class="line">blog_info_yaml_parse_list = yaml.load(blog_info_list_yml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> blog_info <span class="keyword">in</span> blog_info_yaml_parse_list :</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'rss'</span> <span class="keyword">not</span> <span class="keyword">in</span> blog_info.keys() <span class="keyword">or</span> <span class="keyword">not</span> blog_info[<span class="string">'rss'</span>]:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    rss_url = blog_info[<span class="string">'rss'</span>]</span><br><span class="line">    <span class="keyword">try</span> :</span><br><span class="line">        parse_feed = feedparser.parse(rss_url)</span><br><span class="line">    <span class="keyword">except</span> :</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    parse_feed_data =  parse_feed.entries[<span class="number">0</span>]</span><br><span class="line">    print(blog_info[<span class="string">'name'</span>], <span class="string">'|'</span>, parse_feed_data[<span class="string">'title'</span>], <span class="string">'|'</span>, parse_feed_data[<span class="string">'link'</span>])</span><br></pre></td></tr></table></figure><p>위 코드를 실행하면 아래처럼 아주 간단하게 <code>블로그 주인의 이름</code>과 <code>최신글 제목</code>, <code>링크</code>가 출력이 된다.</p><div class="figure center" style="width:;"><a class="fancybox" href="rss_python_script.jpg" title="그러고 보니 너무 오랜만에 글쓰네... (숙연)" data-caption="그러고 보니 너무 오랜만에 글쓰네... (숙연)" data-fancybox="default"><img class="fig-img" src="rss_python_script.jpg" alt="그러고 보니 너무 오랜만에 글쓰네... (숙연)"><span class="image-caption">그러고 보니 너무 오랜만에 글쓰네... (숙연)</span></a><span class="caption">그러고 보니 너무 오랜만에 글쓰네... (숙연)</span></div><h3 id="백문이-불여일견-백견이-불여일타"><a href="#백문이-불여일견-백견이-불여일타" class="headerlink" title="# 백문이 불여일견? 백견이 불여일타!"></a># 백문이 불여일견? 백견이 불여일타!</h3><p>언제 어디서부터 유래된 이야기 인지는 모르지만 “백번 듣는것이 한번 보는것보다 못하고, 백번 보는것이 한번 타자 치는것보다 못하다” 라는 <code>개발버전</code> 속담이 있다. 자, 위에서 정의한 목표를 이루기 위해 실제로 각종 모듈을 설치해 보도록 하자! ( 필자가 테스트 했던 서버의 환경은 CentOS 7.4 64Bit 이니 참고 )</p><ul><li><p>Elasticsearch<br>  이왕 설치하는거 가장 최신버전인 7.3.1을 설치해보자! (버전업이 빨라도 너~무 빨라…)</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 다운을 받고</span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.1-linux-x86_64.tar.gz</span><br><span class="line">// 압축을 푼다음</span><br><span class="line">tar -zxvf elasticsearch-7.3.1-linux-x86_64.tar.gz</span><br><span class="line">cd elasticsearch-7.3.1/conf</span><br><span class="line">// 각종 설정후</span><br><span class="line">vi elasticsearch.yml</span><br><span class="line">node.name: node-1</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">discovery.seed_hosts: [&quot;localhost&quot;]</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br><span class="line">// 실행</span><br><span class="line">bin/elasticsearch</span><br></pre></td></tr></table></figure><p>  <code>http://server-url:9200</code>접근시 아래처럼 나오면 설치 성공</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"name"</span>: <span class="string">"node-1"</span>,</span><br><span class="line"><span class="attr">"cluster_name"</span>: <span class="string">"elasticsearch"</span>,</span><br><span class="line"><span class="attr">"cluster_uuid"</span>: <span class="string">"---"</span>,</span><br><span class="line"><span class="attr">"version"</span>: &#123;</span><br><span class="line"><span class="attr">"number"</span>: <span class="string">"7.3.1"</span>,</span><br><span class="line">~~~</span><br><span class="line">&#125;,</span><br><span class="line">"tagline": "You Know, for Search"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Kibana</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 다운을 받고 </span><br><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-7.3.1-linux-x86_64.tar.gz</span><br><span class="line">// 압축을 푼 다음</span><br><span class="line">tar -zxvf kibana-7.3.1-linux-x86_64.tar.gz</span><br><span class="line">cd kibana-7.3.1-linux-x86_64/config</span><br><span class="line">   // 각종 설정후</span><br><span class="line">   vi kibana.yml</span><br><span class="line">server.host: &quot;~.~.~.~&quot;</span><br><span class="line">elasticsearch.hosts: [&quot;http://~.~.~.~:9200&quot;]</span><br><span class="line">// 실행</span><br><span class="line">bin/kibana</span><br></pre></td></tr></table></figure><p>  <code>http://server-url:5601</code>접근시 키바나 화면이 나오면 설치 성공</p></li><li><p>Packetbeat</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 다운을 받고</span><br><span class="line">wget https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-7.3.1-linux-x86_64.tar.gz</span><br><span class="line">// 압축을 푼 다음</span><br><span class="line">tar -zxvf packetbeat-7.3.1-linux-x86_64.tar.gz</span><br><span class="line">// 각종 설정후 실행 (root 권한으로 실행해야 함)</span><br><span class="line">sudo chown root:root packetbeat.yml</span><br><span class="line">sudo vi packetbeat.yml</span><br><span class="line">output.elasticsearch:</span><br><span class="line">  # Array of hosts to connect to.</span><br><span class="line">  hosts: [&quot;~.~.~.~:9200&quot;]</span><br><span class="line">sudo ./packetbeat -e -c packetbeat.yml</span><br></pre></td></tr></table></figure><p>  이렇게 하고나서 키바나에 가보면 아래처럼 Packetbeat 인덱스 패턴을 만들수 있고 수집이 되고있는것 까지 확인 가능하다.</p>  <div class="figure center" style="width:;"><a class="fancybox" href="packetbeat_es_kibana.jpg" title="데이터가 엄~청 다양하고 많이 수집된다." data-caption="데이터가 엄~청 다양하고 많이 수집된다." data-fancybox="default"><img class="fig-img" src="packetbeat_es_kibana.jpg" alt="데이터가 엄~청 다양하고 많이 수집된다."><span class="image-caption">데이터가 엄~청 다양하고 많이 수집된다.</span></a><span class="caption">데이터가 엄~청 다양하고 많이 수집된다.</span></div></li></ul><h3 id="무엇을-모니터링-할-수-있을까"><a href="#무엇을-모니터링-할-수-있을까" class="headerlink" title="# 무엇을 모니터링 할 수 있을까?"></a># 무엇을 모니터링 할 수 있을까?</h3><p>이제 각종 구성은 했으니 처음에 목표한 <code>어느 rss가 가장 느린가</code>를 체크해 볼 시간이다. python 스크립트를 돌리면 packetbeat 에 의해 네트워크 트래픽이 수집~분석~Elasticsearch에 인덱싱이 되고 이를 키바나의 비쥬얼라이즈를 통해 적절하게 만들어보면 아래처럼 너무나도 간단하게 어느 rss의 응답속도가 가장 느린지 확인할 수 있다. <code>event.duration</code> 필드는 기본적으로 nano second 이다보니 아래 그림에서는 2.6초가 가장 오래걸린 rss url 이라 볼 수 있다.<br><div class="figure center" style="width:;"><a class="fancybox" href="visualize.jpg" title="보라, 키바나의 강력한 비쥬얼라이즈 기능을! (아 눈부셔)" data-caption="보라, 키바나의 강력한 비쥬얼라이즈 기능을! (아 눈부셔)" data-fancybox="default"><img class="fig-img" src="visualize.jpg" alt="보라, 키바나의 강력한 비쥬얼라이즈 기능을! (아 눈부셔)"><span class="image-caption">보라, 키바나의 강력한 비쥬얼라이즈 기능을! (아 눈부셔)</span></a><span class="caption">보라, 키바나의 강력한 비쥬얼라이즈 기능을! (아 눈부셔)</span></div></p><p>한가지 더, packetbeat를 설치하고 기본 설정으로 실행하게 되면 불필요한(outbound 트래픽만을 수집하겠다던 목표와는 무관한) 데이터들도 수집되다보니 아무래도 cpu에 불필요한 부하가 발생할수 있고(아무래도 모든 네트워크 트래픽을 트래킹 하고 분석해야하니…) Elasticsearch 에도 불필요한 데이터가 인덱싱 되곤 한다. 그래서 지금의 Packetbeat 뿐만 아니라 오픈소스를 사용할 경우엔 설정값들을 정확히 알고 목적에 맞는 커스터마이징은 필수인듯 하다. 필자는 http의 outbound 트래픽만을 보고 싶었기 때문에 아래처럼 packetbeat 설정을 하고 다시 실행 해보면 Elasticsearch 에 수집되는 도큐먼트 사이즈가 확연하게 차이나는 것을 확인할 수 있다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">packetbeat.protocols: # 아래 2개 이외에는 전부 주석처리</span><br><span class="line">- type: http</span><br><span class="line">  ports: [80] # 80 port 의 http를 수집하겠다.</span><br><span class="line">- type: tls</span><br><span class="line">  ports:</span><br><span class="line">     - 443   # 443 의 tls를 수집하겠다.</span><br><span class="line"></span><br><span class="line">processors:</span><br><span class="line">  - drop_event.when.equals.network.direction : &quot;inbound&quot; # inbound는 수집하지 않겠다.</span><br></pre></td></tr></table></figure></p><div class="figure center" style="width:;"><a class="fancybox" href="packetbeat_config.jpg" title="좌측이 기본, 우측이 불필요 데이터 제외하고 나서의 수집 상태" data-caption="좌측이 기본, 우측이 불필요 데이터 제외하고 나서의 수집 상태" data-fancybox="default"><img class="fig-img" src="packetbeat_config.jpg" alt="좌측이 기본, 우측이 불필요 데이터 제외하고 나서의 수집 상태"><span class="image-caption">좌측이 기본, 우측이 불필요 데이터 제외하고 나서의 수집 상태</span></a><span class="caption">좌측이 기본, 우측이 불필요 데이터 제외하고 나서의 수집 상태</span></div><p>사실 위 설정값은 <a href="https://www.facebook.com/groups/elasticsearch.kr/permalink/2384124035006756/" target="_blank" rel="noopener">페이스북 한국 Elasticsearch 유저그룹</a>에 문의해서 알게된 내용이다. 역시 커뮤니티 파워, 집단지성의 힘을 다시한번 느낄 수 있었다. (모르면 물어보자! + 문제에 대해 좀더 잘 검색하도록 노력하자!)</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>Packetbeat 을 사용하면서 가장 좋았던 점은 기존 로직과는 전혀 무관하게 작동하는 점이 가장 좋았다. 이러한 점은 어느 상황에서도 서비스 코드 디펜던시가 없어 자유롭게 활용이 가능하다는 뜻으로 해석을 해보곤 한다.<br><div class="figure center" style="width:;"><a class="fancybox" href="angry.jpg" title="마냥 좋다고 운영환경에 무작정 도입하면 이런 따사로운 눈빛을 받을 수 있으니 참고<br>이미지 출처 : https://namu.wiki/w/%EB%82%98%EB%8A%94%20%EC%9E%90%EC%97%B0%EC%9D%B8%EC%9D%B4%EB%8B%A4" data-caption="마냥 좋다고 운영환경에 무작정 도입하면 이런 따사로운 눈빛을 받을 수 있으니 참고<br>이미지 출처 : https://namu.wiki/w/%EB%82%98%EB%8A%94%20%EC%9E%90%EC%97%B0%EC%9D%B8%EC%9D%B4%EB%8B%A4" data-fancybox="default"><img class="fig-img" src="angry.jpg" alt="마냥 좋다고 운영환경에 무작정 도입하면 이런 따사로운 눈빛을 받을 수 있으니 참고<br>이미지 출처 : https://namu.wiki/w/%EB%82%98%EB%8A%94%20%EC%9E%90%EC%97%B0%EC%9D%B8%EC%9D%B4%EB%8B%A4"><span class="image-caption">마냥 좋다고 운영환경에 무작정 도입하면 이런 따사로운 눈빛을 받을 수 있으니 참고<br>이미지 출처 : https://namu.wiki/w/%EB%82%98%EB%8A%94%20%EC%9E%90%EC%97%B0%EC%9D%B8%EC%9D%B4%EB%8B%A4</span></a><span class="caption">마냥 좋다고 운영환경에 무작정 도입하면 이런 따사로운 눈빛을 받을 수 있으니 참고<br>이미지 출처 : https://namu.wiki/w/%EB%82%98%EB%8A%94%20%EC%9E%90%EC%97%B0%EC%9D%B8%EC%9D%B4%EB%8B%A4</span></div><br>필자는 최근 운영환경에도 packetbeat를 적용해서 outbound 트래픽을 모니터링 하고 문제가 있는 엔드포인트에 대해 자동으로 점검을 하는 시스템을 만들려고 하고 있는데, 네트워크 패킷을 전부 까보며(?) 아무래도 cpu 성능에 지장을 줄수밖에 없는 오픈소스 모듈이다보니 다양한 테스트를 통해 서비스 운영에 영향이 없도록 설정값들을 튜닝해 가며 적용해봐야 할 것 같다. (무작정 좋다고 적용하다 오히려 큰 화를 부를 수 있다…)</p><p>내가 맛있어 하는 음식이 남들도 맛있으리란 법 없듯, 소개팅에 나가기전 준비한 멘트가 전부 먹히리라는 법 없듯…<br>모든 상황에는 튜닝은 필수다. 그 튜닝을 얼마나 잘, 그리고 센스있게 하냐가 포인트!<br><br><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;모니터링은 서비스 로직 개발 만큼 한번씩 고민해보고 경험해 봤을 중요한 영역이라 할 수 있다. 그중 웹서버에서 제공해주는 엑세스 로그는 운영하고 있는 웹서비스에 대해 여러가지 측면에서 분석할 수 있는 가장 강력한 아이템 중에 하나라고 생각한다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="packetbeat" scheme="https://taetaetae.github.io/tags/packetbeat/"/>
    
      <category term="network" scheme="https://taetaetae.github.io/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>아파치 로드밸런싱으로 여러 WAS 운영하기</title>
    <link href="https://taetaetae.github.io/2019/08/04/apache-load-balancing/"/>
    <id>https://taetaetae.github.io/2019/08/04/apache-load-balancing/</id>
    <published>2019-08-04T10:50:43.000Z</published>
    <updated>2019-09-18T05:24:00.378Z</updated>
    
    <content type="html"><![CDATA[<p>웹서버 하나만 사용하거나 WAS 하나만을 사용하며 웹서비스를 운영하는 경우는 극히 드물다. 웹서버의 장점과 WAS의 장점 그 두마리의 토끼를 다 잡기 위해 보통 앞단에 웹서버를 두고 그 뒤에 WAS를 두며 서비스를 운영하곤 한다. 헌데 운영하는 서비스가 인기가 많아져(?) 사용량이 많아지다면 그만큼 응답이 느려 (TPS 등) 서버를 늘려야 하는 상황이 생긴다고 가정해보자.<a id="more"></a> (물론 서버를 늘리는 것보다 캐시를 적용하거나 로직을 바꿔보는 노력이 선행되야 하겠지만…) 당연히 서버부터 구매하며 “Scale Out”을 하려고 할것이다. 만약 원래 운영하던 서버가 너무 좋아서 CPU나 메모리 사용률이 거의 바닥이여도 서버를 구매해야 할까?<br>서버를 구매하게되면 결국 두개 이상의 서버가 운영될텐데 그 서버들을 앞에서 묶어주며 트래픽을 분산시켜주는 무언가가 필요하다. 그러한 기술을 바로 <code>로드밸런싱</code> 이라고 한다. 통상 L4 스위치를 활용하여 요청을 여러 서버들로 분산시키며 산술적으로는 서버 대수만큼 성능이 좋아지는 효과를 볼 수 있다.<br>하지만 앞서 말했듯 서버의 자원 사용률이 바닥일 정도로 거의 사용을 안할경우 서버를 구매하는건 너무나 비효율적이다. 이번 포스팅에서는 서버를 늘리지 않으면서 웹서버 중 아파치를 활용하여 여러 WAS를 운영하는 방법에 대해 알아보고자 한다. 서버 늘려야 하는 상황에서 사용해 볼 수 있는 나만의 좋은 무기(?)가 생긴게 아닐까 생각이 든다.</p><p>아파치는 <a href="https://httpd.apache.org/#apache-httpd-22-end-of-life-2018-01-01" target="_blank" rel="noopener">EOL</a>이 되었기 때문에 2.4버전으로 설치하고, WAS는 편의상 톰켓 최신버전으로 설치해서 동일한 서버에 아파치 한대와 톰켓 3대를 연동하는것을 목적으로 한다. 로드밸런싱이 어떤식으로 이루어 지고 하위에 연결된 톰켓을 컨트롤 하는 방법 또한 알아볼 예정이다.</p><blockquote><p>서버 환경 및 설치하게 될 각 버전은 다음과 같다.<br>서버 : CentOS 7.4 64Bit<br>apache : httpd-2.4.39<br>tomcat : apache-tomcat-8.5.43<br>tomcat-connectors(mod_jk) : 1.2.46</p></blockquote><h3 id="Apache-와-Tomcat-설치"><a href="#Apache-와-Tomcat-설치" class="headerlink" title="# Apache 와 Tomcat 설치"></a># Apache 와 Tomcat 설치</h3><p>필자의 포스팅에서 종종 나오는 부분이기도 하고, 구글링 해보면 바로 설치 방법을 쉽게 찾을 수 있겠지만 그렇다고 언급을 안하고 넘어가기엔 너무 불친절하니… 치트키처럼(?) 빠르게 정리해보자.</p><ul><li>Apache<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://apache.tt.co.kr//httpd/httpd-2.4.39.tar.gz</span><br><span class="line">$ tar -zxvf httpd-2.4.39.tar.gz</span><br><span class="line">$ ./configure --prefix=/home/~~~/apache</span><br><span class="line">$ make &amp;&amp; make install</span><br><span class="line">$ cd /home/~~~/apache/bin</span><br><span class="line">$ sudo chown root:계정명 httpd</span><br><span class="line">$ sudo chmod +s httpd</span><br><span class="line">$ vi /home/~~~/apache/conf/httpd.conf</span><br><span class="line">User 계정명</span><br><span class="line">Grop 계정명</span><br><span class="line">$ /home/~~~/apache/bin/apachectl start ← 실행</span><br></pre></td></tr></table></figure></li></ul><p>이렇게 설치를 한뒤 실행을 시키고 서버의 ip를 접속해보면 아래와 같은 화면을 볼 수 있다.</p><ul><li>Tomcat<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://mirror.apache-kr.org/tomcat/tomcat-8/v8.5.43/bin/apache-tomcat-8.5.43.tar.gz</span><br><span class="line">$ tar -zxvf apache-tomcat-8.5.43.tar.gz</span><br><span class="line">$ /home/apache-tomcat-8.5.43/bin/start.sh ← 실행</span><br></pre></td></tr></table></figure></li></ul><p>톰켓의 기본 http 포트인 8080으로 접속을 해보면 귀여운 고양이가 있는 톰켓 기본화면을 볼 수 있다.</p><h3 id="아파치와-톰켓-연동하기"><a href="#아파치와-톰켓-연동하기" class="headerlink" title="# 아파치와 톰켓 연동하기"></a># 아파치와 톰켓 연동하기</h3><p>아파치와 톰켓의 연동은 <code>mod_jk</code> 와 <code>mod_proxy</code> 등 다양한 모듈로 연동을 할 수 있는데 이번 포스팅에서는 <code>mod_jk</code> 를 활용하는 방법에 대해 알아보고자 한다. 우선 mod_jk 를 설치하자.</p><blockquote><p>간단히 mod_jk 는 컴파일, 설정 등 복잡하지만 톰켓 전용 바이너리 프로토콜인 AJP를 사용하기 때문에 높은 성능을 기대할수가 있다. mod_proxy 는 반면 기본으로 아파치에 탑재되어있는 모듈이기 때문에 별도의 모듈 설치가 필요 없고 설정도 간단하다는 장점이 있다. 각 연동방식의 장단점이 있기 때문에 본인이 운영하는 서버 상황에 맞추어 적용 할 필요가 있다.</p></blockquote><ul><li>mod_jk 설치<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://apache.tt.co.kr/tomcat/tomcat-connectors/jk/tomcat-connectors-1.2.46-src.tar.gz</span><br><span class="line">$ tar -zxvf tomcat-connectors-1.2.46-src.tar.gz</span><br><span class="line">$ cd tomcat-connectors-1.2.46-src/native</span><br><span class="line">$ ./configure --with-apxs=/home/~~~/apache/bin/apxs</span><br><span class="line">$ make &amp;&amp; make install</span><br><span class="line">$ /home/~~~/apache/modules 하위에 mod_jk.so가 생김</span><br></pre></td></tr></table></figure></li></ul><p>mod_jk 를 활용하면 AJP라는 통신으로 아파치와 톰켓이 연동되는데 톰켓의 기본 AJP 포트는 8009번임을 알고 다음처럼 설정을 해주자.</p><ul><li><p>apache/conf/workers.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">worker.list=tomcat1</span><br><span class="line">worker.tomcat1.port=8009</span><br><span class="line">worker.tomcat1.host=localhost</span><br><span class="line">worker.tomcat1.type=ajp13</span><br><span class="line">worker.tomcat1.lbfactor=1</span><br></pre></td></tr></table></figure></li><li><p>apache/conf/httpd.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LoadModule jk_module modules/mod_jk.so</span><br><span class="line">&lt;IfModule jk_module&gt;</span><br><span class="line">    JkWorkersFile    conf/workers.properties</span><br><span class="line">    JkLogFile        logs/mod_jk.log</span><br><span class="line">    JkLogLevel       info</span><br><span class="line">    JkMount /* tomcat1</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure></li></ul><p>이렇게 하고서 아파치와 톰켓을 재시작 후에 서버의 ip로 접속해보면 (별도의 port 없이) 톰켓 설정페이지로 랜딩이 되는것을 확인할 수 있다.</p><h3 id="로드밸런싱을-위한-작업"><a href="#로드밸런싱을-위한-작업" class="headerlink" title="# 로드밸런싱을 위한 작업"></a># 로드밸런싱을 위한 작업</h3><p>여기까지는 본 포스팅을 작성하기 위한 밑거름이라고 말할 수 있다. 이제 실제로 로드밸런싱을 해볼 차례.<br>앞서 톰켓 하나만 설치했는데 편의상 톰켓 3개를 설치해두자. (하나를 설치하고 cp -r 명령어를 활용하는게 빠르다.) 그 다음 각 톰켓의 모든 포트를 셋다 다르게 설정해야 하는데 겹치지 않도록 설정해 두고 (필자는 앞자리를 1,2,3 이런식으로 다르게 설정하였다.) 워커(workers.properties)를 아래처럼 설정해주자.</p><ul><li>apache/conf/workers.properties<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">worker.list=load_balancer</span><br><span class="line"></span><br><span class="line">worker.load_balancer.type=lb</span><br><span class="line">worker.load_balancer.balance_workers=tomcat1,tomcat2,tomcat3</span><br><span class="line"></span><br><span class="line">worker.tomcat1.port=18009</span><br><span class="line">worker.tomcat1.host=localhost</span><br><span class="line">worker.tomcat1.type=ajp13</span><br><span class="line">worker.tomcat1.lbfactor=1</span><br><span class="line"></span><br><span class="line">worker.tomcat2.port=28009</span><br><span class="line">worker.tomcat2.host=localhost</span><br><span class="line">worker.tomcat2.type=ajp13</span><br><span class="line">worker.tomcat2.lbfactor=1</span><br><span class="line"></span><br><span class="line">worker.tomcat3.port=38009</span><br><span class="line">worker.tomcat3.host=localhost</span><br><span class="line">worker.tomcat3.type=ajp13</span><br><span class="line">worker.tomcat3.lbfactor=1</span><br></pre></td></tr></table></figure></li></ul><p>이렇게 설정을 한 뒤 앞서 설정한 httpd.conf 에 JkMount 부분도 아래처럼 변경해주자.</p><ul><li>apache/conf/httpd.conf<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JkMount /* load_balancer</span><br></pre></td></tr></table></figure></li></ul><p>위 설정을 다시한번 살펴보자면, <code>/*</code>으로 들어오는 요청을 <code>load_balancer</code>라는 워커로 넘기는데 워커 설정에서는 로드밸런싱이 설정되어 있기 때문에 tomcat1, tomcat2, tomcat3 골고루 요청을 분산해준다는 의미이다.<br>tomcat 하위 logs 폴더에 보면 아래 기본 설정에 의해 엑세스 로그가 로깅이 되는데<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;</span><br><span class="line">               prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;</span><br><span class="line">               pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt;</span><br></pre></td></tr></table></figure></p><p>실제로 테스트를 해보면 다음처럼 9번의 요청을 3대의 톰켓에 골고루 요청된 것을 확인할 수 있다.<br><div class="figure center" style="width:;"><a class="fancybox" href="apache_lb_test.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="apache_lb_test.jpg" alt=""></a></div><div style="clear:both;"></div></p><h3 id="로드밸런싱을-컨트롤-하기-jkmanager"><a href="#로드밸런싱을-컨트롤-하기-jkmanager" class="headerlink" title="# 로드밸런싱을 컨트롤 하기 (jkmanager)"></a># 로드밸런싱을 컨트롤 하기 (jkmanager)</h3><p>위에서 알아본 mod_jk 를 활용한 로드밸런싱을 별도의 서버 재시작 없이 <code>컨트롤</code>이 가능하다고 한다. 이게 어떤것을 의미하냐면 연동된 톰켓 3대중에 한대를 별도의 서버 셧다운을 하지 않아도 제외시킬수 있으며 반대로 다시 투입도 가능하다는 이야기이다. 이를 활용해보면 서비스 배포를 할 경우 위와 같은 설정이 되어있을때 제외 &gt; 배포 &gt; 투입하는 식으로 서비스가 무중단 상태에서 배포가 될수 있는 효과를 얻을 수 있다.<br>설치는 별도로 하지 않아도 되고 mod_jk 모듈 내에 있기 때문에 별도의 설정만 추가해주면 된다.</p><ul><li><p>apache/conf/httpd.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule jk_module&gt;</span><br><span class="line">    JkWorkersFile    conf/workers.properties</span><br><span class="line">    JkLogFile        logs/mod_jk.log</span><br><span class="line">    JkLogLevel       info</span><br><span class="line">    JkMount /* load_balancer</span><br><span class="line"></span><br><span class="line">    &lt;Location /jkmanager/&gt;</span><br><span class="line">        JkMount jkstatus</span><br><span class="line">        Order deny,allow</span><br><span class="line">        Deny from all</span><br><span class="line">        Allow from 127.0.0.1</span><br><span class="line">        Allow from &#123;접근 가능한 IP&#125;</span><br><span class="line">    &lt;/Location&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure></li><li><p>apache/conf/workers.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">worker.list=jkstatus</span><br><span class="line">worker.jkstatus.type=status</span><br></pre></td></tr></table></figure></li></ul><p>설정에서 볼 수 있듯이 해당 설정은 다른측면에서는 상당히 취약점이 많은 부분이다. 해당 설정이 외부에 노출이 되어있다면 그 컨트롤을 서버 관리자가 아닌 다른 누군가가 할수 있기 때문에 꼭 Allow 설정으로 접근 제한을 해둬야 한다. 이렇게 하고 <code>서버 IP/jkmanager/</code> 을 접속해보면 “JK Status Manager” 이라는 문구와 함께 아파치에 연동된 톰켓의 상태를 한눈에 파악할 수 있다.<br><div class="figure center" style="width:;"><a class="fancybox" href="jk_status_manager.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="jk_status_manager.jpg" alt=""></a></div><div style="clear:both;"></div></p><p>여기서 tomcat1 좌측에 있는 <code>E</code>(=edit)를 클릭하고 Activation 값을 “Disabled” 으로 바꿔본 뒤 앞서 테스트한 방법을 다시 해보면 tomcat1 에는 엑세스가 들어오지 않고 9번 엑세스가 골고루 tomca2 와 tomcat3 으로 로드밸런싱이 된것을 확인할 수 있다.<br><div class="figure center" style="width:;"><a class="fancybox" href="apache_lb_test_jkmanager.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="apache_lb_test_jkmanager.jpg" alt=""></a></div><div style="clear:both;"></div></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>각 설정값들은 아무리 필자가 설명을 잘 해도 도큐먼트를 따라갈 수 없듯이 실제 각 도큐먼트를 보면서 설정값 하나하나를 조절해보며 운영하고 있는 서비스의 특징과 상황에 맞도록 맞춰가는것이 핵심일것 같다. (본 포스팅은 아주 가볍게 연동만 해보는 형태이고, 각 설정이나 워커들간의 우선순위 로드밸런싱 같은 경우는 직접 설정을 해가면서 확인이 필요하다. )<br>사실 이부분은 머릿속으로는 어떻게 하는구나라고 알고만 있었는데 실제로 해보니 각 설정들이 어떤 의미이고 어떻게 조절하면 보다 더 좋은 성능이나 다양한 이득을 취할수 있을것 같다는 생각을 해본다.</p><ul><li>참고 링크<br><a href="https://tomcat.apache.org/connectors-doc/reference/workers.html" target="_blank" rel="noopener">https://tomcat.apache.org/connectors-doc/reference/workers.html</a><br><a href="https://tomcat.apache.org/connectors-doc/common_howto/loadbalancers.html" target="_blank" rel="noopener">https://tomcat.apache.org/connectors-doc/common_howto/loadbalancers.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;웹서버 하나만 사용하거나 WAS 하나만을 사용하며 웹서비스를 운영하는 경우는 극히 드물다. 웹서버의 장점과 WAS의 장점 그 두마리의 토끼를 다 잡기 위해 보통 앞단에 웹서버를 두고 그 뒤에 WAS를 두며 서비스를 운영하곤 한다. 헌데 운영하는 서비스가 인기가 많아져(?) 사용량이 많아지다면 그만큼 응답이 느려 (TPS 등) 서버를 늘려야 하는 상황이 생긴다고 가정해보자.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="apache" scheme="https://taetaetae.github.io/tags/apache/"/>
    
      <category term="tomcat" scheme="https://taetaetae.github.io/tags/tomcat/"/>
    
      <category term="Load Balance" scheme="https://taetaetae.github.io/tags/Load-Balance/"/>
    
  </entry>
  
  <entry>
    <title>스프링을 활용한 대용량 파일 업로드 구현</title>
    <link href="https://taetaetae.github.io/2019/07/21/spring-file-upload/"/>
    <id>https://taetaetae.github.io/2019/07/21/spring-file-upload/</id>
    <published>2019-07-21T13:09:58.000Z</published>
    <updated>2019-07-21T16:28:50.271Z</updated>
    
    <content type="html"><![CDATA[<p>개발을 하다보면 실제로 직접 구현을 해본적은 없지만 여기저기서 들어본 지식과 그 동안의 짬밥(?)으로 추측해볼수 있는 부분들이 있다. 물론 모든일에 정답은 없겠지만 요즘 느끼는건 책에서 공부만 해본것과 다른 블로그들에서 눈으로만 보고 넘어가는것들 그리고 직접 손가락을 움직여가며 왜 여기서는 이 방법을 사용하지 고민하면서 구현을 해본다는건 정말 엄청나게 큰 차이가 있는것 같다. <a id="more"></a><br>웹 어플리케이션을 개발하다보면 한번 쯤 만나게 되는 <code>파일 업로드</code> 기능. 필자도 몇번 구현은 해봤지만 그냥 단순히 <code>구현</code>만 해본 상태였다가 최근에 그냥 파일 업로드가 아닌 <code>대용량</code> 파일 업로드에서의 문제가 발생하여 여기저기 삽질을 하게 되었고 정리도 해볼겸 스프링에서의 대용량 파일 업로드시 한번쯤 고려해봐야 할 부분에 대해 정리를 해보려고 한다.</p><blockquote><p>물론 구글에서 검색을 해보면 아마 필자가 쓴것 보다 더 자세하고 좋은 글들이 있겠지만 필자는 보다 <code>대용량</code>에 집중에서 작성해 보고자 한다. 명심하자. “아무리 흐린 잉크라도 좋은 기억력보다 낫다” 라는 말이 있듯이</p></blockquote><h3 id="스프링을-활용한-파일-업로드-구현"><a href="#스프링을-활용한-파일-업로드-구현" class="headerlink" title="# 스프링을 활용한 파일 업로드 구현"></a># 스프링을 활용한 파일 업로드 구현</h3><p>우선 완전 초기상태에서 시작하기 위해 스프링 부트 프로젝트를 만들고 간단하게 파일 업로드를 할 수 있는 form 페이지와 업로드 버튼을 눌렀을때 작동하게 되는 컨트롤러를 만들어 보자.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 너무 간단 ...</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/form"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">form</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"form"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/upload"</span>, method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(@RequestParam(<span class="string">"file"</span>)</span> MultipartFile multipartFile) </span>&#123;</span><br><span class="line">log.info(<span class="string">"### upload"</span>);</span><br><span class="line">File targetFile = <span class="keyword">new</span> File(<span class="string">"/home1/irteam/"</span> + multipartFile.getOriginalFilename());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">InputStream fileStream = multipartFile.getInputStream();</span><br><span class="line">FileUtils.copyInputStreamToFile(fileStream, targetFile);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">FileUtils.deleteQuietly(targetFile);</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"redirect:/form"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>upload</code> 요청이 들어오면 <code>file</code>이라는 이름의 파라미터로 <code>MultipartFile</code>을 받고 파일의 이름을 확인 후 스트림을 읽어 특정 경로에 파일로 저장하는 로직이다. 그다음 <code>/form</code>을 접속하게 되면 나오는 폼 화면을 만들자. 이것도 아주 심플하게!<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>파일 업로드<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/upload"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">value</span>=<span class="string">"파일 선택"</span> <span class="attr">name</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"업로드"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><code>multipart/form-data</code> 라는 Content-Type 을 명시해주고 파일을 선택하면 <code>/upload</code>로 POST요청을 하도록 설정한다. 이렇게 되면 너무 간단하게 + 이상없이 파일이 업로드가 잘 되니 이게 이야기 할 꺼리인가(?) 싶을정도로 심플하다.</p><h3 id="그런데-파일-크기가-크다면"><a href="#그런데-파일-크기가-크다면" class="headerlink" title="# 그런데 파일 크기가 크다면?"></a># 그런데 파일 크기가 크다면?</h3><div class="figure center" style="width:;"><a class="fancybox" href="omg.jpg" title="설마 파일 업로드 하는 용량이 크겠어?... 왠지 파일의 용량이 크면 문제있을것 같은데... <br>출처 : https://m.blog.naver.com/naibbo0407/30170815180" data-caption="설마 파일 업로드 하는 용량이 크겠어?... 왠지 파일의 용량이 크면 문제있을것 같은데... <br>출처 : https://m.blog.naver.com/naibbo0407/30170815180" data-fancybox="default"><img class="fig-img" src="omg.jpg" alt="설마 파일 업로드 하는 용량이 크겠어?... 왠지 파일의 용량이 크면 문제있을것 같은데... <br>출처 : https://m.blog.naver.com/naibbo0407/30170815180"><span class="image-caption">설마 파일 업로드 하는 용량이 크겠어?... 왠지 파일의 용량이 크면 문제있을것 같은데... <br>출처 : https://m.blog.naver.com/naibbo0407/30170815180</span></a><span class="caption">설마 파일 업로드 하는 용량이 크겠어?... 왠지 파일의 용량이 크면 문제있을것 같은데... <br>출처 : https://m.blog.naver.com/naibbo0407/30170815180</span></div><div style="clear:both;"></div><p>개발을 하다보면 항상 생각해야 할 부분중에 하나가 바로 확장성인것 같다. 이 부분에서 역시 문제가 되었던 것. 평소보다 용량이 큰 파일이 업로드가 되면서 (평소 3~400MB 였다가 3~4GB정도의 파일이 업로드가 되는 매직) 업로드가 안되는 상황이 발생하였다. 당연히 문제가 발생하면 누군가 말했듯 로그부터 살펴보았는데 Apache - (AJP) - Tomcat 으로 구성된 환경에서 tomcat 로그에 <code>### upload</code>라는 로그가 없고 아파치 로그엔 <code>502 에러</code>가 발생한 것이었다. 왜 톰켓 로그도 안남고 그전에 에러가 발생하였을까?<br>이때부터 (근거없는 추측을 하며…) 고난과 역경의 삽질을 하기 시작하게 된다. 톰켓 버전이 문제일까? 로그가 안찍혔다면 다른 필터나 인터셉터에서 무언가를 먹고(?)있는건 아닐까? 잠깐, 근데 원래 대용량 업로드가 되긴 해? 파일 업로드/다운로드 하는 사이트 보면 별도 프로그램으로 하던데… 꼬불꼬불 미로속을 헤메는것만 같았던 삽질의 문제는 결국 <code>메모리</code>에 있었다.<br>파일을 업로드 하게 되면 해당 내용을 우선 메모리에 담게 되고 다 담은 후 메모리에 있는 내용을 was에 전달한 뒤 HttpServletRequest 로 넘어오게 된다.(Apache &gt; Tomcat) 그런데 파일을 업로드 하면서 메모리에 파일이 써지다가 메모리 부족으로 OOM이 발생하게 되버린 것이었다. 또한 스프링 파일 최대크기를 별도로 지정하지 않고 있었기 때문에 메모리가 충분했다 하더라도 에러가 발생했을 상황이었다. ( <a href="https://spring.io/guides/gs/uploading-files/" target="_blank" rel="noopener">https://spring.io/guides/gs/uploading-files/</a> 참조 )<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.servlet.multipart.max-file-size</span><br><span class="line">spring.servlet.multipart.max-request-size</span><br></pre></td></tr></table></figure></p><p>그러다보니 웹 서버인 아파치에서는 was 에러인 <code>503</code>이 아닌 <code>502</code>라고 에러를 발생하던 것이였고 지나고 보면 정말 아무것도 아닌 간단한 설정들을 놓친 문제였는데 꽤나 긴 시간을 허비해야만 했던 안타깝지만 보람찼던 (응?) 트러블 슈팅이었다.</p><h3 id="삽질은-곧-경험이-되고-시야가-된다"><a href="#삽질은-곧-경험이-되고-시야가-된다" class="headerlink" title="# 삽질은 곧 경험이 되고 시야가 된다."></a># 삽질은 곧 경험이 되고 시야가 된다.</h3><p>legacy 로직이다보니 was가 파일 업로드 처리를 하게 되었는데 가급적이면 was가 처리하는것 보다는 static 파일을 처리할 수 있는 별도의 웹서버를 만드는게 어떨까 생각이 든다. (조금 알아보니 nodejs 모듈인 <a href="https://github.com/expressjs/multer" target="_blank" rel="noopener">multer</a> 라는게 있다.) 물론 파일 업로드 한 뒤에 별도의 로직을 처리하려면 was가 관여를 해야겠지만 이 부분은 설계를 어떻게 하냐에 따라 충분히 해결할 수 있을것으로 보인다. (웹서버에서 파일을 업로드 한 뒤 비동기로 파일 업로드 완료여부에 따라 was에서 처리를 한다거나 등…)<br>더불어 항상 어플리케이션을 만들때에는 <code>예외처리</code>라는 것을 생각하면서 개발해야한다고 느끼게 되었다. NPE 같은 사소한 로직에서의 예외처리부터 파일 업로드시 서버의 메모리를 생각할수 있는 시야. 이런게 경험이 아닐까 싶다.<br>또한 (잘 돌아가니까) 환경설정 값을 수정하지 않고 배포하는 것보단 가급적 어떤 설정값들에 의해서 어플리케이션이 돌아가는지 특히, 스프링 같은 프레임워크의 도움을 받는다면 해당 프레임워크의 설정값들을 수정하며 성능에 이득을 취할 부분들은 없는지 꼼꼼하게 개발하는 습관을 길러야 할 것 같다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;개발을 하다보면 실제로 직접 구현을 해본적은 없지만 여기저기서 들어본 지식과 그 동안의 짬밥(?)으로 추측해볼수 있는 부분들이 있다. 물론 모든일에 정답은 없겠지만 요즘 느끼는건 책에서 공부만 해본것과 다른 블로그들에서 눈으로만 보고 넘어가는것들 그리고 직접 손가락을 움직여가며 왜 여기서는 이 방법을 사용하지 고민하면서 구현을 해본다는건 정말 엄청나게 큰 차이가 있는것 같다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="spring" scheme="https://taetaetae.github.io/tags/spring/"/>
    
      <category term="fileupload" scheme="https://taetaetae.github.io/tags/fileupload/"/>
    
  </entry>
  
  <entry>
    <title>2019 상반기 리뷰 (feat. 글또)</title>
    <link href="https://taetaetae.github.io/2019/07/07/review-first-half-2019/"/>
    <id>https://taetaetae.github.io/2019/07/07/review-first-half-2019/</id>
    <published>2019-07-07T08:52:20.000Z</published>
    <updated>2019-07-07T15:10:13.467Z</updated>
    
    <content type="html"><![CDATA[<p>누구나 어렸을 땐 빨리 어른이 되고 싶어 하는 것 같다. 시간이 빨리 지나가길 바라고, 빨리 어른이 되고 싶다는 간절함이 있지만 이상하게도 그땐 시간이 천천히 가는 것처럼 느껴졌다. 반면, 시간이 천천히 갔으면 하는 때가 있다. 딱 지금. <a id="more"></a><br>남들은 <code>워어어어얼화아아수우우모옥금퇼</code> 이라고 부르며 시간이 느리게 간다고 빨리 주말이 왔으면 좋겠다고 하지만 요즘의 필자는 정 반대다. 방금 출근한 것 같은데 어느샌가 퇴근인사를 주고받고 있다. 무언가에 홀린 것 같다. 벌써 올해도 절반이 지나가고 뜨거운 여름과 함께 후반전이 시작되었다.</p><div class="figure center" style="width:;"><a class="fancybox" href="speed_time.jpg" title="그래서 빨리 지나갔나...<br>출처 : https://m.blog.naver.com/kong6482/220584667861" data-caption="그래서 빨리 지나갔나...<br>출처 : https://m.blog.naver.com/kong6482/220584667861" data-fancybox="default"><img class="fig-img" src="speed_time.jpg" alt="그래서 빨리 지나갔나...<br>출처 : https://m.blog.naver.com/kong6482/220584667861"><span class="image-caption">그래서 빨리 지나갔나...<br>출처 : https://m.blog.naver.com/kong6482/220584667861</span></a><span class="caption">그래서 빨리 지나갔나...<br>출처 : https://m.blog.naver.com/kong6482/220584667861</span></div><div style="clear:both;"></div><p>이제까지는 12월 말 즈음에 한 해를 바라보고 리뷰를 했었는데 <code>글또</code>라는 글쓰기 모임에 가입을 하게 되어 상반기 리뷰를 해보려 한다. 글또 모임의 첫 숙제가 상반기 리뷰 포스팅이다. 사실 리뷰를 상반기에 하던 연 말에 한 해 기준으로 하던 정해진 건 없지만 나를 다시 바라보고 다잡는 시간이 많을수록 보다 더 앞으로 가는데 힘이 될 거라는 데에는 이견이 없다.</p><h3 id="회사-속에서의-나"><a href="#회사-속에서의-나" class="headerlink" title="# 회사 속에서의 나"></a># 회사 속에서의 나</h3><div class="figure center" style="width:;"><a class="fancybox" href="office_work.jpg" title="회사에서는 회사일이 최우선!<br>출처 : https://m.blog.naver.com/hwee__/221191852972" data-caption="회사에서는 회사일이 최우선!<br>출처 : https://m.blog.naver.com/hwee__/221191852972" data-fancybox="default"><img class="fig-img" src="office_work.jpg" alt="회사에서는 회사일이 최우선!<br>출처 : https://m.blog.naver.com/hwee__/221191852972"><span class="image-caption">회사에서는 회사일이 최우선!<br>출처 : https://m.blog.naver.com/hwee__/221191852972</span></a><span class="caption">회사에서는 회사일이 최우선!<br>출처 : https://m.blog.naver.com/hwee__/221191852972</span></div><div style="clear:both;"></div><p>최근에 팀장님과 면담 중에 나온 이야기다. 신기하게도 군 시절 장기를 꿈꾸던 필자를 어서 전역하라고 권유하시던 대대장님께 매일같이 들었던 이야기와 비슷하다.</p><blockquote><p>“이제는 단순 개발만 하고 기능구현만 하는 것이 아니라 <code>그 이상</code>을 해야 할 시기가 다가온다.”<br> “사람들 관리가 될 수도 있고 어느 한 분야에 전문가가 되어야 할 수도 있고, 선택은 본인의 몫” </p></blockquote><p>사실 기능 구현이야 누구나 다 할 수 있다. 단지 경험에 따른 구현의 속도나 안정성의 차이가 아닐까 생각해본다. 그렇다면 <code>그 이상</code>은 어떻게 해야 할까? 정답은 없겠지만 필자는 <code>그 이상</code>을 해보려 우선 팀에 도움이 되기 위해 여러 가지 자동화 툴 들을 만든 것 같다. 보다 기능 개발에 집중하고 단순 반복적인 업무는 시스템이 할 수 있도록. 그렇게 툴들을 만들어 가며 생각하지 못한 부분들을 배우게 되고 나중에 그걸 또 사용하게 되는, 미래의 나를 위해 강제로 배우고 있는듯한 느낌이랄까. 아, 물론 회사 본연의 업무가 최우선이지만 말이다.<br>어쨌든 <code>시킨 일</code>은 우선 차질 없이 잘 하고 <code>시키지도 않은 일</code>을 찾아서 하려고 노력했던 것 같다. 팀을 위해서, 곧 나를 위해서.<br>적어도 회사에서 있는 시간 속에서는 다른 곳에 한눈 안 팔고 회사 업무에 전념하려고 노력했던 것 같다.</p><h3 id="외부-활동"><a href="#외부-활동" class="headerlink" title="# 외부 활동"></a># 외부 활동</h3><p>부족한 시간을 쪼개면서 밋업이나 세미나에 참여하곤 했었다. 그리고 마냥 듣고만 오진 않았고 “행사에 참여하면 무조건 질문 하나는 하자”라는 나와의 약속을 지키며 정리한 내용을 블로그에 포스팅하기도 하였다. </p><div class="figure center" style="width:;"><a class="fancybox" href="magarine.jpg" title="올해 첫 발표!" data-caption="올해 첫 발표!" data-fancybox="default"><img class="fig-img" src="magarine.jpg" alt="올해 첫 발표!"><span class="image-caption">올해 첫 발표!</span></a><span class="caption">올해 첫 발표!</span></div><div style="clear:both;"></div><p>디자이너와 개발자가 함께하는 투게더톤을 진행하기도 했었다. 투게더톤은 약 한 달 동안 진행되는 해커톤으로 하루 또는 무박 2일 동안 하는 기존 해커톤과 다르다. 이 기간 동안 팀 내에서 자유롭게 일정을 조정할 수 있다. 우리 팀은 약 7주에 걸쳐 “동네 마트 할인 정보를 알려주는 앱” 을 만들게 되었다. 필자는 API 전반에 대해 담당을 하였고 작은 부분이었지만 웹사이트도 간단하게 만들어 보았다. 아무것도 없는 백지상태에서 시작하려니 막막했지만 <a href="https://taetaetae.github.io/2019/05/19/d-light-togetherthon-2019/">후기</a>에서도 적었듯이 다시 해보라고 하면 머릿속에 전체 아키텍처가 그림으로 그려질 만큼 자신감이 생겼다. 특히 정말 좋은 팀원들과 함께 협업할 수 있어서 너무 좋았다.</p><h3 id="내공-연마"><a href="#내공-연마" class="headerlink" title="# 내공 연마"></a># 내공 연마</h3><p>한 달에 2개 이상 블로그 글을 작성하는 목표가 있었다. 그런데 지난달에 이사를 하다 보니 (핑계…) 목표를 달성 할 수가 없었다. 하지만 나름 퀄리티가 있는 글을 쓰려고 노력했고 PV도 작년보다 조금씩 오르고 있는 것 같아 내심 기분이 좋다. 그리고 작년 말부터 시작한 필자의 첫 토이프로젝트 인 <a href="http://daily-devblog.com" target="_blank" rel="noopener">기술블로그 구독서비스</a> 에 이런저런 기능을 추가하였다. 설마 1000명이 넘게 구독 하겠어?라고 생각했지만 이 글을 작성하고 있는 시점에서 1,569명이나 구독했다. 설마 1년 넘게 내가 이 프로젝트를 운영하겠어?라고 생각했지만 다음 주가 되면 딱 1년째. 신기할 따름이다. 마침 기회가 되어 GDG 주관으로 행사하는 <a href="https://festa.io/events/364" target="_blank" rel="noopener">모두의 TOY STORY: SIDE PROJECT 어디까지 가봤니?</a>라는 주제에 첫! 공식 발표자로써 발표를 할 수 있게 되어 너무나도 영광이다. 해당 발표 후기는 나중에 작성하는 것으로~</p><h3 id="글또-3기-다짐"><a href="#글또-3기-다짐" class="headerlink" title="# 글또 3기 다짐"></a># 글또 3기 다짐</h3><p><code>글쓰는 또라이가 세상을 바꾼다</code> 라는 페이스북 모임이 있다. (이번기수가 벌써 3기라고 한다 ㄷㄷ) 글또 라는 모임에 대해 간단히 정리를 해보면 다음과 같다.</p><ul><li>일정의 예치금을 먼저 저장한다.</li><li>2주 간격으로 블로그 글을 작성 + 2명의 글에 대해 서로 리뷰</li><li>PASS권은 2회 (다른사람들의 글에 리뷰를 많이 해주면 PASS 권을 부여)</li><li>글을 올리지 않았거나, 리뷰를 하지 않았을 경우 예치금에서 일부 삭감</li><li>마지막 날까지 진행하고 예치금을 다시 돌려받는 형식</li></ul><p>올해부터 블로그 포스팅을 좀 더 많이 하자고도 했고, 단순 횟수만 늘리는 것이 아닌 글쓰기에 대해서도 연습을 하고자 했는데 마침 딱 원하는 모임이 있어 시작을 하게 되었다.<br>이 모임에 참여하기 위해 무작정 2주마다 한 개의 글을 쓰지 않을 것이다. 배운 것을 기록하고 정리하는 습관을 기르기 위해 글을 쓸 것이다. 또, 양질의 글을 작성하기 위해 글쓰기 책들을 읽어야겠다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>우선 다음 주에 있을 발표 준비에 최선을 다하고, 여력이 되면 새로운 프로젝트를 시작하고 싶다. 회사에서는 회사일 열심히 하고 회사 밖에서는 나만의 인사이트를 찾기 위한 여정에 지치지 않도록 체력이며 정신력이며 갈고닦아야 할 것 같다. 운동도 다시 시작을 해야 할 텐데 . . . ㅠㅠ</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;누구나 어렸을 땐 빨리 어른이 되고 싶어 하는 것 같다. 시간이 빨리 지나가길 바라고, 빨리 어른이 되고 싶다는 간절함이 있지만 이상하게도 그땐 시간이 천천히 가는 것처럼 느껴졌다. 반면, 시간이 천천히 갔으면 하는 때가 있다. 딱 지금.
    
    </summary>
    
      <category term="blog" scheme="https://taetaetae.github.io/categories/blog/"/>
    
    
      <category term="review" scheme="https://taetaetae.github.io/tags/review/"/>
    
      <category term="글또" scheme="https://taetaetae.github.io/tags/%EA%B8%80%EB%98%90/"/>
    
  </entry>
  
  <entry>
    <title>Spring에서 Request를 우아하게 로깅하기</title>
    <link href="https://taetaetae.github.io/2019/06/30/controller-common-logging/"/>
    <id>https://taetaetae.github.io/2019/06/30/controller-common-logging/</id>
    <published>2019-06-30T09:39:47.000Z</published>
    <updated>2019-07-01T02:07:47.247Z</updated>
    
    <content type="html"><![CDATA[<p>스프링 기반의 웹 어플리케이션을 만들다 보면 요청을 처리하는데 맨 처음에 위치하고 있는 <code>Controller</code>(이하 컨트롤러)라는 레이어를 만들게 된다. 그럴때면 사용자가 어떤 요청(Request)을 하였는지에 대해 확인이 필요할 수 있다. <a id="more"></a> 물론 확인을 안해도 무방하지만 가급적 로깅은 시스템 로직에 영향을 주지 않는 범위에서 최대한 다양하게 <code>미리</code> 해두는게 나중에 유지보수시 편할 수 있다. (예전 조직장님께서 말씀하신게 아직도 머릿속에 꽉 자리잡고 있다…)<br>아~주 일반적으로, 컨트롤러에서는 다음과 같이 메소드 단위로 파라미터를 직접 로깅하게 된다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/test1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(@RequestParam String id)</span> </span>&#123;</span><br><span class="line">log.info(<span class="string">"id : &#123;&#125;"</span>, id);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"length : "</span> + id.length();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>이렇게 되면 사용자가 <code>GET /test1</code> 이라는 요청을 보낼때 어떤 파라미터로 호출하였는지에 대해 로깅이 남게 되는데 항상 <code>log.info(&quot;id : {}&quot;, id);</code> 과 같이 수동으로 로깅을 남겨야 하는 불편함이 생긴다. 물론 꼼꼼하게 메소드마다 로깅을 적어주면 전혀 문제될게 없지만 이러한 컨트롤러 ~ 메소드가 한두개가 아닌 수십 또는 수백개일 경우엔 그때마다 로깅을 적어줘야 하는 불편함이 있을 수 있다. 또한 자칫 깜박하고 로깅을 빼먹고 배포를 하게 된 경우 모니터링시 로깅을 하지 않아서 다시 로깅하고 배포를 하는, 별것도 아닌데(?) “정말 불편한” 상황이 있을 수 있다.<br>이번 포스팅에서는 사용자의 요청을 모니터링 하기 위해 컨트롤러마다 코드를 작성해가며 로깅을 하는것이 아니라 <code>HttpServletRequestWrapper</code> 라는 것과 <code>Filter</code>, <code>AOP</code>를 이용하여 <strong>Request의 정보를 한곳에서 우아하게 로깅하는 방법</strong>에 대해 알아보고자 한다.</p><h3 id="요구사항"><a href="#요구사항" class="headerlink" title="# 요구사항"></a># 요구사항</h3><div class="figure center" style="width:;"><a class="fancybox" href="bull_fighting.gif" title="와 개발하자아!<br>출처 : https://gfycat.com/ko/brightevilaoudad" data-caption="와 개발하자아!<br>출처 : https://gfycat.com/ko/brightevilaoudad" data-fancybox="default"><img class="fig-img" src="bull_fighting.gif" alt="와 개발하자아!<br>출처 : https://gfycat.com/ko/brightevilaoudad"><span class="image-caption">와 개발하자아!<br>출처 : https://gfycat.com/ko/brightevilaoudad</span></a><span class="caption">와 개발하자아!<br>출처 : https://gfycat.com/ko/brightevilaoudad</span></div><div style="clear:both;"></div><p>투우사가 흔드는 빨간 천을 보며 돌진하는 황소처럼 (쓰고보니 너무 TMI 같다….) 당장 코딩을 시작하며 개발을 할 수도 있지만 정작 원하는 기능이 무엇인지 천천히 정리하고 넘어갈 필요가 있는 것 같다. (어쩔땐 오히려 후자가 더 빠른 개발을 하게 되는것 같다.)</p><ol><li>GET, POST 등 다양한 http method 로 구현된 모든 컨트롤러의 파라미터와 기타 Request 정보가 로깅이 되야 한다.</li><li>컨트롤러, 메소드가 늘어날때마다 별도의 코드 추가 없이 한곳에서 공통적으로 로깅이 되야 한다.</li><li>URL 중 특정 패턴으로 들어오는 요청은 다른 방식으로 로깅을 하거나, 로깅에서 제외할 수 있어야 한다.</li><li>앞서 말했듯 다른 비지니스 로직에 영향을 주지 않아야 한다.</li></ol><h3 id="구현하기-Request-의-파라미터-정리"><a href="#구현하기-Request-의-파라미터-정리" class="headerlink" title="# 구현하기 - Request 의 파라미터 정리"></a># 구현하기 - Request 의 파라미터 정리</h3><p>Request 의 모든 로깅을 한곳에서 처리하기 위해서 filter(필터)를 활용하였다. 필터는 Dispatcher servlet의 앞단에 위치하고 있기 때문에 모든 정보를 확인할 수 있는데 용이하다. 물론 인터셉터를 활용해서도 방법이 있겠지만 본 포스팅 에서는 필터를 활용해서 구현하는것을 목적으로 한다. (사실 인터셉터로 몇번 시도해보다가 실패해서…유유 )</p><div class="figure center" style="width:;"><a class="fancybox" href="spring-request-lifecycle.jpg" title="Spring MVC Request Life Cycle<br>출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/" data-caption="Spring MVC Request Life Cycle<br>출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/" data-fancybox="default"><img class="fig-img" src="spring-request-lifecycle.jpg" alt="Spring MVC Request Life Cycle<br>출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/"><span class="image-caption">Spring MVC Request Life Cycle<br>출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/</span></a><span class="caption">Spring MVC Request Life Cycle<br>출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/</span></div><div style="clear:both;"></div><p>Filter를 만들기 전에 Filter에서 사용할 주요 핵심(?) 클래스가 필요한데 <code>HttpServletRequest</code> 를 Wrapping 해서 사용하기 위해 <code>HttpServletRequestWrapper</code>를 상속받는 클래스를 만들자. Request 에 담겨있는 param 과 body로 요청이 들어올 경우 body에 있는 내용을 param 에 담는 로직이다. 주요 설명은 코드 안에서 주석으로 설명하겠다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadableRequestWrapper</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span> </span>&#123; <span class="comment">// 상속</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Charset encoding;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">byte</span>[] rawData;</span><br><span class="line"><span class="keyword">private</span> Map&lt;String, String[]&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ReadableRequestWrapper</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(request);</span><br><span class="line"><span class="keyword">this</span>.params.putAll(request.getParameterMap()); <span class="comment">// 원래의 파라미터를 저장</span></span><br><span class="line"></span><br><span class="line">String charEncoding = request.getCharacterEncoding(); <span class="comment">// 인코딩 설정</span></span><br><span class="line"><span class="keyword">this</span>.encoding = StringUtils.isBlank(charEncoding) ? StandardCharsets.UTF_8 : Charset.forName(charEncoding);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">InputStream is = request.getInputStream();</span><br><span class="line"><span class="keyword">this</span>.rawData = IOUtils.toByteArray(is); <span class="comment">// InputStream 을 별도로 저장한 다음 getReader() 에서 새 스트림으로 생성</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// body 파싱</span></span><br><span class="line">String collect = <span class="keyword">this</span>.getReader().lines().collect(Collectors.joining(System.lineSeparator()));</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isEmpty(collect)) &#123; <span class="comment">// body 가 없을경우 로깅 제외</span></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (request.getContentType() != <span class="keyword">null</span> &amp;&amp; request.getContentType().contains(</span><br><span class="line">ContentType.MULTIPART_FORM_DATA.getMimeType())) &#123; <span class="comment">// 파일 업로드시 로깅제외</span></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">JSONParser jsonParser = <span class="keyword">new</span> JSONParser();</span><br><span class="line">Object parse = jsonParser.parse(collect);</span><br><span class="line"><span class="keyword">if</span> (parse <span class="keyword">instanceof</span> JSONArray) &#123;</span><br><span class="line">JSONArray jsonArray = (JSONArray)jsonParser.parse(collect);</span><br><span class="line">setParameter(<span class="string">"requestBody"</span>, jsonArray.toJSONString());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">JSONObject jsonObject = (JSONObject)jsonParser.parse(collect);</span><br><span class="line">Iterator iterator = jsonObject.keySet().iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">String key = (String)iterator.next();</span><br><span class="line">setParameter(key, jsonObject.get(key).toString().replace(<span class="string">"\""</span>, <span class="string">"\\\""</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">log.error(<span class="string">"ReadableRequestWrapper init error"</span>, e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getParameter</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">String[] paramArray = getParameterValues(name);</span><br><span class="line"><span class="keyword">if</span> (paramArray != <span class="keyword">null</span> &amp;&amp; paramArray.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> paramArray[<span class="number">0</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, String[]&gt; getParameterMap() &#123;</span><br><span class="line"><span class="keyword">return</span> Collections.unmodifiableMap(params);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Enumeration&lt;String&gt; <span class="title">getParameterNames</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Collections.enumeration(params.keySet());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String[] getParameterValues(String name) &#123;</span><br><span class="line">String[] result = <span class="keyword">null</span>;</span><br><span class="line">String[] dummyParamValue = params.get(name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (dummyParamValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">result = <span class="keyword">new</span> String[dummyParamValue.length];</span><br><span class="line">System.arraycopy(dummyParamValue, <span class="number">0</span>, result, <span class="number">0</span>, dummyParamValue.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(String name, String value)</span> </span>&#123;</span><br><span class="line">String[] param = &#123;value&#125;;</span><br><span class="line">setParameter(name, param);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(String name, String[] values)</span> </span>&#123;</span><br><span class="line">params.put(name, values);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletInputStream <span class="title">getInputStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> ByteArrayInputStream byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(<span class="keyword">this</span>.rawData);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ServletInputStream() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFinished</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isReady</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReadListener</span><span class="params">(ReadListener readListener)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Do nothing</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> byteArrayInputStream.read();</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedReader <span class="title">getReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">this</span>.getInputStream(), <span class="keyword">this</span>.encoding));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>가장 중요한 부분은 <code>IOUtils.toByteArray(is)</code> 요 부분인데, InputStream은 한번밖에 읽을 수 없기 때문에 이 필터에서 스트림을 읽는 대신, 래퍼 구현으로 새 스트림 생성하도록 작업을 하였다. 자칫 잘못하다간 body의 내용이 유실될 수도 있기 때문이다.<br>참조 :<br><a href="http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once" target="_blank" rel="noopener">http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once</a><br><a href="http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge" target="_blank" rel="noopener">http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge</a></p><p>위에서 만든 래퍼 클래스를 이제 필터에서 적용해보자.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadableRequestWrapperFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Do nothing</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">ReadableRequestWrapper wrapper = <span class="keyword">new</span> ReadableRequestWrapper((HttpServletRequest)request);</span><br><span class="line">chain.doFilter(wrapper, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>이렇게 되면 param으로 넘어온 파라미터나 body로 넘어온 정보들이 파싱되어 param에 담기게 된다.<br>(JSON으로 파싱하는 부분은 조금 지저분해 보일 수 있지만 다양한 테스트를 해보면서 얻은 결과물이다. 더 좋은 방식이 있다면 언제든지 PullRequest 또는 댓글 환영!)</p><h3 id="구현하기-컨트롤러에-AOP-셋팅"><a href="#구현하기-컨트롤러에-AOP-셋팅" class="headerlink" title="# 구현하기 - 컨트롤러에 AOP 셋팅"></a># 구현하기 - 컨트롤러에 AOP 셋팅</h3><p>이제 Request 의 params 를 한곳에서 로깅할 차례이다. 물론 위에서 만든 필터에서 로깅을 해도 되지만 필터에 로직이 들어가는 것보다 별도의 로직에서 처리하는게 맞다고 생각되어 분리를 하였다. (관심사의 분리)<br>AOP를 활용하여 다음과 같이 로직을 작성하였다. 아래 로직은 이해하기에 큰 어려움은 없을것 같지만 주석으로 설명을 하겠다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggerAspect</span> </span>&#123;</span><br><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(* com.taetaetae..*Controller.*(..))"</span>) <span class="comment">// 이런 패턴이 실행될 경우 수행</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loggerPointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Around</span>(<span class="string">"loggerPointCut()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">methodLogger</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Object result = proceedingJoinPoint.proceed();</span><br><span class="line">HttpServletRequest request = ((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getRequest(); <span class="comment">// request 정보를 가져온다.</span></span><br><span class="line"></span><br><span class="line">String controllerName = proceedingJoinPoint.getSignature().getDeclaringType().getSimpleName();</span><br><span class="line">String methodName = proceedingJoinPoint.getSignature().getName();</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">params.put(<span class="string">"controller"</span>, controllerName);</span><br><span class="line">params.put(<span class="string">"method"</span>, methodName);</span><br><span class="line">params.put(<span class="string">"params"</span>, getParams(request));</span><br><span class="line">params.put(<span class="string">"log_time"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">params.put(<span class="string">"request_uri"</span>, request.getRequestURI());</span><br><span class="line">params.put(<span class="string">"http_method"</span>, request.getMethod());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">log.error(<span class="string">"LoggerAspect error"</span>, e);</span><br><span class="line">&#125;</span><br><span class="line">log.info(<span class="string">"params : &#123;&#125;"</span>, params); <span class="comment">// param에 담긴 정보들을 한번에 로깅한다.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line"><span class="keyword">throw</span> throwable;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 에 담긴 정보를 JSONObject 형태로 반환한다.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JSONObject <span class="title">getParams</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">Enumeration&lt;String&gt; params = request.getParameterNames();</span><br><span class="line"><span class="keyword">while</span> (params.hasMoreElements()) &#123;</span><br><span class="line">String param = params.nextElement();</span><br><span class="line">String replaceParam = param.replaceAll(<span class="string">"\\."</span>, <span class="string">"-"</span>);</span><br><span class="line">jsonObject.put(replaceParam, request.getParameter(param));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> jsonObject;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>위 코드에서는 단순히 console log를 찍었지만 필자가 운영하고 있는 어드민 툴에서는 Request 정보를 Elasticsearch 에 인덱싱하고 이를 키바나에서 보다 쉽게 조회 및 모니터링이 가능하도록 구현하였다. 로깅을 어떤식으로 남길지, 로깅이 아닌 특정 상황에서 알림을 보낸다거나 등등 이 부분은 실제 구현시에 상황에 맞춰서 만들면 될 것 같다.<br>또한 <code>Pointcut</code> 부분을 다르게 활용하여 위에서 이야기한 요구사항의 3번 (URL 중 특정 패턴으로 들어오는 요청은 다른 방식으로 로깅을 하거나, 로깅에서 제외할 수 있어야 한다.) 를 해결할 수 있다.<br>아참, AOP의 개념을 좀더 알고 싶다면 jojoldu 님의 블로그 포스팅을 추천한다. <a href="https://jojoldu.tistory.com/71" target="_blank" rel="noopener">https://jojoldu.tistory.com/71</a></p><p>그래서 아래처럼 테스트를 해보면 GET 이던 POST 이던 로깅이 되는것을 확인할수 있다.<br><div class="figure " style="width:;"><a class="fancybox" href="test.jpg" title="더 이쁘게 로깅을 하는건 자유!" data-caption="더 이쁘게 로깅을 하는건 자유!" data-fancybox="default"><img class="fig-img" src="test.jpg" alt="더 이쁘게 로깅을 하는건 자유!"><span class="image-caption">더 이쁘게 로깅을 하는건 자유!</span></a><span class="caption">더 이쁘게 로깅을 하는건 자유!</span></div><div style="clear:both;"></div></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>사실 이 로직을 만들게 된 계기는 팀원중에 한분이 “GET 의 파라미터는 로깅이 되는데 POST 의 파라미터는 로깅이 안되요” 라는 말에 투우사 앞에 있는 황소마냥 찾아보다 만들게 되었다. 참고로 이 부분은 하나의 <code>무기</code>가 될것 같아 github에 공개를 하였고 위에서 적었던 요구사항보다 더 좋은 내용이 있다면 언제든지 PullRequest 를 날려주기를 바란다. Spring Boot 환경에서 Filter를 추가하며 구성하였다.<br><a href="https://github.com/taetaetae/request_logging" target="_blank" rel="noopener">https://github.com/taetaetae/request_logging</a><br>필터와 인터셉터, AOP 등 평소 자주 사용하지 않은 (이미 누군가 다 만들어 둔) 부분을 만지면서 다시한번 Spring의 주요 개념을 숙지하는데 도움이 되었던 경험으로 남을 것 같다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;스프링 기반의 웹 어플리케이션을 만들다 보면 요청을 처리하는데 맨 처음에 위치하고 있는 &lt;code&gt;Controller&lt;/code&gt;(이하 컨트롤러)라는 레이어를 만들게 된다. 그럴때면 사용자가 어떤 요청(Request)을 하였는지에 대해 확인이 필요할 수 있다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="spring" scheme="https://taetaetae.github.io/tags/spring/"/>
    
      <category term="logging" scheme="https://taetaetae.github.io/tags/logging/"/>
    
      <category term="HttpServletRequestWrapper" scheme="https://taetaetae.github.io/tags/HttpServletRequestWrapper/"/>
    
      <category term="Filter" scheme="https://taetaetae.github.io/tags/Filter/"/>
    
      <category term="AOP" scheme="https://taetaetae.github.io/tags/AOP/"/>
    
  </entry>
  
  <entry>
    <title>D.light 투게더톤 참가후기</title>
    <link href="https://taetaetae.github.io/2019/05/19/d-light-togetherthon-2019/"/>
    <id>https://taetaetae.github.io/2019/05/19/d-light-togetherthon-2019/</id>
    <published>2019-05-19T13:46:03.000Z</published>
    <updated>2019-05-30T08:14:52.107Z</updated>
    
    <content type="html"><![CDATA[<p>회사일을 하다 보면 시키는 대로 혹은 팀의 목표에 부합하기 위해 어쩔 수 없이 해야 하는 일을 하게 된다. 그러한 일이 재미있고 결과물에 대한 만족도가 100% 라면 다행이지만 간혹 재미도 없고 시켜서 하는 일은 밤을 꼬박 새 가면서 완성을 해도 썩 그렇게 만족스럽지 못한 경우가 대부분인 것 같다.<a id="more"></a> (물론 회사일에서 자신만의 인사이트를 찾는다면 금상첨화겠지만… + 매번 회사일이 재미없고 하기 싫은건 아님)<br>언제부터인지 필자도 이러한 부분에 갈증을 느끼며 회사와는 별도로 무언가를 만들어 보고 싶은 마음이 무럭무럭 생겨날 즈음 facebook 타임라인에서 개발자와 디자이너가 약 7주간 프로젝트를 진행하는 <code>D.light 투게더톤</code> 이라는 행사가 있다는 것을 발견하고 나름 정성스레 지원서를 작성 후 합격 메일을 받게 된다. (<a href="https://www.facebook.com/groups/gdgseoul/permalink/1265219273647317/" target="_blank" rel="noopener">GDG Facebook 해당 게시글</a>)<br>이번 포스팅에서는 해커톤과는 살짝 성격이 다른 <code>D.light 투게더톤</code>을 진행하면서 느꼈던 부분들과 진행한 결과물에 대해 간략히 리뷰를 해보며 정말 <code>급행</code>처럼 지나간 약 7주간을 돌이켜 보는 시간을 갖고자 한다.</p><h3 id="팀-빌딩"><a href="#팀-빌딩" class="headerlink" title="# 팀 빌딩"></a># 팀 빌딩</h3><div class="figure center" style="width:;"><a class="fancybox" href="team_build.jpg" title="눈도 못마주칠 정도로 어색한 첫날<br>Team. 그팽" data-caption="눈도 못마주칠 정도로 어색한 첫날<br>Team. 그팽" data-fancybox="default"><img class="fig-img" src="team_build.jpg" alt="눈도 못마주칠 정도로 어색한 첫날<br>Team. 그팽"><span class="image-caption">눈도 못마주칠 정도로 어색한 첫날<br>Team. 그팽</span></a><span class="caption">눈도 못마주칠 정도로 어색한 첫날<br>Team. 그팽</span></div><div style="clear:both;"></div><p>총 6개 팀 중에 필자는 여자 디자이너 두 분, 남자 안드로이드 개발자 두 분을 포함한 팀에 속하게 되었다. 5명 중 해커톤 참여 경험이 있다는 이유만으로 여자 디자이너 분께서 팀장이 되시고, 7주라는 시간이 정말 급하게 지나갈 것 같다는 억지(?) 이유를 들먹여 <code>그팽</code>이라는 팀 이름이 정해졌다. 그렇게 “우리가 정말 무엇을 만들 수 있을까?” 하는 의구심 속에 프로젝트가 시작이 되었다. </p><h3 id="프로젝트-진행-전반"><a href="#프로젝트-진행-전반" class="headerlink" title="# 프로젝트 진행 전반"></a># 프로젝트 진행 전반</h3><p>신기하게도 우리 5명은 각각 사는 지역이 전부 달랐다. (심지어 한 분은 매주 저 멀리 충청남도 천안에서 올라오셔야 하는 수고를 ㅠㅠ) 매 주말마다 오프라인으로 만나서 회의를 진행했다. 그래야 길다면 길고 짧다면 짧은 7주 안에 완성도 높은 결과물을 만들 수 있을 것 같아서였다. 프로젝트의 주제를 정하는 아이디어 회의에서 정해진 우리의 목표는 “동네 마트 할인 정보를 알려주는 앱”을 만들기로 하였다.<br><div class="figure center" style="width:;"><a class="fancybox" href="diagram.jpg" title="시간가는줄 몰랐던 아이데이션 회의" data-caption="시간가는줄 몰랐던 아이데이션 회의" data-fancybox="default"><img class="fig-img" src="diagram.jpg" alt="시간가는줄 몰랐던 아이데이션 회의"><span class="image-caption">시간가는줄 몰랐던 아이데이션 회의</span></a><span class="caption">시간가는줄 몰랐던 아이데이션 회의</span></div><div style="clear:both;"></div></p><p>팀워크가 중요한 <code>투게더톤</code> 임에도 불구하고 여느 천재 디자이너, 천재 개발자처럼 <code>일당백</code> 스타일로 뚝딱 만드는 그런 프로젝트의 진행 방식은 피하려고 우리 모두가 노력하였다. 되도록이면 이렇게 모인 다섯 명이 한마음 한뜻으로 각자가 생각하는 크기와 양은 다르겠지만 이 프로젝트를 통해 무엇이라도 배울 수 있었으면 했다. 디자이너 분들은 서로 디자인하신 시안에 대해 공유를 하면서 개선해 나가는 모습과, 안드로이드 개발자 두분은 (거의 매일) 밤마다 서로 슬랙에서 개발 방법론에 대해 스터디를 하는 모습이 보기 너무 보기 좋았다. 물론 필자도 아무것도 없는 환경에서 백엔드 서버를 구축하고 API를 만드는 과정 속에서 정말 많은것을 배울 수 있었다.<br>그렇게 시간이 흘러 마지막 발표하는 전날엔 팀원 몇 분과 함께 꼬박 밤을 새우며 프로젝트 결과물의 완성도를 높이는데 노력하였고 필자 개인적으로 아주 성공적으로 프로젝트를 마무리할 수 있었다.</p><h3 id="개발-진행"><a href="#개발-진행" class="headerlink" title="# 개발 진행"></a># 개발 진행</h3><p>안드로이드 개발자분들은 코틀린 기반으로 개발을 하였다. 여러 디자인 패턴과 다양한 기술들을 사용하였다고 들었는데 필자는 아쉽게도 백엔드 개발을 하다 보니 전부를 이해하지는 못하였다.<br>예전에 토이 프로젝트를 파이썬 기반으로 해본 경험이 있어서 Flask 또는 Django 기반으로 API 서버를 구축해볼까 하고 고민하였다. 하지만 (Spring Boot 기반으로도 해보고 싶었고) 파이썬보다는 자바 기반으로 다양한 어플리케이션의 요구 사항을 개발하는데 조금 더 능숙할 것 같아서 Spring Boot 기반으로 개발 환경을 구성하였다.<br>서버는 AWS 프리티어의 EC2를 발급받고 DB 또한 AWS에서 제공해주는 RDS(mysql)을 발급받아 구성하였다. 그리고 DNS는 예전에 무료 도메인을 찾다가 알게 된 <a href="http://mooo.com/" target="_blank" rel="noopener">http://mooo.com/</a> 라는 서비스에서 발급받아 연결하였고, 프로젝트 기능 중에 서버에서 앱으로 푸시를 하는 기능이 있었는데 Firebase를 활용해서 구성할 수 있었다.<br><div class="figure center" style="width:;"><a class="fancybox" href="server.jpg" title="사용한 기술들" data-caption="사용한 기술들" data-fancybox="default"><img class="fig-img" src="server.jpg" alt="사용한 기술들"><span class="image-caption">사용한 기술들</span></a><span class="caption">사용한 기술들</span></div><div style="clear:both;"></div></p><p>Entity Relationship Diagram (ERD) 는 무료로 인터넷에서 사용할 수 있는 툴이 있는지 찾다보니 <a href="http://aquerytool.com/" target="_blank" rel="noopener">http://aquerytool.com/</a> 라는 서비스가 있었고 (무려 한글…) 약간 부족하였지만 테이블들을 구성하고 연결관계를 표현하기에는 정말 간단하고 쉽게 사용할 수 있었다.<br><div class="figure center" style="width:;"><a class="fancybox" href="erd.jpg" title="테이블 관계도. PK, FK 등 완벽하진 않다." data-caption="테이블 관계도. PK, FK 등 완벽하진 않다." data-fancybox="default"><img class="fig-img" src="erd.jpg" alt="테이블 관계도. PK, FK 등 완벽하진 않다."><span class="image-caption">테이블 관계도. PK, FK 등 완벽하진 않다.</span></a><span class="caption">테이블 관계도. PK, FK 등 완벽하진 않다.</span></div><div style="clear:both;"></div></p><p>개발환경을 구성하면서 어떤 부분들은 보기만 해보고 사용만 해봤지 실제로 구성을 해보지는 않아서 정말 막막한 부분도 있었고 특히 내가 이것 하나 못하는가 하며 자괴감이 들때도 있었지만 그러면서 많은것을 배울 수 있었고 다시 해보라고 하면 머릿속에 전체 아키텍쳐가 그림으로 그려질 만큼 자신감이 조금이라도 생겨서 다행이라고 생각한다.</p><h3 id="프로젝트-결과"><a href="#프로젝트-결과" class="headerlink" title="# 프로젝트 결과"></a># 프로젝트 결과</h3><p><a href="http://magarine.mooo.com" target="_blank" rel="noopener">http://magarine.mooo.com</a><br>우리가 만든 서비스는 마트 가격 내린다 는 의미에서 <code>마가린</code> 이라는 이름으로 만들었고 그에 걸맞는 앱 아이콘이 만들어졌다. 필자는 이 아이콘을 볼때마다 심쿵거릴정도로 너무 이쁜것 같다.<br><div class="figure center" style="width:;"><a class="fancybox" href="magarine.jpg" title="마가린이 무려 천막을 달고 마트가 되었는데 할인이 되었기에 잘려 나가는 아트웤(?)을 표현해주셨다. 키햐... 무슨말이 필요하는가" data-caption="마가린이 무려 천막을 달고 마트가 되었는데 할인이 되었기에 잘려 나가는 아트웤(?)을 표현해주셨다. 키햐... 무슨말이 필요하는가" data-fancybox="default"><img class="fig-img" src="magarine.jpg" alt="마가린이 무려 천막을 달고 마트가 되었는데 할인이 되었기에 잘려 나가는 아트웤(?)을 표현해주셨다. 키햐... 무슨말이 필요하는가"><span class="image-caption">마가린이 무려 천막을 달고 마트가 되었는데 할인이 되었기에 잘려 나가는 아트웤(?)을 표현해주셨다. 키햐... 무슨말이 필요하는가</span></a><span class="caption">마가린이 무려 천막을 달고 마트가 되었는데 할인이 되었기에 잘려 나가는 아트웤(?)을 표현해주셨다. 키햐... 무슨말이 필요하는가</span></div><div style="clear:both;"></div></p><p>정말 간단하게 말하자면 일종의 쇼핑몰을 만들었다. 물건을 사고자 하는 사용자는 손쉽게 위치기반으로 근처 동네 마트의 할인 상품을 한눈에 확인 가능하고, 물건을 파는 마트 주인은 간단하고 편하게 홍보를 하는 서비스이다. 아쉽게도 물건을 파는 마트 주인을 위한 앱은 시간관계상 못 만들었지만 추후 기회가 된다면, 그리고 팀원들과 논의후 만들어 볼 계획이다.<br>프로젝트 소개 페이지에서 적어 놓은 것 처럼 여러가지 기능을 구현하였다. 그것도 완벽하게. </p><ul><li>단골마트 : 주변의 마트 또는 슈퍼를 지도에서 찾아 단골마트로 지정하고 마트의 전단지를 보며 행사를 확인할 수 있음</li><li>상품검색 : 단골마트에서 팔고있는 상품들을 검색이 가능</li><li>장보기 메모 : 상품 상세 페이지에서 구매할 수량을 선택하고 장보기 메모에 담아서 나중에 구매 또는 취소를 할 수 있음</li><li>장보기 메모 내역 : 이제까지 구매했던 이력을 확인할 수 있고 마치 가계부처럼 자신의 소비 습관을 해당 메뉴에서 분석할 수 있음</li><li>할인 알림 설정 : 원하는 상품이 있다면 알림설정을 할 수 있고 판매자가 상품을 등록하는 순간 푸시메세지로 정보를 알려줌</li></ul><p>아래는 발표 자료. 매년마다 어떤 행사에서라도 꼭 발표를 한 번 이상 하자는 나와의 약속을 이번 <code>D.light 투게더톤</code>에서 달성할 수 있어서 좋았다. 물론 이번 발표때도 여유라곤 찾을 수 없었지만…</p><iframe src="//www.slideshare.net/slideshow/embed_code/key/DzmojsEbuBMJus" width="750" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>결국 여러 심사조건(?)으로 6개 팀중 상위 2팀에게 주는 sketch 라이센스를 받게 되었고 (필자피셜) 만족할만한 마무리가 될 수 있었다.</p><div class="figure center" style="width:;"><a class="fancybox" href="result.jpg" title="우리 다섯명 팀원들의 캐릭터(By ZEPETO), 최종발표 장소인 구글캠퍼스, sketch 라이센스" data-caption="우리 다섯명 팀원들의 캐릭터(By ZEPETO), 최종발표 장소인 구글캠퍼스, sketch 라이센스" data-fancybox="default"><img class="fig-img" src="result.jpg" alt="우리 다섯명 팀원들의 캐릭터(By ZEPETO), 최종발표 장소인 구글캠퍼스, sketch 라이센스"><span class="image-caption">우리 다섯명 팀원들의 캐릭터(By ZEPETO), 최종발표 장소인 구글캠퍼스, sketch 라이센스</span></a><span class="caption">우리 다섯명 팀원들의 캐릭터(By ZEPETO), 최종발표 장소인 구글캠퍼스, sketch 라이센스</span></div><div style="clear:both;"></div><p>발표에서도 몇번을 반복하며 이야기 했지만 이런 팀원들을 또 만날 수 있을까 하는 생각과 함께 다시한번 팀원들에게 감사하다는 말을 전하고 싶다. 그리고 아무것도 정해지지 않는 상황과 아무것도 구축되어 있지 않은 개발환경에서 나름 구현하고자 했던 기능을 구현하며 멋지게 마무리 할수 있어 다행이라 생각하고 다양한 트러블슈팅 속에서 나름 많은것을 배울 수 있었다.<br>머릿속에 있는 것과 그것을 말로 설명할 수 있는 것, 나아가 그것을 직접 내 손으로 해보고 문제를 해결해 나가는 것은 엄청난 차이가 있다고 생각한다. 그러한 과정들 속에서, 그리고 이렇게 다양한 사람들과의 협업을 통해 배우는 것 또한 분명히 있고 그것을 오롯히 내것으로 만드는게 마지막으로 남겨진 숙제인것 같다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;회사일을 하다 보면 시키는 대로 혹은 팀의 목표에 부합하기 위해 어쩔 수 없이 해야 하는 일을 하게 된다. 그러한 일이 재미있고 결과물에 대한 만족도가 100% 라면 다행이지만 간혹 재미도 없고 시켜서 하는 일은 밤을 꼬박 새 가면서 완성을 해도 썩 그렇게 만족스럽지 못한 경우가 대부분인 것 같다.
    
    </summary>
    
      <category term="review" scheme="https://taetaetae.github.io/categories/review/"/>
    
    
      <category term="hackathon" scheme="https://taetaetae.github.io/tags/hackathon/"/>
    
      <category term="gdg" scheme="https://taetaetae.github.io/tags/gdg/"/>
    
  </entry>
  
  <entry>
    <title>자바, 성능, 모니터링 테크세미나 정리 및 후기 (by 우아한 형제들)</title>
    <link href="https://taetaetae.github.io/2019/05/12/got-of-java-seminar/"/>
    <id>https://taetaetae.github.io/2019/05/12/got-of-java-seminar/</id>
    <published>2019-05-12T11:04:01.000Z</published>
    <updated>2019-05-30T08:14:51.849Z</updated>
    
    <content type="html"><![CDATA[<p>실무에서 자바 기반으로 개발을 하고 서비스를 운영을 하다보면 처음엔 아무런 문제가 없다가 사용자가 몰리는 등 이벤트성으로 트래픽이 많아질 경우 꼭 문제가 생기기 마련이다. 그럴때면 뒤늦게 부랴부랴 원인을 찾고 개선하기 바빠지게 된다.  <a id="more"></a> (아마 윗분들에게 혼나면서?ㅠㅠ)<br>평소에 이런 성능문제를 개선하고 미리 모니터링 할수있는 부분에 대해 관심을 갖고 있었던 찰나, 우아한 형제들에서 <a href="https://www.facebook.com/woowahanTech/photos/a.1925530564354206/2280664485507477" target="_blank" rel="noopener">5월 우아한 테크 세미나</a>를 한다기에 부랴부랴 장문의 글로 신청을 하였고 운이 좋아 당첨이 되었다.<br>한창 회사에서 새로운 서비스 출시, 그리고 잠을 줄여가며 별도로 진행하고 있던 토이프로젝트 등 여러가지로 바쁜 시기였지만 특히 예전부터 뵙고싶던 이상민님께서 직접 강의를 해주신다기에 피곤한 심신을 이끌고 세미나에 참석하였고 그 후기를 적어보고자 한다.</p><blockquote><p>두레이로 만드신 발표자료를 공유해 주셨지만 저작권 문제도 있고 해서 필자기준에서 이해한 부분에 대해서만 공유하고자 한다. 더불어 그냥 듣고 앵무새처럼 발표내용 그대로를 공유하는건 의미가 없다고 생각되어…</p></blockquote><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="1.jpg" title="포스터만 봐도 벌써부터 가슴이 뛴다(?)." data-caption="포스터만 봐도 벌써부터 가슴이 뛴다(?)." data-fancybox="default"><img class="fig-img" src="1.jpg" alt="포스터만 봐도 벌써부터 가슴이 뛴다(?)."><span class="image-caption">포스터만 봐도 벌써부터 가슴이 뛴다(?).</span></a><span class="caption">포스터만 봐도 벌써부터 가슴이 뛴다(?).</span></div><div style="clear:both;"></div><h3 id="성능"><a href="#성능" class="headerlink" title="# 성능"></a># 성능</h3><p>구글에서 작성한 <a href="https://developers.google.com/web/fundamentals/performance/why-performance-matters/" target="_blank" rel="noopener">성능이 중요한 이유</a> 라는 아티클을 공유해 주셨다. (시간이 된다면 한번 읽어보길 강추, 무려 한글!) 어플리케이션에서 성능은 사용자의 증가, 이탈율, 응답속도에 영향이 있고 이는 결국 추구하는 가치(이를 테면 수익)에 직면한다고 한다.<br>사용자는 어느 관점에서 바라보는가에 따라 달라지고 각 관점에 따라 성능을 챙겨야 하는 부분이 달라진다. 수강신청을 하는 시점에서의 사용자와 뉴스 페이지를 읽는 시점에서의 사용자는 각 성격이 엄연히 다른것처럼. </p><ul><li>시스템 관리자<ul><li>등록된 / 등록되지 않은 사용자</li></ul></li><li>서버 관점<ul><li>로그인된 / 로그인 하지 않은 사용자</li></ul></li><li>성능 테스터 관점<ul><li>Active User<ul><li>서버에 부하를 주는 사용자</li><li>메뉴나 링크를 누르고 결과가 나오기를 기다리는 사용자</li><li>성능테스트시 Vuser와 거의 동일 ( Vuser : 가상사용자(virtual user) )</li></ul></li><li>Concurrent user<ul><li>서버에 부하를 주고 있거나, 줄 가능성이 매우높은 서비스에 접속중인 사용자</li><li>웹 페이지를 띄워놓은 사용자</li></ul></li></ul></li></ul><p>TPS(Transaction Per Seconds)는 초당 얼마나 많은 요청을 처리할수 있는지에 대한 시스템의 절대적인 수치로 볼수있다. (개발자는 어느상황에서든지 대충 감으로 이야기 하지말고 정확한 수치로 이야기 해야한다는 뼈를 때리는 조언과 함께…)  TPS는 Scale out/up을 통해 증가시킬수 있지만 Response Time 은 불가능하다. 물론 어플리케이션을 튜닝하면 두 수치 모두 개선이 가능하다. 이러한 TPS와 Response Time의 최대치는 출시전에 반드시 테스트를 통해 알고 있어야 이슈발생시 대응하는데 유용하다.<br>Bottleneck 즉 병목은 장비, 어플리케이션, 저장소, 설정 등 다양한 상황에서 발생할수 있다. 그중에 “아주 일반적”으로 가장 병목이 많이 발생하는 구간은 DB이고 그 다음으로 클라이언트(Web page, App), Network이 있을 수 있다.<br>결론은 <strong>Performance engineering is “Composite Art” of IT</strong> 라는 하나의 문장으로 정리를 해주셨다. 아무리 이쁜 디자인과 어렵고 복잡한 기능이 있을지라도 성능이 뒷받침 안된다면 대용량 트래픽 상황에서는 무의미해지기 때문이라고 생각한다.</p><h2 id="자바"><a href="#자바" class="headerlink" title="# 자바"></a># 자바</h2><p>자바의 역사에 대해 설명해 주셨다. ( 역사에 대한 보다 자세한 설명은 <a href="https://www.whatap.io/blog/12/" target="_blank" rel="noopener">https://www.whatap.io/blog/12/</a> 참고 ) 언제부터인가 JDK 라이센스 이슈가 많았었는데 실무에서 개발하는 입장에서는 java 8 에서는 문제가 안되고 java 11부터 라이센스 문제가 복잡하게 생길수 있다고 한다. 이부분은 공식문서(?)를 찾아보는게 좋을듯 하다. (개인 또는 회사에서 사용할 경우 상황에 따라 법적 이슈가 생길수도, 안생길수도 있는 복잡한 문제가 있어보여서… 필자도 제대로 이해하지는 못했다ㅠ)</p><p>그리고 각 자바 버전에서 발표한 새로운 기능에 대해 설명해주셨다.</p><ul><li>Java 8<ul><li>lambda, stream, default method, LocalDate / LocalTime 추가</li><li>stream 과 foreach 의 성능은 거의 차이 없음 (오히려 가독성이 나빠질수도 있다.)</li><li>ParallelStream 은 해당 장비의 cpu 개수만큼 스레드 풀을 만들어 사용 (오히려 독이 될수 있으니 잘 알아보고 사용할것)</li></ul></li><li>Java 9<ul><li>Compact Strings : char[] &gt; byte[]</li><li>G1 default GC : <a href="https://www.oracle.com/technetwork/tutorials/tutorials-1876574.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/tutorials/tutorials-1876574.html</a></li><li>Collections of (불변) : List.of, Set.of, Map.of</li></ul></li><li>Java 10<ul><li>var 의 등장</li><li>Application Class-Data Sharing(AppCDS)</li></ul></li><li>Java 11<ul><li>Oracle JDK의 유료화</li><li>Http Client. 기본 설정값들을 제대로 알고 써야한다. ( <a href="https://golb.hplar.ch/2019/01/java-11-http-client.html" target="_blank" rel="noopener">https://golb.hplar.ch/2019/01/java-11-http-client.html</a> )</li></ul></li><li>Java 12<ul><li>Switch expressions</li><li>Shenandoah : <a href="https://www.youtube.com/watch?v=E1M3hNlhQCg" target="_blank" rel="noopener">https://www.youtube.com/watch?v=E1M3hNlhQCg</a></li></ul></li></ul><h2 id="모니터링"><a href="#모니터링" class="headerlink" title="# 모니터링"></a># 모니터링</h2><p>유명한 상용 APM들을 설명해 주셨다. 각각의 장점에 대해 설명해 주셨는데 정말 회사에 요청해 구매할수만 있다면 사서 해보고 싶을정도로 신기한 기능이 많았다. 그중 dynatrace 는 에이전트만 설치해두면 별도의 설정 필요없이 알아서 해준다고…</p><ul><li>dynatrace (<a href="https://www.dynatrace.com/" target="_blank" rel="noopener">https://www.dynatrace.com/</a>)</li><li>new relic (<a href="https://newrelic.com/" target="_blank" rel="noopener">https://newrelic.com/</a>)</li><li>AppDynamics (<a href="https://www.appdynamics.com/" target="_blank" rel="noopener">https://www.appdynamics.com/</a>)</li><li>WhaTap (<a href="https://www.whatap.io/" target="_blank" rel="noopener">https://www.whatap.io/</a>)</li></ul><p>오픈소스로는 스카우터와 핀포인트를 설명해 주셨다. 필자는 핀포인트로 회사 서비스를 모니터링 중에 있는데 스카우터에도 좋은 기능이 많아 보여 기회가 된다면 개발서버에 설치해서 핀포인트와 각각 장단점을 비교해 보고 싶어질 정도로 스카우터 자랑을 엄청 해주셨다. (NHN에서는 스카우터로 모니터링 하고 있다고 하니 더욱더 관심이 가게 되었다.)</p><ul><li>scouter (<a href="https://github.com/scouter-project/scouter" target="_blank" rel="noopener">https://github.com/scouter-project/scouter</a>)</li><li>pinpoint (<a href="https://github.com/naver/pinpoint" target="_blank" rel="noopener">https://github.com/naver/pinpoint</a>)</li></ul><p>APM 즉, Application Performance Management의 핵심은 바로 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.instrument/java/lang/instrument/package-summary.html" target="_blank" rel="noopener">java.lang.instrument</a> package 와 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.instrument/java/lang/instrument/ClassFileTransformer.html" target="_blank" rel="noopener">Java ClassFileTransformer</a> 에 있다고 하셨다. 마치 Spring의  AOP처럼.</p><p>이번 세션의 결론은 처음에 이야기 하신 부분과 비슷한 “절대로 단정짓지 마라 ! 데이터로 이야기 하자 !” 라는 문장으로 정리를 해주셨다. 그만큼 테스트를 많이 해보고 평소에 모니터링을 자주 해가며 서비스의 안정성을 높여야 한다는 뜻으로 이해했다.<br>끝으로 Q&amp;A가 있어 평소에 궁금했던 질문을 드렸고 너무 친절하게 화이트보드에 그래프를 그려주시면서 (원래 강의시간보다 30분정도 더 하게 만든 장본인…ㅠㅠ) 답변을 해주셨다.</p><p>Q. Application의 상태를 확인하기 위해 각종 모니터링 툴을 활용하는데, 오히려 모니터링이 과하다 보면 Application 성능에 영향을 주게 된다. 어떻게 해야하는가?</p><p>A. 모니터링툴을 홍보하는 쪽에서는 당연히 성능에 영향이 없다고 한다. 하지만 먼저 개발서버에서 테스트를 해봐서 모니터링툴이 있고 없고의 서비 리소스의 차이를 확인해보고 조금씩 적용범위를 늘려가는 식으로 해보는것도 하나의 방법이 될 수 있다. 또한 샘플링을 통해 일부분만 확인하는 방법도 있다. (필자가 이용하는 pinpoint는 request의 20% 이런식으로 샘플링을 하고 있었는데 scouter에서는 response time기준으로 샘플링이 되나보다?ㄷㄷ)</p><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="2.jpg" title="너무 두서없이 적었나..." data-caption="너무 두서없이 적었나..." data-fancybox="default"><img class="fig-img" src="2.jpg" alt="너무 두서없이 적었나..."><span class="image-caption">너무 두서없이 적었나...</span></a><span class="caption">너무 두서없이 적었나...</span></div><div style="clear:both;"></div><p>그리고 필자의 질문 때문이였는지 실무에서 있었던 장애시 그래프 사례를 보여주시며 끔찍한(?) 상황까지 재밌게 표현해 주시며 약 3시간여 진행된 세미나가 마무리 되었다.</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>자바로 Application개발을 하면서 성능과 모니터링은 마치 삼겹살엔 소주, 치킨에 맥주처럼 정말 떼려야 뗄 수 없는 사이인것 같다. 우아한 형제들에서 주최한 이번 기술 세미나는 필자에게 정말 많은것을 배우게 해준 좋은 행사였다. 그리고 회사에 가면 짬나는 시간을 활용해서 스카우터로 성능테스트를 해볼 계획이다. (라고 말하면 안되고 점심에 졸려서 성능테스트를 해봤다고 말해야 직장 상사가 좋아하신다 라고 말씀해주셨다 ㅎㅎ)</p><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="3.jpg" title="질문을 해야 내것이 된다는 나와의 약속을 이번에도 지킬수 있었다! (질문하고 받은 배달의 민족 쿠폰!)" data-caption="질문을 해야 내것이 된다는 나와의 약속을 이번에도 지킬수 있었다! (질문하고 받은 배달의 민족 쿠폰!)" data-fancybox="default"><img class="fig-img" src="3.jpg" alt="질문을 해야 내것이 된다는 나와의 약속을 이번에도 지킬수 있었다! (질문하고 받은 배달의 민족 쿠폰!)"><span class="image-caption">질문을 해야 내것이 된다는 나와의 약속을 이번에도 지킬수 있었다! (질문하고 받은 배달의 민족 쿠폰!)</span></a><span class="caption">질문을 해야 내것이 된다는 나와의 약속을 이번에도 지킬수 있었다! (질문하고 받은 배달의 민족 쿠폰!)</span></div><div style="clear:both;"></div><p>1,2 회 모두 탈락해서 못들었지만 다음에도 이런 기술관련 행사가 있으면 꼭 듣고 싶고 마지막으로 필자에 질문에 너무 성실하게 답변해 주시고 재밌고 귀에 쏙쏙 들어오는 강연을 해주신 이상민님께 이 포스팅으로나마 다시한번 감사의 말씀을 전하고 싶다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;실무에서 자바 기반으로 개발을 하고 서비스를 운영을 하다보면 처음엔 아무런 문제가 없다가 사용자가 몰리는 등 이벤트성으로 트래픽이 많아질 경우 꼭 문제가 생기기 마련이다. 그럴때면 뒤늦게 부랴부랴 원인을 찾고 개선하기 바빠지게 된다.
    
    </summary>
    
      <category term="review" scheme="https://taetaetae.github.io/categories/review/"/>
    
    
      <category term="java" scheme="https://taetaetae.github.io/tags/java/"/>
    
      <category term="performance" scheme="https://taetaetae.github.io/tags/performance/"/>
    
      <category term="monitoring" scheme="https://taetaetae.github.io/tags/monitoring/"/>
    
  </entry>
  
  <entry>
    <title>spring-boot에서 mybatis로 mysql 연동하기</title>
    <link href="https://taetaetae.github.io/2019/04/21/spring-boot-mybatis-mysql-xml/"/>
    <id>https://taetaetae.github.io/2019/04/21/spring-boot-mybatis-mysql-xml/</id>
    <published>2019-04-21T13:47:04.000Z</published>
    <updated>2019-05-30T08:14:51.918Z</updated>
    
    <content type="html"><![CDATA[<p>실무에서 개발을 하다보면 과거 누군가 잘 구성해 놓은 밥상(legacy)에 숟가락만 얹는 느낌으로 <code>로직 구현</code>만 할때가 있다. 그러다보면 각종 레이어가 어떻게 구성(설정)되어있는지도 모르고 <a id="more"></a> 간혹 설정에서 문제가 발생하면 “아 내가 이것도 모르고 이제까지 개발을 해왔나” 하는 자괴감이 들며 몇시간을 삽질하는 경우가 있다. 그게 지금의 필자인것 같다. (눙물…)<br><div class="figure center" style="width:;"><a class="fancybox" href="mung.jpg" title="<br>출처 : http://blog.naver.com/PostView.nhn?blogId=ondo_h&logNo=221437452142" data-caption="<br>출처 : http://blog.naver.com/PostView.nhn?blogId=ondo_h&logNo=221437452142" data-fancybox="default"><img class="fig-img" src="mung.jpg" alt="<br>출처 : http://blog.naver.com/PostView.nhn?blogId=ondo_h&logNo=221437452142"><span class="image-caption"><br>출처 : http://blog.naver.com/PostView.nhn?blogId=ondo_h&logNo=221437452142</span></a><span class="caption"><br>출처 : http://blog.naver.com/PostView.nhn?blogId=ondo_h&logNo=221437452142</span></div><div style="clear:both;"></div></p><p>사이드 프로젝트 초기셋팅을 하며 호기롭게 spring boot 최신버전에서 db를 연동하려 했는데 막상 완전 바닥부터 해본 경험이 적다보니 (spring boot 2 버전에서는 더욱더…) 어디서부터 뭘 설정을 해야할지… 그리고 <code>이럴때 보는</code> 도큐먼트를 봐도 잘 이해가 안되어 삽질을 해가며 당황하기 일쑤였다.<br>이번 포스팅에서는 아래와 같은 구성을 하는데 목표를 두고자 한다.</p><ul><li>Spring Boot 2 프로젝트를 처음 만들고 </li><li>mybatis 를 사용해서</li><li>mysql 을 연동하는것 (AWS 의 RDS를 사용, 추후 RDS사용법에 대해 블로깅 예정)</li></ul><p>위와 같은 상황을 처음 접하는 분들께 도움이 되었으면 하는 바램으로 짧게나마 필자의 삽질기를 여행해보자.</p><h3 id="Spring-boot-2-프로젝트-만들기"><a href="#Spring-boot-2-프로젝트-만들기" class="headerlink" title="# Spring boot 2 프로젝트 만들기"></a># Spring boot 2 프로젝트 만들기</h3><p>필자는 IntelliJ를 사용하고 있어서 새로 프로젝트를 만들려고 할때 클릭 몇번만으로 dependency 설정까지 다 해주기 때문에 편하고 좋았다. 혹 이클립스나 다른 IDE를 사용하고 있다면 <a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a> 을 참고하면 도움이 될것같다. 여기서도 클릭 몇번으로 IntelliJ 에서 해주는 것처럼 내가 사용할 모듈을 선택하고 generate 를 누르면 프로젝트가 생성되어 다운로드 받아진다. (참 좋은 세상…)<br>우선 File → New → Project 를 눌러서 아래 창을 열어보자. 그리고 뭔가 다 해줄것 같은 (개발도 해주면 안되나…) <code>Spring Initializr</code>을 선택후 아래와 같은 설정을 적어준 뒤 다음을 눌러준다.</p><div class="figure center" style="width:;"><a class="fancybox" href="1.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="1.jpg" alt=""></a></div><div style="clear:both;"></div><p>사용할 모듈을 선택해주자. 필자는 이것저것(?)을 도와주는 <code>lombok</code>과 <code>Mybatis</code>, <code>MySQL</code>을 선택하고 프로젝트를 생성하였다. 그러면 이쁜(?) pom.xml 과 함께 당장 개발을 시작할 수 있는 환경이 제공된다.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p><div class="figure center" style="width:;"><a class="fancybox" href="2.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="2.jpg" alt=""></a></div><div style="clear:both;"></div><p>우선 여기까지 잘 되었는제 확인해보기 위해 Controller 에 현재시간을 출력하는걸 만들어 보고<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(path = <span class="string">"/helloWorld"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">helloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>톰켓을 실행해보면 정상적으로 접속과 출력이 되는것을 확인할 수 있다.</p><div class="figure center" style="width:;"><a class="fancybox" href="3.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="3.jpg" alt=""></a></div><div style="clear:both;"></div><h3 id="MySQL-연동하기"><a href="#MySQL-연동하기" class="headerlink" title="# MySQL 연동하기"></a># MySQL 연동하기</h3><p>필자가 허둥지둥 했던점 중 하나는 MyBatis와 MySQL을 동시에 연동하려고 하다보니 문제가 발생해도 어디서의 문제인지를 제대로 파악하지 못하고 삽질했다는 점이다. 여기서 정확히 짚고 넘어가면 우선 데이터를 연결해주는 ORM인 MyBatis를 셋팅해준 다음 MySQL을 연동해주는 식으로 분리해서 설정을 하면 햇갈리지 않고 (돌아가지 않고) 보다 빠르게 설정이 가능할것 같다. (여기서 순서는 중요하지 않고 별도로 설정해야 한다는 관점이 중요한것 같다.)<br>우선 <code>src/main/resources</code>폴더에 있는 <code>application.properties</code> 에 다음처럼 작성해주자.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.hikari.jdbc-url=jdbc:mysql://&#123;url&#125;:&#123;port&#125;/&#123;db&#125;</span><br><span class="line">spring.datasource.hikari.username=&#123;id&#125;</span><br><span class="line">spring.datasource.hikari.password=&#123;password&#125;</span><br></pre></td></tr></table></figure></p><p>위의 jdbc-url 항목에서 AWS에서 제공하는 RDS를 사용하는 경우 RDS에서 제공해주는 엔드포인트와 포트를 적어주면 된다. (추후 AWS - RDS에 대해 블로깅 예정이다.)<br>Spring Boot 2.0 이후부터 기본적으로 사용되는 커넥션 풀이 HikariCP로 변경되었다고 한다. (<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Release-Notes#hikaricp" target="_blank" rel="noopener">링크</a>) 커넥션 풀 종류중 성능이 좋다고 하는데 <a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="noopener">링크</a>를 가보면 다른 커넥션 풀 라이브러리와 성능을 비교한 벤치마크 결과를 확인할 수 있다.<br>위처럼 <code>spring.datasource.hikari</code> 가 prefix로 붙고 각종 정보들을 적어주어 config 에서 인식될수 있도록 해주자. 그 다음 DataSource 설정을 해준다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:/application.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseConfiguration</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.hikari"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HikariConfig <span class="title">hikariConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> HikariConfig();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">DataSource dataSource = <span class="keyword">new</span> HikariDataSource(hikariConfig());</span><br><span class="line">log.info(<span class="string">"datasource : &#123;&#125;"</span>, dataSource);</span><br><span class="line"><span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>위 내용은 DataSource 를 hikariConfig에서 설정한 정보로 만들어 준다는 의미이다. 이렇게만 하고 프로젝트를 다시 실행시켜보면 logger 에 의해 datasource 의 정보를 볼수가 있다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-04-22 00:27:35.048  INFO 23040 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...</span><br><span class="line">2019-04-22 00:27:36.221  INFO 23040 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.</span><br><span class="line">2019-04-22 00:27:36.222  INFO 23040 --- [           main] c.e.m.config.DatabaseConfiguration       : datasource : HikariDataSource (HikariPool-1)</span><br><span class="line">2019-04-22 00:27:36.527  INFO 23040 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &apos;applicationTaskExecutor&apos;</span><br></pre></td></tr></table></figure></p><p>여기까지 우선 Datasource 설정이 끝났다.<br>Q : <code>com.mysql.cj.jdbc.Driver</code> 에서 <code>cj</code>가 뭐지?<br>A : 해당 클래스는 더이상 사용하지 않아 <code>com.mysql.jdbc.Driver</code>로 설정하고 실행시켜보면 아래 문구를 볼수가 있다.</p><blockquote><p>Loading class `com.mysql.jdbc.Driver’. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver’. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.</p></blockquote><p>당황하지 말고 클래스를 바꿔주자.</p><h3 id="MyBatis-연동하기"><a href="#MyBatis-연동하기" class="headerlink" title="# MyBatis 연동하기"></a># MyBatis 연동하기</h3><p>DB를 연동했으니 이제 쿼리를 작성하고 원하는 결과를 얻기위해 MyBatis를 활용할 차례다. 위에서 작성한 <code>DatabaseConfiguration</code>에 추가로 다음과 같이 작성해주자.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseConfiguration</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">SqlSessionFactoryBean sqlSessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">sqlSessionFactoryBean.setDataSource(dataSource);</span><br><span class="line">sqlSessionFactoryBean.setMapperLocations(applicationContext.getResources(<span class="string">"classpath:/mapper/**/*.xml"</span>));</span><br><span class="line"><span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">sqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>이 설정은 위에서 설정한 datasource를 사용하고 쿼리가 작성되는 xml위치를 지정해 줌으로써 추후 <code>Mapper</code> or <code>DAO</code> 레벨에서 사용되는 쿼리를 인식해주는 과정이다. 여기서 <code>classpath</code>는 <code>src/main/resourcs</code>이고 해당 쿼리가 있는 xml 위치는 본인의 취향대로 위치키시고 그에 맞도록 설정해주면 된다.<br>이렇게 한뒤 MySQL Workbench 로 DB에 접속후 임의의 데이터를 생성한 다음<br><div class="figure center" style="width:;"><a class="fancybox" href="4.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="4.jpg" alt=""></a></div><div style="clear:both;"></div><br>DAO 를 만들어 주고 이를 호출해보면 정상적으로 데이터를 읽어오는것이 확인된다.</p><ul><li><p>DAO</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.express.magarine.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiDao</span> </span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAMESPACE = <span class="string">"com.express.magarine.api."</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">selectName</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> sqlSession.selectOne(NAMESPACE + <span class="string">"selectName"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>query xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.express.magarine.api"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectName"</span> <span class="attr">resultType</span>=<span class="string">"string"</span>&gt;</span></span><br><span class="line">SELECT name</span><br><span class="line">FROM test</span><br><span class="line">LIMIT 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiController</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ApiDao apiDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(path = <span class="string">"/helloWorld"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">helloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> String.format(<span class="string">"%s %s"</span>, apiDao.selectName(), LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>결과</p><div class="figure center" style="width:;"><a class="fancybox" href="5.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="5.jpg" alt=""></a></div><div style="clear:both;"></div></li></ul><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><div class="figure center" style="width:;"><a class="fancybox" href="gvsc.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="gvsc.png" alt=""></a></div><div style="clear:both;"></div><p>이 코드를, 그리고 이 포스팅을 작성하기 직전까지만 해도 “그냥 하면 되는거 아니야?”라고 생각했지만 알고있는 지식과 막상 해보는건 정말 하늘과 땅차이 라는걸 다시한번 느끼게 되었다. (자괴감의 연속…) 더불어 Spring Boot 의 간편함에 놀라웠고 이제 회사일이 조금 잠잠해졌으니 (과연?) Spring Boot로 이것저것 만들며 스터디를 해야겠다고 다짐해본다.<br>참고 URL</p><ul><li><a href="https://spring.io/guides/gs/accessing-data-mysql/" target="_blank" rel="noopener">https://spring.io/guides/gs/accessing-data-mysql/</a></li><li><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="noopener">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;실무에서 개발을 하다보면 과거 누군가 잘 구성해 놓은 밥상(legacy)에 숟가락만 얹는 느낌으로 &lt;code&gt;로직 구현&lt;/code&gt;만 할때가 있다. 그러다보면 각종 레이어가 어떻게 구성(설정)되어있는지도 모르고
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="mybatis" scheme="https://taetaetae.github.io/tags/mybatis/"/>
    
      <category term="spring-boot" scheme="https://taetaetae.github.io/tags/spring-boot/"/>
    
      <category term="mysql" scheme="https://taetaetae.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>AWS 프리티어 발급부터 EC2 접속까지</title>
    <link href="https://taetaetae.github.io/2019/04/14/aws-freetier-create-and-ssh-access/"/>
    <id>https://taetaetae.github.io/2019/04/14/aws-freetier-create-and-ssh-access/</id>
    <published>2019-04-14T08:39:03.000Z</published>
    <updated>2019-05-30T08:14:51.901Z</updated>
    
    <content type="html"><![CDATA[<p>IT 쪽에 일을 하고 있거나 관심을 가지고 있는 사람이라면 한번쯤을 들어봤을 AWS(Amazon Web Services). 이름에서도 알수있는 것처럼 아마존에서 제공하는 각종 원격 컴퓨팅 웹서비스이다. <a id="more"></a> 아마존은 이러한 서비스를 누구나 쉽게 접근해볼수 있도록 <a href="https://aws.amazon.com/ko/free/" target="_blank" rel="noopener">AWS 프리티어</a>를 제공해 주는데 이 프리티어 만으로도 과금없이 (또는 최소화 하여) 웹서비스를 구성할수 있다. 필자가 운영하고 있는 <a href="http://daily-devblog.com" target="_blank" rel="noopener">기술블로그 구독서비스</a>또한 AWS 프리티어로 운영되고 있다.<br>최근 GDG Seoul, P-typer, Sketch Seoul 에서 주최한 <a href="https://www.meetup.com/ko-KR/GDG-Seoul/events/259463050/" target="_blank" rel="noopener">D.light 345 투게더톤</a>에 참가하며 사이드 프로젝트를 하고 있는데 마침 AWS를 사용하게 되었다. 예전에 사용했을때는 장님 코끼리 만지듯이 설정을 했었는데 이번기회를 통해 다시한번 정리를 해본다.<br>본 포스팅에서는 AWS 계정을 발급받고 신용카드 확인까지 된 계정에서 EC2 서버를 발급받고 putty를 활용하여 서버에 접근을 해보는것을 목표로 둔다. </p><blockquote><p>(사이드 프로젝트를 하면서) 아마도 웹서비스를 개발하면서 AWS를 활용하는 부분에 대해 시리즈물로 포스팅을 하게 될것 같다.<br>사실 너무 간단해서 이런걸 글로 쓰나? 라고 할수도 있지만 눈으로만 보는것과 직접 해보는 것이 다르고, 이걸 다시 글로써 정리를 하는것 또한 완전 다른 부분이기 때문에 포스팅을 해본다.</p></blockquote><h3 id="EC2-생성하기"><a href="#EC2-생성하기" class="headerlink" title="# EC2 생성하기"></a># EC2 생성하기</h3><p>EC2? Amazon Elastic Compute Cloud의 약자로 물리서버가 아닌 클라우드 서버를 제공하고 있다. EC2의 장점은 서버의 스펙을 쉽고 자유롭게 조정할 수 있는점이 가장 매력있게 생각한다. 우선 콘솔에 들어가 EC2를 검색후 접속을 하고 <code>인스턴스 시작</code>을 눌러서 인스턴스 생성 화면으로 들어간다.<br><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="ec2-1.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="ec2-1.jpg" alt=""></a></div><div style="clear:both;"></div></p><p>AMI 즉 생성할 이미지를 선택하는 부분인데 여기서 주의할점은 잘못선택 했다간 계정 만들었을때의 카드로 생각지도 못할 금액이 결제가 되버릴수도 있다. (실제로 필자도 AWS를 처음 만져볼때 아무생각없이 좋아보이는걸로 했다가 한 30달러 정도를 지불했어야만 했다…) 좌측에 보면 <code>프리 티어만</code>이라는 체크박스를 체크하고 자신이 원하는 이미지를 선택하자. 일반적인 리눅스 서버를 발급받고 싶기 때문에 빨간 영역의 이미지를 선택하고 선택한 이미지의 스팩을 다시한번 확인하자. (cpu 1개에 메모리도 1기가… 너무 짜지만 무료니까…)<br><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="ec2-2.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="ec2-2.jpg" alt=""></a></div><div style="clear:both;"></div></p><p>마지막으로 <code>시작하기</code> 를 누르면 키 페어를 선택 또는 생성하도록 안내가 나오는데 당연히 아무것도 안한 상태라 <code>새 키 페어 생성</code>을 선택해 주고 이름을 지정한뒤 키 파일을 받아준다. 이 부분에서도 조심해야할 점이 키 페어를 한번 다운 받으면 다시 동일한 키 페어를 다운받을수가 없게 된다. (나중에 다시 발급을 받아야 하는 번거로운 문제가…) 다운을 받고 잊어버리지 않도록 잘 보관해두자.<br><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="ec2-3.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="ec2-3.jpg" alt=""></a></div><div style="clear:both;"></div></p><p>키 페어를 다운 받으면 생성중이라는 메세지와 함께 결과화면이 나온다. 여기서도 중요한 부분! <code>프리티어</code>라는 달콤한 키워드 때문에 들뜬 마음으로 성급하게 빨리 서버를 받아보고 싶다고 <code>다음다음 신공</code>을 하다보면 자칫 간과할수가 있는데 화면을 보면 <code>결제 알림 생성</code>이라는 다행스러운 기능이 있다. 별 어려운 설정이 아니니 꼭 설정을 해서 필자같이 기부(?)를 하는 일이 발생하지 않았으면 한다…<br><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="ec2-4.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="ec2-4.jpg" alt=""></a></div><div style="clear:both;"></div></p><p>EC2 인스턴스가 생성이 되었다. 인스턴스의 각종 정보를 확인할수가 있는데 public IP, public DNS 까지 제공되는것을 확인할 수 있다. (추후 DNS를 구입하게 되다면 이 IP에 연결을 시켜 도메인으로 해당 서버에 접속을 할수가 있게 된다.)<br><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="ec2-5.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="ec2-5.jpg" alt=""></a></div><div style="clear:both;"></div></p><h3 id="putty-로-발급받은-EC2-인스턴스에-접속을-해보자"><a href="#putty-로-발급받은-EC2-인스턴스에-접속을-해보자" class="headerlink" title="# putty 로 발급받은 EC2 인스턴스에 접속을 해보자."></a># putty 로 발급받은 EC2 인스턴스에 접속을 해보자.</h3><p>이제 발급받은 EC2 인스턴스에 접속을 해볼 차례이다. 다양한 서버 접속툴이 있지만 필자는 putty를 가장 선호한다. 디자인은 구닥다리처럼 보일지 모르겠지만 개인적으로 직관적인 UI에 가벼운 프로그램이라 생각이 든다. 우선 putty를 <a href="https://www.putty.org/" target="_blank" rel="noopener">다운</a> 받고 <code>putty.exe</code>를 실행시킨뒤에 바로 ssh 접속을 하면 너무 간단하게 서버 접속에 성공을 할수 있지만 위에서 받은 키 페어 파일을 다시 private key 로 전환해야 하는데 putty를 다운받으면 동일한 폴더에 <code>puttygen.exe</code>라는 파일을 실행시켜주자.<br>그다음 <code>pem</code>파일을 불러와서 마우스를 움직여서 게이지(?)를 다 채우고 <code>save private key</code>를 줄러 저장을 하는데 여기서 주의할점은 <code>ppk</code>파일명을 <code>pem</code>파일명과 동일하게 저장해야 한다는 것이다. (안그러면 서버 접속시 실패가 남… 삽질…)<br><div class="figure center" style="width:;"><a class="fancybox" href="putty-1.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="putty-1.jpg" alt=""></a></div><div style="clear:both;"></div> </p><p><code>putty.exe</code>를 실행시킨뒤 <code>Connection</code> &gt; <code>SSH</code> &gt; <code>Auth</code> 탭에서 방금 만들어 놓은 <code>ppk</code>파일을 불러오고, 다시 <code>Session</code>탭에서 host name 을 입력해주고 적당한 이름으로 저장을 눌러준다. 여기서 host name은 위에서 EC2 생성시 <code>Amazon Linux AMI</code>를 선택했기 때문에 사용자의 이름은 <code>ec2-user</code>가 되고 인스턴스의 정보중 public DNS와 함께 조합하여 다음과 같은 url을 적어준다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ec2-user@&#123;public DNS&#125;</span><br><span class="line">e.g. ec2-user@ec2-###.compute.amazonaws.com</span><br></pre></td></tr></table></figure></p><div class="figure center" style="width:;"><a class="fancybox" href="putty-2.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="putty-2.jpg" alt=""></a></div><div style="clear:both;"></div> <p>이렇게 하고 해당 세션을 더블클릭 또는 하단에 <code>Open</code>을 누르게 되면 해당 서버로 접속이 되는것을 확인할 수 있다.<br><div class="figure center" style="width:;"><a class="fancybox" href="putty-3.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="putty-3.jpg" alt=""></a></div><div style="clear:both;"></div><br>사실 기술을 배움에 있어 가장 훌륭한 도구는 제공되는 도큐먼트만한게 없다고 생각한다. 그에 필자의 블로그도 좋지만(?) 도큐먼트를 보면서 좀더 자세한 설명을 봐야 한다는 것을 강조하며 이번 포스팅을 마무리 해본다.<br>※ putty로 AWS EC2 접속하기 : <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/putty.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/putty.html</a></p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>다양한 클라우드 서비스들중에 너무나도 신기할정도로 간편하게 클릭 몇번만으로 서버를 띄우고, 서버 접속없이 이또한 클릭 몇번만으로 어플리케이션을 운영할수도 있는 서비스들이 많다. 하지만 필자는 시스템 아키텍쳐를 구성할때엔 버튼 하나로 설치 및 셋팅되는 것보다 직접 설정을 건드려가며 소스로 설치하는 것을 선호한다. 그럼에 AWS의 EC2라는 서비스는 필자의 취향에 너무 알맞는 서비스라며 매력을 느끼고 있는 중이다.<br>사이즈 프로젝트를 진행하면서 보다 다양한 AWS 프리티어 활용기를 포스팅 할 수 있을것 같아 벌써부터 설렌다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;IT 쪽에 일을 하고 있거나 관심을 가지고 있는 사람이라면 한번쯤을 들어봤을 AWS(Amazon Web Services). 이름에서도 알수있는 것처럼 아마존에서 제공하는 각종 원격 컴퓨팅 웹서비스이다.
    
    </summary>
    
      <category term="tech" scheme="https://taetaetae.github.io/categories/tech/"/>
    
    
      <category term="aws" scheme="https://taetaetae.github.io/tags/aws/"/>
    
      <category term="ec2" scheme="https://taetaetae.github.io/tags/ec2/"/>
    
      <category term="putty" scheme="https://taetaetae.github.io/tags/putty/"/>
    
  </entry>
  
  <entry>
    <title>KafkaKRU(Kafka 한국사용자 모임) 밋업 후기</title>
    <link href="https://taetaetae.github.io/2019/03/31/kafka-meetup-2019/"/>
    <id>https://taetaetae.github.io/2019/03/31/kafka-meetup-2019/</id>
    <published>2019-03-30T16:49:30.000Z</published>
    <updated>2019-05-30T08:14:52.053Z</updated>
    
    <content type="html"><![CDATA[<p>필자는 ElasticStack을 사용하면서 처음 카프카를 접하게 되었다. 메세징 큐 라는 개념도 전혀 모르는 상태에서 설치부터 ElasticStack 연동까지 사용하며 정말 <code>강제로</code> 카프카에 대해 공부를 하게 되었다. 카프카를 자주 다루고 메커니즘에 대해 자세히 살펴보다 잠깐 해이해질 무렵 카프카 한국 사용자 모임에서 밋업을 한다고 하길래 빛의 속도로 신청, 아마도 1등으로 신청했지 않았을까 싶다.<a id="more"></a><br>사실 작년 카프카 밋업을 못간게 너무 한(?)이 되어 이번엔 회사 업무 등 여러가지로 한창 바쁘지만 “지금이 아니면 안돼” 라는 생각으로 밋업을 다녀왔고, 짧지만 후기를 작성해 보고자 한다.</p><blockquote><p>(요즘 왜 이렇게 바쁜지 모르겠지만… 신기하게도 그 바쁜 일정들이 하나도 겹치지 않는게 더 신기하다… )</p></blockquote><div class="figure center" style="width:;"><a class="fancybox" href="first.jpg" title="삼성 SDS 건물에서 진행된 카프카 밋업" data-caption="삼성 SDS 건물에서 진행된 카프카 밋업" data-fancybox="default"><img class="fig-img" src="first.jpg" alt="삼성 SDS 건물에서 진행된 카프카 밋업"><span class="image-caption">삼성 SDS 건물에서 진행된 카프카 밋업</span></a><span class="caption">삼성 SDS 건물에서 진행된 카프카 밋업</span></div><div style="clear:both;"></div><p>참고로 필자는 카프카에 대해 아주 조금 건드려본 수준이라 발표하시는 분들의 전부를 습득하기엔 다소 그릇이 작아서 일부 세션은 거의 “그런가보다~” 하고 들을 수 밖에 없었다. 후기도 아마 그런 맥락으로 작성할듯 싶다.</p><ul><li>Kafka 한국 사용자 모임 링크 : <a href="https://www.facebook.com/groups/kafka.kru" target="_blank" rel="noopener">https://www.facebook.com/groups/kafka.kru</a></li></ul><h3 id="카프카를-활용한-캐시-로그-처리-김현준-카카오"><a href="#카프카를-활용한-캐시-로그-처리-김현준-카카오" class="headerlink" title="# 카프카를 활용한 캐시 로그 처리 - 김현준(카카오)"></a># 카프카를 활용한 캐시 로그 처리 - 김현준(카카오)</h3><ul><li>이미지 등 캐시서버의 로그를 분석하기 위한 시스템을 구축하는데 ElasticStack 을 활용</li><li>Elasticsearch 로 늦게 들어와서 사례를 찾아보니 대용량 로깅 처리시 앞단에 메세징 큐를 둬야 한다고 했고 그게 카프카</li><li>카프카 모니터링은 그라파나로 활용</li><li>lag이 자꾸 생김<ul><li>파티션을 쪼개거나, 컨슈머를 늘리는 방법이 있음</li><li>auto.commit.interval.ms 와 enable.auto.commit=true 로 조정</li><li>interval을 줄이니 lag이 줄어듬</li></ul></li><li>현재는 수백대 캐시서버의 로그를 초당 15만건 이상 처리중</li></ul><p>질문을 했다. 필자도 lag이 높아지면 어쩌지 하는 불안감과 높아지면 컨슈머를 늘리면 되겠지 하는 막연함이 있었는데 commit interval을 줄이면 lag이 줄어든다고 해서 무조건 줄이면 좋은가에 답변은 카프카를 관리하는 주키퍼쪽에 무리가 간다고 설명해 주셨다. 역시 만병통치약은 없고 상황에 따라 적절하게 시스템 관리자가 조정해가며 운영해야 하는점을 느꼈다.</p><ul><li>참고 URL : <a href="https://kafka.apache.org/documentation/#adminclientconfigs" target="_blank" rel="noopener">https://kafka.apache.org/documentation/#adminclientconfigs</a></li></ul><h3 id="카프카를-활용한-엘라스틱서치-실무프로젝트-소개-이은학-메가존"><a href="#카프카를-활용한-엘라스틱서치-실무프로젝트-소개-이은학-메가존" class="headerlink" title="# 카프카를 활용한 엘라스틱서치 실무프로젝트 소개 - 이은학(메가존)"></a># 카프카를 활용한 엘라스틱서치 실무프로젝트 소개 - 이은학(메가존)</h3><ul><li>카드사의 프로젝트를 약 3개월간 개발하였고 전체 아키텍쳐 중에 일부분을 kakfa를 활용</li><li>Elasticsearch 데이터를 hadoop에 백업 형태로 옮기며 관리</li><li>filebeat &gt; kafka &gt; spark streaming 을 활용하여 데이터의 검증처리가 가능 (특정 상황에서의 관리자에게 알림 등)</li><li>logstash 의 ruby 필터를 활용하여 일정의 작업을 해주는 데이터 파이프라인 구성 가능 (개인정보 식별 등)</li><li>logstash 는 cron형태의 배치로도 가능</li></ul><p>또 질문을 하였다. (카프카 밋업과는 무관했지만…) logastsh 를 사용하면서 필터쪽에 로직이 들어가면 성능상 괜찮냐는 질문에 하루에 15억건을 처리하고있고 문제가 없었다고 한다. 필자는 아파치 엑세스 로그를 logstash로 처리하면서 간혹 뻗거나 에러가 발생했는데 아마 파일을 logstash가 직접 바라보고 처리도 하게해서 그런것 같다. (지금은 filebeat가 shipper 역활을 수행하고 있고 큰 무리 없이 운영중)</p><h3 id="카프카를-활용한-rabbitMQ-로그처리-정원빈-카카오"><a href="#카프카를-활용한-rabbitMQ-로그처리-정원빈-카카오" class="headerlink" title="# 카프카를 활용한 rabbitMQ 로그처리 - 정원빈 (카카오)"></a># 카프카를 활용한 rabbitMQ 로그처리 - 정원빈 (카카오)</h3><ul><li>레빗엠큐는 erlang으로 구현된 AMQP 메시지 브로커이고 TCP기반으로 구성</li><li>Kafka 는 게으르지만 메우 효율성이 뛰어남, 반면 RabbitMQ 는 똑똑하지만 보다 느림</li><li>Kafka 에서 Elasticsearch 로의 ingset 는 NIFI를 활용</li><li>레빗엠큐와 카프카의 차이</li></ul><table><thead><tr><th></th><th>Kafka</th><th>RabbitMQ</th></tr></thead><tbody><tr><td>컨슈머 추가</td><td>여러 컨슈머가 하나의 메세지를 동시에 할수 있어 확장에 용이함</td><td>확장할때마다 큐를 추가 생성해야함</td></tr><tr><td>메세지 저장</td><td>로그기반으로 디스크에 저장, 리텐션 이후 삭제</td><td>큐 기반으로 메모리에 저장 컨슈머가 메세지 수신시 즉시 삭제</td></tr><tr><td>메세지 처리</td><td>발송확인 가능 / 수신확인 불가능</td><td>발송확인/수신확인 가능</td></tr></tbody></table><h3 id="카프카를-마이크로서비스-아키텍쳐에-활용하기-이동진-아파치-소프트웨어-파운데이션"><a href="#카프카를-마이크로서비스-아키텍쳐에-활용하기-이동진-아파치-소프트웨어-파운데이션" class="headerlink" title="# 카프카를 마이크로서비스 아키텍쳐에 활용하기 - 이동진 (아파치 소프트웨어 파운데이션)"></a># 카프카를 마이크로서비스 아키텍쳐에 활용하기 - 이동진 (아파치 소프트웨어 파운데이션)</h3><ul><li>카프카 스트림즈 소개 (Interactive Query)</li><li>카프카를 활용하여 마이크로서비스에서 사용하려면 데이터를 임시 공간에 넣어두고 (redis 같은?) 빼서 사용하는 형태가 아니라 Interactive Query 또는 Queryable Store 로 활용 가능</li></ul><p>사실 이부분은 필자가 제대로 못따라간 세션중에 하나이다. 용어나 메커니즘도 다소 생소했고 대략 어떤 부분을 발표해주시는지 느낌은 있었으나 제대로 이해를 못해서 …  부끄럽지만 카프카 스트림즈의 공식링크로 대체한다. </p><p><a href="https://kafka.apache.org/documentation/streams/" target="_blank" rel="noopener">https://kafka.apache.org/documentation/streams/</a></p><h3 id="카프카-프로듀서-amp-컨슈머-강한구-카카오-모빌리티"><a href="#카프카-프로듀서-amp-컨슈머-강한구-카카오-모빌리티" class="headerlink" title="# 카프카 프로듀서 &amp; 컨슈머 - 강한구 (카카오 모빌리티)"></a># 카프카 프로듀서 &amp; 컨슈머 - 강한구 (카카오 모빌리티)</h3><ul><li>프로듀서<ul><li>메세지를 생산 및 전송</li><li>Accumulator : 사용자가 send한 record를 메모리 쌓는 역활</li><li>Network thread : 전송</li><li>각 옵션 활용법 (도큐먼트 문서로 대체)<ul><li><a href="https://docs.confluent.io/current/installation/configuration/producer-configs.html#linger-ms" target="_blank" rel="noopener">linger.ms</a></li><li><a href="https://docs.confluent.io/current/installation/configuration/producer-configs.html#max-request-size" target="_blank" rel="noopener">max.request</a></li><li><a href="https://docs.confluent.io/current/installation/configuration/producer-configs.html#max-in-flight-requests-per-connection" target="_blank" rel="noopener">max.in.flight.requests.per.connection</a></li></ul></li></ul></li><li>브로커<ul><li>메세지를 저장</li><li>topic name - partition 폴더 구조</li><li>세그먼트 단위로 저장 (*.index, *.log, *.timeindex)</li></ul></li><li>컨슈머<ul><li>Fetcher : 네트워크 스레드와 비슷한 역할</li><li>Coordinator : 어떤 토픽의 어떤 파티션을 comsume할지, 브로커의 그룹 코디네이터와 통신 (hearbeat, offset comit, consumer group join)</li></ul></li></ul><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><div class="figure center" style="width:;"><a class="fancybox" href="meetup.jpg" title="발표자 분들과 질문 두번에서 받은 책선물" data-caption="발표자 분들과 질문 두번에서 받은 책선물" data-fancybox="default"><img class="fig-img" src="meetup.jpg" alt="발표자 분들과 질문 두번에서 받은 책선물"><span class="image-caption">발표자 분들과 질문 두번에서 받은 책선물</span></a><span class="caption">발표자 분들과 질문 두번에서 받은 책선물</span></div><div style="clear:both;"></div><p>확실히 수박 겉핥기 식으로  보다보니 지식에 대한 깊이도 얕아 발표자분이 전달하시고자 하는 내용을 100% 다 수용하기엔 힘들었다. 다음엔 가기전에 미리 밋업 발표에 대한 공부를 조금이라도 하고 들을 준비를 한 뒤에 참여하는것으로… 하지만 카프카를 활용해서 다양한 시스템 구성 방법론에 대해 간접으로라도 배울수 있었고, 현재 필자가 운영하고 있는 카프카의 설정값들을에 대해 잘 설정이 되어있나 (막연히 기본값들로만 설정되어 있지는 않은가) 살펴볼 계기가 만들어진것 같다. 이번에도 <code>다행히</code> “행사에 참여하면 꼭 질문을 하나이상 하자!” 라는 나와의 약속을 지킬수 있어 다행이었다.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;필자는 ElasticStack을 사용하면서 처음 카프카를 접하게 되었다. 메세징 큐 라는 개념도 전혀 모르는 상태에서 설치부터 ElasticStack 연동까지 사용하며 정말 &lt;code&gt;강제로&lt;/code&gt; 카프카에 대해 공부를 하게 되었다. 카프카를 자주 다루고 메커니즘에 대해 자세히 살펴보다 잠깐 해이해질 무렵 카프카 한국 사용자 모임에서 밋업을 한다고 하길래 빛의 속도로 신청, 아마도 1등으로 신청했지 않았을까 싶다.
    
    </summary>
    
      <category term="review" scheme="https://taetaetae.github.io/categories/review/"/>
    
    
      <category term="kafka" scheme="https://taetaetae.github.io/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Write The Docs 서울 밋업 후기 (개발자 강추!)</title>
    <link href="https://taetaetae.github.io/2019/03/24/write-the-docs-seoul-2019-review/"/>
    <id>https://taetaetae.github.io/2019/03/24/write-the-docs-seoul-2019-review/</id>
    <published>2019-03-24T12:43:14.000Z</published>
    <updated>2019-05-30T08:14:51.642Z</updated>
    
    <content type="html"><![CDATA[<p>필자는 평소 개발자에게 가장 중요한 덕목 중 하나가 <code>글쓰기</code>라고 생각하고 있다. 마침 글쓰기와 기술의 접점을 고민하고 이야기하는 “Write The Docs 서울 밋업”(<a href="https://festa.io/events/191" target="_blank" rel="noopener">링크</a>) 이 있다고 하여 쉬고 싶던 주말이지만 만사를 집어치우고 참석하게 되었다. <a id="more"></a>사실 연예인 개발자분들을 직접 만날 수 있다는 기대감도 있었기 때문이다. (발표하시는 바로 앞자리에 앉았는데 정작 한마디도 못 건넸지만…)</p><div class="figure fig-75 center" style="width:;"><a class="fancybox" href="intro.jpg" title="밋업 가능길 문득 나를 사로잡았던 문구와 밋업 장소 마루 180" data-caption="밋업 가능길 문득 나를 사로잡았던 문구와 밋업 장소 마루 180" data-fancybox="default"><img class="fig-img" src="intro.jpg" alt="밋업 가능길 문득 나를 사로잡았던 문구와 밋업 장소 마루 180"><span class="image-caption">밋업 가능길 문득 나를 사로잡았던 문구와 밋업 장소 마루 180</span></a><span class="caption">밋업 가능길 문득 나를 사로잡았던 문구와 밋업 장소 마루 180</span></div><div style="clear:both;"></div><p>발표에 앞서 “이 발표 자료는 공개할 예정이니 필기하실 필요가 없다”라고 하셨다. 하지만 뒤통수를 (좋은 의미) 몇 대 아니 몇십대 맞은 느낌이라 정리를 하지 않을 수가 없었고 오늘 느끼고 배운 마음을 쭉 유지하고 싶어(내 것으로 만들고 싶어) 후기를 작성해 본다. 더불어 제목에 감히 개발자 강추!라고 적을만큼 최근 밋업 행사 중에 손꼽을 정도로 좋았기 때문이다.</p><div class="figure center" style="width:;"><a class="fancybox" href="action.gif" title="이정도로 쌔게 맞은건 아니다...<br>출처 : https://namu.moe/w/뒤통수" data-caption="이정도로 쌔게 맞은건 아니다...<br>출처 : https://namu.moe/w/뒤통수" data-fancybox="default"><img class="fig-img" src="action.gif" alt="이정도로 쌔게 맞은건 아니다...<br>출처 : https://namu.moe/w/뒤통수"><span class="image-caption">이정도로 쌔게 맞은건 아니다...<br>출처 : https://namu.moe/w/뒤통수</span></a><span class="caption">이정도로 쌔게 맞은건 아니다...<br>출처 : https://namu.moe/w/뒤통수</span></div><h3 id="변성윤-소카-글쓰는-개발자-모임-글또"><a href="#변성윤-소카-글쓰는-개발자-모임-글또" class="headerlink" title="# 변성윤(소카) - 글쓰는 개발자 모임, 글또"></a># 변성윤(소카) - 글쓰는 개발자 모임, 글또</h3><div class="figure fig-50 center" style="width:;"><a class="fancybox" href="session-1.jpg" title="변성윤 님" data-caption="변성윤 님" data-fancybox="default"><img class="fig-img" src="session-1.jpg" alt="변성윤 님"><span class="image-caption">변성윤 님</span></a><span class="caption">변성윤 님</span></div><div style="clear:both;"></div><p>필자도 가입만 하고 활동은 안 하는 중인 “글 쓰는 개발자 모임 - 글또” 모임에 대해 소개해주셨다. 글을 꾸준히 작성하기 위해 만들었고, 일정에 예치금을 내고 정해진 규칙에 의해 블로그에 글을 올리면 다시 돈을 환급받는 반강제적인 모임이라고 한다. 그뿐만 아니라 다른 분들이 글을 써서 공유를 하면 성윤님이 직접 피드백을 주며 개발 시 리팩토링을 하듯 더 나은 품질의 글을 쓸 수 있도록 도움을 주고 있다고 하신다. 이러한 피드백 문화가 1:N이 아닌 N:N이 되면 또 다른 동기부여가 될 것 같은데 … 하는 아쉬움을 느꼈다.<br>사실 “글을 꾸준히 작성”하는 부분이 필자도 매우 공감이 된다. 바쁘고, 귀찮고, 글을 쓰려면 욕심이 생기고 그러다 미루고… 그 동기부여가 “돈” 일수밖에 없는 현실이 아쉽긴 한데 오히려 그 “돈”만큼 동기부여가 잘 되는 것도 없을것 같다. (헬스장 1년 권 계약하고 돈이 아까워서라도 나가는 느낌으로…)<br>올해 새로운 기수를 모집한다고 하니 그때는 꼭 지원해서 글을 꾸준히 쓰는 습관을 길러보고 싶다.</p><h3 id="김대권-당근마켓-기술-블로그-생존-전략-구글-시대의-글쓰기"><a href="#김대권-당근마켓-기술-블로그-생존-전략-구글-시대의-글쓰기" class="headerlink" title="# 김대권(당근마켓) - 기술 블로그 생존 전략 : 구글 시대의 글쓰기"></a># 김대권(당근마켓) - 기술 블로그 생존 전략 : 구글 시대의 글쓰기</h3><div class="figure fig-50 center" style="width:;"><a class="fancybox" href="session-2.jpg" title="김대권 님" data-caption="김대권 님" data-fancybox="default"><img class="fig-img" src="session-2.jpg" alt="김대권 님"><span class="image-caption">김대권 님</span></a><span class="caption">김대권 님</span></div><div style="clear:both;"></div><p>얼마 전에 한번 쓱 보고 정독할 수밖에 없던 포스팅인 <a href="[https://www.44bits.io/ko/post/8-suggestions-for-tech-programming-blog](https://www.44bits.io/ko/post/8-suggestions-for-tech-programming-blog">좋은 기술 블로그를 만들어 나가기 위한 8가지 제언</a> 을 작성하시고, 해당 기술블로그 를 운영하시고 계시는 김대권 님께서 글을 왜 쓰는지, 그리고 어떻게 하면 사람들에게 잘 읽힐 수 있을지에 대해 구글 검색엔진 관점에서 정리해주셨다.<br>우리는 보통 읽히기 위해 공개된 글을 쓰기 때문에 좋은 글을 쓰는 게 선행되어야 하지만 반대로 어떻게 하면 잘 읽힐 수 있을지에 대해 고민이 필요한 부분 같다.  요즘은 소셜미디어나 검색을 통해 글이 공유되고 검색되는데 장기적으로 봤을 때는 검색엔진에 노출이 돼야 한다고 하신다.  또한 검색엔진은 백과사전처럼 정답을 알려주는것이 아닌 “거대한 추천 시스템”의 관점으로 접근해야 하며, 글의 양이 너무 크거나 적으면 안 되고 적당한(?) 수준을 지켜야 이를 검색엔진이 알아서 판단한다고 한다.<br>또한 <a href="[http://blog.weirdx.io/post/60414](http://blog.weirdx.io/post/60414">What nobody tells you about documentation (번역본)</a> 이라는 것도 소개해주시며 결국엔 글 내용의 자체가 좋아야 한다고 재차 강조하셨다. (매우 공감, SEO 아무리 잘 설정해봤자 내용이 안 좋으면 말짱 꽝)</p><h3 id="홍연의-LINE-To-지식-공유를-시작하려는-개발자-From-당신의-든든한-서포터-Developer-Relations팀"><a href="#홍연의-LINE-To-지식-공유를-시작하려는-개발자-From-당신의-든든한-서포터-Developer-Relations팀" class="headerlink" title="# 홍연의(LINE) - To. 지식 공유를 시작하려는 개발자, From. 당신의 든든한 서포터 Developer Relations팀"></a># 홍연의(LINE) - To. 지식 공유를 시작하려는 개발자, From. 당신의 든든한 서포터 Developer Relations팀</h3><div class="figure fig-50 center" style="width:;"><a class="fancybox" href="session-3.jpg" title="홍연의 님" data-caption="홍연의 님" data-fancybox="default"><img class="fig-img" src="session-3.jpg" alt="홍연의 님"><span class="image-caption">홍연의 님</span></a><span class="caption">홍연의 님</span></div><div style="clear:both;"></div><p>다소 생소한 Developer Relations 팀에 대해 소개를 해주시며 꼭 기술 관점이 아닌 다양한 분야에서 해당 팀이 어떤 지원을 해주고 있는지에 대해 알려주셨다. 기술 블로그 운영, 소셜 페이지 관리, 개발 컨퍼런스, 세미나, 커뮤니티 후원 등등 개발자와 개발 문화를 알리는 모든 일을 하고 있다고 한다.<br>옆 회사(?)이지만 저런 개발자의 문화를 만드는 팀이 있다는 게 부럽기도 하였고, 가끔 세미나가 있는 걸로 아는데 공개적으로 하면 어떨까 하는 아쉬움이 있지만… 점차 private에서 public으로 확대될 꺼라 기대를 해본다.<br>발표를 내가 직접 들으며 이러한 문화를 만들 수도 있겠구나 하는 생각도 해봤다. 작게는 팀 단위부터 시작해서 서버/앱 등 개발자들을 모아두고 관심 있는 사람들끼리 공유하는 자리를 정기적으로 만드는… 중요한 건 “정기적”으로… 일단 나부터라도 시작을 해보자.</p><h3 id="조은별-시큐아이-사용자를-외면하지-않는-릴리스-노트"><a href="#조은별-시큐아이-사용자를-외면하지-않는-릴리스-노트" class="headerlink" title="# 조은별(시큐아이) - 사용자를 외면하지 않는 릴리스 노트"></a># 조은별(시큐아이) - 사용자를 외면하지 않는 릴리스 노트</h3><div class="figure fig-50 center" style="width:;"><a class="fancybox" href="session-4.jpg" title="조은별 님" data-caption="조은별 님" data-fancybox="default"><img class="fig-img" src="session-4.jpg" alt="조은별 님"><span class="image-caption">조은별 님</span></a><span class="caption">조은별 님</span></div><div style="clear:both;"></div><p>테크니컬 라이터가 무슨 일을 하고 어떤 부분에서 고민을 하는지에 대해 소개를 해주셨다. 하나의 예로 앱스토어에서 릴리즈 노트를 보면 A라는 앱은 단순 “기능 개선”, “버그 수정” 인데 B라는 앱은 개발과 무관한 일반 사용자가 보더라도 상세히 적힌 걸 볼 수 있다. 이것만 봐도 그 앱에 대한 신뢰가 높아질 수 있는 부분이라고 생각할 수 있다는 점에서 나는 commit message, PR 등 너무 의미 없는 메세지들로 일관한 건 아닐까 하는 반성을 할 수 있었다. (뜬금스럽지만…)<br>프로야구의 더블플레이 룰이 올해부터 개정되는 것을 예로 들어주며 누가 읽고, 어떻게 읽으며 무엇을 읽는가에 대해 관점을 가지고 해당 사용자 시선에서 이해할 수 있도록 하는 게 가장 좋다고 설명해 주셨다. (이 분야 또한 리펙토링의 반복… )</p><h3 id="이동욱-우아한형제들-개발자는-왜-블로그를-해야하나요"><a href="#이동욱-우아한형제들-개발자는-왜-블로그를-해야하나요" class="headerlink" title="# 이동욱(우아한형제들) - 개발자는 왜 블로그를 해야하나요?"></a># 이동욱(우아한형제들) - 개발자는 왜 블로그를 해야하나요?</h3><div class="figure fig-50 center" style="width:;"><a class="fancybox" href="session-5.jpg" title="이동욱 님" data-caption="이동욱 님" data-fancybox="default"><img class="fig-img" src="session-5.jpg" alt="이동욱 님"><span class="image-caption">이동욱 님</span></a><span class="caption">이동욱 님</span></div><div style="clear:both;"></div><p>기술블로그를 어떻게 써야 하고 어떤 식으로 관리를 해야 하는지가 아닌 조금 더 강한 느낌의 “개발자는 기술블로그를 해야 한다” 의 이유를 설명해주셨다. 동욱님은 블로그를 통해 이직도 하고 기고&amp;집필 요청도 받으시고 인터뷰 요청도 받고…심지어 광고수입으로 매월 70~100달러가 들어온다고 한다. (필자의 몇 배인지 가늠도 안 간다…)<br>다양한 분야에서 얻은 이득이 많기 때문에 기술블로그를 해야 한다고 말하고 있고, 연봉/회사/직위/재산을 빼고 나를 표현할 수 있는 것이라고는 기술블로그밖에 없다고 한다. (극 공감) 필자도 서두에 말했던 것처럼 개발자는 글을 써야 한다고 하는 사람 중에 한 명이다 보니 동욱님의 발표 하나하나가 너무 몸 쪽 깊숙이 들어와서 글을 좀더 자주 + 잘 써야겠다고 다짐을 하게 되었다. 그리고 마지막에 말씀하신 중국 속담 하나가 아직까지 필자의 뒤통수를 계속 때리고 있다.<br><code>아무리 흐린 잉크라도 좋은 기억력보다 낫다</code></p><h3 id="변정훈-BlockchainOS-개발-관련-기술-블로그-운영하기"><a href="#변정훈-BlockchainOS-개발-관련-기술-블로그-운영하기" class="headerlink" title="# 변정훈(BlockchainOS) - 개발 관련 기술 블로그 운영하기"></a># 변정훈(BlockchainOS) - 개발 관련 기술 블로그 운영하기</h3><div class="figure fig-50 center" style="width:;"><a class="fancybox" href="session-6.jpg" title="변정훈 님" data-caption="변정훈 님" data-fancybox="default"><img class="fig-img" src="session-6.jpg" alt="변정훈 님"><span class="image-caption">변정훈 님</span></a><span class="caption">변정훈 님</span></div><div style="clear:both;"></div><p>국내에 몇 안되는, 오랫동안 기술블로그를 운영해오시는 개발자 중에 한분인 아웃사이더 변정훈님께서 어떤 식으로 기술블로그를 운영해야 하는가에 대해 발표해주셨다. 필자와는 다르게 (워낙 많이 쓰셔서 일것 같지만) 퇴고는 잘 안 하시고 항상 글을 작성할 것을 생각하며 개인 노트에 메모하고 글을 쓴다고 하신다. (필자도 얼마 전부터 <a href="https://notion.so/" target="_blank" rel="noopener">노션</a>이라는 것을 활용해서 관리하고 있는데… 잘 따라 하고 있는 것 같아 나름 뿌듯함을 느꼈다.)<br>이 세션에서도 뒤통수를 때리는 멘트가 많았는데… 괜히 유명하신 분이 아니구나 싶을 정도였다. (심지어 멘트마저…)</p><ul><li>공부할 시간도 적은데 블로그는 또 언제 쓰는가 &gt; 공부할게 많으니까 블로그를 쓴다. (캬~ 1)</li><li>글을 지속적으로 쓰려면 어떻게 해야 하는가 &gt; 꾸준히 쓰다 보니 이제는 근육처럼 되었다. (캬~ 2)</li><li>문제가 생겨 검색해보고 해결한다고 해서 내 것이 되는 것은 아님 &gt; 내가 직접 재현을 해보고 테스트를 해봐야 내것이 됨. (캬~ 3)</li></ul><p>나름의 철학으로 글을 작성할 때 일관된 흐름을 유지하려고 노력 중이시고 그게 구글에서 검색하면 아웃사이더님의 글이 처음으로 나오는 이유가 아닐까 싶다. (그만큼 사이트의 신뢰도가 높아져서?)</p><h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>무슨 말이 필요하겠는가. 필자의 메모장에도 블로깅을 하려고 적어놓은 것들만 있지 실제로 실행에 옮기지 못하고 있는데 꾸준히, 그리고 체계적으로, 읽는 사람의 위치에서 글을 잘 써보겠다고 다짐할 수 있었던 좋은 행사였다. 한 가지, 밋업이 끝나고 네트워킹 행사나 뒷풀이가 있었으면 좋았을 텐데 하는 아쉬움이 있었지만 다른 행사에서 자주 찾아뵈고 하다 보면 인연이 생길 꺼라 감히 소망해본다.</p><p>#wtdseoul #WritetheDocs</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;필자는 평소 개발자에게 가장 중요한 덕목 중 하나가 &lt;code&gt;글쓰기&lt;/code&gt;라고 생각하고 있다. 마침 글쓰기와 기술의 접점을 고민하고 이야기하는 “Write The Docs 서울 밋업”(&lt;a href=&quot;https://festa.io/events/191&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;링크&lt;/a&gt;) 이 있다고 하여 쉬고 싶던 주말이지만 만사를 집어치우고 참석하게 되었다.
    
    </summary>
    
      <category term="review" scheme="https://taetaetae.github.io/categories/review/"/>
    
    
      <category term="blog" scheme="https://taetaetae.github.io/tags/blog/"/>
    
      <category term="write" scheme="https://taetaetae.github.io/tags/write/"/>
    
      <category term="write the docs" scheme="https://taetaetae.github.io/tags/write-the-docs/"/>
    
  </entry>
  
</feed>
