
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="꿈꾸는 태태태의 공간">
    <title>시계열 데이터를 분석하여 미래 예측 하기(Anomaly Detection) - 꿈꾸는 태태태의 공간</title>
    <meta name="author" content="taetaetae">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"taetaetae","sameAs":["https://facebook.com/taetaetae0","https://www.linkedin.com/in/태관-권-517825129/","mailto:taetaetae_@naver.com"],"image":"profile.png"},"articleBody":"급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까? 위 질문에 공통된 정답은 예전 기록들인것 같다. 날씨예측은 기상청에서 과거 기록들을 보고 비가 올지 말지를 결정하고 ( 과거 날씨 서비스를 담당해봤지만 단순히 과거 기록들로 예측한다는건 불가능에 가깝긴 하다. ) 매장 운영시간은 예전에 손님들이 언제왔는지에 대한 데이터를 보고. 비트코인이나 주식은 차트를 보고 어느정도는 상승장일지 하락장일지 추측이 가능하다고 한다. ( 물론 호재/악재에 따라 흔들리지만..ㅠㅠ..?? )이처럼 시간의 흐름에 따라 만들어진 데이터를 분석하는것을 시계열 데이터 분석이라 부르고 있다. 필자가 운영하는 서비스에서 시계열 데이터 분석을 통해 장애를 사전에 방지하는 사례를 공유 해보고자 한다.\n# 상황파악부터손자병법에는 지피지기 백전불태 라는 말이 있다. 그만큼 현 상황을 잘 알아야 대응을 잘할수 있다는것. 필자가 운영하는 서비스는 PG(Payment Gateway) 서비스로 쇼핑몰같은 온/오프라인 사업자와 실제 카드사와의 중간 역활을 해주고 있다. 이를테면 사용자가 생수를 10,000원에 XX카드로 구매해줘 라고 요청이 오면 그 정보를 다시 형식에 맞춰 카드사로 전달하여 사용자가 물건을 구매할수 있도록 해준다.PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.\n# 요구사항 및 과거 데이터 분석서비스를 운영해보니 감지하기 어려운 상황들이 있었다. \n\n연동하는 쇼핑몰에서 문제가 발생하거나 네트워크 문제가 발생할경우 즉, 트래픽이 평소보다 적게 들어올 경우\n정상적인 에러(e.g. 잔액부족) 가 갑자기 많이 발생할 경우\n\n이를 분석하기위해 기존의 트래픽/데이터를 분석해봐야 했다.결제건수 Kibana Visualize, 기영이 패턴결제건수 Kibana Visualize, 기영이 패턴위 그래프는 결제데이터 카운트 인데 어느정도 패턴을 찾을수 있다.에러건수 Kibana Visualize, 악어 패턴..(무리수..)에러건수 Kibana Visualize, 악어 패턴..(무리수..)위 그래프는 에러카운트 인데 일정한 패턴 속에서 어느 지점에서는 튀는것을 확인할수 있다. (빨간색 영역) 그렇다면 어떤 방법으로 장애상황보다 앞서서 감지를 할수 있을까? ( 장애 : 어떠한 내/외부 요인으로 인해 정상적인 서비스가 되지 않는 상태 )\n# 장애발생 전에 먼저 찾아보자!가장 간단하게는 기존 데이터를 보고 수동으로 설정하는 방법이 있을수 있다. 예로들어 자정 즈음에는 결제량이 가장 많기때문에 약 xx건으로 설정해두고, 새벽에는 결제량이 가장 적기 때문에 약 yy건으로 설정해둔 후 에러 건수나 결제건수에 대해 실시간으로 검사를 해가면서 설정한 값보다 벗어날 경우 알림을 주는 방법이다.하지만 아무리 과거 데이터를 완벽하게 분석했다 할지라도 24시간 모든 시점에서 예측은 벗어날 수밖에 없다. (예로들어 쇼핑 이벤트를 갑작스럽게 하게되면 결제량은 예측하지 못할정도로 늘어날테고…) 또한 설정한 예측값을 벗어날 경우 수동으로 다시 예측값을 조정해줘야 하는데, 이럴꺼면 24시간 종합 상황실에서 사람이 직접 눈으로 보는것 보다 못할것 같다. (인력 리소스가 충분하다면 뭐… 그렇게 해도 된다.)\n# 지난 데이터와 비교하기일주일 기준으로 지난 일주일과의 데이터를 비교해보는 방법또한 있다. 간단하게 설명하면 이번주 월요일 10시의 데이터와 지난주 월요일 10시의 데이터의 차이를 비교해보는 방법이다. 키바나에서 클릭 몇번만으로 시각화를 도와주는 Visualize 기능을 통해 지난 일주일과 이번주를 비교해보면 아래 그래프처럼 표현이 가능하다.일주일 전 데이터와 단순 비교일주일 전 데이터와 단순 비교이 경우도 지난주 상황과 이번주 상황이 다른 경우에는 원하는 비교 항목 외에 다른 요인이 추가되기 때문에 원하는 비교를 할수가 없고 위에서 수동으로 설정하는 방법과 별반 다를바 없을것으로 생각된다.\n# 조금더 우아하게! (언제부턴가 우아하단 말을 좋아하는것 같다..)개발자는 문제에 대해서 언제나 분석을 토대로 접근을 하는것을 목표로 해야한다. 언제부턴가 Hot한 머신러닝을 도입해 보고 싶었으나 아직 그런 실력이 되질 못하고… 폭풍 구글링을 통해 알게된 Facebook에서 만든 Prophet이라는 모듈을 활용해보고자 한다.https://opensource.fb.com/#artificial 이곳에 가보면 여러 Artificial Intelligence 관련된 오픈소스들중에 Prophet 모듈을 찾을수 있다. 다행히도 BSD License라서 실무에서도 다양하게 활용할수 있을것으로 보인다. 친절하게도 Quick Start을 통해 어떤식으로 예측을 하는지 보여준다. 참고로 Python 과 R 을 지원한다. (python 의 대단함을 다시금 느끼며…)구성은 CentOS 7 + python3.6 + jenkins 를 활용한다. (python 경험이 부족하므로 코드가 허접할수도 있으니 양해바란다.)데이터 분석시 가장 많이 사용된다는 Pandas와 대규모 다차원 배열을 쉽게 처리 할 수 있게 해주는 numpy, 그리고 bprophet를 비롯한 필요한 모듈들을 pip로 설치해준다.123pip install pandaspip install fbprophetpip install numpy\n필요한 모듈들을 import를 한다.123456import matplotlibmatplotlib.use('Agg') // centos 서버 환경에서 돌릴경우 예측결과를 그래프로 보는 과정에서 오류가 발생한다. 이를 방직하기 위해 해당 코드를 적어준다.import pandas as pdimport requests, datetimefrom fbprophet import Prophet\n기존에 데이터들은 모두 실시간으로 elasticserach에 인덱싱 중이기 때문에 rest api 를 활용하면 쉽게 데이터를 얻을수가 있다. (RDB로 관리를 했더라면… 배보다 배꼽이 더 큰 상황이였지 않았을까 하는 생각이 든다.)123456789101112131415161718192021# 현재 시 기준 2주 (24 x 14 시간) 전의 데이터를 가져온다.day_gap = 14now_datetime = datetime.datetime.now()end_time = datetime.datetime(now_datetime.year, now_datetime.month, now_datetime.day, now_datetime.hour, 0,0)end_time_stamp = str(int(end_time.timestamp() * 1000))start_time = end_time - datetime.timedelta(days=day_gap)start_time_stamp = str(int(start_time.timestamp() * 1000))url = 'http://elasticsearch:9200/_msearch'headers = &#123;    \"Content-Type\" : \"application/x-ndjson\"&#125;es_data = '&#123;\"index\":[\"index_name\"]&#125;\\n&#123;\"size\":0,\"query\":&#123;\"bool\":&#123;\"must\":[&#123;\"range\":&#123;\"log_time\":&#123;\"gte\":' + start_time_stamp + ',\"lte\":' + end_time_stamp + '&#125;&#125;&#125;]&#125;&#125;,\"aggs\":&#123;\"2\":&#123;\"date_histogram\":&#123;\"field\":\"log_time\",\"interval\":\"1h\", \"time_zone\":\"Asia/Tokyo\"&#125;&#125;&#125;&#125;\\n'response_list = requests.post(url=url, headers=headers, data=es_data.encode('utf-8')).json()['responses'][0]['aggregations']['2']['buckets']print('기준 : ' + str(start_time) + ' ~ ' + str(end_time))# es 데이터 중 시간값을 형식에 바꾸면서 key-value 형태로 정제한다.query_result = &#123;&#125;for data in response_list :    query_result[data['key_as_string'].replace('T',' ').replace('.000+09:00', '')] = data['doc_count']\nelasticsearch에서 aggregation을 활용하여 데이터를 1시간 단위로 가져올경우 데이터가 없는 경우를 대비해 비어있는 시간에 해당하는 카운트를 0으로 맞춰주기 위하여 loop를 돌며 데이터를 정제해준다. (이 방법보다 더 좋은 방법이 분명 있을것이다…)\n123456789anomaly_detection_base_data = &#123;&#125;for data in range(24 * day_gap) :    key_date_time = start_time.strftime('%Y-%m-%d %H:00:00')    if key_date_time in query_result :        anomaly_detection_base_data[key_date_time] = query_result[key_date_time]    else :        anomaly_detection_base_data[key_date_time] = 0    start_time = start_time + datetime.timedelta(hours=1)\npandas 를 활용하여 데이터를 DataFrame 형식에 맞춰준 다음 시간기준으로 다음 24시간의 데이터를 예측하도록 한다.12345df = pd.DataFrame(list(anomaly_detection_base_data.items()), columns=['ds', 'y'])m = Prophet()m.fit(df)future = m.make_future_dataframe(periods=24 , freq='H')forecast = m.predict(future)\n실제 집계한 값과 예측값을 비교하여 알림발생 유무를 결정한다.123456789# 현재시간 -1시간 전 실제 집계check_datetime = now_datetime - datetime.timedelta(hours=1)check_datetime = check_datetime.strftime('%Y-%m-%d %H:00:00')check_datetime_count = query_result[check_datetime]print('실제 집계수 : ' + check_datetime + ' → ' + str(check_datetime_count))# 예측 최대치forecast_max_count = forecast[forecast.ds == check_datetime]['yhat_upper'].values[0]print('예측 최대치 : ' + check_datetime  + ' → ' +  str(forecast_max_count))\n여기서는 에러 카운트가 평소와는 다르게 발생할 경우에 알림을 발송을 하려 하기때문에 아래처럼 구성을 해준다.12345if check_datetime_count &gt; forecast_max_count :  # 예측한 결과를 이미지로 저장후 알림에 포함시켜준다.  forecast_graph = m.plot(forecast, plot_cap=False, xlabel='time', ylabel='count');  file_name = 'forecast_graph.png'  forecast_graph.savefig(file_name)\n이런 python script를 jenkins 를 활용하여 1시간에 한번씩 실행될수있도록 구성해 두고 문제가 발생할때는 아래처럼 메일로 알림을 받는다.예측결과예측결과위 그래프를 분석하면 다음과 같다.\n\n검정색 점 : 실제 데이터\n파란 실선 : 트랜드 그래프\n하늘색 음영 : 예측한 최대/최소치의 영역빨간색으로 표시한 점 두개를 보면 예측을 벗어난것을 확인할수 있고 실제로 저 시간대에 내부적 이슈로 인해 에러가 많이 발생한 경우이다. (장애 발생 시점)\n\n이런식으로 구성을 해두면 앞서 수동으로 최대/최소 수치를 정해두고 이탈했는지에 대해서 모니터링 하는것보다 훨씬더 우아하게 모니터링을 할수있다.물론 해당 모듈이 완벽하다는 소리는 아니다. 필자도 해당 모듈을 사용하다보니 어떤 경우에서는 예측수치와 실제 데이터가 비슷한 경우가 있어 알람을 받은 경우도 있다. 예전 포스팅에서도 이야기 했듯 정답은 없는것 같다. 상황에 맞춰서 지속적으로 커스터마이징을 해야하는게 개발자의 숙명 아닐까 싶다.\n# 마치며사실 이렇게 시계열 데이터라는 단어나 Prophet같은 오픈소스를 검색할수 있었던건 작년 Elastic{ON}Tour 에서 봤던 Elastic X-pack의 머신러닝 기능 때문이다. 그때 받은 충격(?)이 아직까지 있는건지 이렇게 오픈소스로 비슷하게나마 구현할수 있었던 원동력이 된것 같다. 기회가 되면 X-pack을 구매해서 운영하는 서비스에 머신러닝을 활용해서 이러한 시계열 데이터에 대해 분석해보고싶다.\n","dateCreated":"2018-05-31T17:03:41+09:00","dateModified":"2018-10-17T12:00:52+09:00","datePublished":"2018-05-31T17:03:41+09:00","description":"급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?","headline":"시계열 데이터를 분석하여 미래 예측 하기(Anomaly Detection)","image":["kiyoung_chart.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://taetaetae.github.io/2018/05/31/anomaly-detection/"},"publisher":{"@type":"Organization","name":"taetaetae","sameAs":["https://facebook.com/taetaetae0","https://www.linkedin.com/in/태관-권-517825129/","mailto:taetaetae_@naver.com"],"image":"profile.png","logo":{"@type":"ImageObject","url":"profile.png"}},"url":"https://taetaetae.github.io/2018/05/31/anomaly-detection/","keywords":"python, anomaly detection, elasticsearch, prophet, facebook","thumbnailUrl":"kiyoung_chart.png"}</script>
    <meta name="description" content="급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?">
<meta name="keywords" content="python,anomaly detection,elasticsearch,prophet,facebook">
<meta property="og:type" content="blog">
<meta property="og:title" content="시계열 데이터를 분석하여 미래 예측 하기(Anomaly Detection)">
<meta property="og:url" content="https://taetaetae.github.io/2018/05/31/anomaly-detection/index.html">
<meta property="og:site_name" content="꿈꾸는 태태태의 공간">
<meta property="og:description" content="급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-10-17T03:00:52.456Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="시계열 데이터를 분석하여 미래 예측 하기(Anomaly Detection)">
<meta name="twitter:description" content="급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?">
<meta name="twitter:image" content="https://taetaetae.github.io/2018/05/31/anomaly-detection/pg.png">
    
    
        
    
    
        <meta property="og:image" content="https://taetaetae.github.io/2018/05/31/anomaly-detection/kiyoung_chart.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://taetaetae.github.io/2018/05/31/anomaly-detection/kiyoung_chart.png" />
    
    
    
        <meta property="og:image" content="https://taetaetae.github.io/assets/images/profile.png"/>
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-86432198-1', 'auto');
        ga('send', 'pageview');
    </script>


    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: "ca-pub-5788330009690816",
  enable_page_level_ads: true
  });
</script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">꿈꾸는 태태태의 공간</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/profile.png" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/profile.png" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">taetaetae</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Programmer</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/taetaetae0" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/태관-권-517825129/" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:taetaetae_@naver.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>    
    <ins class="adsbygoogle"
   style="display:inline-block;max-width:250px;width:100%;max-height:300px;height:100%"
   data-ad-client="ca-pub-5788330009690816">
</ins>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    <div class="main-content-wrap">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5788330009690816"
     data-ad-slot="9180895229"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            시계열 데이터를 분석하여 미래 예측 하기(Anomaly Detection)
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2018-05-31T17:03:41+09:00">
	
		    May 31, 2018
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/tech/">tech</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?<br>또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?<br>뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?<br> <a id="more"></a><br>위 질문에 공통된 정답은 <code>예전 기록들</code>인것 같다. 날씨예측은 기상청에서 과거 기록들을 보고 비가 올지 말지를 결정하고 ( 과거 날씨 서비스를 담당해봤지만 단순히 과거 기록들로 예측한다는건 불가능에 가깝긴 하다. ) 매장 운영시간은 예전에 손님들이 언제왔는지에 대한 데이터를 보고. 비트코인이나 주식은 차트를 보고 어느정도는 상승장일지 하락장일지 추측이 가능하다고 한다. ( 물론 호재/악재에 따라 흔들리지만..ㅠㅠ..?? )<br>이처럼 시간의 흐름에 따라 만들어진 데이터를 분석하는것을 <code>시계열 데이터 분석</code>이라 부르고 있다. 필자가 운영하는 서비스에서 시계열 데이터 분석을 통해 장애를 사전에 방지하는 사례를 공유 해보고자 한다.</p>
<h3 id="상황파악부터"><a href="#상황파악부터" class="headerlink" title="# 상황파악부터"></a># 상황파악부터</h3><p>손자병법에는 지피지기 백전불태 라는 말이 있다. 그만큼 현 상황을 잘 알아야 대응을 잘할수 있다는것. 필자가 운영하는 서비스는 PG(Payment Gateway) 서비스로 쇼핑몰같은 온/오프라인 사업자와 실제 카드사와의 중간 역활을 해주고 있다. 이를테면 사용자가 <code>생수를 10,000원에 XX카드로 구매해줘</code> 라고 요청이 오면 그 정보를 다시 형식에 맞춰 카드사로 전달하여 사용자가 물건을 구매할수 있도록 해준다.<br><div class="figure center" style="width:;"><img class="fig-img" src="pg.png" alt="PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다."><span class="image-caption">PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.</span><span class="caption">PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.</span></div></p>
<h3 id="요구사항-및-과거-데이터-분석"><a href="#요구사항-및-과거-데이터-분석" class="headerlink" title="# 요구사항 및 과거 데이터 분석"></a># 요구사항 및 과거 데이터 분석</h3><p>서비스를 운영해보니 감지하기 어려운 상황들이 있었다. </p>
<ul>
<li>연동하는 쇼핑몰에서 문제가 발생하거나 네트워크 문제가 발생할경우 즉, 트래픽이 평소보다 적게 들어올 경우</li>
<li>정상적인 에러(e.g. 잔액부족) 가 갑자기 많이 발생할 경우</li>
</ul>
<p>이를 분석하기위해 기존의 트래픽/데이터를 분석해봐야 했다.<br><div class="figure center" style="width:;"><img class="fig-img" src="trade_count.png" alt="결제건수 Kibana Visualize, 기영이 패턴"><span class="image-caption">결제건수 Kibana Visualize, 기영이 패턴</span><span class="caption">결제건수 Kibana Visualize, 기영이 패턴</span></div><br>위 그래프는 결제데이터 카운트 인데 어느정도 패턴을 찾을수 있다.<br><div class="figure center" style="width:;"><img class="fig-img" src="error_count.png" alt="에러건수 Kibana Visualize, 악어 패턴..(무리수..)"><span class="image-caption">에러건수 Kibana Visualize, 악어 패턴..(무리수..)</span><span class="caption">에러건수 Kibana Visualize, 악어 패턴..(무리수..)</span></div><br>위 그래프는 에러카운트 인데 일정한 패턴 속에서 어느 지점에서는 튀는것을 확인할수 있다. (빨간색 영역) 그렇다면 어떤 방법으로 장애상황보다 앞서서 감지를 할수 있을까? ( 장애 : 어떠한 내/외부 요인으로 인해 정상적인 서비스가 되지 않는 상태 )</p>
<h3 id="장애발생-전에-먼저-찾아보자"><a href="#장애발생-전에-먼저-찾아보자" class="headerlink" title="# 장애발생 전에 먼저 찾아보자!"></a># 장애발생 전에 먼저 찾아보자!</h3><p>가장 간단하게는 기존 데이터를 보고 수동으로 설정하는 방법이 있을수 있다. 예로들어 자정 즈음에는 결제량이 가장 많기때문에 약 xx건으로 설정해두고, 새벽에는 결제량이 가장 적기 때문에 약 yy건으로 설정해둔 후 에러 건수나 결제건수에 대해 실시간으로 검사를 해가면서 설정한 값보다 벗어날 경우 알림을 주는 방법이다.<br>하지만 아무리 과거 데이터를 완벽하게 분석했다 할지라도 24시간 모든 시점에서 예측은 벗어날 수밖에 없다. (예로들어 쇼핑 이벤트를 갑작스럽게 하게되면 결제량은 예측하지 못할정도로 늘어날테고…) 또한 설정한 예측값을 벗어날 경우 수동으로 다시 예측값을 조정해줘야 하는데, 이럴꺼면 24시간 종합 상황실에서 사람이 직접 눈으로 보는것 보다 못할것 같다. (인력 리소스가 충분하다면 뭐… 그렇게 해도 된다.)</p>
<h3 id="지난-데이터와-비교하기"><a href="#지난-데이터와-비교하기" class="headerlink" title="# 지난 데이터와 비교하기"></a># 지난 데이터와 비교하기</h3><p>일주일 기준으로 지난 일주일과의 데이터를 비교해보는 방법또한 있다. 간단하게 설명하면 이번주 월요일 10시의 데이터와 지난주 월요일 10시의 데이터의 차이를 비교해보는 방법이다. 키바나에서 클릭 몇번만으로 시각화를 도와주는 Visualize 기능을 통해 지난 일주일과 이번주를 비교해보면 아래 그래프처럼 표현이 가능하다.<br><div class="figure center" style="width:;"><img class="fig-img" src="visualize.png" alt="일주일 전 데이터와 단순 비교"><span class="image-caption">일주일 전 데이터와 단순 비교</span><span class="caption">일주일 전 데이터와 단순 비교</span></div><br>이 경우도 지난주 상황과 이번주 상황이 다른 경우에는 원하는 비교 항목 외에 다른 요인이 추가되기 때문에 원하는 비교를 할수가 없고 위에서 수동으로 설정하는 방법과 별반 다를바 없을것으로 생각된다.</p>
<h3 id="조금더-우아하게-언제부턴가-우아하단-말을-좋아하는것-같다"><a href="#조금더-우아하게-언제부턴가-우아하단-말을-좋아하는것-같다" class="headerlink" title="# 조금더 우아하게! (언제부턴가 우아하단 말을 좋아하는것 같다..)"></a># 조금더 우아하게! <code>(언제부턴가 우아하단 말을 좋아하는것 같다..)</code></h3><p>개발자는 문제에 대해서 언제나 분석을 토대로 접근을 하는것을 목표로 해야한다. 언제부턴가 Hot한 머신러닝을 도입해 보고 싶었으나 아직 그런 실력이 되질 못하고… 폭풍 구글링을 통해 알게된 Facebook에서 만든 <a href="https://facebook.github.io/prophet/" target="_blank" rel="noopener">Prophet</a>이라는 모듈을 활용해보고자 한다.<br><a href="https://opensource.fb.com/#artificial" target="_blank" rel="noopener">https://opensource.fb.com/#artificial</a> 이곳에 가보면 여러 Artificial Intelligence 관련된 오픈소스들중에 Prophet 모듈을 찾을수 있다. 다행히도 <a href="https://namu.wiki/w/BSD%20%EB%9D%BC%EC%9D%B4%EC%84%A0%EC%8A%A4" target="_blank" rel="noopener">BSD License</a>라서 실무에서도 다양하게 활용할수 있을것으로 보인다. 친절하게도 <code>Quick Start</code>을 통해 어떤식으로 예측을 하는지 보여준다. 참고로 Python 과 R 을 지원한다. (python 의 대단함을 다시금 느끼며…)<br>구성은 CentOS 7 + python3.6 + jenkins 를 활용한다. (python 경험이 부족하므로 코드가 허접할수도 있으니 양해바란다.)<br>데이터 분석시 가장 많이 사용된다는 <code>Pandas</code>와 대규모 다차원 배열을 쉽게 처리 할 수 있게 해주는 <code>numpy</code>, 그리고 <code>bprophet</code>를 비롯한 필요한 모듈들을 pip로 설치해준다.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install pandas</span><br><span class="line">pip install fbprophet</span><br><span class="line">pip install numpy</span><br></pre></td></tr></table></figure></p>
<p>필요한 모듈들을 import를 한다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line">matplotlib.use(<span class="string">'Agg'</span>) // centos 서버 환경에서 돌릴경우 예측결과를 그래프로 보는 과정에서 오류가 발생한다. 이를 방직하기 위해 해당 코드를 적어준다.</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> requests, datetime</span><br><span class="line"><span class="keyword">from</span> fbprophet <span class="keyword">import</span> Prophet</span><br></pre></td></tr></table></figure></p>
<p>기존에 데이터들은 모두 실시간으로 elasticserach에 인덱싱 중이기 때문에 rest api 를 활용하면 쉽게 데이터를 얻을수가 있다. (RDB로 관리를 했더라면… 배보다 배꼽이 더 큰 상황이였지 않았을까 하는 생각이 든다.)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 현재 시 기준 2주 (24 x 14 시간) 전의 데이터를 가져온다.</span></span><br><span class="line">day_gap = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">now_datetime = datetime.datetime.now()</span><br><span class="line">end_time = datetime.datetime(now_datetime.year, now_datetime.month, now_datetime.day, now_datetime.hour, <span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">end_time_stamp = str(int(end_time.timestamp() * <span class="number">1000</span>))</span><br><span class="line">start_time = end_time - datetime.timedelta(days=day_gap)</span><br><span class="line">start_time_stamp = str(int(start_time.timestamp() * <span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://elasticsearch:9200/_msearch'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"Content-Type"</span> : <span class="string">"application/x-ndjson"</span></span><br><span class="line">&#125;</span><br><span class="line">es_data = <span class="string">'&#123;"index":["index_name"]&#125;\n&#123;"size":0,"query":&#123;"bool":&#123;"must":[&#123;"range":&#123;"log_time":&#123;"gte":'</span> + start_time_stamp + <span class="string">',"lte":'</span> + end_time_stamp + <span class="string">'&#125;&#125;&#125;]&#125;&#125;,"aggs":&#123;"2":&#123;"date_histogram":&#123;"field":"log_time","interval":"1h", "time_zone":"Asia/Tokyo"&#125;&#125;&#125;&#125;\n'</span></span><br><span class="line">response_list = requests.post(url=url, headers=headers, data=es_data.encode(<span class="string">'utf-8'</span>)).json()[<span class="string">'responses'</span>][<span class="number">0</span>][<span class="string">'aggregations'</span>][<span class="string">'2'</span>][<span class="string">'buckets'</span>]</span><br><span class="line">print(<span class="string">'기준 : '</span> + str(start_time) + <span class="string">' ~ '</span> + str(end_time))</span><br><span class="line"></span><br><span class="line"><span class="comment"># es 데이터 중 시간값을 형식에 바꾸면서 key-value 형태로 정제한다.</span></span><br><span class="line">query_result = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> response_list :</span><br><span class="line">    query_result[data[<span class="string">'key_as_string'</span>].replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'.000+09:00'</span>, <span class="string">''</span>)] = data[<span class="string">'doc_count'</span>]</span><br></pre></td></tr></table></figure></p>
<p>elasticsearch에서 aggregation을 활용하여 데이터를 1시간 단위로 가져올경우 데이터가 없는 경우를 대비해 비어있는 시간에 해당하는 카운트를 0으로 맞춰주기 위하여 loop를 돌며 데이터를 정제해준다. (이 방법보다 더 좋은 방법이 분명 있을것이다…)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">anomaly_detection_base_data = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> range(<span class="number">24</span> * day_gap) :</span><br><span class="line">    key_date_time = start_time.strftime(<span class="string">'%Y-%m-%d %H:00:00'</span>)</span><br><span class="line">    <span class="keyword">if</span> key_date_time <span class="keyword">in</span> query_result :</span><br><span class="line">        anomaly_detection_base_data[key_date_time] = query_result[key_date_time]</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        anomaly_detection_base_data[key_date_time] = <span class="number">0</span></span><br><span class="line">    start_time = start_time + datetime.timedelta(hours=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>pandas 를 활용하여 데이터를 DataFrame 형식에 맞춰준 다음 <code>시간</code>기준으로 다음 24시간의 데이터를 예측하도록 한다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(list(anomaly_detection_base_data.items()), columns=[<span class="string">'ds'</span>, <span class="string">'y'</span>])</span><br><span class="line">m = Prophet()</span><br><span class="line">m.fit(df)</span><br><span class="line">future = m.make_future_dataframe(periods=<span class="number">24</span> , freq=<span class="string">'H'</span>)</span><br><span class="line">forecast = m.predict(future)</span><br></pre></td></tr></table></figure></p>
<p>실제 집계한 값과 예측값을 비교하여 알림발생 유무를 결정한다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 현재시간 -1시간 전 실제 집계</span></span><br><span class="line">check_datetime = now_datetime - datetime.timedelta(hours=<span class="number">1</span>)</span><br><span class="line">check_datetime = check_datetime.strftime(<span class="string">'%Y-%m-%d %H:00:00'</span>)</span><br><span class="line">check_datetime_count = query_result[check_datetime]</span><br><span class="line">print(<span class="string">'실제 집계수 : '</span> + check_datetime + <span class="string">' → '</span> + str(check_datetime_count))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 예측 최대치</span></span><br><span class="line">forecast_max_count = forecast[forecast.ds == check_datetime][<span class="string">'yhat_upper'</span>].values[<span class="number">0</span>]</span><br><span class="line">print(<span class="string">'예측 최대치 : '</span> + check_datetime  + <span class="string">' → '</span> +  str(forecast_max_count))</span><br></pre></td></tr></table></figure></p>
<p>여기서는 에러 카운트가 평소와는 다르게 발생할 경우에 알림을 발송을 하려 하기때문에 아래처럼 구성을 해준다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> check_datetime_count &gt; forecast_max_count :</span><br><span class="line">  <span class="comment"># 예측한 결과를 이미지로 저장후 알림에 포함시켜준다.</span></span><br><span class="line">  forecast_graph = m.plot(forecast, plot_cap=<span class="keyword">False</span>, xlabel=<span class="string">'time'</span>, ylabel=<span class="string">'count'</span>);</span><br><span class="line">  file_name = <span class="string">'forecast_graph.png'</span></span><br><span class="line">  forecast_graph.savefig(file_name)</span><br></pre></td></tr></table></figure></p>
<p>이런 python script를 jenkins 를 활용하여 1시간에 한번씩 실행될수있도록 구성해 두고 문제가 발생할때는 아래처럼 메일로 알림을 받는다.<br><div class="figure center" style="width:;"><img class="fig-img" src="forecast_graph.png" alt="예측결과"><span class="image-caption">예측결과</span><span class="caption">예측결과</span></div><br>위 그래프를 분석하면 다음과 같다.</p>
<ul>
<li>검정색 점 : 실제 데이터</li>
<li>파란 실선 : 트랜드 그래프</li>
<li>하늘색 음영 : 예측한 최대/최소치의 영역<br>빨간색으로 표시한 점 두개를 보면 예측을 벗어난것을 확인할수 있고 실제로 저 시간대에 내부적 이슈로 인해 에러가 많이 발생한 경우이다. (장애 발생 시점)</li>
</ul>
<p>이런식으로 구성을 해두면 앞서 수동으로 최대/최소 수치를 정해두고 이탈했는지에 대해서 모니터링 하는것보다 훨씬더 우아하게 모니터링을 할수있다.<br>물론 해당 모듈이 완벽하다는 소리는 아니다. 필자도 해당 모듈을 사용하다보니 어떤 경우에서는 예측수치와 실제 데이터가 비슷한 경우가 있어 알람을 받은 경우도 있다. 예전 포스팅에서도 이야기 했듯 정답은 없는것 같다. 상황에 맞춰서 지속적으로 커스터마이징을 해야하는게 개발자의 숙명 아닐까 싶다.</p>
<h3 id="마치며"><a href="#마치며" class="headerlink" title="# 마치며"></a># 마치며</h3><p>사실 이렇게 <code>시계열 데이터</code>라는 단어나 <code>Prophet</code>같은 오픈소스를 검색할수 있었던건 작년 <a href="https://taetaetae.github.io/2017/12/14/elastic-on-tour/">Elastic{ON}Tour 에서 봤던 Elastic X-pack의 머신러닝 기능</a> 때문이다. 그때 받은 충격(?)이 아직까지 있는건지 이렇게 오픈소스로 비슷하게나마 구현할수 있었던 원동력이 된것 같다. 기회가 되면 X-pack을 구매해서 운영하는 서비스에 머신러닝을 활용해서 이러한 시계열 데이터에 대해 분석해보고싶다.</p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5788330009690816"
     data-ad-slot="9180895229"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/anomaly-detection/">anomaly detection</a> <a class="tag tag--primary tag--small t-link" href="/tags/elasticsearch/">elasticsearch</a> <a class="tag tag--primary tag--small t-link" href="/tags/facebook/">facebook</a> <a class="tag tag--primary tag--small t-link" href="/tags/prophet/">prophet</a> <a class="tag tag--primary tag--small t-link" href="/tags/python/">python</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/06/27/apache-vs-nginx/" data-tooltip="Apache냐 Nginx냐, 그것이 알고싶다." aria-label="PREVIOUS: Apache냐 Nginx냐, 그것이 알고싶다.">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/04/29/apache-408-response-code/" data-tooltip="아파치 엑세스 로그에 408코드가?" aria-label="NEXT: 아파치 엑세스 로그에 408코드가?">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://taetaetae.github.io/2018/05/31/anomaly-detection/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://taetaetae.github.io/2018/05/31/anomaly-detection/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://taetaetae.github.io/2018/05/31/anomaly-detection/" title="Share on Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 taetaetae. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/06/27/apache-vs-nginx/" data-tooltip="Apache냐 Nginx냐, 그것이 알고싶다." aria-label="PREVIOUS: Apache냐 Nginx냐, 그것이 알고싶다.">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/04/29/apache-408-response-code/" data-tooltip="아파치 엑세스 로그에 408코드가?" aria-label="NEXT: 아파치 엑세스 로그에 408코드가?">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://taetaetae.github.io/2018/05/31/anomaly-detection/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://taetaetae.github.io/2018/05/31/anomaly-detection/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://taetaetae.github.io/2018/05/31/anomaly-detection/" title="Share on Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="5">
    <i id="btn-close-shareoptions" class="fa fa-times"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://taetaetae.github.io/2018/05/31/anomaly-detection/">
                    <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://taetaetae.github.io/2018/05/31/anomaly-detection/">
                    <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://taetaetae.github.io/2018/05/31/anomaly-detection/">
                    <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.png" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">taetaetae</h4>
        
            <div id="about-card-bio"><p>Programmer</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Naver Corp.</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                korea
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover_2.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'https://taetaetae.github.io/2018/05/31/anomaly-detection/';
                 
                    this.page.identifier = '2018/05/31/anomaly-detection/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'taetaetae';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    



    </body>
</html>
